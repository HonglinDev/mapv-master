{"version":3,"file":"mapv.js","sources":["version.js","../src/canvas/clear.ts","../src/canvas/resolutionScale.ts","../src/utils/Event.ts","../src/utils/cityCenter.ts","../src/data/DataSet.ts","../src/canvas/shape/honeycomb.ts","../src/canvas/path/simple.ts","../src/canvas/draw/simple.ts","../src/utils/Canvas.ts","../src/utils/data-range/Intensity.ts","../src/utils/window.ts","../src/canvas/draw/heatmap.ts","../src/canvas/draw/grid.ts","../src/canvas/draw/honeycomb.ts","../src/webgl/draw/util.js","../src/webgl/draw/line.js","../src/webgl/draw/point.js","../src/webgl/draw/earcut.js","../src/webgl/draw/polygon.js","../src/webgl/draw/simple.js","../src/utils/curve.ts","../src/utils/forceEdgeBundling.js","../src/utils/data-range/Category.ts","../src/utils/data-range/Choropleth.ts","../src/map/mapHelper.js","../src/map/baidu-map/CanvasLayer.js","../src/utils/Tween.ts","../src/utils/index.ts","../src/canvas/draw/arrow.ts","../src/canvas/draw/clip.ts","../src/canvas/draw/cluster.ts","../src/canvas/draw/text.ts","../src/canvas/draw/icon.ts","../src/utils/supercluster.js","../src/map/BaseLayer.ts","../src/map/baidu-map/AnimationLayer.js","../src/map/baidu-map/Layer.js","../src/map/google-map/CanvasLayer.js","../src/map/google-map/Layer.js","../src/map/maptalks-map/Layer.js","../src/map/gaode-map/Layer.js","../src/map/openlayers-map/Layer.js","../src/map/leaflet-map/MapVRenderer.js","../src/map/leaflet-map/Layer.js","../src/map/cesium/MapVRenderer.js","../src/map/cesium/Layer.js","../src/data/geojson.ts","../src/data/csv.ts"],"sourcesContent":["export var version = \"2.0.62\";\n","/**\n * 清除Canvas画布\n * @author kyle / http://nikai.us/\n */\n\n/**\n * 清除整个Canvas画布\n * @param {CanvasRenderingContext2D} context - Canvas上下文\n */\nexport default function clear(context: CanvasRenderingContext2D): void {\n    if (context && context.clearRect && context.canvas) {\n        context.clearRect(0, 0, context.canvas.width, context.canvas.height);\n    }\n    //context.canvas.width = context.canvas.width;\n    //context.canvas.height = context.canvas.height;\n}\n\n/**\n * 清除Canvas指定区域\n * @param {CanvasRenderingContext2D} context - Canvas上下文\n * @param {number} x - 清除区域左上角X坐标\n * @param {number} y - 清除区域左上角Y坐标\n * @param {number} width - 清除区域宽度\n * @param {number} height - 清除区域高度\n */\nexport function clearRect(\n    context: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    width: number,\n    height: number\n): void {\n    if (context && context.clearRect) {\n        context.clearRect(x, y, width, height);\n    }\n}","/**\n * 分辨率缩放模块\n * @author kyle / http://nikai.us/\n */\n\n/**\n * 调整画布分辨率以适配设备像素比\n * @param context Canvas上下文\n */\nexport default function (context: CanvasRenderingContext2D): void {\n    const devicePixelRatio = window.devicePixelRatio || 1;\n    \n    // 调整画布实际尺寸\n    context.canvas.width = context.canvas.width * devicePixelRatio;\n    context.canvas.height = context.canvas.height * devicePixelRatio;\n    \n    // 保持画布显示尺寸不变\n    context.canvas.style.width = context.canvas.width / devicePixelRatio + 'px';\n    context.canvas.style.height = context.canvas.height / devicePixelRatio  + 'px';\n    \n    // 缩放上下文\n    context.scale(devicePixelRatio, devicePixelRatio);\n}\n\n/**\n * 获取设备像素比\n * @returns 设备像素比\n */\nexport function getDevicePixelRatio(): number {\n    return window.devicePixelRatio || 1;\n}\n\n/**\n * 缩放上下文但不改变画布尺寸\n * @param context Canvas上下文\n * @returns 设备像素比\n */\nexport function scaleContext(context: CanvasRenderingContext2D): number {\n    const devicePixelRatio = window.devicePixelRatio || 1;\n    context.scale(devicePixelRatio, devicePixelRatio);\n    return devicePixelRatio;\n}","/*\n * @Author: 李红林 1770679549@qq.com\n * @Date: 2025-12-01 14:42:23\n * @LastEditors: 李红林 1770679549@qq.com\n * @LastEditTime: 2025-12-01 15:27:41\n * @FilePath: \\mapv-master\\src\\utils\\Event.ts\n * @Description: \n * \n */\n\n// 定义事件回调函数类型\nexport type EventCallback = (event: string, params: any, senderId: string | null) => void;\n\n// 定义订阅者类型\nexport interface Subscriber {\n    callback: EventCallback;\n}\n\n// 定义事件类\nexport default class Event {\n    private _subscribers: { [event: string]: Subscriber[] };\n\n    constructor() {\n        this._subscribers = {};  // 事件订阅者集合\n    }\n\n    /**\n     * 订阅事件，添加事件监听器\n     * @param {String} event        事件名称。可用事件: 'put', 'update', 'remove'\n     * @param {function} callback   回调方法。接收三个参数:\n     *                                  {String} event - 事件名称\n     *                                  {Object | null} params - 事件参数\n     *                                  {String | Number} senderId - 发送者ID\n     */\n    on(event: string, callback: EventCallback): void {\n        let subscribers = this._subscribers[event];\n        if (!subscribers) {\n            subscribers = [];\n            this._subscribers[event] = subscribers;\n        }\n\n        subscribers.push({\n            callback: callback\n        });\n    }\n\n    /**\n     * 取消订阅事件，移除事件监听器\n     * @param {String} event - 事件名称\n     * @param {function} callback - 回调函数\n     */\n    off(event: string, callback: EventCallback): void {\n        const subscribers = this._subscribers[event];\n        if (subscribers) {\n            //this._subscribers[event] = subscribers.filter(listener => listener.callback != callback);\n            for (let i = 0; i < subscribers.length; i++) {\n                if (subscribers[i].callback === callback) {\n                    subscribers.splice(i, 1);\n                    i--;\n                }\n            }\n        }\n    }\n\n    /**\n     * 触发事件\n     * @param {String} event - 事件名称\n     * @param {Object | null} params - 事件参数\n     * @param {String} [senderId] - 可选的发送者ID\n     * @private\n     */\n    protected _trigger(event: string, params: any, senderId?: string): void {\n        if (event === '*') {\n            throw new Error('不能触发事件 *');\n        }\n\n        const subscribers: Subscriber[] = [];\n        if (event in this._subscribers) {\n            subscribers.push(...this._subscribers[event]);\n        }\n        if ('*' in this._subscribers) {\n            subscribers.push(...this._subscribers['*']);\n        }\n\n        for (let i = 0, len = subscribers.length; i < len; i++) {\n            const subscriber = subscribers[i];\n            if (subscriber.callback) {\n                subscriber.callback(event, params, senderId || null);\n            }\n        }\n    }\n\n    /**\n     * 将事件方法绑定到对象\n     * @param {Object} obj - 要绑定事件方法的对象\n     */\n    static bind(obj: any): void {\n        const event = new Event();\n        obj.on = event.on.bind(event);\n        obj.off = event.off.bind(event);\n        obj._trigger = event._trigger.bind(event);\n        obj._subscribers = event._subscribers;\n    }\n}\n","/**\n * 根据城市名称获取中心坐标\n * @author kyle / http://nikai.us/\n */\n\n// 定义城市数据接口\ninterface City {\n    n: string; // 城市名称\n    g: string; // 地理坐标和缩放级别\n    cities?: City[]; // 下属城市列表（仅省份有）\n}\n\n// 定义城市中心数据结构\ninterface CityCenterData {\n    municipalities: City[]; // 直辖市\n    provinces: City[]; // 省份\n    other: City[]; // 其他地区\n}\n\n// 城市中心数据\nconst citycenter: CityCenterData = {\n    municipalities: [\n        {n: \"北京\", g: \"116.395645,39.929986|12\"},\n        {n: \"上海\", g: \"121.487899,31.249162|12\"},\n        {n: \"天津\", g: \"117.210813,39.14393|12\"},\n        {n: \"重庆\", g: \"106.530635,29.544606|12\"}\n    ],\n    provinces: [\n        {n: \"安徽\", g: \"117.216005,31.859252|8\", cities: [{n: \"合肥\", g: \"117.282699,31.866942|12\"}]},\n        {n: \"福建\", g: \"117.984943,26.050118|8\", cities: [{n: \"福州\", g: \"119.330221,26.047125|12\"}]},\n        {n: \"广东\", g: \"113.394818,23.408004|8\", cities: [{n: \"广州\", g: \"113.30765,23.120049|12\"}]},\n        {n: \"广西\", g: \"108.671981,23.745228|8\", cities: [{n: \"南宁\", g: \"108.377632,22.81689|12\"}]},\n        {n: \"贵州\", g: \"106.713478,26.578343|8\", cities: [{n: \"贵阳\", g: \"106.713478,26.578343|12\"}]},\n        {n: \"海南\", g: \"110.33119,20.031971|8\", cities: [{n: \"海口\", g: \"110.33119,20.031971|12\"}]},\n        {n: \"河北\", g: \"114.514862,38.042818|8\", cities: [{n: \"石家庄\", g: \"114.514862,38.042818|12\"}]},\n        {n: \"河南\", g: \"113.625368,34.746599|8\", cities: [{n: \"郑州\", g: \"113.625368,34.746599|12\"}]},\n        {n: \"黑龙江\", g: \"126.642464,45.756967|8\", cities: [{n: \"哈尔滨\", g: \"126.642464,45.756967|12\"}]},\n        {n: \"湖北\", g: \"114.305393,30.59285|8\", cities: [{n: \"武汉\", g: \"114.305393,30.59285|12\"}]},\n        {n: \"湖南\", g: \"112.93881,28.22808|8\", cities: [{n: \"长沙\", g: \"112.93881,28.22808|12\"}]},\n        {n: \"吉林\", g: \"125.3245,43.817075|8\", cities: [{n: \"长春\", g: \"125.3245,43.817075|12\"}]},\n        {n: \"江苏\", g: \"118.796877,32.060255|8\", cities: [{n: \"南京\", g: \"118.796877,32.060255|12\"}]},\n        {n: \"江西\", g: \"115.858198,28.682025|8\", cities: [{n: \"南昌\", g: \"115.858198,28.682025|12\"}]},\n        {n: \"辽宁\", g: \"123.43286,41.805698|8\", cities: [{n: \"沈阳\", g: \"123.43286,41.805698|12\"}]},\n        {n: \"内蒙古\", g: \"111.670801,40.818311|6\", cities: [{n: \"呼和浩特\", g: \"111.670801,40.818311|12\"}]},\n        {n: \"宁夏\", g: \"106.258357,38.468011|6\", cities: [{n: \"银川\", g: \"106.258357,38.468011|12\"}]},\n        {n: \"青海\", g: \"101.778245,36.623178|6\", cities: [{n: \"西宁\", g: \"101.778245,36.623178|12\"}]},\n        {n: \"山东\", g: \"117.000923,36.675807|8\", cities: [{n: \"济南\", g: \"117.000923,36.675807|12\"}]},\n        {n: \"山西\", g: \"112.54884,37.857014|8\", cities: [{n: \"太原\", g: \"112.54884,37.857014|12\"}]},\n        {n: \"陕西\", g: \"108.939751,34.341568|8\", cities: [{n: \"西安\", g: \"108.939751,34.341568|12\"}]},\n        {n: \"四川\", g: \"104.065735,30.570206|8\", cities: [{n: \"成都\", g: \"104.065735,30.570206|12\"}]},\n        {n: \"西藏\", g: \"91.117514,29.646921|6\", cities: [{n: \"拉萨\", g: \"91.117514,29.646921|12\"}]},\n        {n: \"新疆\", g: \"87.616842,43.825592|6\", cities: [{n: \"乌鲁木齐\", g: \"87.616842,43.825592|12\"}]},\n        {n: \"云南\", g: \"102.832891,24.880058|8\", cities: [{n: \"昆明\", g: \"102.832891,24.880058|12\"}]},\n        {n: \"浙江\", g: \"120.153576,30.287459|8\", cities: [{n: \"杭州\", g: \"120.153576,30.287459|12\"}]}\n    ],\n    other: [\n        {n: \"钓鱼岛\", g: \"123.474498,25.746388|15\"},\n        {n: \"三沙\", g: \"112.338941,16.834872|14\"}\n    ]\n};\n\n// 定义坐标接口\ninterface Coordinate {\n    lng: number; // 经度\n    lat: number; // 纬度\n}\n\n/**\n * 解析地理坐标字符串\n * @param {string} g - 地理坐标字符串，格式为\"lng,lat|zoom\"\n * @returns {Coordinate} - 解析后的坐标对象\n */\nfunction getCenter(g: string): Coordinate {\n    const item = g.split(\"|\");\n    const coords = item[0].split(\",\");\n    return {\n        lng: parseFloat(coords[0]),\n        lat: parseFloat(coords[1])\n    };\n}\n\n/**\n * 根据城市名称获取省份名称\n * @param {string} name - 城市名称\n * @returns {string | null} - 省份名称，找不到返回null\n */\nexport function getProvinceNameByCityName(name: string): string | null {\n    const provinces = citycenter.provinces;\n    for (let i = 0; i < provinces.length; i++) {\n        const provinceName = provinces[i].n;\n        const cities = provinces[i].cities || [];\n        for (let j = 0; j < cities.length; j++) {\n            if (cities[j].n === name) {\n                return provinceName;\n            }\n        }\n    }\n    return null;\n}\n\n/**\n * 根据城市名称获取城市中心坐标\n * @param {string} name - 城市名称\n * @returns {Coordinate | null} - 城市中心坐标，找不到返回null\n */\nexport function getCenterByCityName(name: string): Coordinate | null {\n    // 移除城市名称中的\"市\"字\n    name = name.replace('市', '');\n    \n    // 先查找直辖市\n    for (let i = 0; i < citycenter.municipalities.length; i++) {\n        if (citycenter.municipalities[i].n === name) {\n            return getCenter(citycenter.municipalities[i].g);\n        }\n    }\n    \n    // 查找其他地区\n    for (let i = 0; i < citycenter.other.length; i++) {\n        if (citycenter.other[i].n === name) {\n            return getCenter(citycenter.other[i].g);\n        }\n    }\n    \n    // 查找省份和下属城市\n    const provinces = citycenter.provinces;\n    for (let i = 0; i < provinces.length; i++) {\n        // 先查找省份\n        if (provinces[i].n === name) {\n            return getCenter(provinces[i].g);\n        }\n        \n        // 查找下属城市\n        const cities = provinces[i].cities || [];\n        for (let j = 0; j < cities.length; j++) {\n            if (cities[j].n === name) {\n                return getCenter(cities[j].g);\n            }\n        }\n    }\n    \n    return null;\n}\n\nexport default {\n    getProvinceNameByCityName,\n    getCenterByCityName\n};","import Event from \"../utils/Event\";\nimport cityCenter from \"../utils/cityCenter\";\n\n// 定义地理数据类型\nexport type GeometryType = 'Point' | 'LineString' | 'Polygon' | 'MultiLineString' | 'MultiPolygon';\n\n// 定义坐标类型\nexport type Coordinate = [number, number];\nexport type LineCoordinates = Coordinate[];\nexport type PolygonCoordinates = LineCoordinates[];\nexport type MultiPolygonCoordinates = PolygonCoordinates[];\n\n// 定义几何接口\nexport interface Geometry {\n    type: GeometryType;\n    coordinates: Coordinate | LineCoordinates | PolygonCoordinates | MultiPolygonCoordinates;\n    [key: string]: any;\n}\n\n// 定义数据项接口\nexport interface DataItem {\n    geometry?: Geometry;\n    lng?: number;\n    lat?: number;\n    city?: string;\n    time?: number | string;\n    [key: string]: any;\n}\n\n// 定义数据集选项接口\nexport interface DataSetOptions {\n    [key: string]: any;\n}\n\n// 定义get方法参数接口\nexport interface DataSetGetArgs {\n    filter?: (item: DataItem) => boolean;\n    transferCoordinate?: (coordinate: Coordinate) => Coordinate;\n    fromColumn?: string;\n    toColumn?: string;\n}\n\n// 定义update方法参数接口\nexport interface DataSetUpdateCondition {\n    [key: string]: any;\n}\n\nexport default class DataSet {\n    private _options: DataSetOptions;\n    private _data: DataItem[];\n    private _dataCache: DataItem[];\n\n    /**\n     * 构造函数\n     * @param data 初始数据，可以是单个数据项或数据项数组\n     * @param options 数据集配置选项\n     */\n    constructor(data?: DataItem | DataItem[], options?: DataSetOptions) {\n        (Event as any).bind(this)();\n\n        this._options = options || {};\n        this._data = []; // 存储数据的数组\n        this._dataCache = [];\n\n        // 提供初始数据时添加数据\n        if (data) {\n            this.add(data);\n        }\n    }\n\n    /**\n     * 添加数据\n     * @param data 要添加的数据，可以是单个数据项或数据项数组\n     * @param senderId 发送者ID（预留参数）\n     */\n    add(data: DataItem | DataItem[], senderId?: any): void {\n        if (Array.isArray(data)) {\n            // 处理数组数据\n            for (let i = 0, len = data.length; i < len; i++) {\n                if (data[i]) {\n                    if (data[i].time && typeof data[i].time === 'string') {\n                        const timeStr = data[i].time as string;\n                        if (timeStr.length === 14 && timeStr.substr(0, 2) === '20') {\n                            data[i].time = new Date(timeStr.substr(0, 4) + '-' + timeStr.substr(4, 2) + '-' + timeStr.substr(6, 2) + ' ' + timeStr.substr(8, 2) + ':' + timeStr.substr(10, 2) + ':' + timeStr.substr(12, 2)).getTime();\n                        }\n                    }\n                    this._data.push(data[i]);\n                }\n            }\n        } else if (typeof data === 'object' && data !== null) {\n            // 处理单个数据项\n            this._data.push(data);\n        } else {\n            throw new Error('未知的数据类型');\n        }\n\n        this._dataCache = JSON.parse(JSON.stringify(this._data));\n    }\n\n    /**\n     * 重置数据到初始状态\n     */\n    reset(): void {\n        this._data = JSON.parse(JSON.stringify(this._dataCache));\n    }\n\n    /**\n     * 获取数据\n     * @param args 参数配置\n     * @returns 处理后的数据数组\n     */\n    get(args?: DataSetGetArgs): DataItem[] {\n        args = args || {};\n\n        // 获取数据引用\n        let data = this._data;\n\n        // 应用过滤条件\n        if (args.filter) {\n            const newData: DataItem[] = [];\n            for (let i = 0; i < data.length; i++) {\n                if (args.filter(data[i])) {\n                    newData.push(data[i]);\n                }\n            }\n            data = newData;\n        }\n\n        // 转换坐标\n        if (args.transferCoordinate) {\n            data = this.transferCoordinate(data, args.transferCoordinate, args.fromColumn, args.toColumn);\n        }\n\n        return data;\n    }\n\n    /**\n     * 设置数据\n     * @param data 要设置的数据，可以是单个数据项或数据项数组\n     */\n    set(data: DataItem | DataItem[]): void {\n        this._set(data);\n        (this as any)._trigger('change');\n    }\n\n    /**\n     * 内部设置数据方法\n     * @param data 要设置的数据，可以是单个数据项或数据项数组\n     */\n    private _set(data: DataItem | DataItem[]): void {\n        this.clear();\n        this.add(data);\n    }\n\n    /**\n     * 清空数据\n     * @param args 参数配置（预留）\n     */\n    clear(args?: any): void {\n        this._data = []; // 清空数据数组\n    }\n\n    /**\n     * 更新数据\n     * @param cbk 更新回调函数\n     * @param condition 更新条件\n     */\n    update(cbk: (item: DataItem) => void, condition?: DataSetUpdateCondition): void {\n        const data = this._data;\n        for (let i = 0; i < data.length; i++) {\n            if (condition) {\n                let flag = true;\n                for (const key in condition) {\n                    if (data[i][key] != condition[key]) {\n                        flag = false;\n                    }\n                }\n                if (flag) {\n                    cbk && cbk(data[i]);\n                }\n            } else {\n                cbk && cbk(data[i]);\n            }\n        }\n\n        this._dataCache = JSON.parse(JSON.stringify(this._data));\n\n        (this as any)._trigger('change');\n    }\n\n    /**\n     * 转换坐标\n     * @param data 要转换的数据数组\n     * @param transferFn 坐标转换函数\n     * @param fromColumn 源坐标列名\n     * @param toColumnName 目标坐标列名\n     * @returns 转换后的数据数组\n     */\n    transferCoordinate(data: DataItem[], transferFn: (coordinate: Coordinate) => Coordinate, fromColumn?: string, toColumnName?: string): DataItem[] {\n        toColumnName = toColumnName || '_coordinates';\n        fromColumn = fromColumn || 'coordinates';\n\n        for (let i = 0; i < data.length; i++) {\n            const geometry = data[i].geometry;\n            if (!geometry) continue;\n            \n            const coordinates = geometry[fromColumn];\n            switch (geometry.type) {\n                case 'Point':\n                    geometry[toColumnName] = transferFn(coordinates as Coordinate);\n                    break;\n                case 'LineString':\n                    const newLineCoordinates: Coordinate[] = [];\n                    for (let j = 0; j < (coordinates as LineCoordinates).length; j++) {\n                        newLineCoordinates.push(transferFn((coordinates as LineCoordinates)[j]));\n                    }\n                    geometry[toColumnName] = newLineCoordinates;\n                    break;\n                case 'MultiLineString':\n                case 'Polygon':\n                    const newPolygonCoordinates = this.getPolygon(coordinates as PolygonCoordinates, transferFn);\n                    geometry[toColumnName] = newPolygonCoordinates;\n                    break;\n                case 'MultiPolygon':\n                    const newMultiPolygonCoordinates: PolygonCoordinates[] = [];\n                    for (let c = 0; c < (coordinates as MultiPolygonCoordinates).length; c++) {\n                        const polygon = (coordinates as MultiPolygonCoordinates)[c];\n                        const newPolygon = this.getPolygon(polygon, transferFn);\n                        newMultiPolygonCoordinates.push(newPolygon);\n                    }\n                    geometry[toColumnName] = newMultiPolygonCoordinates;\n                    break;\n            }\n        }\n\n        return data;\n    }\n\n    /**\n     * 处理多边形坐标转换\n     * @param coordinates 多边形坐标数组\n     * @param transferFn 坐标转换函数\n     * @returns 转换后的多边形坐标数组\n     */\n    private getPolygon(coordinates: PolygonCoordinates, transferFn: (coordinate: Coordinate) => Coordinate): PolygonCoordinates {\n        const newCoordinates: PolygonCoordinates = [];\n        for (let c = 0; c < coordinates.length; c++) {\n            const coordinate = coordinates[c];\n            const newcoordinate: Coordinate[] = [];\n            for (let j = 0; j < coordinate.length; j++) {\n                newcoordinate.push(transferFn(coordinate[j]));\n            }\n            newCoordinates.push(newcoordinate);\n        }\n        return newCoordinates;\n    }\n\n    /**\n     * 初始化几何信息\n     * @param transferFn 自定义几何转换函数\n     */\n    initGeometry(transferFn?: (item: DataItem) => Geometry): void {\n        if (transferFn) {\n            this._data.forEach((item) => {\n                item.geometry = transferFn(item);\n            });\n        } else {\n            this._data.forEach((item) => {\n                if (!item.geometry) {\n                    if (item.lng !== undefined && item.lat !== undefined) {\n                        item.geometry = {\n                            type: 'Point',\n                            coordinates: [item.lng, item.lat]\n                        };\n                    } else if (item.city) {\n                        const center = cityCenter.getCenterByCityName(item.city);\n                        if (center) {\n                            item.geometry = {\n                                type: 'Point',\n                                coordinates: [center.lng, center.lat]\n                            };\n                        }\n                    }\n                }\n            });\n        }\n    }\n\n    /**\n     * 获取当前列的最大值\n     * @param columnName 列名\n     * @returns 最大值或undefined\n     */\n    getMax(columnName: string): number | undefined {\n        const data = this._data;\n\n        if (!data || data.length <= 0) {\n            return undefined;\n        }\n\n        let max = parseFloat(data[0][columnName]);\n\n        for (let i = 1; i < data.length; i++) {\n            const value = parseFloat(data[i][columnName]);\n            if (value > max) {\n                max = value;\n            }\n        }\n\n        return max;\n    }\n\n    /**\n     * 获取当前列的总和\n     * @param columnName 列名\n     * @returns 总和或undefined\n     */\n    getSum(columnName: string): number | undefined {\n        const data = this._data;\n\n        if (!data || data.length <= 0) {\n            return undefined;\n        }\n\n        let sum = 0;\n\n        for (let i = 0; i < data.length; i++) {\n            if (data[i][columnName]) {\n                sum += parseFloat(data[i][columnName]);\n            }\n        }\n\n        return sum;\n    }\n\n    /**\n     * 获取当前列的最小值\n     * @param columnName 列名\n     * @returns 最小值或undefined\n     */\n    getMin(columnName: string): number | undefined {\n        const data = this._data;\n\n        if (!data || data.length <= 0) {\n            return undefined;\n        }\n\n        let min = parseFloat(data[0][columnName]);\n\n        for (let i = 1; i < data.length; i++) {\n            const value = parseFloat(data[i][columnName]);\n            if (value < min) {\n                min = value;\n            }\n        }\n\n        return min;\n    }\n\n    /**\n     * 获取去重的数据\n     * @param columnName 列名\n     * @returns 去重后的字符串数组或undefined\n     */\n    getUnique(columnName: string): string[] | undefined {\n        const data = this._data;\n\n        if (!data || data.length <= 0) {\n            return undefined;\n        }\n\n        const maps: { [key: string]: boolean } = {};\n\n        for (let i = 1; i < data.length; i++) {\n            maps[data[i][columnName]] = true;\n        }\n\n        const result: string[] = [];\n        for (const key in maps) {\n            result.push(key);\n        }\n\n        return result;\n    }\n\n    /**\n     * 获取平均值\n     * @param columnName 列名\n     * @returns 平均值\n     */\n    getAverage(columnName: string): number {\n        const data = this._data;\n\n        if (!data || data.length <= 0) {\n            return 0;\n        }\n\n        let sum = 0;\n        let count = 0;\n\n        for (let i = 0; i < data.length; i++) {\n            if (data[i][columnName] !== undefined) {\n                sum += parseFloat(data[i][columnName]);\n                count++;\n            }\n        }\n\n        return count > 0 ? sum / count : 0;\n    }\n\n    /**\n     * 数据排序\n     * @param columnName 排序列名\n     * @param order 排序方式 'asc' 或 'desc'\n     */\n    sort(columnName: string, order: 'asc' | 'desc' = 'asc'): void {\n        this._data.sort((a, b) => {\n            const aVal = parseFloat(a[columnName]);\n            const bVal = parseFloat(b[columnName]);\n            \n            if (order === 'desc') {\n                return bVal - aVal;\n            }\n            return aVal - bVal;\n        });\n        \n        (this as any)._trigger('change');\n    }\n\n    /**\n     * 数据分页\n     * @param page 页码（从1开始）\n     * @param pageSize 每页数据条数\n     * @returns 分页后的数据数组\n     */\n    getPage(page: number, pageSize: number): DataItem[] {\n        const start = (page - 1) * pageSize;\n        const end = start + pageSize;\n        return this._data.slice(start, end);\n    }\n\n    /**\n     * 获取数据总数\n     * @returns 数据总数\n     */\n    getTotal(): number {\n        return this._data.length;\n    }\n\n    /**\n     * 数据分组\n     * @param columnName 分组列名\n     * @returns 分组后的对象，键为分组值，值为对应的数据数组\n     */\n    groupBy(columnName: string): { [key: string]: DataItem[] } {\n        const groups: { [key: string]: DataItem[] } = {};\n        \n        this._data.forEach(item => {\n            const key = item[columnName];\n            if (!groups[key]) {\n                groups[key] = [];\n            }\n            groups[key].push(item);\n        });\n        \n        return groups;\n    }\n\n    /**\n     * 查找数据\n     * @param predicate 查找条件函数\n     * @returns 找到的第一个数据项或null\n     */\n    find(predicate: (item: DataItem) => boolean): DataItem | null {\n        for (let i = 0; i < this._data.length; i++) {\n            if (predicate(this._data[i])) {\n                return this._data[i];\n            }\n        }\n        return null;\n    }\n\n    /**\n     * 查找所有匹配的数据\n     * @param predicate 查找条件函数\n     * @returns 所有匹配的数据项数组\n     */\n    findAll(predicate: (item: DataItem) => boolean): DataItem[] {\n        return this._data.filter(predicate);\n    }\n\n    /**\n     * 数据映射转换\n     * @param mapper 映射函数\n     * @returns 映射后的数组\n     */\n    map<T>(mapper: (item: DataItem, index: number, array: DataItem[]) => T): T[] {\n        return this._data.map(mapper);\n    }\n\n    /**\n     * 数据过滤\n     * @param predicate 过滤函数\n     * @returns 过滤后的数组\n     */\n    filter(predicate: (item: DataItem, index: number, array: DataItem[]) => boolean): DataItem[] {\n        return this._data.filter(predicate);\n    }\n}\n","/**\n * 蜂窝形状绘制模块\n */\n\n// 定义中心点接口\ninterface Point {\n    x: number;\n    y: number;\n}\n\n/**\n * 计算六边形的角点坐标\n * @param center 中心点\n * @param size 六边形大小\n * @param i 角点索引（0-5）\n * @returns 角点坐标\n */\nfunction hex_corner(center: Point, size: number, i: number): number[] {\n    const angle_deg = 60 * i + 30;\n    const angle_rad = Math.PI / 180 * angle_deg;\n    return [center.x + size * Math.cos(angle_rad), center.y + size * Math.sin(angle_rad)];\n}\n\n/**\n * 绘制六边形\n * @param context Canvas上下文\n * @param x 中心点x坐标\n * @param y 中心点y坐标\n * @param size 六边形大小\n */\nfunction draw(context: CanvasRenderingContext2D, x: number, y: number, size: number): void {\n    for (let j = 0; j < 6; j++) {\n        const result = hex_corner({\n            x: x,\n            y: y\n        }, size, j);\n\n        context.lineTo(result[0], result[1]);\n    }\n}\n\nexport {draw};","/**\n * 简单路径绘制模块\n * @author kyle / http://nikai.us/\n */\n\nimport DataSet from \"../../data/DataSet\";\nimport {draw as drawHoneycomb} from \"../shape/honeycomb\";\n\n// 导入DataSet中的DataItem类型\nimport { DataItem as DataSetDataItem } from \"../../data/DataSet\";\n\n// 定义数据项接口，扩展自DataSetDataItem\ninterface DataItem extends DataSetDataItem {\n    symbol?: string;\n    size?: number;\n    _size?: number;\n    image?: ImageOptions;\n}\n\n// 定义图片选项接口\ninterface ImageOptions {\n    url?: string;\n    width?: number;\n    height?: number;\n    [key: string]: any;\n}\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    symbol?: string;\n    size?: number;\n    _size?: number;\n    bigData?: string;\n    multiPolygonDraw?: () => boolean | void;\n    image?: ImageOptions;\n    gradient?: Record<string, string>;\n    [key: string]: any; // 支持动态属性\n}\n\nexport default {\n    /**\n     * 绘制数据集\n     * @param context Canvas上下文\n     * @param dataSet 数据集\n     * @param options 绘制选项\n     */\n    drawDataSet: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 获取数据\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n\n        // 遍历绘制每个数据项\n        for (let i = 0, len = data.length; i < len; i++) {\n            const item = data[i];\n            this.draw(context, item, options);\n        }\n    },\n    \n    /**\n     * 绘制单个数据项\n     * @param context Canvas上下文\n     * @param data 数据项\n     * @param options 绘制选项\n     * @returns 布尔值或undefined\n     */\n    draw: function (context: CanvasRenderingContext2D, data: DataItem, options: DrawOptions): boolean | void {\n        // 确保geometry存在\n        if (!data.geometry) return;\n        \n        const type = data.geometry.type;\n        const coordinates = data.geometry._coordinates || data.geometry.coordinates;\n        const symbol = data.symbol || options.symbol || 'circle';\n        \n        // 根据几何类型绘制\n        switch (type) {\n            case 'Point':\n                const size = data._size || data.size || options._size || options.size || 5;\n                \n                // 根据符号类型绘制\n                if (symbol === 'circle') {\n                    if (options.bigData === 'Point') {\n                        context.moveTo(coordinates[0], coordinates[1]);\n                    }\n                    context.arc(coordinates[0], coordinates[1], size, 0, Math.PI * 2);\n                } else if (symbol === 'rect') {\n                    context.rect(coordinates[0] - size / 2, coordinates[1] - size / 2, size, size);\n                } else if (symbol === 'honeycomb') {\n                    drawHoneycomb(context, coordinates[0], coordinates[1], size);\n                } else if (symbol === 'image') {\n                    // 支持图片标记\n                    this.drawImageMarker(context, data, options);\n                }\n                break;\n            case 'LineString':\n                this.drawLineString(context, coordinates as number[][]);\n                break;\n            case 'MultiLineString':\n                for (let i = 0; i < (coordinates as number[][][]).length; i++) {\n                    const lineString = (coordinates as number[][][])[i];\n                    this.drawLineString(context, lineString);\n                }\n                break;\n            case 'Polygon':\n                this.drawPolygon(context, coordinates as number[][][]);\n                break;\n            case 'MultiPolygon':\n                for (let i = 0; i < (coordinates as number[][][][]).length; i++) {\n                    const polygon = (coordinates as number[][][][])[i];\n                    this.drawPolygon(context, polygon);\n                    if (options.multiPolygonDraw) {\n                        const flag = options.multiPolygonDraw();\n                        if (flag) {\n                            return flag;\n                        }\n                    }\n                }\n                break;\n            default:\n                console.error('类型 ' + type + ' 目前不支持！');\n                break;\n        }\n    },\n\n    /**\n     * 绘制图片标记\n     * @param context Canvas上下文\n     * @param data 数据项\n     * @param options 绘制选项\n     */\n    drawImageMarker: function(context: CanvasRenderingContext2D, data: DataItem, options: DrawOptions) {\n        // 确保geometry存在\n        if (!data.geometry) return;\n        \n        const coordinates = data.geometry._coordinates || data.geometry.coordinates;\n        const x = coordinates[0];\n        const y = coordinates[1];\n        \n        // 获取图片相关配置\n        const imageOptions = Object.assign({}, options.image || {}, data.image || {});\n        const imageUrl = imageOptions.url;\n        \n        if (imageUrl) {\n            const img = new Image();\n            img.onload = function() {\n                const size = data._size || data.size || options._size || options.size || 20;\n                const width = imageOptions.width || size;\n                const height = imageOptions.height || size;\n                \n                // 居中绘制\n                context.drawImage(img, x - width/2, y - height/2, width, height);\n            };\n            img.src = imageUrl;\n        } else {\n            // 如果没有图片，则绘制默认圆形\n            const size = data._size || data.size || options._size || options.size || 5;\n            context.arc(x, y, size, 0, Math.PI * 2);\n        }\n    },\n\n    /**\n     * 绘制线串\n     * @param context Canvas上下文\n     * @param coordinates 坐标数组\n     */\n    drawLineString: function(context: CanvasRenderingContext2D, coordinates: number[][]) {\n        for (let j = 0; j < coordinates.length; j++) {\n            const x = coordinates[j][0];\n            const y = coordinates[j][1];\n            if (j == 0) {\n                context.moveTo(x, y);\n            } else {\n                context.lineTo(x, y);\n            }\n        }\n    },\n\n    /**\n     * 绘制多边形\n     * @param context Canvas上下文\n     * @param coordinates 坐标数组\n     */\n    drawPolygon: function(context: CanvasRenderingContext2D, coordinates: number[][][]) {\n        context.beginPath();\n\n        for (let i = 0; i < coordinates.length; i++) {\n            const coordinate = coordinates[i];\n\n            context.moveTo(coordinate[0][0], coordinate[0][1]);\n            for (let j = 1; j < coordinate.length; j++) {\n                context.lineTo(coordinate[j][0], coordinate[j][1]);\n            }\n            context.lineTo(coordinate[0][0], coordinate[0][1]);\n            context.closePath();\n        }\n    },\n\n    /**\n     * 增强版多边形绘制，支持渐变填充\n     * @param context Canvas上下文\n     * @param coordinates 坐标数组\n     * @param options 绘制选项\n     */\n    drawPolygonEnhanced: function(context: CanvasRenderingContext2D, coordinates: number[][][], options: DrawOptions) {\n        context.beginPath();\n\n        for (let i = 0; i < coordinates.length; i++) {\n            const coordinate = coordinates[i];\n\n            context.moveTo(coordinate[0][0], coordinate[0][1]);\n            for (let j = 1; j < coordinate.length; j++) {\n                context.lineTo(coordinate[j][0], coordinate[j][1]);\n            }\n            context.lineTo(coordinate[0][0], coordinate[0][1]);\n            context.closePath();\n            \n            // 如果配置了渐变填充\n            if (options.gradient) {\n                const gradient = context.createLinearGradient(\n                    coordinate[0][0], coordinate[0][1],\n                    coordinate[2] ? coordinate[2][0] : coordinate[0][0], \n                    coordinate[2] ? coordinate[2][1] : coordinate[0][1]\n                );\n                \n                // 添加渐变色点\n                for (const key in options.gradient) {\n                    gradient.addColorStop(parseFloat(key), options.gradient[key]);\n                }\n                \n                context.fillStyle = gradient;\n            }\n        }\n    }\n};","/**\n * 简单绘制模块\n * @author kyle / http://nikai.us/\n */\n\nimport pathSimple from \"../path/simple\";\nimport DataSet from \"../../data/DataSet\";\n\n// 直接使用DataSet中的DataItem类型\nimport { DataItem } from '../../data/DataSet';\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    bigData?: string;\n    fillStyle?: string;\n    strokeStyle?: string;\n    lineWidth?: number;\n    lineDash?: number[];\n    filter?: (item: DataItem) => boolean;\n    multiPolygonDraw?: () => void;\n    transferCoordinate?: (coordinate: number[]) => number[];\n    [key: string]: any; // 支持动态属性\n}\n\nexport default {\n    draw: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 获取数据\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n\n        // 保存上下文状态\n        context.save();\n\n        // 设置上下文属性\n        for (const key in options) {\n            (context as any)[key] = options[key];\n        }\n\n        // 大数据模式\n        if (options.bigData) {\n            context.save();\n            context.beginPath();\n\n            // 绘制所有数据项\n            for (let i = 0, len = data.length; i < len; i++) {\n                const item = data[i];\n                pathSimple.draw(context, item, options);\n            }\n\n            const type = options.bigData;\n\n            // 根据几何类型进行填充或描边\n            if (type == 'Point' || type == 'Polygon' || type == 'MultiPolygon') {\n                context.fill();\n                \n                // 设置虚线样式\n                if ((context as any).lineDash) {\n                    context.setLineDash((context as any).lineDash);\n                }\n                \n                // 应用数据项的虚线样式\n                const lastItem = data[data.length - 1];\n                if (lastItem.lineDash) {\n                    context.setLineDash(lastItem.lineDash);\n                }\n\n                // 描边\n                if ((lastItem.strokeStyle || options.strokeStyle) && options.lineWidth) {\n                    context.stroke();\n                }\n\n            } else if (type == 'LineString' || type == 'MultiLineString') {\n                // 线类型直接描边\n                context.stroke();\n            }\n\n            context.restore();\n        } else {\n            // 普通模式，逐个绘制数据项\n            for (let i = 0, len = data.length; i < len; i++) {\n                const item = data[i];\n\n                context.save();\n\n                // 设置填充样式\n                if (item.fillStyle || item._fillStyle) {\n                    context.fillStyle = item.fillStyle || item._fillStyle;\n                }\n\n                // 设置描边样式\n                if (item.strokeStyle || item._strokeStyle) {\n                    context.strokeStyle = item.strokeStyle || item._strokeStyle;\n                }\n\n                // 设置虚线样式\n                if ((context as any).lineDash) {\n                    context.setLineDash((context as any).lineDash);\n                }\n                \n                if (item.lineDash) {\n                    context.setLineDash(item.lineDash);\n                }\n\n                // 确保geometry存在\n                if (!item.geometry) continue;\n                const type = item.geometry.type;\n\n                context.beginPath();\n\n                // 定义多边形绘制函数\n                options.multiPolygonDraw = function() {\n                    context.fill();\n                    if ((item.strokeStyle || options.strokeStyle) && options.lineWidth) {\n                        context.stroke();\n                    }\n                };\n                \n                // 绘制数据项\n                pathSimple.draw(context, item, options);\n\n                // 根据几何类型进行填充或描边\n                if (type == 'Point' || type == 'Polygon' || type == 'MultiPolygon') {\n                    context.fill();\n                    if ((item.strokeStyle || options.strokeStyle) && options.lineWidth) {\n                        context.stroke();\n                    }\n                } else if (type == 'LineString' || type == 'MultiLineString') {\n                    // 线类型设置线宽后描边\n                    if (item.lineWidth || item._lineWidth) {\n                        context.lineWidth = item.lineWidth || item._lineWidth;\n                    }\n                    context.stroke();\n                }\n\n                context.restore();\n            }\n        }\n\n        context.restore();\n    },\n    \n    /**\n     * 增强版绘制函数，支持更多自定义选项\n     * @param context Canvas上下文\n     * @param dataSet 数据集\n     * @param options 绘制选项\n     */\n    drawEnhanced: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 获取数据\n        let data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n        \n        // 保存上下文状态\n        context.save();\n        \n        // 应用全局上下文设置\n        for (const key in options) {\n            // 跳过一些特殊属性，避免覆盖\n            if (!['data', 'filter', 'transferCoordinate'].includes(key)) {\n                (context as any)[key] = options[key];\n            }\n        }\n        \n        // 如果有数据过滤器，则应用\n        if (options.filter && typeof options.filter === 'function') {\n            data = data.filter(options.filter as (value: DataItem, index: number, array: DataItem[]) => unknown);\n        }\n        \n        // 大数据模式处理\n        if (options.bigData) {\n            context.save();\n            context.beginPath();\n            \n            // 绘制所有数据项\n            for (let i = 0, len = data.length; i < len; i++) {\n                const item = data[i];\n                pathSimple.draw(context, item, options);\n            }\n            \n            const type = options.bigData;\n            \n            // 根据几何类型进行填充或描边\n            if (type == 'Point' || type == 'Polygon' || type == 'MultiPolygon') {\n                context.fill();\n                \n                // 设置虚线样式\n                if ((context as any).lineDash) {\n                    context.setLineDash((context as any).lineDash);\n                }\n                \n                // 应用最后一个数据项的虚线样式\n                const lastItem = data[data.length - 1];\n                if (lastItem.lineDash) {\n                    context.setLineDash(lastItem.lineDash);\n                }\n                \n                // 描边\n                if ((lastItem.strokeStyle || options.strokeStyle) && options.lineWidth) {\n                    context.stroke();\n                }\n            } else if (type == 'LineString' || type == 'MultiLineString') {\n                context.stroke();\n            }\n            \n            context.restore();\n        } else {\n            // 普通模式，逐个绘制数据项\n            for (let i = 0, len = data.length; i < len; i++) {\n                const item = data[i];\n                \n                context.save();\n                \n                // 应用单个元素的样式设置\n                if (item.fillStyle || item._fillStyle) {\n                    context.fillStyle = item.fillStyle || item._fillStyle;\n                }\n                \n                if (item.strokeStyle || item._strokeStyle) {\n                    context.strokeStyle = item.strokeStyle || item._strokeStyle;\n                }\n                \n                if (item.lineWidth || item._lineWidth) {\n                    context.lineWidth = item.lineWidth || item._lineWidth;\n                }\n                \n                // 设置虚线样式\n                if ((context as any).lineDash) {\n                    context.setLineDash((context as any).lineDash);\n                }\n                \n                if (item.lineDash) {\n                    context.setLineDash(item.lineDash);\n                }\n                \n                // 添加阴影效果支持\n                if (item.shadowBlur || options.shadowBlur) {\n                    context.shadowBlur = item.shadowBlur || options.shadowBlur || 0;\n                }\n                \n                if (item.shadowColor || options.shadowColor) {\n                    context.shadowColor = item.shadowColor || options.shadowColor || 'rgba(0, 0, 0, 0)';\n                }\n                \n                if (item.shadowOffsetX || options.shadowOffsetX) {\n                    context.shadowOffsetX = item.shadowOffsetX || options.shadowOffsetX || 0;\n                }\n                \n                if (item.shadowOffsetY || options.shadowOffsetY) {\n                    context.shadowOffsetY = item.shadowOffsetY || options.shadowOffsetY || 0;\n                }\n                \n                // 确保geometry存在\n                if (!item.geometry) continue;\n                const type = item.geometry.type;\n                context.beginPath();\n                \n                // 定义多边形绘制函数\n                options.multiPolygonDraw = function() {\n                    context.fill();\n                    if ((item.strokeStyle || options.strokeStyle) && options.lineWidth) {\n                        context.stroke();\n                    }\n                };\n                \n                // 绘制元素\n                pathSimple.draw(context, item, options);\n                \n                // 根据几何类型进行填充或描边\n                if (type == 'Point' || type == 'Polygon' || type == 'MultiPolygon') {\n                    context.fill();\n                    \n                    if ((item.strokeStyle || options.strokeStyle) && options.lineWidth) {\n                        context.stroke();\n                    }\n                } else if (type == 'LineString' || type == 'MultiLineString') {\n                    context.stroke();\n                }\n                \n                context.restore();\n            }\n        }\n        \n        context.restore();\n    }\n};","/**\n * 创建Canvas元素\n * @param {number} width - Canvas宽度\n * @param {number} height - Canvas高度\n * @returns {HTMLCanvasElement | null} - 创建的Canvas元素\n */\nfunction Canvas(width?: number, height?: number): HTMLCanvasElement | null {\n    let canvas: HTMLCanvasElement | null = null;\n\n    if (typeof document !== 'undefined') {\n        canvas = document.createElement('canvas');\n\n        if (width !== undefined) {\n            canvas.width = width;\n        }\n\n        if (height !== undefined) {\n            canvas.height = height;\n        }\n    }\n\n    return canvas;\n}\n\nexport default Canvas;","/**\n * 强度映射工具\n * @author kyle / http://nikai.us/\n */\n\nimport Canvas from \"../Canvas\";\n\n// 定义渐变配置接口\nexport interface Gradient {\n    [key: string]: string;\n}\n\n// 定义强度选项接口\nexport interface IntensityOptions {\n    gradient?: Gradient;\n    maxSize?: number;\n    minSize?: number;\n    max?: number;\n    min?: number;\n}\n\n// 定义图例选项接口\nexport interface LegendOptions {\n    width?: number;\n    height?: number;\n    showLabels?: boolean;\n}\n\n/**\n * 强度映射类，用于处理数据的强度映射，包括颜色渐变、大小映射等\n */\nexport default class Intensity {\n    private gradient: Gradient;\n    private maxSize: number;\n    private minSize: number;\n    private max: number;\n    private min: number;\n    private paletteCtx: CanvasRenderingContext2D | null = null;\n\n    /**\n     * 构造函数\n     * @param {IntensityOptions} [options] - 配置选项\n     */\n    constructor(options?: IntensityOptions) {\n        options = options || {};\n        this.gradient = options.gradient || {\n            0.25: \"rgba(0, 0, 255, 1)\",\n            0.55: \"rgba(0, 255, 0, 1)\",\n            0.85: \"rgba(255, 255, 0, 1)\",\n            1.0: \"rgba(255, 0, 0, 1)\"\n        };\n        this.maxSize = options.maxSize || 35;\n        this.minSize = options.minSize || 0;\n        this.max = options.max || 100;\n        this.min = options.min || 0;\n        this.initPalette();\n    }\n\n    /**\n     * 设置最大值\n     * @param {number} value - 最大值\n     */\n    setMax(value: number): void {\n        this.max = value || 100;\n    }\n\n    /**\n     * 设置最小值\n     * @param {number} value - 最小值\n     */\n    setMin(value: number): void {\n        this.min = value || 0;\n    }\n\n    /**\n     * 设置最大尺寸\n     * @param {number} maxSize - 最大尺寸\n     */\n    setMaxSize(maxSize: number): void {\n        this.maxSize = maxSize || 35;\n    }\n\n    /**\n     * 设置最小尺寸\n     * @param {number} minSize - 最小尺寸\n     */\n    setMinSize(minSize: number): void {\n        this.minSize = minSize || 0;\n    }\n\n    /**\n     * 初始化调色板\n     */\n    private initPalette(): void {\n        const gradient = this.gradient;\n        const canvas = Canvas(256, 1);\n\n        if (canvas) {\n            this.paletteCtx = canvas.getContext('2d');\n            if (this.paletteCtx) {\n                const lineGradient = this.paletteCtx.createLinearGradient(0, 0, 256, 1);\n\n                for (const key in gradient) {\n                    lineGradient.addColorStop(parseFloat(key), gradient[key]);\n                }\n\n                this.paletteCtx.fillStyle = lineGradient;\n                this.paletteCtx.fillRect(0, 0, 256, 1);\n            }\n        }\n    }\n\n    /**\n     * 根据值获取颜色\n     * @param {number} value - 输入值\n     * @returns {string} - 颜色字符串\n     */\n    getColor(value: number): string {\n        const imageData = this.getImageData(value);\n        return `rgba(${imageData[0]}, ${imageData[1]}, ${imageData[2]}, ${imageData[3] / 256})`;\n    }\n\n    /**\n     * 根据值获取图像数据\n     * @param {number} [value] - 输入值，可选\n     * @returns {Uint8ClampedArray | number[]} - 图像数据\n     */\n    getImageData(value?: number): Uint8ClampedArray | number[] {\n        if (!this.paletteCtx) {\n            return [0, 0, 0, 0];\n        }\n\n        const imageData = this.paletteCtx.getImageData(0, 0, 256, 1).data;\n\n        if (value === undefined) {\n            return imageData;\n        }\n\n        const max = this.max;\n        const min = this.min;\n\n        let normalizedValue = value;\n        if (normalizedValue > max) {\n            normalizedValue = max;\n        }\n\n        if (normalizedValue < min) {\n            normalizedValue = min;\n        }\n\n        const index = Math.floor((normalizedValue - min) / (max - min) * (256 - 1)) * 4;\n\n        return [imageData[index], imageData[index + 1], imageData[index + 2], imageData[index + 3]];\n    }\n\n    /**\n     * 根据值获取尺寸\n     * @param {number} value - 输入值\n     * @returns {number} - 尺寸\n     */\n    getSize(value: number): number {\n        let size = 0;\n        const max = this.max;\n        const min = this.min;\n        const maxSize = this.maxSize;\n        const minSize = this.minSize;\n\n        let normalizedValue = value;\n        if (normalizedValue > max) {\n            normalizedValue = max;\n        }\n\n        if (normalizedValue < min) {\n            normalizedValue = min;\n        }\n\n        if (max > min) {\n            size = minSize + (normalizedValue - min) / (max - min) * (maxSize - minSize);\n        } else {\n            return maxSize;\n        }\n\n        return size;\n    }\n\n    /**\n     * 设置渐变色\n     * @param {Gradient} gradient - 渐变配置\n     */\n    setGradient(gradient: Gradient): void {\n        this.gradient = gradient;\n        this.initPalette();\n    }\n\n    /**\n     * 获取当前渐变色配置\n     * @returns {Gradient} - 渐变配置\n     */\n    getGradient(): Gradient {\n        return this.gradient;\n    }\n\n    /**\n     * 根据预设主题设置渐变色\n     * @param {string} theme - 主题名称\n     * @returns {boolean} - 是否成功设置主题\n     */\n    setTheme(theme: string): boolean {\n        const themes: { [key: string]: Gradient } = {\n            'rainbow': {\n                0.0: 'blue',\n                0.25: 'cyan',\n                0.5: 'lime',\n                0.75: 'yellow',\n                1.0: 'red'\n            },\n            'fire': {\n                0.0: 'black',\n                0.25: 'purple',\n                0.5: 'orange',\n                0.75: 'yellow',\n                1.0: 'white'\n            },\n            'water': {\n                0.0: 'white',\n                0.25: 'lightblue',\n                0.5: 'blue',\n                0.75: 'darkblue',\n                1.0: 'black'\n            },\n            'earth': {\n                0.0: 'green',\n                0.25: 'yellowgreen',\n                0.5: 'yellow',\n                0.75: 'orange',\n                1.0: 'brown'\n            }\n        };\n        \n        if (themes[theme]) {\n            this.gradient = themes[theme];\n            this.initPalette();\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * 获取预设主题列表\n     * @returns {string[]} - 主题列表\n     */\n    getThemes(): string[] {\n        return ['rainbow', 'fire', 'water', 'earth'];\n    }\n\n    /**\n     * 更新最大最小值\n     * @param {number} min - 最小值\n     * @param {number} max - 最大值\n     */\n    setMinMax(min: number, max: number): void {\n        this.min = min;\n        this.max = max;\n    }\n\n    /**\n     * 更新最大最小尺寸\n     * @param {number} minSize - 最小尺寸\n     * @param {number} maxSize - 最大尺寸\n     */\n    setMinMaxSize(minSize: number, maxSize: number): void {\n        this.minSize = minSize;\n        this.maxSize = maxSize;\n    }\n\n    /**\n     * 获取图例\n     * @param {LegendOptions} options - 图例选项\n     * @returns {HTMLCanvasElement | null} - 图例Canvas元素\n     */\n    getLegend(options: LegendOptions): HTMLCanvasElement | null {\n        const gradient = this.gradient;\n        const width = options.width || 20;\n        const height = options.height || 180;\n        const canvas = Canvas(width, height);\n\n        if (!canvas) {\n            return null;\n        }\n\n        const paletteCtx = canvas.getContext('2d');\n        if (!paletteCtx) {\n            return null;\n        }\n\n        const lineGradient = paletteCtx.createLinearGradient(0, height, 0, 0);\n\n        for (const key in gradient) {\n            lineGradient.addColorStop(parseFloat(key), gradient[key]);\n        }\n\n        paletteCtx.fillStyle = lineGradient;\n        paletteCtx.fillRect(0, 0, width, height);\n        \n        // 添加数值标签\n        if (options.showLabels !== false) {\n            paletteCtx.fillStyle = 'black';\n            paletteCtx.font = '12px Arial';\n            paletteCtx.textAlign = 'left';\n            \n            // 添加最大值和最小值标签\n            const maxLabel = this.max.toString();\n            const minLabel = this.min.toString();\n            \n            paletteCtx.fillText(maxLabel, width + 5, 12);\n            paletteCtx.fillText(minLabel, width + 5, height);\n            \n            // 添加中间值标签\n            const midValue = (this.max + this.min) / 2;\n            const midLabel = midValue.toFixed(1);\n            paletteCtx.fillText(midLabel, width + 5, height / 2);\n        }\n\n        return canvas;\n    }\n}","/**\n * 全局对象和设备像素比模块\n */\n\n// 获取全局对象，优先使用window，如果不存在则使用空对象\nconst global: Window & typeof globalThis = typeof window === 'undefined' ? {} as any : window;\n\n// 获取设备像素比，默认值为1\nconst devicePixelRatio: number = global.devicePixelRatio || 1;\n\n// 导出设备像素比\nexport {devicePixelRatio};\n// 导出全局对象作为window\nexport {global as window};\n// 默认导出全局对象\nexport default global;","/**\n * 绘制热力图\n * @author kyle / http://nikai.us/\n */\n\nimport Intensity from \"../../utils/data-range/Intensity\";\nimport pathSimple from \"../path/simple\";\nimport Canvas from \"../../utils/Canvas\";\nimport DataSet from \"../../data/DataSet\";\nimport {devicePixelRatio} from \"../../utils/window\";\n\n// 导入DataSet中的DataItem类型\nimport { DataItem as DataSetDataItem } from \"../../data/DataSet\";\n\n// 定义数据项接口，扩展自DataSetDataItem\ninterface DataItem extends DataSetDataItem {\n    count?: number;\n}\n\n// 定义热力图选项接口\ninterface HeatmapOptions {\n    size?: number;\n    _size?: number;\n    max?: number;\n    min?: number;\n    range?: number[];\n    maxOpacity?: number;\n    minOpacity?: number;\n    strength?: number;\n    gradient?: Record<string, string>;\n    withoutAlpha?: boolean;\n    absolute?: boolean;\n    [key: string]: any; // 支持动态属性\n}\n\n/**\n * 创建热力图圆形点\n * @param size 圆形大小\n * @returns Canvas对象，包含绘制好的圆形\n */\nfunction createCircle(size: number): HTMLCanvasElement {\n    const shadowBlur = size / 2;\n    const r2 = size + shadowBlur;\n    const offsetDistance = 10000;\n\n    const circle = Canvas(r2 * 2, r2 * 2) as HTMLCanvasElement;\n    const context = circle.getContext('2d');\n    \n    if (!context) {\n        return circle;\n    }\n\n    context.shadowBlur = shadowBlur;\n    context.shadowColor = 'black';\n    context.shadowOffsetX = context.shadowOffsetY = offsetDistance;\n\n    context.beginPath();\n    context.arc(r2 - offsetDistance, r2 - offsetDistance, size, 0, Math.PI * 2, true);\n    context.closePath();\n    context.fill();\n    return circle;\n}\n\n/**\n * 对热力图像素进行着色处理\n * @param pixels 像素数据\n * @param gradient 渐变颜色数据\n * @param options 热力图选项\n */\nfunction colorize(pixels: Uint8ClampedArray, gradient: Uint8ClampedArray, options: HeatmapOptions): void {\n    const max = getMax(options);\n    const min = getMin(options);\n    const diff = max - min;\n    const range = options.range || null;\n\n    let jMin = 0;\n    let jMax = 1024;\n    if (range && range.length === 2) {\n        jMin = (range[0] - min) / diff * 1024;\n    }\n\n    if (range && range.length === 2) {\n        jMax = (range[1] - min) / diff * 1024;\n    }\n\n    const maxOpacity = options.maxOpacity || 0.8;\n    const minOpacity = options.minOpacity || 0;\n\n    for (let i = 3, len = pixels.length, j: number; i < len; i += 4) {\n        j = pixels[i] * 4; // 从透明度值获取渐变颜色\n\n        // 调整透明度范围\n        if (pixels[i] / 256 > maxOpacity) {\n            pixels[i] = 256 * maxOpacity;\n        }\n        if (pixels[i] / 256 < minOpacity) {\n            pixels[i] = 256 * minOpacity;\n        }\n\n        // 根据范围设置颜色\n        if (j && j >= jMin && j <= jMax) {\n            pixels[i - 3] = gradient[j];\n            pixels[i - 2] = gradient[j + 1];\n            pixels[i - 1] = gradient[j + 2];\n        } else {\n            pixels[i] = 0;\n        }\n    }\n}\n\n/**\n * 获取最大值\n * @param options 热力图选项\n * @returns 最大值\n */\nfunction getMax(options: HeatmapOptions): number {\n    return options.max || 100;\n}\n\n/**\n * 获取最小值\n * @param options 热力图选项\n * @returns 最小值\n */\nfunction getMin(options: HeatmapOptions): number {\n    return options.min || 0;\n}\n\n/**\n * 绘制灰度热力图\n * @param context Canvas上下文\n * @param dataSet 数据集\n * @param options 热力图选项\n */\nfunction drawGray(context: CanvasRenderingContext2D, dataSet: DataItem[], options: HeatmapOptions): void {\n    const max = getMax(options);\n    const min = getMin(options);\n    \n    // 确定热力图点大小\n    let size = options._size;\n    if (size === undefined) {\n        size = options.size;\n        if (size === undefined) {\n            size = 13;\n        }\n    }\n\n    // 创建强度对象，用于颜色渐变\n    const intensity = new Intensity({\n        gradient: options.gradient,\n        max: max,\n        min: min\n    });\n\n    // 创建圆形点\n    const circle = createCircle(size);\n    const circleHalfWidth = circle.width / 2;\n    const circleHalfHeight = circle.height / 2;\n\n    // 按透明度排序数据，优化绘制性能\n    const dataOrderByAlpha: Record<string, DataItem[]> = {};\n\n    dataSet.forEach(function(item) {\n        const count = item.count === undefined ? 1 : item.count;\n        const alpha = Math.min(1, count / max).toFixed(2);\n        dataOrderByAlpha[alpha] = dataOrderByAlpha[alpha] || [];\n        dataOrderByAlpha[alpha].push(item);\n    });\n\n    // 绘制数据\n    for (const i in dataOrderByAlpha) {\n        if (isNaN(parseFloat(i))) continue;\n        const _data = dataOrderByAlpha[i];\n        context.beginPath();\n        \n        if (!options.withoutAlpha) {\n            context.globalAlpha = parseFloat(i);\n        }\n        \n        context.strokeStyle = intensity.getColor(parseFloat(i) * max);\n        \n        _data.forEach(function(item) {\n            if (!item.geometry) {\n                return;\n            }\n\n            const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n            const type = item.geometry.type;\n            \n            if (type === 'Point') {\n                    const count = item.count === undefined ? 1 : item.count;\n                    context.globalAlpha = count / max;\n                    const pointCoordinates = coordinates as number[];\n                    context.drawImage(circle, pointCoordinates[0] - circleHalfWidth, pointCoordinates[1] - circleHalfHeight);\n                } else if (type === 'LineString') {\n                    const count = item.count === undefined ? 1 : item.count;\n                    context.globalAlpha = count / max;\n                    context.beginPath();\n                    pathSimple.draw(context, item, options);\n                    context.stroke();\n                }\n        });\n    }\n}\n\n/**\n * 主绘制函数\n * @param context Canvas上下文\n * @param dataSet 数据集\n * @param options 热力图选项\n */\nfunction draw(context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: HeatmapOptions): void {\n    // 检查画布大小\n    if (context.canvas.width <= 0 || context.canvas.height <= 0) {\n        return;\n    }\n\n    // 设置强度\n    const strength = options.strength || 0.3;\n    context.strokeStyle = 'rgba(0,0,0,' + strength + ')';\n\n    // 创建阴影画布\n    let shadowCanvas = Canvas(context.canvas.width, context.canvas.height) as HTMLCanvasElement;\n    const shadowContext = shadowCanvas.getContext('2d');\n    \n    if (!shadowContext) {\n        return;\n    }\n    \n    shadowContext.scale(devicePixelRatio, devicePixelRatio);\n\n    // 获取数据\n    const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n\n    context.save();\n\n    // 创建强度对象\n    let intensity = new Intensity({\n        gradient: options.gradient\n    });\n\n    // 绘制灰度热力图\n        drawGray(shadowContext, data as DataItem[], options);\n\n        // 着色处理\n        if (!options.absolute) {\n            const colored = shadowContext.getImageData(0, 0, context.canvas.width, context.canvas.height);\n            colorize(colored.data as Uint8ClampedArray, intensity.getImageData() as Uint8ClampedArray, options);\n            context.putImageData(colored, 0, 0);\n\n            context.restore();\n        }\n\n        // 释放资源\n        intensity = null as any;\n        shadowCanvas = null as any;\n}\n\nexport default {\n    draw\n};","/**\n * 绘制网格图\n * @author kyle / http://nikai.us/\n */\n\nimport Intensity from '../../utils/data-range/Intensity';\nimport DataSet, { DataItem as DataSetDataItem } from \"../../data/DataSet\";\n\n// 定义数据项接口，扩展自DataSetDataItem\ninterface DataItem extends DataSetDataItem {\n    count?: number;\n}\n\n// 定义偏移量接口\ninterface Offset {\n    x: number;\n    y: number;\n}\n\n// 定义标签选项接口\ninterface LabelOptions {\n    show?: boolean;\n    fillStyle?: string;\n    font?: string;\n    shadowColor?: string;\n    shadowBlur?: number;\n}\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    _size?: number;\n    size?: number;\n    enableCluster?: boolean;\n    offset?: Offset;\n    min?: number;\n    max?: number;\n    gradient?: Record<string, string>;\n    strokeStyle?: string;\n    lineWidth?: number;\n    label?: LabelOptions;\n    [key: string]: any; // 支持动态属性\n}\n\nexport default {\n    draw: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 保存上下文状态\n        context.save();\n\n        // 获取数据\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n\n        // 网格数据对象\n        const grids: Record<string, number> = {};\n\n        // 网格大小\n        const size = options._size || options.size || 50;\n\n        // 是否启用聚类（后端传入数据为网格数据时，传入enableCluster为false，前端不进行网格化操作，直接画方格）\n        const enableCluster = 'enableCluster' in options ? options.enableCluster : true;\n\n        // 偏移量\n        const offset = options.offset || {\n            x: 0,\n            y: 0\n        };\n\n        // 创建强度对象，用于颜色渐变\n        const intensity = new Intensity({\n            min: options.min || 0,\n            max: options.max || 100,\n            gradient: options.gradient\n        });\n\n        if (!enableCluster) {\n            // 直接绘制网格数据模式\n            for (let i = 0; i < data.length; i++) {\n                const item = data[i];\n                if (!item.geometry) continue;\n                const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n                const gridKey = coordinates.join(',');\n                grids[gridKey] = item.count || 1;\n            }\n            \n            // 绘制每个网格\n            for (const gridKey in grids) {\n                const [x, y] = gridKey.split(',').map(Number);\n\n                context.beginPath();\n                context.rect(x - size / 2, y - size / 2, size, size);\n                context.fillStyle = intensity.getColor(grids[gridKey]);\n                context.fill();\n                \n                // 如果设置了描边样式和线宽，则绘制边框\n                if (options.strokeStyle && options.lineWidth) {\n                    context.stroke();\n                }\n            }\n        } else {\n            // 聚类模式，将数据点聚合到网格中\n            for (let i = 0; i < data.length; i++) {\n                const item = data[i];\n                if (!item.geometry) continue;\n                const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n                const gridKey = Math.floor((coordinates[0] - offset.x) / size) + ',' + Math.floor((coordinates[1] - offset.y) / size);\n                if (!grids[gridKey]) {\n                    grids[gridKey] = 0;\n                }\n\n                grids[gridKey] += ~~(item.count || 1);\n            }\n\n            // 绘制每个网格\n            for (const gridKey in grids) {\n                const [x, y] = gridKey.split(',').map(Number);\n\n                context.beginPath();\n                context.rect(x * size + 0.5 + offset.x, y * size + 0.5 + offset.y, size, size);\n                context.fillStyle = intensity.getColor(grids[gridKey]);\n                context.fill();\n                \n                // 如果设置了描边样式和线宽，则绘制边框\n                if (options.strokeStyle && options.lineWidth) {\n                    context.stroke();\n                }\n            }\n        }\n\n        // 如果需要显示标签\n        if (options.label && options.label.show !== false) {\n            // 设置标签样式\n            context.fillStyle = options.label.fillStyle || 'white';\n\n            if (options.label.font) {\n                context.font = options.label.font;\n            }\n\n            if (options.label.shadowColor) {\n                context.shadowColor = options.label.shadowColor;\n            }\n\n            if (options.label.shadowBlur) {\n                context.shadowBlur = options.label.shadowBlur;\n            }\n\n            // 绘制标签\n            for (const gridKey in grids) {\n                const [x, y] = gridKey.split(',').map(Number);\n                const text = grids[gridKey].toString();\n                const textWidth = context.measureText(text).width;\n                \n                if (!enableCluster) {\n                    // 直接绘制模式下的标签位置\n                    context.fillText(text, x - textWidth / 2, y + 5);\n                } else {\n                    // 聚类模式下的标签位置\n                    context.fillText(text, x * size + 0.5 + offset.x + size / 2 - textWidth / 2, y * size + 0.5 + offset.y + size / 2 + 5);\n                }\n            }\n        }\n\n        // 恢复上下文状态\n        context.restore();\n    }\n};","/**\n * 绘制蜂窝图（六边形网格）\n * @author kyle / http://nikai.us/\n */\n\nimport Intensity from \"../../utils/data-range/Intensity\";\nimport DataSet from \"../../data/DataSet\";\n\n// 定义中心点接口\ninterface Point {\n    x: number;\n    y: number;\n}\n\n// 导入DataSet中的DataItem类型\nimport { DataItem } from \"../../data/DataSet\";\n\n// 定义偏移量接口\ninterface Offset {\n    x: number;\n    y: number;\n}\n\n// 定义标签选项接口\ninterface LabelOptions {\n    show?: boolean;\n    fillStyle?: string;\n    font?: string;\n    shadowColor?: string;\n    shadowBlur?: number;\n}\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    _size?: number;\n    size?: number;\n    offset?: Offset;\n    max?: number;\n    gradient?: Record<string, string>;\n    strokeStyle?: string;\n    lineWidth?: number;\n    label?: LabelOptions;\n    [key: string]: any; // 支持动态属性\n}\n\n// 定义六边形网格数据接口\ntype HexBin = DataItem[] & {\n    i: number;\n    j: number;\n    x: number;\n    y: number;\n    count?: number;\n};\n\n/**\n * 计算六边形的角点坐标\n * @param center 中心点\n * @param size 六边形大小\n * @param i 角点索引（0-5）\n * @returns 角点坐标\n */\nfunction hex_corner(center: Point, size: number, i: number): number[] {\n    const angle_deg = 60 * i + 30;\n    const angle_rad = Math.PI / 180 * angle_deg;\n    return [center.x + size * Math.cos(angle_rad), center.y + size * Math.sin(angle_rad)];\n}\n\nexport default {\n    draw: function(context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 保存上下文状态\n        context.save();\n\n        // 获取数据\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n\n        // 设置上下文属性\n        for (const key in options) {\n            (context as any)[key] = options[key];\n        }\n\n        // 偏移量\n        const offset = options.offset || {\n            x: 10,\n            y: 10\n        };\n\n        // 计算六边形参数\n        let r = options._size || options.size || 40;\n        r = r / 2 / Math.sin(Math.PI / 3);\n        const dx = r * 2 * Math.sin(Math.PI / 3);\n        const dy = r * 1.5;\n\n        // 六边形网格数据\n        const binsById: Record<string, HexBin> = {};\n\n        // 将数据点分配到六边形网格中\n        for (let i = 0; i < data.length; i++) {\n            const item = data[i];\n            if (!item.geometry) continue;\n            \n            const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n            const py = (coordinates[1] - offset.y) / dy;\n            let pj = Math.round(py);\n            const px = (coordinates[0] - offset.x) / dx - (pj & 1 ? 0.5 : 0);\n            let pi = Math.round(px);\n            const py1 = py - pj;\n\n            // 调整六边形归属\n            if (Math.abs(py1) * 3 > 1) {\n                const px1 = px - pi;\n                const pi2 = pi + (px < pi ? -1 : 1) / 2;\n                const pj2 = pj + (py < pj ? -1 : 1);\n                const px2 = px - pi2;\n                const py2 = py - pj2;\n                if (px1 * px1 + py1 * py1 > px2 * px2 + py2 * py2) {\n                    pi = pi2 + (pj & 1 ? 1 : -1) / 2;\n                    pj = pj2;\n                }\n            }\n\n            // 生成网格ID并存储数据\n            const id = pi + \"-\" + pj;\n            let bin = binsById[id];\n            if (bin) {\n                bin.push(item);\n            } else {\n                bin = binsById[id] = [item] as HexBin;\n                bin.i = pi;\n                bin.j = pj;\n                bin.x = (pi + (pj & 1 ? 1 / 2 : 0)) * dx;\n                bin.y = pj * dy;\n            }\n        }\n\n        // 创建强度对象，用于颜色渐变\n        const intensity = new Intensity({\n            max: options.max || 100,\n            maxSize: r,\n            gradient: options.gradient\n        });\n\n        // 绘制六边形网格\n        for (const key in binsById) {\n            const item = binsById[key];\n\n            context.beginPath();\n\n            // 绘制六边形\n            for (let j = 0; j < 6; j++) {\n                const result = hex_corner({\n                    x: item.x + offset.x,\n                    y: item.y + offset.y\n                }, r, j);\n\n                context.lineTo(result[0], result[1]);\n            }\n\n            context.closePath();\n\n            // 计算网格内数据总和\n            let count = 0;\n            for (let i = 0; i < item.length; i++) {\n                count += item[i].count || 1;\n            }\n            item.count = count;\n\n            // 设置填充颜色并绘制\n            context.fillStyle = intensity.getColor(count);\n            context.fill();\n            \n            // 如果设置了描边样式和线宽，则绘制边框\n            if (options.strokeStyle && options.lineWidth) {\n                context.stroke();\n            }\n        }\n\n        // 如果需要显示标签\n        if (options.label && options.label.show !== false) {\n            // 设置标签样式\n            context.fillStyle = options.label.fillStyle || 'white';\n\n            if (options.label.font) {\n                context.font = options.label.font;\n            }\n\n            if (options.label.shadowColor) {\n                context.shadowColor = options.label.shadowColor;\n            }\n\n            if (options.label.shadowBlur) {\n                context.shadowBlur = options.label.shadowBlur;\n            }\n\n            // 绘制标签\n            for (const key in binsById) {\n                const item = binsById[key];\n                let text = item.count || 0;\n                if (text < 0) {\n                    text = parseFloat(text.toFixed(2));\n                } else {\n                    text = Math.floor(text);\n                }\n                const textWidth = context.measureText(text.toString()).width;\n                context.fillText(text.toString(), item.x + offset.x - textWidth / 2, item.y + offset.y + 5);\n            }\n        }\n\n        // 恢复上下文状态\n        context.restore();\n    }\n};","export function createShader(gl, src, type) {\r\n    var shader = gl.createShader(type);\r\n    gl.shaderSource(shader, src);\r\n    gl.compileShader(shader);\r\n    return shader;\r\n}\r\n\r\nexport function initShaders(gl, vs_source, fs_source) {\r\n\r\n    var vertexShader = createShader(gl, vs_source, gl.VERTEX_SHADER);\r\n    var fragmentShader = createShader(gl, fs_source, gl.FRAGMENT_SHADER);\r\n     \r\n    var glProgram = gl.createProgram();\r\n     \r\n    gl.attachShader(glProgram, vertexShader);\r\n    gl.attachShader(glProgram, fragmentShader);\r\n    gl.linkProgram(glProgram);\r\n \r\n    gl.useProgram(glProgram);\r\n\r\n    return glProgram;\r\n}\r\n\r\nexport function getColorData(color) {\r\n    var tmpCanvas = document.createElement('canvas');\r\n    var tmpCtx = tmpCanvas.getContext('2d');\r\n    tmpCanvas.width = 1;\r\n    tmpCanvas.height = 1;\r\n    tmpCtx.fillStyle = color;\r\n    tmpCtx.fillRect(0, 0, 1, 1);\r\n    return tmpCtx.getImageData(0, 0, 1, 1).data;\r\n}\r\n","import {initShaders, getColorData} from './util';\r\n\r\nvar vs_s = [\r\n    'attribute vec4 a_Position;',\r\n    'void main() {',\r\n    'gl_Position = a_Position;',\r\n    'gl_PointSize = 30.0;',\r\n    '}'\r\n].join('');\r\n\r\nvar fs_s = [\r\n    'precision mediump float;',\r\n    'uniform vec4 u_FragColor;',\r\n    'void main() {',\r\n    'gl_FragColor = u_FragColor;',\r\n    '}'\r\n].join('');\r\n\r\nfunction draw(gl, data, options) {\r\n\r\n    if (!data) {\r\n        return;\r\n    }\r\n\r\n    var program = initShaders(gl, vs_s, fs_s)\r\n\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n    //gl.clearColor(0.0, 0.0, 1.0, 1.0);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    var halfCanvasWidth = gl.canvas.width / 2;\r\n    var halfCanvasHeight = gl.canvas.height / 2;\r\n\r\n    // Create a buffer object\r\n    var vertexBuffer = gl.createBuffer();\r\n    // Bind the buffer object to target\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n\r\n    var a_Position = gl.getAttribLocation(program, 'a_Position');\r\n    // Assign the buffer object to a_Position variable\r\n    gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0);\r\n\r\n    // Enable the assignment to a_Position variable\r\n    gl.enableVertexAttribArray(a_Position);\r\n\r\n    var uFragColor = gl.getUniformLocation(program, 'u_FragColor');\r\n\r\n    var colored = getColorData(options.strokeStyle || 'red')\r\n\r\n    gl.uniform4f(uFragColor,\r\n        colored[0] / 255,\r\n        colored[1] / 255,\r\n        colored[2] / 255,\r\n        colored[3] / 255);\r\n\r\n    gl.lineWidth(options.lineWidth || 1);\r\n\r\n    for (var i = 0, len = data.length; i < len; i++) {\r\n        var _geometry = data[i].geometry._coordinates;\r\n\r\n        var verticesData = [];\r\n\r\n        for (var j = 0; j < _geometry.length; j++) {\r\n            var item = _geometry[j];\r\n\r\n            var x = (item[0] - halfCanvasWidth) / halfCanvasWidth;\r\n            var y = (halfCanvasHeight - item[1]) / halfCanvasHeight;\r\n            verticesData.push(x, y);\r\n        }\r\n\r\n        var vertices = new Float32Array(verticesData);\r\n        // Write date into the buffer object\r\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n        gl.drawArrays(gl.LINE_STRIP, 0, _geometry.length);\r\n    }\r\n\r\n};\r\n\r\nexport default {\r\n    draw: draw\r\n}\r\n","import {initShaders, getColorData} from './util';\r\n\r\nvar vs_s = [\r\n    'attribute vec4 a_Position;',\r\n    'attribute float a_PointSize;',\r\n    'void main() {',\r\n    'gl_Position = a_Position;',\r\n    'gl_PointSize = a_PointSize;',\r\n    '}'\r\n].join('');\r\n\r\nvar fs_s = [\r\n    'precision mediump float;',\r\n    'uniform vec4 u_FragColor;',\r\n    'void main() {',\r\n    'gl_FragColor = u_FragColor;',\r\n    '}'\r\n].join('');\r\n\r\nfunction draw (gl, data, options) {\r\n\r\n    if (!data) {\r\n        return;\r\n    }\r\n\r\n    var program = initShaders(gl, vs_s, fs_s)\r\n\r\n    var a_Position = gl.getAttribLocation(program, 'a_Position');\r\n\r\n    var a_PointSize = gl.getAttribLocation(program, 'a_PointSize');\r\n\r\n    var uFragColor = gl.getUniformLocation(program, 'u_FragColor');\r\n\r\n    //gl.clearColor(0.0, 0.0, 1.0, 1.0);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    var halfCanvasWidth = gl.canvas.width / 2;\r\n    var halfCanvasHeight = gl.canvas.height / 2;\r\n\r\n    var verticesData = [];\r\n    var count = 0;\r\n    for (var i = 0; i < data.length; i++) {\r\n        var item = data[i].geometry._coordinates;\r\n\r\n        var x = (item[0]- halfCanvasWidth) / halfCanvasWidth;\r\n        var y = (halfCanvasHeight - item[1]) / halfCanvasHeight;\r\n\r\n        if (x < -1 || x > 1 || y < -1 || y > 1) {\r\n            continue;\r\n        }\r\n        verticesData.push(x, y);\r\n        count++;\r\n    }\r\n\r\n    var vertices = new Float32Array(verticesData);\r\n    var n = count; // The number of vertices\r\n\r\n    // Create a buffer object\r\n    var vertexBuffer = gl.createBuffer();\r\n\r\n    // Bind the buffer object to target\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);\r\n    // Write date into the buffer object\r\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n    // Assign the buffer object to a_Position variable\r\n    gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0);\r\n\r\n    // Enable the assignment to a_Position variable\r\n    gl.enableVertexAttribArray(a_Position);\r\n\r\n    gl.vertexAttrib1f(a_PointSize, options._size);\r\n\r\n    var colored = getColorData(options.fillStyle || 'red')\r\n\r\n    gl.uniform4f(uFragColor,\r\n        colored[0] / 255,\r\n        colored[1] / 255,\r\n        colored[2] / 255,\r\n        colored[3] / 255);\r\n    gl.drawArrays(gl.POINTS, 0, n);\r\n};\r\n\r\nexport default {\r\n    draw: draw\r\n}\r\n","'use strict';\r\n\r\nfunction earcut(data, holeIndices, dim) {\r\n\r\n    dim = dim || 2;\r\n\r\n    var hasHoles = holeIndices && holeIndices.length,\r\n        outerLen = hasHoles ? holeIndices[0] * dim : data.length,\r\n        outerNode = linkedList(data, 0, outerLen, dim, true),\r\n        triangles = [];\r\n\r\n    if (!outerNode) return triangles;\r\n\r\n    var minX, minY, maxX, maxY, x, y, size;\r\n\r\n    if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\r\n\r\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\r\n    if (data.length > 80 * dim) {\r\n        minX = maxX = data[0];\r\n        minY = maxY = data[1];\r\n\r\n        for (var i = dim; i < outerLen; i += dim) {\r\n            x = data[i];\r\n            y = data[i + 1];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n        }\r\n\r\n        // minX, minY and size are later used to transform coords into integers for z-order calculation\r\n        size = Math.max(maxX - minX, maxY - minY);\r\n    }\r\n\r\n    earcutLinked(outerNode, triangles, dim, minX, minY, size);\r\n\r\n    return triangles;\r\n}\r\n\r\n// create a circular doubly linked list from polygon points in the specified winding order\r\nfunction linkedList(data, start, end, dim, clockwise) {\r\n    var i, last;\r\n\r\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\r\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    } else {\r\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    }\r\n\r\n    if (last && equals(last, last.next)) {\r\n        removeNode(last);\r\n        last = last.next;\r\n    }\r\n\r\n    return last;\r\n}\r\n\r\n// eliminate colinear or duplicate points\r\nfunction filterPoints(start, end) {\r\n    if (!start) return start;\r\n    if (!end) end = start;\r\n\r\n    var p = start,\r\n        again;\r\n    do {\r\n        again = false;\r\n\r\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\r\n            removeNode(p);\r\n            p = end = p.prev;\r\n            if (p === p.next) return null;\r\n            again = true;\r\n\r\n        } else {\r\n            p = p.next;\r\n        }\r\n    } while (again || p !== end);\r\n\r\n    return end;\r\n}\r\n\r\n// main ear slicing loop which triangulates a polygon (given as a linked list)\r\nfunction earcutLinked(ear, triangles, dim, minX, minY, size, pass) {\r\n    if (!ear) return;\r\n\r\n    // interlink polygon nodes in z-order\r\n    if (!pass && size) indexCurve(ear, minX, minY, size);\r\n\r\n    var stop = ear,\r\n        prev, next;\r\n\r\n    // iterate through ears, slicing them one by one\r\n    while (ear.prev !== ear.next) {\r\n        prev = ear.prev;\r\n        next = ear.next;\r\n\r\n        if (size ? isEarHashed(ear, minX, minY, size) : isEar(ear)) {\r\n            // cut off the triangle\r\n            triangles.push(prev.i / dim);\r\n            triangles.push(ear.i / dim);\r\n            triangles.push(next.i / dim);\r\n\r\n            removeNode(ear);\r\n\r\n            // skipping the next vertice leads to less sliver triangles\r\n            ear = next.next;\r\n            stop = next.next;\r\n\r\n            continue;\r\n        }\r\n\r\n        ear = next;\r\n\r\n        // if we looped through the whole remaining polygon and can't find any more ears\r\n        if (ear === stop) {\r\n            // try filtering points and slicing again\r\n            if (!pass) {\r\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, size, 1);\r\n\r\n            // if this didn't work, try curing all small self-intersections locally\r\n            } else if (pass === 1) {\r\n                ear = cureLocalIntersections(ear, triangles, dim);\r\n                earcutLinked(ear, triangles, dim, minX, minY, size, 2);\r\n\r\n            // as a last resort, try splitting the remaining polygon into two\r\n            } else if (pass === 2) {\r\n                splitEarcut(ear, triangles, dim, minX, minY, size);\r\n            }\r\n\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n// check whether a polygon node forms a valid ear with adjacent nodes\r\nfunction isEar(ear) {\r\n    var a = ear.prev,\r\n        b = ear,\r\n        c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // now make sure we don't have other points inside the potential ear\r\n    var p = ear.next.next;\r\n\r\n    while (p !== ear.prev) {\r\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.next;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction isEarHashed(ear, minX, minY, size) {\r\n    var a = ear.prev,\r\n        b = ear,\r\n        c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // triangle bbox; min & max are calculated like this for speed\r\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x),\r\n        minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y),\r\n        maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x),\r\n        maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\r\n\r\n    // z-order range for the current triangle bbox;\r\n    var minZ = zOrder(minTX, minTY, minX, minY, size),\r\n        maxZ = zOrder(maxTX, maxTY, minX, minY, size);\r\n\r\n    // first look for points inside the triangle in increasing z-order\r\n    var p = ear.nextZ;\r\n\r\n    while (p && p.z <= maxZ) {\r\n        if (p !== ear.prev && p !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.nextZ;\r\n    }\r\n\r\n    // then look for points in decreasing z-order\r\n    p = ear.prevZ;\r\n\r\n    while (p && p.z >= minZ) {\r\n        if (p !== ear.prev && p !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.prevZ;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// go through all polygon nodes and cure small local self-intersections\r\nfunction cureLocalIntersections(start, triangles, dim) {\r\n    var p = start;\r\n    do {\r\n        var a = p.prev,\r\n            b = p.next.next;\r\n\r\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\r\n\r\n            triangles.push(a.i / dim);\r\n            triangles.push(p.i / dim);\r\n            triangles.push(b.i / dim);\r\n\r\n            // remove two nodes involved\r\n            removeNode(p);\r\n            removeNode(p.next);\r\n\r\n            p = start = b;\r\n        }\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return p;\r\n}\r\n\r\n// try splitting polygon into two and triangulate them independently\r\nfunction splitEarcut(start, triangles, dim, minX, minY, size) {\r\n    // look for a valid diagonal that divides the polygon into two\r\n    var a = start;\r\n    do {\r\n        var b = a.next.next;\r\n        while (b !== a.prev) {\r\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\r\n                // split the polygon in two by the diagonal\r\n                var c = splitPolygon(a, b);\r\n\r\n                // filter colinear points around the cuts\r\n                a = filterPoints(a, a.next);\r\n                c = filterPoints(c, c.next);\r\n\r\n                // run earcut on each half\r\n                earcutLinked(a, triangles, dim, minX, minY, size);\r\n                earcutLinked(c, triangles, dim, minX, minY, size);\r\n                return;\r\n            }\r\n            b = b.next;\r\n        }\r\n        a = a.next;\r\n    } while (a !== start);\r\n}\r\n\r\n// link every hole into the outer loop, producing a single-ring polygon without holes\r\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\r\n    var queue = [],\r\n        i, len, start, end, list;\r\n\r\n    for (i = 0, len = holeIndices.length; i < len; i++) {\r\n        start = holeIndices[i] * dim;\r\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\r\n        list = linkedList(data, start, end, dim, false);\r\n        if (list === list.next) list.steiner = true;\r\n        queue.push(getLeftmost(list));\r\n    }\r\n\r\n    queue.sort(compareX);\r\n\r\n    // process holes from left to right\r\n    for (i = 0; i < queue.length; i++) {\r\n        eliminateHole(queue[i], outerNode);\r\n        outerNode = filterPoints(outerNode, outerNode.next);\r\n    }\r\n\r\n    return outerNode;\r\n}\r\n\r\nfunction compareX(a, b) {\r\n    return a.x - b.x;\r\n}\r\n\r\n// find a bridge between vertices that connects hole with an outer ring and and link it\r\nfunction eliminateHole(hole, outerNode) {\r\n    outerNode = findHoleBridge(hole, outerNode);\r\n    if (outerNode) {\r\n        var b = splitPolygon(outerNode, hole);\r\n        filterPoints(b, b.next);\r\n    }\r\n}\r\n\r\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\r\nfunction findHoleBridge(hole, outerNode) {\r\n    var p = outerNode,\r\n        hx = hole.x,\r\n        hy = hole.y,\r\n        qx = -Infinity,\r\n        m;\r\n\r\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\r\n    // segment's endpoint with lesser x will be potential connection point\r\n    do {\r\n        if (hy <= p.y && hy >= p.next.y) {\r\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\r\n            if (x <= hx && x > qx) {\r\n                qx = x;\r\n                if (x === hx) {\r\n                    if (hy === p.y) return p;\r\n                    if (hy === p.next.y) return p.next;\r\n                }\r\n                m = p.x < p.next.x ? p : p.next;\r\n            }\r\n        }\r\n        p = p.next;\r\n    } while (p !== outerNode);\r\n\r\n    if (!m) return null;\r\n\r\n    if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\r\n\r\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\r\n    // if there are no points found, we have a valid connection;\r\n    // otherwise choose the point of the minimum angle with the ray as connection point\r\n\r\n    var stop = m,\r\n        mx = m.x,\r\n        my = m.y,\r\n        tanMin = Infinity,\r\n        tan;\r\n\r\n    p = m.next;\r\n\r\n    while (p !== stop) {\r\n        if (hx >= p.x && p.x >= mx &&\r\n                pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\r\n\r\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\r\n\r\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\r\n                m = p;\r\n                tanMin = tan;\r\n            }\r\n        }\r\n\r\n        p = p.next;\r\n    }\r\n\r\n    return m;\r\n}\r\n\r\n// interlink polygon nodes in z-order\r\nfunction indexCurve(start, minX, minY, size) {\r\n    var p = start;\r\n    do {\r\n        if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, size);\r\n        p.prevZ = p.prev;\r\n        p.nextZ = p.next;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    p.prevZ.nextZ = null;\r\n    p.prevZ = null;\r\n\r\n    sortLinked(p);\r\n}\r\n\r\n// Simon Tatham's linked list merge sort algorithm\r\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\r\nfunction sortLinked(list) {\r\n    var i, p, q, e, tail, numMerges, pSize, qSize,\r\n        inSize = 1;\r\n\r\n    do {\r\n        p = list;\r\n        list = null;\r\n        tail = null;\r\n        numMerges = 0;\r\n\r\n        while (p) {\r\n            numMerges++;\r\n            q = p;\r\n            pSize = 0;\r\n            for (i = 0; i < inSize; i++) {\r\n                pSize++;\r\n                q = q.nextZ;\r\n                if (!q) break;\r\n            }\r\n\r\n            qSize = inSize;\r\n\r\n            while (pSize > 0 || (qSize > 0 && q)) {\r\n\r\n                if (pSize === 0) {\r\n                    e = q;\r\n                    q = q.nextZ;\r\n                    qSize--;\r\n                } else if (qSize === 0 || !q) {\r\n                    e = p;\r\n                    p = p.nextZ;\r\n                    pSize--;\r\n                } else if (p.z <= q.z) {\r\n                    e = p;\r\n                    p = p.nextZ;\r\n                    pSize--;\r\n                } else {\r\n                    e = q;\r\n                    q = q.nextZ;\r\n                    qSize--;\r\n                }\r\n\r\n                if (tail) tail.nextZ = e;\r\n                else list = e;\r\n\r\n                e.prevZ = tail;\r\n                tail = e;\r\n            }\r\n\r\n            p = q;\r\n        }\r\n\r\n        tail.nextZ = null;\r\n        inSize *= 2;\r\n\r\n    } while (numMerges > 1);\r\n\r\n    return list;\r\n}\r\n\r\n// z-order of a point given coords and size of the data bounding box\r\nfunction zOrder(x, y, minX, minY, size) {\r\n    // coords are transformed into non-negative 15-bit integer range\r\n    x = 32767 * (x - minX) / size;\r\n    y = 32767 * (y - minY) / size;\r\n\r\n    x = (x | (x << 8)) & 0x00FF00FF;\r\n    x = (x | (x << 4)) & 0x0F0F0F0F;\r\n    x = (x | (x << 2)) & 0x33333333;\r\n    x = (x | (x << 1)) & 0x55555555;\r\n\r\n    y = (y | (y << 8)) & 0x00FF00FF;\r\n    y = (y | (y << 4)) & 0x0F0F0F0F;\r\n    y = (y | (y << 2)) & 0x33333333;\r\n    y = (y | (y << 1)) & 0x55555555;\r\n\r\n    return x | (y << 1);\r\n}\r\n\r\n// find the leftmost node of a polygon ring\r\nfunction getLeftmost(start) {\r\n    var p = start,\r\n        leftmost = start;\r\n    do {\r\n        if (p.x < leftmost.x) leftmost = p;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return leftmost;\r\n}\r\n\r\n// check if a point lies within a convex triangle\r\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\r\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\r\n           (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\r\n           (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\r\n}\r\n\r\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\r\nfunction isValidDiagonal(a, b) {\r\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\r\n           locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\r\n}\r\n\r\n// signed area of a triangle\r\nfunction area(p, q, r) {\r\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\r\n}\r\n\r\n// check if two points are equal\r\nfunction equals(p1, p2) {\r\n    return p1.x === p2.x && p1.y === p2.y;\r\n}\r\n\r\n// check if two segments intersect\r\nfunction intersects(p1, q1, p2, q2) {\r\n    if ((equals(p1, q1) && equals(p2, q2)) ||\r\n        (equals(p1, q2) && equals(p2, q1))) return true;\r\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\r\n           area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\r\n}\r\n\r\n// check if a polygon diagonal intersects any polygon segments\r\nfunction intersectsPolygon(a, b) {\r\n    var p = a;\r\n    do {\r\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\r\n                intersects(p, p.next, a, b)) return true;\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return false;\r\n}\r\n\r\n// check if a polygon diagonal is locally inside the polygon\r\nfunction locallyInside(a, b) {\r\n    return area(a.prev, a, a.next) < 0 ?\r\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\r\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\r\n}\r\n\r\n// check if the middle point of a polygon diagonal is inside the polygon\r\nfunction middleInside(a, b) {\r\n    var p = a,\r\n        inside = false,\r\n        px = (a.x + b.x) / 2,\r\n        py = (a.y + b.y) / 2;\r\n    do {\r\n        if (((p.y > py) !== (p.next.y > py)) && (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\r\n            inside = !inside;\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return inside;\r\n}\r\n\r\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\r\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\r\nfunction splitPolygon(a, b) {\r\n    var a2 = new Node(a.i, a.x, a.y),\r\n        b2 = new Node(b.i, b.x, b.y),\r\n        an = a.next,\r\n        bp = b.prev;\r\n\r\n    a.next = b;\r\n    b.prev = a;\r\n\r\n    a2.next = an;\r\n    an.prev = a2;\r\n\r\n    b2.next = a2;\r\n    a2.prev = b2;\r\n\r\n    bp.next = b2;\r\n    b2.prev = bp;\r\n\r\n    return b2;\r\n}\r\n\r\n// create a node and optionally link it with previous one (in a circular doubly linked list)\r\nfunction insertNode(i, x, y, last) {\r\n    var p = new Node(i, x, y);\r\n\r\n    if (!last) {\r\n        p.prev = p;\r\n        p.next = p;\r\n\r\n    } else {\r\n        p.next = last.next;\r\n        p.prev = last;\r\n        last.next.prev = p;\r\n        last.next = p;\r\n    }\r\n    return p;\r\n}\r\n\r\nfunction removeNode(p) {\r\n    p.next.prev = p.prev;\r\n    p.prev.next = p.next;\r\n\r\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\r\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\r\n}\r\n\r\nfunction Node(i, x, y) {\r\n    // vertice index in coordinates array\r\n    this.i = i;\r\n\r\n    // vertex coordinates\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    // previous and next vertice nodes in a polygon ring\r\n    this.prev = null;\r\n    this.next = null;\r\n\r\n    // z-order curve value\r\n    this.z = null;\r\n\r\n    // previous and next nodes in z-order\r\n    this.prevZ = null;\r\n    this.nextZ = null;\r\n\r\n    // indicates whether this is a steiner point\r\n    this.steiner = false;\r\n}\r\n\r\n// return a percentage difference between the polygon area and its triangulation area;\r\n// used to verify correctness of triangulation\r\nearcut.deviation = function (data, holeIndices, dim, triangles) {\r\n    var hasHoles = holeIndices && holeIndices.length;\r\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\r\n\r\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\r\n    if (hasHoles) {\r\n        for (var i = 0, len = holeIndices.length; i < len; i++) {\r\n            var start = holeIndices[i] * dim;\r\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\r\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\r\n        }\r\n    }\r\n\r\n    var trianglesArea = 0;\r\n    for (i = 0; i < triangles.length; i += 3) {\r\n        var a = triangles[i] * dim;\r\n        var b = triangles[i + 1] * dim;\r\n        var c = triangles[i + 2] * dim;\r\n        trianglesArea += Math.abs(\r\n            (data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\r\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\r\n    }\r\n\r\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\r\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\r\n};\r\n\r\nfunction signedArea(data, start, end, dim) {\r\n    var sum = 0;\r\n    for (var i = start, j = end - dim; i < end; i += dim) {\r\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\r\n        j = i;\r\n    }\r\n    return sum;\r\n}\r\n\r\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\r\nearcut.flatten = function (data) {\r\n    var dim = data[0][0].length,\r\n        result = {vertices: [], holes: [], dimensions: dim},\r\n        holeIndex = 0;\r\n\r\n    for (var i = 0; i < data.length; i++) {\r\n        for (var j = 0; j < data[i].length; j++) {\r\n            for (var d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\r\n        }\r\n        if (i > 0) {\r\n            holeIndex += data[i - 1].length;\r\n            result.holes.push(holeIndex);\r\n        }\r\n    }\r\n    return result;\r\n};\r\n\r\nexport default earcut;\r\n\r\n","import {initShaders, getColorData} from './util';\r\nimport earcut from './earcut';\r\n\r\nvar vs_s = [\r\n    'attribute vec4 a_Position;',\r\n    'void main() {',\r\n    'gl_Position = a_Position;',\r\n    'gl_PointSize = 30.0;',\r\n    '}'\r\n].join('');\r\n\r\nvar fs_s = [\r\n    'precision mediump float;',\r\n    'uniform vec4 u_FragColor;',\r\n    'void main() {',\r\n    'gl_FragColor = u_FragColor;',\r\n    '}'\r\n].join('');\r\n\r\nfunction draw(gl, data, options) {\r\n\r\n    if (!data) {\r\n        return;\r\n    }\r\n\r\n    // gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\r\n\r\n    var program = initShaders(gl, vs_s, fs_s)\r\n\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\r\n\r\n    var halfCanvasWidth = gl.canvas.width / 2;\r\n    var halfCanvasHeight = gl.canvas.height / 2;\r\n\r\n    // Bind the buffer object to target\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer());\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer());\r\n\r\n    var a_Position = gl.getAttribLocation(program, 'a_Position');\r\n    // Assign the buffer object to a_Position variable\r\n    gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0);\r\n\r\n    // Enable the assignment to a_Position variable\r\n    gl.enableVertexAttribArray(a_Position);\r\n\r\n    var uFragColor = gl.getUniformLocation(program, 'u_FragColor');\r\n\r\n    var colored = getColorData(options.fillStyle || 'red')\r\n\r\n    gl.uniform4f(uFragColor,\r\n        colored[0] / 255,\r\n        colored[1] / 255,\r\n        colored[2] / 255,\r\n        colored[3] / 255);\r\n\r\n    gl.lineWidth(options.lineWidth || 1);\r\n\r\n    var verticesArr = [];\r\n    var trianglesArr = [];\r\n\r\n    var maxSize = 65536;\r\n    var indexOffset = 0;\r\n\r\n    for (var i = 0, len = data.length; i < len; i++) {\r\n\r\n        var flatten = earcut.flatten(data[i].geometry._coordinates || data[i].geometry.coordinates);\r\n        var vertices = flatten.vertices;\r\n        indexOffset = verticesArr.length / 2;\r\n        for (var j = 0; j < vertices.length; j += 2) {\r\n            vertices[j] = (vertices[j] - halfCanvasWidth) / halfCanvasWidth;\r\n            vertices[j + 1] = (halfCanvasHeight - vertices[j + 1]) / halfCanvasHeight;\r\n        }\r\n\r\n        if ((verticesArr.length + vertices.length) / 2 > maxSize) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verticesArr), gl.STATIC_DRAW);\r\n            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(trianglesArr), gl.STATIC_DRAW);\r\n            gl.drawElements(gl.TRIANGLES, trianglesArr.length, gl.UNSIGNED_SHORT, 0);\r\n            verticesArr.length = 0;\r\n            trianglesArr.length = 0;\r\n            indexOffset = 0;\r\n        }\r\n\r\n        for (var j = 0; j < vertices.length; j++) {\r\n            verticesArr.push(vertices[j]);\r\n        }\r\n\r\n        var triangles = earcut(vertices, flatten.holes, flatten.dimensions);\r\n        for (var j = 0; j < triangles.length; j++) {\r\n            trianglesArr.push(triangles[j] + indexOffset);\r\n        }\r\n    }\r\n\r\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verticesArr), gl.STATIC_DRAW);\r\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(trianglesArr), gl.STATIC_DRAW);\r\n    gl.drawElements(gl.TRIANGLES, trianglesArr.length, gl.UNSIGNED_SHORT, 0);\r\n\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n\r\n};\r\n\r\nexport default {\r\n    draw: draw\r\n}\r\n","/**\r\n * @author kyle / http://nikai.us/\r\n */\r\nimport DataSet from \"../../data/DataSet\";\r\nimport line from \"./line\";\r\nimport point from \"./point\";\r\nimport polygon from \"./polygon\";\r\n\r\nexport default {\r\n    draw: function(gl, dataSet, options) {\r\n        var data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\r\n        if (data.length > 0) {\r\n            if (data[0].geometry.type == \"LineString\") {\r\n                line.draw(gl, data, options);\r\n            } else if (data[0].geometry.type == \"Polygon\" || data[0].geometry.type == \"MultiPolygon\") {\r\n                polygon.draw(gl, data, options);\r\n            } else {\r\n                point.draw(gl, data, options);\r\n            }\r\n        }\r\n    }\r\n}\r\n","/**\n * 曲线生成工具\n * 根据弧线的坐标节点数组生成曲线点\n */\n\n// 定义点接口\nexport interface Point {\n    lng: number;\n    lat: number;\n}\n\n// 定义曲线选项接口\ninterface CurveOptions {\n    count?: number;\n}\n\n// 定义曲线点类型\nexport type CurvePoint = [number, number];\n\n/**\n * 根据两点获取曲线坐标点数组\n * @param {Point} obj1 - 起点\n * @param {Point} obj2 - 终点\n * @param {number} count - 曲线线段数量，默认为40\n * @returns {CurvePoint[] | null} - 曲线坐标点数组\n */\nfunction getCurveByTwoPoints(obj1: Point, obj2: Point, count?: number): CurvePoint[] | null {\n    if (!obj1 || !obj2) {\n        return null;\n    }\n\n    // 贝塞尔曲线的三个基函数\n    const B1 = (x: number): number => {\n        return 1 - 2 * x + x * x;\n    };\n    \n    const B2 = (x: number): number => {\n        return 2 * x - 2 * x * x;\n    };\n    \n    const B3 = (x: number): number => {\n        return x * x;\n    };\n\n    const curveCoordinates: CurvePoint[] = [];\n    const pointCount = count || 40; // 曲线由点Count个小线段组成\n    let inc = 0;\n\n    const lat1 = parseFloat(obj1.lat.toString());\n    const lat2 = parseFloat(obj2.lat.toString());\n    const lng1 = parseFloat(obj1.lng.toString());\n    const lng2 = parseFloat(obj2.lng.toString());\n\n    // 计算曲线角度\n    let adjustedLng1 = lng1;\n    let adjustedLng2 = lng2;\n    \n    if (adjustedLng2 > adjustedLng1) {\n        if (parseFloat((adjustedLng2 - adjustedLng1).toString()) > 180) {\n            if (adjustedLng1 < 0) {\n                adjustedLng1 = parseFloat((180 + 180 + adjustedLng1).toString());\n                adjustedLng2 = parseFloat((180 + 180 + adjustedLng2).toString());\n            }\n        }\n    }\n\n    let t: number;\n    let h: number;\n    let h2: number;\n    let lat3: number;\n    let lng3: number;\n\n    // 纬度相同\n    if (lat2 === lat1) {\n        t = 0;\n        h = adjustedLng1 - adjustedLng2;\n    } \n    // 经度相同\n    else if (adjustedLng2 === adjustedLng1) {\n        t = Math.PI / 2;\n        h = lat1 - lat2;\n    } \n    // 其他情况\n    else {\n        t = Math.atan((lat2 - lat1) / (adjustedLng2 - adjustedLng1));\n        h = (lat2 - lat1) / Math.sin(t);\n    }\n\n    const t2 = t + (Math.PI / 5);\n    h2 = h / 2;\n    lng3 = h2 * Math.cos(t2) + adjustedLng1;\n    lat3 = h2 * Math.sin(t2) + lat1;\n\n    // 生成曲线点\n    for (let i = 0; i < pointCount + 1; i++) {\n        const x = adjustedLng1 * B1(inc) + lng3 * B2(inc) + adjustedLng2 * B3(inc);\n        const y = lat1 * B1(inc) + lat3 * B2(inc) + lat2 * B3(inc);\n        const lng1_src = obj1.lng;\n        const lng2_src = obj2.lng;\n\n        curveCoordinates.push([\n            (lng1_src < 0 && lng2_src > 0) ? x - 360 : x, y\n        ]);\n        inc += (1 / pointCount);\n    }\n\n    return curveCoordinates;\n}\n\n/**\n * 根据弧线的坐标节点数组获取曲线点\n * @param {Point[]} points - 坐标节点数组\n * @param {CurveOptions} options - 曲线选项\n * @returns {CurvePoint[]} - 曲线坐标点数组\n */\nfunction getCurvePoints(points: Point[], options?: CurveOptions): CurvePoint[] {\n    let curvePoints: CurvePoint[] = [];\n    for (let i = 0; i < points.length - 1; i++) {\n        const p = getCurveByTwoPoints(points[i], points[i + 1], options?.count);\n        if (p && p.length > 0) {\n            curvePoints = curvePoints.concat(p);\n        }\n    }\n    return curvePoints;\n}\n\n// 曲线工具对象\nexport const curve = {\n    getPoints: getCurvePoints\n};\n\nexport default curve;","/* \r\nFDEB algorithm implementation [www.win.tue.nl/~dholten/papers/forcebundles_eurovis.pdf].\r\n\r\nAuthor:  (github.com/upphiminn)\r\n2013\r\n\r\n*/\r\n  \r\nvar ForceEdgeBundling = function(){\r\n    var data_nodes = {},        // {'nodeid':{'x':,'y':},..}\r\n            data_edges = [],        // [{'source':'nodeid1', 'target':'nodeid2'},..]\r\n            compatibility_list_for_edge = [],\r\n            subdivision_points_for_edge = [],\r\n            K = 0.1,                // global bundling constant controling edge stiffness\r\n            S_initial = 0.1,        // init. distance to move points\r\n            P_initial = 1,          // init. subdivision number\r\n            P_rate    = 2,          // subdivision rate increase\r\n            C = 6,                  // number of cycles to perform\r\n            I_initial = 70,         // init. number of iterations for cycle\r\n            I_rate = 0.6666667,     // rate at which iteration number decreases i.e. 2/3\r\n            compatibility_threshold = 0.6,\r\n            invers_quadratic_mode  = false,\r\n            eps = 1e-8;\r\n             \r\n\r\n        /*** Geometry Helper Methods ***/\r\n        function vector_dot_product(p, q){\r\n            return p.x * q.x + p.y * q.y;\r\n        }\r\n\r\n        function edge_as_vector(P){\r\n            return {'x': data_nodes[P.target].x - data_nodes[P.source].x,\r\n                    'y': data_nodes[P.target].y - data_nodes[P.source].y}\r\n        }\r\n\r\n        function edge_length(e){\r\n            return Math.sqrt(Math.pow(data_nodes[e.source].x-data_nodes[e.target].x, 2) +\r\n                             Math.pow(data_nodes[e.source].y-data_nodes[e.target].y, 2));\r\n        }\r\n\r\n        function custom_edge_length(e){\r\n            return Math.sqrt(Math.pow(e.source.x - e.target.x, 2) + Math.pow(e.source.y - e.target.y, 2));\r\n        }\r\n\r\n        function edge_midpoint(e){\r\n            var middle_x = (data_nodes[e.source].x + data_nodes[e.target].x) / 2.0;\r\n            var middle_y = (data_nodes[e.source].y + data_nodes[e.target].y) / 2.0;\r\n            return {'x': middle_x, 'y': middle_y};\r\n        }\r\n\r\n        function compute_divided_edge_length(e_idx){\r\n            var length = 0;\r\n            for(var i = 1; i < subdivision_points_for_edge[e_idx].length; i++){\r\n                var segment_length = euclidean_distance(subdivision_points_for_edge[e_idx][i],\r\n                                                        subdivision_points_for_edge[e_idx][i-1]);\r\n                length += segment_length;\r\n            }\r\n            return length;\r\n        }\r\n\r\n        function euclidean_distance(p, q){\r\n            return Math.sqrt(Math.pow(p.x-q.x, 2) + Math.pow(p.y-q.y, 2));\r\n        }\r\n\r\n        function project_point_on_line(p, Q)\r\n        {   \r\n            var L = Math.sqrt((Q.target.x - Q.source.x) * (Q.target.x - Q.source.x) + (Q.target.y - Q.source.y) * (Q.target.y - Q.source.y));\r\n            var r = ((Q.source.y - p.y) * (Q.source.y - Q.target.y) - (Q.source.x - p.x) * (Q.target.x - Q.source.x)) / (L * L);\r\n            \r\n            return  {'x':(Q.source.x + r * (Q.target.x - Q.source.x)), 'y':(Q.source.y + r * (Q.target.y - Q.source.y))};\r\n        }\r\n\r\n        /*** ********************** ***/\r\n\r\n        /*** Initialization Methods ***/\r\n        function initialize_edge_subdivisions()\r\n        {\r\n            for(var i = 0; i < data_edges.length; i++)\r\n             if(P_initial == 1)\r\n                subdivision_points_for_edge[i] = []; //0 subdivisions\r\n             else{\r\n                subdivision_points_for_edge[i] = [];\r\n                subdivision_points_for_edge[i].push(data_nodes[data_edges[i].source]);\r\n                subdivision_points_for_edge[i].push(data_nodes[data_edges[i].target]);\r\n            }\r\n        }\r\n\r\n        function initialize_compatibility_lists()\r\n        {\r\n            for(var i = 0; i < data_edges.length; i++)\r\n                compatibility_list_for_edge[i] = []; //0 compatible edges.\r\n        }\r\n\r\n        function filter_self_loops(edgelist){\r\n            var filtered_edge_list = [];\r\n            for(var e=0; e < edgelist.length; e++){\r\n                if(data_nodes[edgelist[e].source].x != data_nodes[edgelist[e].target].x  &&\r\n                   data_nodes[edgelist[e].source].y != data_nodes[edgelist[e].target].y ){ //or smaller than eps\r\n                    filtered_edge_list.push(edgelist[e]);\r\n\r\n                }\r\n            }\r\n\r\n            return filtered_edge_list;\r\n        }\r\n        /*** ********************** ***/\r\n\r\n        /*** Force Calculation Methods ***/\r\n        function apply_spring_force(e_idx, i, kP){\r\n\r\n            var prev = subdivision_points_for_edge[e_idx][i-1];\r\n            var next = subdivision_points_for_edge[e_idx][i+1];\r\n            var crnt = subdivision_points_for_edge[e_idx][i];\r\n\r\n            var x = prev.x - crnt.x + next.x - crnt.x;\r\n            var y = prev.y - crnt.y + next.y - crnt.y;\r\n            \r\n            x *= kP;\r\n            y *= kP;\r\n            \r\n            return {'x' : x, 'y' : y};\r\n        }\r\n\r\n        function apply_electrostatic_force(e_idx, i , S){\r\n            var sum_of_forces         = { 'x' : 0, 'y' : 0};\r\n            var compatible_edges_list = compatibility_list_for_edge[e_idx];\r\n            \r\n            for(var oe = 0; oe < compatible_edges_list.length; oe++){\r\n                var force = {'x': subdivision_points_for_edge[compatible_edges_list[oe]][i].x - subdivision_points_for_edge[e_idx][i].x,\r\n                             'y': subdivision_points_for_edge[compatible_edges_list[oe]][i].y - subdivision_points_for_edge[e_idx][i].y};\r\n\r\n                \r\n                if((Math.abs(force.x) > eps)||(Math.abs(force.y) > eps)){\r\n                \r\n                var diff = ( 1 / Math.pow(custom_edge_length({'source':subdivision_points_for_edge[compatible_edges_list[oe]][i],\r\n                                                              'target':subdivision_points_for_edge[e_idx][i]}),1));\r\n                \r\n                sum_of_forces.x += force.x*diff;\r\n                sum_of_forces.y += force.y*diff;\r\n                }\r\n            } \r\n            return sum_of_forces;\r\n        }\r\n\r\n\r\n        function apply_resulting_forces_on_subdivision_points(e_idx, P, S){\r\n            var kP = K/(edge_length(data_edges[e_idx])*(P+1)); // kP=K/|P|(number of segments), where |P| is the initial length of edge P.\r\n                        // (length * (num of sub division pts - 1))\r\n            var resulting_forces_for_subdivision_points = [{'x':0, 'y':0}];\r\n            for(var i = 1; i < P+1; i++){ // exclude initial end points of the edge 0 and P+1\r\n                var resulting_force     = {'x' : 0, 'y' : 0};\r\n                \r\n                var spring_force            = apply_spring_force(e_idx, i , kP);\r\n                var electrostatic_force     = apply_electrostatic_force(e_idx, i, S);\r\n                \r\n                resulting_force.x   = S*(spring_force.x + electrostatic_force.x);\r\n                resulting_force.y   = S*(spring_force.y + electrostatic_force.y);\r\n\r\n                resulting_forces_for_subdivision_points.push(resulting_force);\r\n            }\r\n            resulting_forces_for_subdivision_points.push({'x':0, 'y':0});\r\n            return resulting_forces_for_subdivision_points;\r\n        }\r\n        /*** ********************** ***/\r\n\r\n        /*** Edge Division Calculation Methods ***/\r\n        function update_edge_divisions(P){\r\n            for(var e_idx=0; e_idx < data_edges.length; e_idx++){\r\n\r\n                if( P == 1 ){\r\n                    subdivision_points_for_edge[e_idx].push(data_nodes[data_edges[e_idx].source]); // source\r\n                    subdivision_points_for_edge[e_idx].push(edge_midpoint(data_edges[e_idx])); // mid point\r\n                    subdivision_points_for_edge[e_idx].push(data_nodes[data_edges[e_idx].target]); // target\r\n                }else{\r\n\r\n                    var divided_edge_length = compute_divided_edge_length(e_idx);\r\n                    var segment_length      = divided_edge_length / (P+1);\r\n                    var current_segment_length = segment_length;\r\n                    var new_subdivision_points = [];\r\n                    new_subdivision_points.push(data_nodes[data_edges[e_idx].source]); //source\r\n\r\n                    for(var i = 1; i < subdivision_points_for_edge[e_idx].length; i++){\r\n                        var old_segment_length = euclidean_distance(subdivision_points_for_edge[e_idx][i], subdivision_points_for_edge[e_idx][i-1]);\r\n\r\n                        while(old_segment_length > current_segment_length){\r\n                            var percent_position = current_segment_length / old_segment_length;\r\n                            var new_subdivision_point_x = subdivision_points_for_edge[e_idx][i-1].x;\r\n                            var new_subdivision_point_y = subdivision_points_for_edge[e_idx][i-1].y;\r\n\r\n                            new_subdivision_point_x += percent_position*(subdivision_points_for_edge[e_idx][i].x - subdivision_points_for_edge[e_idx][i-1].x);\r\n                            new_subdivision_point_y += percent_position*(subdivision_points_for_edge[e_idx][i].y - subdivision_points_for_edge[e_idx][i-1].y);\r\n                            new_subdivision_points.push( {'x':new_subdivision_point_x, \r\n                                                          'y':new_subdivision_point_y });\r\n                            \r\n                            old_segment_length     -= current_segment_length;\r\n                            current_segment_length  = segment_length;\r\n                        }\r\n                        current_segment_length -= old_segment_length;\r\n                    }\r\n                    new_subdivision_points.push(data_nodes[data_edges[e_idx].target]); //target\r\n                    subdivision_points_for_edge[e_idx] = new_subdivision_points;\r\n                }\r\n            }\r\n        }\r\n        /*** ********************** ***/\r\n\r\n        /*** Edge compatibility measures ***/\r\n        function angle_compatibility(P, Q){\r\n            var result = Math.abs(vector_dot_product(edge_as_vector(P),edge_as_vector(Q))/(edge_length(P)*edge_length(Q)));\r\n            return result;\r\n        }\r\n\r\n        function scale_compatibility(P, Q){\r\n            var lavg = (edge_length(P) + edge_length(Q))/2.0;\r\n            var result = 2.0/(lavg/Math.min(edge_length(P),edge_length(Q)) + Math.max(edge_length(P), edge_length(Q))/lavg);\r\n            return result;\r\n        }\r\n\r\n        function position_compatibility(P, Q){\r\n            var lavg = (edge_length(P) + edge_length(Q))/2.0;\r\n            var midP = {'x':(data_nodes[P.source].x + data_nodes[P.target].x)/2.0,\r\n                        'y':(data_nodes[P.source].y + data_nodes[P.target].y)/2.0};\r\n            var midQ = {'x':(data_nodes[Q.source].x + data_nodes[Q.target].x)/2.0,\r\n                        'y':(data_nodes[Q.source].y + data_nodes[Q.target].y)/2.0};\r\n            var result = lavg/(lavg + euclidean_distance(midP, midQ));\r\n            return result;\r\n        }\r\n\r\n        function edge_visibility(P, Q){\r\n            var I0 = project_point_on_line(data_nodes[Q.source], {'source':data_nodes[P.source],\r\n                                                                  'target':data_nodes[P.target]});\r\n            var I1 = project_point_on_line(data_nodes[Q.target], {'source':data_nodes[P.source], \r\n                                                                  'target':data_nodes[P.target]}); //send acutal edge points positions\r\n            var midI = {'x':(I0.x + I1.x)/2.0, \r\n                        'y':(I0.y + I1.y)/2.0};\r\n            var midP = {'x':(data_nodes[P.source].x + data_nodes[P.target].x)/2.0, \r\n                        'y':(data_nodes[P.source].y + data_nodes[P.target].y)/2.0};\r\n            var result = Math.max(0, 1 - 2 * euclidean_distance(midP,midI)/euclidean_distance(I0,I1));\r\n            return result;\r\n        }\r\n\r\n        function visibility_compatibility(P, Q){\r\n            return Math.min(edge_visibility(P,Q), edge_visibility(Q,P));\r\n        }\r\n\r\n        function compatibility_score(P, Q){\r\n            var result = (angle_compatibility(P,Q) * scale_compatibility(P,Q) * \r\n                          position_compatibility(P,Q) * visibility_compatibility(P,Q));\r\n\r\n            return result;\r\n        }\r\n\r\n        function are_compatible(P, Q){\r\n            // console.log('compatibility ' + P.source +' - '+ P.target + ' and ' + Q.source +' '+ Q.target);\r\n            return (compatibility_score(P,Q) >= compatibility_threshold);\r\n        }\r\n\r\n        function compute_compatibility_lists()\r\n        {\r\n            for(var e = 0; e < data_edges.length - 1; e++){\r\n                for( var oe = e + 1 ; oe < data_edges.length; oe++){ // don't want any duplicates\r\n                    if(e == oe)\r\n                        continue;\r\n                    else{\r\n                        if(are_compatible(data_edges[e],data_edges[oe])){\r\n                            compatibility_list_for_edge[e].push(oe);\r\n                            compatibility_list_for_edge[oe].push(e);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        /*** ************************ ***/\r\n\r\n        /*** Main Bundling Loop Methods ***/ \r\n        var forcebundle = function(){\r\n            var S = S_initial;\r\n            var I = I_initial;\r\n            var P = P_initial;\r\n            \r\n            initialize_edge_subdivisions();\r\n            initialize_compatibility_lists();\r\n            update_edge_divisions(P);\r\n            compute_compatibility_lists();\r\n            for(var cycle=0; cycle < C; cycle++){\r\n                for (var iteration = 0; iteration < I; iteration++){\r\n                    var forces = [];\r\n                    for(var edge = 0; edge < data_edges.length; edge++){\r\n                        forces[edge] = apply_resulting_forces_on_subdivision_points(edge, P, S);\r\n                    }\r\n                    for(var e = 0; e < data_edges.length; e++){\r\n                        for(var i=0; i < P + 1;i++){\r\n                            subdivision_points_for_edge[e][i].x += forces[e][i].x;\r\n                            subdivision_points_for_edge[e][i].y += forces[e][i].y;\r\n                        }\r\n                    }\r\n                }\r\n                //prepare for next cycle\r\n                S = S / 2;\r\n                P = P * 2;\r\n                I = I_rate * I;\r\n                \r\n                update_edge_divisions(P);\r\n                // console.log('C' + cycle);\r\n                // console.log('P' + P);\r\n                // console.log('S' + S);\r\n            }\r\n            return subdivision_points_for_edge;\r\n        }\r\n        /*** ************************ ***/\r\n\r\n\r\n        /*** Getters/Setters Methods ***/ \r\n        forcebundle.nodes = function(nl){\r\n            if(arguments.length == 0){\r\n                return data_nodes;\r\n            }\r\n            else{\r\n                data_nodes = nl;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.edges = function(ll){\r\n            if(arguments.length == 0){\r\n                return data_edges;\r\n            }\r\n            else{\r\n                data_edges = filter_self_loops(ll); //remove edges to from to the same point\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.bundling_stiffness = function(k){\r\n            if(arguments.length == 0){\r\n                return K;\r\n            }\r\n            else{\r\n                K = k;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.step_size = function(step){\r\n            if(arguments.length == 0){\r\n                return S_initial;\r\n            }\r\n            else{\r\n                S_initial = step;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.cycles = function(c){\r\n            if(arguments.length == 0){\r\n                return C;\r\n            }\r\n            else{\r\n                C = c;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.iterations = function(i){\r\n            if(arguments.length == 0){\r\n                return I_initial;\r\n            }\r\n            else{\r\n                I_initial = i;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.iterations_rate = function(i){\r\n            if(arguments.length == 0){\r\n                return I_rate;\r\n            }\r\n            else{\r\n                I_rate = i;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.subdivision_points_seed = function(p){\r\n            if(arguments.length == 0){\r\n                return P;\r\n            }\r\n            else{\r\n                P = p;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.subdivision_rate = function(r){\r\n            if(arguments.length == 0){\r\n                return P_rate;\r\n            }\r\n            else{\r\n                P_rate = r;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        forcebundle.compatbility_threshold = function(t){\r\n            if(arguments.length == 0){\r\n                return compatbility_threshold;\r\n            }\r\n            else{\r\n                compatibility_threshold = t;\r\n            }\r\n            return forcebundle;\r\n        }\r\n\r\n        /*** ************************ ***/\r\n\r\n    return forcebundle;\r\n}\r\n\r\nexport default ForceEdgeBundling;\r\n\r\n","/**\n * 分类映射工具\n * @author kyle / http://nikai.us/\n */\n\nimport DataSet from '../../data/DataSet';\n\n// 定义分类规则接口\nexport interface SplitList {\n    [key: string]: any;\n}\n\n// 定义分类选项接口\nexport interface CategoryOptions {\n    splitList?: SplitList;\n}\n\n// 定义图例选项接口\nexport interface LegendOptions {\n    [key: string]: any;\n}\n\n/**\n * 分类映射类，用于处理分类数据\n */\nexport default class Category {\n    private splitList: SplitList;\n\n    /**\n     * 构造函数\n     * @param {SplitList} splitList - 分类规则\n     */\n    constructor(splitList: SplitList = { other: 1 }) {\n        this.splitList = splitList;\n    }\n\n    /**\n     * 根据值获取分类结果\n     * @param {any} count - 输入值\n     * @returns {any} - 分类结果\n     */\n    get(count: any): any {\n        const splitList = this.splitList;\n        let value = splitList['other'];\n\n        for (const i in splitList) {\n            if (count == i) {\n                value = splitList[i];\n                break;\n            }\n        }\n\n        return value;\n    }\n\n    /**\n     * 根据DataSet自动生成对应的splitList\n     * @param {DataSet} dataSet - 数据集\n     * @param {string[]} [color] - 颜色数组\n     */\n    generateByDataSet(dataSet: DataSet, color?: string[]): void {\n        const colors = color || [\n            'rgba(255, 255, 0, 0.8)', \n            'rgba(253, 98, 104, 0.8)', \n            'rgba(255, 146, 149, 0.8)', \n            'rgba(255, 241, 193, 0.8)', \n            'rgba(110, 176, 253, 0.8)', \n            'rgba(52, 139, 251, 0.8)', \n            'rgba(17, 102, 252, 0.8)'\n        ];\n        \n        const data = dataSet.get();\n        this.splitList = {};\n        let count = 0;\n        \n        for (let i = 0; i < data.length; i++) {\n            const dataCount = data[i].count;\n            if (this.splitList[dataCount] === undefined) {\n                this.splitList[dataCount] = colors[count];\n                count++;\n            }\n            if (count >= colors.length - 1) {\n                break;\n            }\n        }\n\n        this.splitList['other'] = colors[colors.length - 1];\n    }\n\n    /**\n     * 根据唯一值自动生成splitList\n     * @param {DataSet} dataSet - 数据集\n     * @param {string} columnName - 列名\n     * @param {string[]} [colors] - 颜色数组\n     */\n    generateByUniqueValues(dataSet: DataSet, columnName: string, colors?: string[]): void {\n        // 注意：这里假设DataSet有getUnique方法，需要确保DataSet类中有这个方法\n        const uniqueValues = (dataSet as any).getUnique(columnName);\n        const colorArray = colors || this.getDefaultColors();\n        \n        this.splitList = {};\n        for (let i = 0; i < uniqueValues.length; i++) {\n            this.splitList[uniqueValues[i]] = colorArray[i % colorArray.length];\n        }\n        this.splitList['other'] = colorArray[colorArray.length - 1];\n    }\n\n    /**\n     * 获取默认颜色列表\n     * @returns {string[]} - 默认颜色列表\n     */\n    getDefaultColors(): string[] {\n        return [\n            'rgba(255, 255, 0, 0.8)', \n            'rgba(253, 98, 104, 0.8)', \n            'rgba(255, 146, 149, 0.8)', \n            'rgba(255, 241, 193, 0.8)', \n            'rgba(110, 176, 253, 0.8)', \n            'rgba(52, 139, 251, 0.8)', \n            'rgba(17, 102, 252, 0.8)',\n            'rgba(0, 176, 104, 0.8)',\n            'rgba(128, 128, 128, 0.8)',\n            'rgba(255, 0, 255, 0.8)'\n        ];\n    }\n\n    /**\n     * 添加新的分类规则\n     * @param {string} key - 分类键\n     * @param {any} value - 分类值\n     */\n    addCategory(key: string, value: any): void {\n        this.splitList[key] = value;\n    }\n\n    /**\n     * 移除分类规则\n     * @param {string} key - 分类键\n     */\n    removeCategory(key: string): void {\n        delete this.splitList[key];\n    }\n\n    /**\n     * 更新分类规则\n     * @param {string} key - 分类键\n     * @param {any} value - 分类值\n     * @returns {boolean} - 是否更新成功\n     */\n    updateCategory(key: string, value: any): boolean {\n        if (this.splitList[key] !== undefined) {\n            this.splitList[key] = value;\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * 获取所有分类规则\n     * @returns {SplitList} - 分类规则\n     */\n    getCategories(): SplitList {\n        return this.splitList;\n    }\n\n    /**\n     * 获取图例\n     * @param {LegendOptions} options - 图例选项\n     * @returns {HTMLDivElement} - 图例元素\n     */\n    getLegend(options: LegendOptions): HTMLDivElement {\n        const splitList = this.splitList;\n        const container = document.createElement('div');\n        container.style.cssText = \"background:#fff; padding: 5px; border: 1px solid #ccc;\";\n        let html = '';\n        for (const key in splitList) {\n            html += `<div style=\"line-height: 19px;\" value=\"${key}\"><span style=\"vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:${splitList[key]};\"></span><span style=\"margin-left: 3px;\">${key}<span></div>`;\n        }\n        container.innerHTML = html;\n        return container;\n    }\n}","/**\n * 区间映射工具\n * @author kyle / http://nikai.us/\n */\n\nimport DataSet from '../../data/DataSet';\n\n// 定义区间规则接口\nexport interface RangeRule {\n    start?: number;\n    end?: number;\n    value: any;\n}\n\n// 定义自定义区间接口\nexport interface CustomRange {\n    start: number;\n    end: number;\n}\n\n// 定义图例选项接口\nexport interface LegendOptions {\n    [key: string]: any;\n}\n\n/**\n * 区间映射类，用于处理区间数据\n */\nexport default class Choropleth {\n    private splitList: RangeRule[];\n\n    /**\n     * 构造函数\n     * @param {RangeRule[]} splitList - 区间规则\n     */\n    constructor(splitList: RangeRule[] = [{ start: 0, value: 'red' }]) {\n        this.splitList = splitList;\n    }\n\n    /**\n     * 根据值获取区间结果\n     * @param {number} count - 输入值\n     * @returns {any} - 区间结果\n     */\n    get(count: number): any {\n        const splitList = this.splitList;\n        let value = false;\n\n        for (let i = 0; i < splitList.length; i++) {\n            const rule = splitList[i];\n            const startCondition = rule.start === undefined || count >= rule.start;\n            const endCondition = rule.end === undefined || count < rule.end;\n            \n            if (startCondition && endCondition) {\n                value = rule.value;\n                break;\n            }\n        }\n\n        return value;\n    }\n\n    /**\n     * 根据DataSet自动生成对应的区间规则\n     * @param {DataSet} dataSet - 数据集\n     */\n    generateByDataSet(dataSet: DataSet): void {\n        const min = dataSet.getMin('count') || 0;\n        const max = dataSet.getMax('count') || 100;\n        this.generateByMinMax(min, max);\n    }\n\n    /**\n     * 根据最小值和最大值生成区间规则\n     * @param {number} min - 最小值\n     * @param {number} max - 最大值\n     */\n    generateByMinMax(min: number, max: number): void {\n        const colors = [\n            'rgba(255, 255, 0, 0.8)', \n            'rgba(253, 98, 104, 0.8)', \n            'rgba(255, 146, 149, 0.8)', \n            'rgba(255, 241, 193, 0.8)', \n            'rgba(110, 176, 253, 0.8)', \n            'rgba(52, 139, 251, 0.8)', \n            'rgba(17, 102, 252, 0.8)'\n        ];\n        \n        const splitNum = Number((max - min) / 7);\n        const maxNum = Number(max);\n        let index = Number(min);\n        this.splitList = [];\n        let count = 0;\n\n        while (index < maxNum) {\n            this.splitList.push({\n                start: index,\n                end: index + splitNum,\n                value: colors[count]\n            });\n            count++;\n            index += splitNum;\n        }\n    }\n\n    /**\n     * 根据自定义区间生成区间规则\n     * @param {CustomRange[]} ranges - 自定义区间\n     * @param {string[]} [colors] - 颜色数组\n     */\n    generateByCustomRange(ranges: CustomRange[], colors?: string[]): void {\n        const colorArray = colors || this.getDefaultColors();\n        this.splitList = [];\n        \n        for (let i = 0; i < ranges.length; i++) {\n            this.splitList.push({\n                start: ranges[i].start,\n                end: ranges[i].end,\n                value: colorArray[i % colorArray.length]\n            });\n        }\n    }\n\n    /**\n     * 获取默认颜色列表\n     * @returns {string[]} - 默认颜色列表\n     */\n    getDefaultColors(): string[] {\n        return [\n            'rgba(255, 255, 0, 0.8)', \n            'rgba(253, 98, 104, 0.8)', \n            'rgba(255, 146, 149, 0.8)', \n            'rgba(255, 241, 193, 0.8)', \n            'rgba(110, 176, 253, 0.8)', \n            'rgba(52, 139, 251, 0.8)', \n            'rgba(17, 102, 252, 0.8)',\n            'rgba(0, 176, 104, 0.8)',\n            'rgba(128, 128, 128, 0.8)',\n            'rgba(255, 0, 255, 0.8)'\n        ];\n    }\n\n    /**\n     * 添加新的区间规则\n     * @param {RangeRule} range - 区间规则\n     */\n    addRange(range: RangeRule): void {\n        this.splitList.push(range);\n        // 重新排序以确保区间顺序正确\n        this.splitList.sort((a, b) => (a.start || 0) - (b.start || 0));\n    }\n\n    /**\n     * 移除区间规则\n     * @param {number} index - 区间规则索引\n     */\n    removeRange(index: number): void {\n        if (index >= 0 && index < this.splitList.length) {\n            this.splitList.splice(index, 1);\n        }\n    }\n\n    /**\n     * 更新区间规则\n     * @param {number} index - 区间规则索引\n     * @param {RangeRule} range - 新的区间规则\n     * @returns {boolean} - 是否更新成功\n     */\n    updateRange(index: number, range: RangeRule): boolean {\n        if (index >= 0 && index < this.splitList.length) {\n            this.splitList[index] = range;\n            // 重新排序以确保区间顺序正确\n            this.splitList.sort((a, b) => (a.start || 0) - (b.start || 0));\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * 获取所有区间规则\n     * @returns {RangeRule[]} - 区间规则\n     */\n    getRanges(): RangeRule[] {\n        return this.splitList;\n    }\n\n    /**\n     * 获取图例\n     * @param {LegendOptions} options - 图例选项\n     * @returns {HTMLDivElement} - 图例元素\n     */\n    getLegend(options: LegendOptions): HTMLDivElement {\n        const splitList = this.splitList;\n        const container = document.createElement('div');\n        container.style.cssText = \"background:#fff; padding: 5px; border: 1px solid #ccc;\";\n        let html = '';\n        \n        for (let i = 0; i < splitList.length; i++) {\n            const range = splitList[i];\n            let label = '';\n            \n            if (range.start !== undefined && range.end !== undefined) {\n                label = `${range.start} - ${range.end}`;\n            } else if (range.start !== undefined) {\n                label = `> ${range.start}`;\n            } else if (range.end !== undefined) {\n                label = `< ${range.end}`;\n            } else {\n                label = 'All';\n            }\n            \n            html += `<div style=\"line-height: 19px;\"><span style=\"vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:${range.value};\"></span><span style=\"margin-left: 3px;\">${label}<span></div>`;\n        }\n        \n        container.innerHTML = html;\n        return container;\n    }\n}","/**\r\n * @author Mofei<http://www.zhuwenlong.com>\r\n */\r\n\r\nclass MapHelper {\r\n    constructor(id, type, opt) {\r\n        if (!id || !type) {\r\n            console.warn('id 和 type 为必填项');\r\n            return false;\r\n        }\r\n\r\n\r\n        if (type == 'baidu') {\r\n            if (!BMap) {\r\n                console.warn('请先引入百度地图JS API');\r\n                return false;\r\n            }\r\n        } else {\r\n            console.warn('暂不支持你的地图类型');\r\n        }\r\n        this.type = type;\r\n        var center = (opt && opt.center) ? opt.center : [106.962497, 38.208726];\r\n        var zoom = (opt && opt.zoom) ? opt.zoom : 5;\r\n        var map = this.map = new BMap.Map(id, {\r\n            enableMapClick: false\r\n        });\r\n        map.centerAndZoom(new BMap.Point(center[0], center[1]), zoom);\r\n        map.enableScrollWheelZoom(true);\r\n\r\n        map.setMapStyle({\r\n            style: 'light'\r\n        });\r\n    }\r\n\r\n    addLayer(datas, options) {\r\n        if (this.type == 'baidu') {\r\n            return new mapv.baiduMapLayer(this.map, dataSet, options);\r\n        }\r\n    }\r\n\r\n    getMap() {\r\n        return this.map;\r\n    }\r\n}\r\n\r\n// function MapHelper(dom, type, opt) {\r\n//     var map = new BMap.Map(dom, {\r\n//         enableMapClick: false\r\n//     });\r\n//     map.centerAndZoom(new BMap.Point(106.962497, 38.208726), 5);\r\n//     map.enableScrollWheelZoom(true);\r\n\r\n//     map.setMapStyle({\r\n//         style: 'light'\r\n//     });\r\n// }\r\n\r\nexport default MapHelper;","/**\r\n * 一直覆盖在当前地图视野的Canvas对象\r\n *\r\n * @author nikai (@胖嘟嘟的骨头, nikai@baidu.com)\r\n *\r\n * @param \r\n * {\r\n *     map 地图实例对象\r\n * }\r\n */\r\n\r\nfunction CanvasLayer(options) {\r\n    this.options = options || {};\r\n    this.paneName = this.options.paneName || 'mapPane';\r\n    this.context = this.options.context  || '2d';\r\n    this.zIndex = this.options.zIndex || 0;\r\n    this.mixBlendMode = this.options.mixBlendMode || null;\r\n    this.enableMassClear = this.options.enableMassClear;\r\n    this._map = options.map;\r\n    this._lastDrawTime = null;\r\n    this.show();\r\n}\r\n\r\nvar global = typeof window === 'undefined' ? {} : window;\r\nvar BMap = global.BMap || global.BMapGL;\r\nif (BMap) {\r\n\r\n    CanvasLayer.prototype = new BMap.Overlay();\r\n\r\n    CanvasLayer.prototype.initialize = function(map) {\r\n        this._map = map;\r\n        var canvas = this.canvas = document.createElement(\"canvas\");\r\n        canvas.style.cssText = \"position:absolute;\" + \"left:0;\" + \"top:0;\" + \"z-index:\" + this.zIndex + \";user-select:none;\";\r\n        canvas.style.mixBlendMode = this.mixBlendMode;\r\n        this.adjustSize();\r\n        var pane = map.getPanes()[this.paneName];\r\n        if (!pane) {\r\n            pane = map.getPanes().floatShadow;\r\n        }\r\n        pane.appendChild(canvas);\r\n        var that = this;\r\n        map.addEventListener('resize', function() {\r\n            that.adjustSize();\r\n            that._draw();\r\n        });\r\n        map.addEventListener('update', function() {\r\n            that._draw();\r\n        });\r\n        /*\r\n        map.addEventListener('moving', function() {\r\n            that._draw();\r\n        });\r\n        */\r\n        if (this.options.updateImmediate) {\r\n            setTimeout(function() {\r\n                that._draw();\r\n            }, 100);\r\n        }\r\n        return this.canvas;\r\n    }\r\n\r\n    CanvasLayer.prototype.adjustSize = function() {\r\n        var size = this._map.getSize();\r\n        var canvas = this.canvas;\r\n\r\n        var devicePixelRatio = this.devicePixelRatio = global.devicePixelRatio || 1;\r\n\r\n        canvas.width = size.width * devicePixelRatio;\r\n        canvas.height = size.height * devicePixelRatio;\r\n        if (this.context == '2d') {\r\n            canvas.getContext(this.context).scale(devicePixelRatio, devicePixelRatio);\r\n        }\r\n\r\n        canvas.style.width = size.width + \"px\";\r\n        canvas.style.height = size.height + \"px\";\r\n    }\r\n\r\n    CanvasLayer.prototype.draw = function() {\r\n        var self = this;\r\n        if (this.options.updateImmediate) {\r\n            self._draw();\r\n        } else {\r\n            clearTimeout(self.timeoutID);\r\n            self.timeoutID = setTimeout(function() {\r\n                self._draw();\r\n            }, 15);\r\n        }\r\n    }\r\n\r\n    CanvasLayer.prototype._draw = function() {\r\n        var map = this._map;\r\n        var size = map.getSize();\r\n        var center = map.getCenter();\r\n        if (center) {\r\n            var pixel = map.pointToOverlayPixel(center);\r\n            this.canvas.style.left = pixel.x - size.width / 2 + 'px';\r\n            this.canvas.style.top = pixel.y - size.height / 2 + 'px';\r\n            this.dispatchEvent('draw');\r\n            this.options.update && this.options.update.call(this);\r\n        }\r\n    }\r\n\r\n    CanvasLayer.prototype.getContainer = function() {\r\n        return this.canvas;\r\n    }\r\n\r\n    CanvasLayer.prototype.show = function() {\r\n        if (!this.canvas) {\r\n            this._map.addOverlay(this);\r\n        }\r\n        this.canvas.style.display = \"block\";\r\n    }\r\n\r\n    CanvasLayer.prototype.hide = function() {\r\n        this.canvas.style.display = \"none\";\r\n        //this._map.removeOverlay(this);\r\n    }\r\n\r\n    CanvasLayer.prototype.setZIndex = function(zIndex) {\r\n        this.zIndex = zIndex;\r\n        this.canvas.style.zIndex = this.zIndex;\r\n    }\r\n\r\n    CanvasLayer.prototype.getZIndex = function() {\r\n        return this.zIndex;\r\n    }\r\n\r\n}\r\n\r\nexport default CanvasLayer;\r\n","/**\n * Tween.js - 基于MIT许可证\n * https://github.com/tweenjs/tween.js\n * ----------------------------------------------\n *\n * 查看 https://github.com/tweenjs/tween.js/graphs/contributors 获取完整贡献者列表。\n * 谢谢大家，你们太棒了！\n */\n\n// 定义缓动函数类型\nexport type EasingFunction = (k: number) => number;\n\n// 定义插值函数类型\nexport type InterpolationFunction = (v: number[], k: number) => number;\n\n// 定义回调函数类型\nexport type TweenCallback = (object: any) => void;\nexport type UpdateCallback = (progress: number) => void;\n\n// 定义Tween类接口\nexport interface TweenInstance {\n    to(properties: any, duration?: number): this;\n    start(time?: number): this;\n    stop(): this;\n    end(): this;\n    stopChainedTweens(): this;\n    delay(amount: number): this;\n    repeat(times: number): this;\n    repeatDelay(amount: number): this;\n    yoyo(yoyo: boolean): this;\n    easing(easing: EasingFunction): this;\n    interpolation(interpolation: InterpolationFunction): this;\n    chain(...tweens: TweenInstance[]): this;\n    onStart(callback: TweenCallback): this;\n    onUpdate(callback: UpdateCallback): this;\n    onComplete(callback: TweenCallback): this;\n    onStop(callback: TweenCallback): this;\n    update(time: number): boolean;\n}\n\n// 定义TWEEN主对象接口\nexport interface TWEENStatic {\n    getAll(): TweenInstance[];\n    removeAll(): void;\n    add(tween: TweenInstance): void;\n    remove(tween: TweenInstance): void;\n    update(time?: number, preserve?: boolean): boolean;\n    now(): number;\n    Tween: new (object: any) => TweenInstance;\n    Easing: any;\n    Interpolation: any;\n}\n\n// TWEEN主对象实现\nconst TWEEN: TWEENStatic = (function () {\n\n    const _tweens: TweenInstance[] = [];\n\n    return {\n        /**\n         * 获取所有活动的tween实例\n         */\n        getAll: function (): TweenInstance[] {\n            return _tweens;\n        },\n\n        /**\n         * 移除所有tween实例\n         */\n        removeAll: function (): void {\n            _tweens.length = 0;\n        },\n\n        /**\n         * 添加一个tween实例\n         */\n        add: function (tween: TweenInstance): void {\n            _tweens.push(tween);\n        },\n\n        /**\n         * 移除一个tween实例\n         */\n        remove: function (tween: TweenInstance): void {\n            const i = _tweens.indexOf(tween);\n            if (i !== -1) {\n                _tweens.splice(i, 1);\n            }\n        },\n\n        /**\n         * 更新所有tween实例\n         */\n        update: function (time?: number, preserve?: boolean): boolean {\n            if (_tweens.length === 0) {\n                return false;\n            }\n\n            let i = 0;\n            time = time !== undefined ? time : TWEEN.now();\n\n            while (i < _tweens.length) {\n                if (_tweens[i].update(time) || preserve) {\n                    i++;\n                } else {\n                    _tweens.splice(i, 1);\n                }\n            }\n\n            return true;\n        },\n\n        /**\n         * 获取当前时间\n         */\n        now: function (): number {\n            return 0; // 初始值，后续会被覆盖\n        }\n    };\n\n})() as any;\n\n// Include a performance.now polyfill.\n// In node.js, use process.hrtime.\nif (typeof (window) === 'undefined' && typeof (process) !== 'undefined') {\n    TWEEN.now = function (): number {\n        const time = process.hrtime();\n        // Convert [seconds, nanoseconds] to milliseconds.\n        return time[0] * 1000 + time[1] / 1000000;\n    };\n}\n// In a browser, use window.performance.now if it is available.\nelse if (typeof (window) !== 'undefined' &&\n         window.performance !== undefined &&\n         window.performance.now !== undefined) {\n    // This must be bound, because directly assigning this function\n    // leads to an invocation exception in Chrome.\n    TWEEN.now = window.performance.now.bind(window.performance);\n}\n// Use Date.now if it is available.\nelse if (Date.now !== undefined) {\n    TWEEN.now = Date.now;\n}\n// Otherwise, use 'new Date().getTime()'.\nelse {\n    TWEEN.now = function (): number {\n        return new Date().getTime();\n    };\n}\n\n/**\n * Tween类实现\n */\nTWEEN.Tween = function (object: any): TweenInstance {\n    const _object = object;\n    const _valuesStart: { [key: string]: number | number[] } = {};\n    let _valuesEnd: { [key: string]: number | number[] | string } = {};\n    let _valuesStartRepeat: { [key: string]: number } = {};\n    let _duration = 1000;\n    let _repeat = 0;\n    let _repeatDelayTime: number | undefined;\n    let _yoyo = false;\n    let _isPlaying = false;\n    let _reversed = false;\n    let _delayTime = 0;\n    let _startTime: number | null = null;\n    let _easingFunction: EasingFunction = TWEEN.Easing.Linear.None;\n    let _interpolationFunction: InterpolationFunction = TWEEN.Interpolation.Linear;\n    const _chainedTweens: TweenInstance[] = [];\n    let _onStartCallback: TweenCallback | null = null;\n    let _onStartCallbackFired = false;\n    let _onUpdateCallback: UpdateCallback | null = null;\n    let _onCompleteCallback: TweenCallback | null = null;\n    let _onStopCallback: TweenCallback | null = null;\n\n    const tween = {\n        /**\n         * 设置目标属性和持续时间\n         */\n        to: function (properties: any, duration?: number): TweenInstance {\n            _valuesEnd = properties;\n            if (duration !== undefined) {\n                _duration = duration;\n            }\n            return this;\n        },\n\n        /**\n         * 开始tween动画\n         */\n        start: function (time?: number): TweenInstance {\n            TWEEN.add(this);\n            _isPlaying = true;\n            _onStartCallbackFired = false;\n            _startTime = time !== undefined ? time : TWEEN.now();\n            _startTime += _delayTime;\n\n            for (const property in _valuesEnd) {\n                // Check if an Array was provided as property value\n                if (_valuesEnd[property] instanceof Array) {\n                    if ((_valuesEnd[property] as any).length === 0) {\n                        continue;\n                    }\n                    // Create a local copy of the Array with the start value at the front\n                    (_valuesEnd[property] as any) = [_object[property]].concat(_valuesEnd[property]);\n                }\n\n                // If `to()` specifies a property that doesn't exist in the source object,\n                // we should not set that property in the object\n                if (_object[property] === undefined) {\n                    continue;\n                }\n\n                // Save the starting value.\n                _valuesStart[property] = _object[property];\n                if ((_valuesStart[property] instanceof Array) === false) {\n                    _valuesStart[property] = Number(_valuesStart[property]); // Ensures we're using numbers, not strings\n                }\n                _valuesStartRepeat[property] = _valuesStart[property] as number || 0;\n            }\n\n            return this;\n        },\n\n        /**\n         * 停止tween动画\n         */\n        stop: function (): TweenInstance {\n            if (!_isPlaying) {\n                return this;\n            }\n\n            TWEEN.remove(this);\n            _isPlaying = false;\n\n            if (_onStopCallback !== null) {\n                _onStopCallback.call(_object, _object);\n            }\n\n            this.stopChainedTweens();\n            return this;\n        },\n\n        /**\n         * 立即结束tween动画\n         */\n        end: function (): TweenInstance {\n            this.update((_startTime as number) + _duration);\n            return this;\n        },\n\n        /**\n         * 停止所有链式tween动画\n         */\n        stopChainedTweens: function (): TweenInstance {\n            for (let i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++) {\n                _chainedTweens[i].stop();\n            }\n            return this;\n        },\n\n        /**\n         * 设置延迟时间\n         */\n        delay: function (amount: number): TweenInstance {\n            _delayTime = amount;\n            return this;\n        },\n\n        /**\n         * 设置重复次数\n         */\n        repeat: function (times: number): TweenInstance {\n            _repeat = times;\n            return this;\n        },\n\n        /**\n         * 设置重复延迟时间\n         */\n        repeatDelay: function (amount: number): TweenInstance {\n            _repeatDelayTime = amount;\n            return this;\n        },\n\n        /**\n         * 设置是否反向播放\n         */\n        yoyo: function (yoyo: boolean): TweenInstance {\n            _yoyo = yoyo;\n            return this;\n        },\n\n        /**\n         * 设置缓动函数\n         */\n        easing: function (easing: EasingFunction): TweenInstance {\n            _easingFunction = easing;\n            return this;\n        },\n\n        /**\n         * 设置插值函数\n         */\n        interpolation: function (interpolation: InterpolationFunction): TweenInstance {\n            _interpolationFunction = interpolation;\n            return this;\n        },\n\n        /**\n         * 设置链式tween动画\n         */\n        chain: function (...args: TweenInstance[]): TweenInstance {\n            _chainedTweens.length = 0;\n            for (let i = 0, numArgs = args.length; i < numArgs; i++) {\n                _chainedTweens.push(args[i]);\n            }\n            return this;\n        },\n\n        /**\n         * 设置开始回调\n         */\n        onStart: function (callback: TweenCallback): TweenInstance {\n            _onStartCallback = callback;\n            return this;\n        },\n\n        /**\n         * 设置更新回调\n         */\n        onUpdate: function (callback: UpdateCallback): TweenInstance {\n            _onUpdateCallback = callback;\n            return this;\n        },\n\n        /**\n         * 设置完成回调\n         */\n        onComplete: function (callback: TweenCallback): TweenInstance {\n            _onCompleteCallback = callback;\n            return this;\n        },\n\n        /**\n         * 设置停止回调\n         */\n        onStop: function (callback: TweenCallback): TweenInstance {\n            _onStopCallback = callback;\n            return this;\n        },\n\n        /**\n         * 更新tween动画\n         */\n        update: function (time: number): boolean {\n            let property: string;\n            let elapsed: number;\n            let value: number;\n\n            if (time < _startTime!) {\n                return true;\n            }\n\n            if (_onStartCallbackFired === false) {\n                if (_onStartCallback !== null) {\n                    _onStartCallback.call(_object, _object);\n                }\n                _onStartCallbackFired = true;\n            }\n\n            elapsed = (time - _startTime!) / _duration;\n            elapsed = elapsed > 1 ? 1 : elapsed;\n\n            value = _easingFunction(elapsed);\n\n            for (property in _valuesEnd) {\n                // Don't update properties that do not exist in the source object\n                if (_valuesStart[property] === undefined) {\n                    continue;\n                }\n\n                const start = _valuesStart[property] as number;\n                const end = _valuesEnd[property];\n\n                if (end instanceof Array) {\n                    _object[property] = _interpolationFunction(end, value);\n                } else {\n                    // Parses relative end values with start as base (e.g.: +10, -3)\n                    let parsedEnd: number;\n                    if (typeof end === 'string') {\n                        if (end.charAt(0) === '+' || end.charAt(0) === '-') {\n                            parsedEnd = start + parseFloat(end);\n                        } else {\n                            parsedEnd = parseFloat(end);\n                        }\n                    } else {\n                        parsedEnd = end as number;\n                    }\n\n                    // Protect against non numeric properties.\n                    if (typeof parsedEnd === 'number') {\n                        _object[property] = start + (parsedEnd - start) * value;\n                    }\n                }\n            }\n\n            if (_onUpdateCallback !== null) {\n                _onUpdateCallback.call(_object, value);\n            }\n\n            if (elapsed === 1) {\n                if (_repeat > 0) {\n                    if (isFinite(_repeat)) {\n                        _repeat--;\n                    }\n\n                    // Reassign starting values, restart by making startTime = now\n                    for (property in _valuesStartRepeat) {\n                        const endValue = _valuesEnd[property];\n                        if (typeof endValue === 'string') {\n                            _valuesStartRepeat[property] += parseFloat(endValue);\n                        } else if (typeof endValue === 'number') {\n                            _valuesStartRepeat[property] += endValue;\n                        }\n\n                        if (_yoyo) {\n                            const tmp = _valuesStartRepeat[property];\n                            const endVal = _valuesEnd[property];\n                            if (typeof endVal === 'number') {\n                                _valuesStartRepeat[property] = endVal;\n                                _valuesEnd[property] = tmp;\n                            }\n                        }\n\n                        _valuesStart[property] = _valuesStartRepeat[property];\n                    }\n\n                    if (_yoyo) {\n                        _reversed = !_reversed;\n                    }\n\n                    if (_repeatDelayTime !== undefined) {\n                        _startTime = time + _repeatDelayTime;\n                    } else {\n                        _startTime = time + _delayTime;\n                    }\n\n                    return true;\n                } else {\n                    if (_onCompleteCallback !== null) {\n                        _onCompleteCallback.call(_object, _object);\n                    }\n\n                    for (let i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++) {\n                        // Make the chained tweens start exactly at the time they should,\n                        // even if the `update()` method was called way past the duration of the tween\n                        _chainedTweens[i].start((_startTime as number) + _duration);\n                    }\n\n                    return false;\n                }\n            }\n\n            return true;\n        }\n    };\n\n    return tween;\n} as any;\n\n/**\n * 缓动函数集合\n */\nTWEEN.Easing = {\n    Linear: {\n        None: function (k: number): number {\n            return k;\n        }\n    },\n\n    Quadratic: {\n        In: function (k: number): number {\n            return k * k;\n        },\n\n        Out: function (k: number): number {\n            return k * (2 - k);\n        },\n\n        InOut: function (k: number): number {\n            if ((k *= 2) < 1) {\n                return 0.5 * k * k;\n            }\n            return -0.5 * (--k * (k - 2) - 1);\n        }\n    },\n\n    Cubic: {\n        In: function (k: number): number {\n            return k * k * k;\n        },\n\n        Out: function (k: number): number {\n            return --k * k * k + 1;\n        },\n\n        InOut: function (k: number): number {\n            if ((k *= 2) < 1) {\n                return 0.5 * k * k * k;\n            }\n            return 0.5 * ((k -= 2) * k * k + 2);\n        }\n    },\n\n    Quartic: {\n        In: function (k: number): number {\n            return k * k * k * k;\n        },\n\n        Out: function (k: number): number {\n            return 1 - (--k * k * k * k);\n        },\n\n        InOut: function (k: number): number {\n            if ((k *= 2) < 1) {\n                return 0.5 * k * k * k * k;\n            }\n            return -0.5 * ((k -= 2) * k * k * k - 2);\n        }\n    },\n\n    Quintic: {\n        In: function (k: number): number {\n            return k * k * k * k * k;\n        },\n\n        Out: function (k: number): number {\n            return --k * k * k * k * k + 1;\n        },\n\n        InOut: function (k: number): number {\n            if ((k *= 2) < 1) {\n                return 0.5 * k * k * k * k * k;\n            }\n            return 0.5 * ((k -= 2) * k * k * k * k + 2);\n        }\n    },\n\n    Sinusoidal: {\n        In: function (k: number): number {\n            return 1 - Math.cos(k * Math.PI / 2);\n        },\n\n        Out: function (k: number): number {\n            return Math.sin(k * Math.PI / 2);\n        },\n\n        InOut: function (k: number): number {\n            return 0.5 * (1 - Math.cos(Math.PI * k));\n        }\n    },\n\n    Exponential: {\n        In: function (k: number): number {\n            return k === 0 ? 0 : Math.pow(1024, k - 1);\n        },\n\n        Out: function (k: number): number {\n            return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);\n        },\n\n        InOut: function (k: number): number {\n            if (k === 0) {\n                return 0;\n            }\n            if (k === 1) {\n                return 1;\n            }\n            if ((k *= 2) < 1) {\n                return 0.5 * Math.pow(1024, k - 1);\n            }\n            return 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);\n        }\n    },\n\n    Circular: {\n        In: function (k: number): number {\n            return 1 - Math.sqrt(1 - k * k);\n        },\n\n        Out: function (k: number): number {\n            return Math.sqrt(1 - (--k * k));\n        },\n\n        InOut: function (k: number): number {\n            if ((k *= 2) < 1) {\n                return -0.5 * (Math.sqrt(1 - k * k) - 1);\n            }\n            return 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\n        }\n    },\n\n    Elastic: {\n        In: function (k: number): number {\n            if (k === 0) {\n                return 0;\n            }\n            if (k === 1) {\n                return 1;\n            }\n            return -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n        },\n\n        Out: function (k: number): number {\n            if (k === 0) {\n                return 0;\n            }\n            if (k === 1) {\n                return 1;\n            }\n            return Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\n        },\n\n        InOut: function (k: number): number {\n            if (k === 0) {\n                return 0;\n            }\n            if (k === 1) {\n                return 1;\n            }\n            k *= 2;\n            if (k < 1) {\n                return -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n            }\n            return 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\n        }\n    },\n\n    Back: {\n        In: function (k: number): number {\n            const s = 1.70158;\n            return k * k * ((s + 1) * k - s);\n        },\n\n        Out: function (k: number): number {\n            const s = 1.70158;\n            return --k * k * ((s + 1) * k + s) + 1;\n        },\n\n        InOut: function (k: number): number {\n            const s = 1.70158 * 1.525;\n            if ((k *= 2) < 1) {\n                return 0.5 * (k * k * ((s + 1) * k - s));\n            }\n            return 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\n        }\n    },\n\n    Bounce: {\n        In: function (k: number): number {\n            return 1 - TWEEN.Easing.Bounce.Out(1 - k);\n        },\n\n        Out: function (k: number): number {\n            if (k < (1 / 2.75)) {\n                return 7.5625 * k * k;\n            } else if (k < (2 / 2.75)) {\n                return 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\n            } else if (k < (2.5 / 2.75)) {\n                return 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\n            } else {\n                return 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\n            }\n        },\n\n        InOut: function (k: number): number {\n            if (k < 0.5) {\n                return TWEEN.Easing.Bounce.In(k * 2) * 0.5;\n            }\n            return TWEEN.Easing.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\n        }\n    }\n};\n\n/**\n * 插值函数集合\n */\nTWEEN.Interpolation = {\n    Linear: function (v: number[], k: number): number {\n        const m = v.length - 1;\n        const f = m * k;\n        const i = Math.floor(f);\n        const fn = TWEEN.Interpolation.Utils.Linear;\n\n        if (k < 0) {\n            return fn(v[0], v[1], f);\n        }\n\n        if (k > 1) {\n            return fn(v[m], v[m - 1], m - f);\n        }\n\n        return fn(v[i], v[i + 1 > m ? m : i + 1], f - i);\n    },\n\n    Bezier: function (v: number[], k: number): number {\n        let b = 0;\n        const n = v.length - 1;\n        const pw = Math.pow;\n        const bn = TWEEN.Interpolation.Utils.Bernstein;\n\n        for (let i = 0; i <= n; i++) {\n            b += pw(1 - k, n - i) * pw(k, i) * v[i] * bn(n, i);\n        }\n\n        return b;\n    },\n\n    CatmullRom: function (v: number[], k: number): number {\n        const m = v.length - 1;\n        let f = m * k;\n        let i = Math.floor(f);\n        const fn = TWEEN.Interpolation.Utils.CatmullRom;\n\n        if (v[0] === v[m]) {\n            if (k < 0) {\n                i = Math.floor(f = m * (1 + k));\n            }\n            return fn(v[(i - 1 + m) % m], v[i], v[(i + 1) % m], v[(i + 2) % m], f - i);\n        } else {\n            if (k < 0) {\n                return v[0] - (fn(v[0], v[0], v[1], v[1], -f) - v[0]);\n            }\n\n            if (k > 1) {\n                return v[m] - (fn(v[m], v[m], v[m - 1], v[m - 1], f - m) - v[m]);\n            }\n\n            return fn(v[i ? i - 1 : 0], v[i], v[m < i + 1 ? m : i + 1], v[m < i + 2 ? m : i + 2], f - i);\n        }\n    },\n\n    Utils: {\n        Linear: function (p0: number, p1: number, t: number): number {\n            return (p1 - p0) * t + p0;\n        },\n\n        Bernstein: function (n: number, i: number): number {\n            const fc = TWEEN.Interpolation.Utils.Factorial;\n            return fc(n) / fc(i) / fc(n - i);\n        },\n\n        Factorial: (function () {\n            const a: number[] = [1];\n\n            return function (n: number): number {\n                let s = 1;\n\n                if (a[n]) {\n                    return a[n];\n                }\n\n                for (let i = n; i > 1; i--) {\n                    s *= i;\n                }\n\n                a[n] = s;\n                return s;\n            };\n        })(),\n\n        CatmullRom: function (p0: number, p1: number, p2: number, p3: number, t: number): number {\n            const v0 = (p2 - p0) * 0.5;\n            const v1 = (p3 - p1) * 0.5;\n            const t2 = t * t;\n            const t3 = t * t2;\n\n            return (2 * p1 - 2 * p2 + v0 + v1) * t3 + (-3 * p1 + 3 * p2 - 2 * v0 - v1) * t2 + v0 * t + p1;\n        }\n    }\n};\n\nexport default TWEEN;\n","/**\n * 工具函数集合\n */\n\n/**\n * 根据两点坐标获取角度\n * @param start 起点坐标 [x, y]\n * @param end 终点坐标 [x, y]\n * @returns 角度（不是弧度）\n */\nexport function getAngle(start: number[], end: number[]): number {\n    const diff_x = end[0] - start[0];\n    const diff_y = end[1] - start[1];\n    let deg = 360 * Math.atan(diff_y / diff_x) / (2 * Math.PI);\n    \n    // 调整角度范围，确保结果在0-360度之间\n    if (end[0] < start[0]) {\n        deg = deg + 180;\n    }\n    \n    return deg;\n}","/**\n * 绘制沿线箭头\n * @author kyle / http://nikai.us/\n */\n\nimport pathSimple from \"../path/simple\";\nimport DataSet from \"../../data/DataSet\";\nimport {getAngle} from \"../../utils/index.js\";\nimport {devicePixelRatio} from \"../../utils/window.js\";\n\n// 图片缓存对象\nconst imageCache: Record<string, HTMLImageElement | null> = {};\n\n// 定义数据项接口\ninterface DataItem {\n    fillStyle?: string;\n    _fillStyle?: string;\n    strokeStyle?: string;\n    _strokeStyle?: string;\n    geometry: {\n        type: string;\n        coordinates: number[][];\n        _coordinates?: number[][];\n    };\n}\n\n// 定义箭头选项接口\ninterface ArrowOptions {\n    url?: string;\n    interval?: number;\n}\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    arrow: ArrowOptions;\n    [key: string]: any; // 支持动态属性\n}\n\nconst object = {\n    draw: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 默认箭头图片URL\n        let imageCacheKey = 'http://huiyan.baidu.com/github/tools/gis-drawing/static/images/direction.png';\n        if (options.arrow && options.arrow.url) {\n            imageCacheKey = options.arrow.url;\n        }\n\n        // 初始化图片缓存\n        if (!imageCache[imageCacheKey]) {\n            imageCache[imageCacheKey] = null;\n        }\n\n        let directionImage = imageCache[imageCacheKey];\n        \n        // 如果图片未加载，异步加载图片后重新绘制\n        if (!directionImage) {\n            const args = Array.prototype.slice.call(arguments);\n            const image = new Image();\n            image.onload = () => {\n                imageCache[imageCacheKey] = image;\n                object.draw.apply(null, args as [CanvasRenderingContext2D, DataSet | DataItem[], DrawOptions]);\n            }\n            image.src = imageCacheKey;\n            return;\n        }\n        \n        // 获取数据\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n\n        context.save();\n\n        // 设置上下文属性\n        for (const key in options) {\n            (context as any)[key] = options[key];\n        }\n\n        let points: number[][] = [];\n        let preCoordinate: number[] | null = null;\n        \n        // 遍历数据绘制箭头\n        for (let i = 0, len = data.length; i < len; i++) {\n            const item = data[i];\n\n            context.save();\n\n            // 设置填充样式\n            if (item.fillStyle || item._fillStyle) {\n                context.fillStyle = item.fillStyle || item._fillStyle;\n            }\n\n            // 设置描边样式\n            if (item.strokeStyle || item._strokeStyle) {\n                context.strokeStyle = item.strokeStyle || item._strokeStyle;\n            }\n\n            // 确保geometry存在\n            if (!item.geometry) {\n                context.restore();\n                continue;\n            }\n            \n            const type = item.geometry.type;\n\n            context.beginPath();\n            // 处理LineString类型数据\n            if (type === 'LineString') {\n                const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n                const interval = options.arrow.interval !== undefined ? options.arrow.interval : 1;\n                \n                // 遍历坐标点绘制箭头\n                for (let j = 0; j < coordinates.length; j += interval) {\n                    if (coordinates[j] && coordinates[j + 1]) {\n                        const coordinate = coordinates[j];\n\n                        // 跳过距离过近的点\n                        if (preCoordinate && getDistance(coordinate, preCoordinate) < 30) {\n                            continue;\n                        }\n\n                        context.save();\n                        // 计算角度并旋转\n                        const angle = getAngle(coordinates[j], coordinates[j + 1]);\n                        context.translate(coordinate[0], coordinate[1]);\n                        context.rotate((angle) * Math.PI / 180);\n                        // 绘制箭头图片\n                        context.drawImage(directionImage, -directionImage.width / 4, -directionImage.height / 4, directionImage.width / 2, directionImage.height / 2);\n                        context.restore();\n\n                        points.push(coordinate);\n                        preCoordinate = coordinate;\n                    }\n                }\n            }\n\n            context.restore();\n\n        };\n\n        context.restore();\n\n    }\n}\n\n/**\n * 计算两点之间的距离\n * @param coordinateA 第一个坐标点\n * @param coordinateB 第二个坐标点\n * @returns 两点之间的距离\n */\nfunction getDistance(coordinateA: number[], coordinateB: number[]): number {\n    return Math.sqrt(Math.pow(coordinateA[0] - coordinateB[0], 2) + Math.pow(coordinateA[1] - coordinateB[1], 2));\n}\n\nexport default object;","/**\n * 绘制裁剪区域\n * @author Mofei Zhu<mapv@zhuwenlong.com>\n */\n\nimport pathSimple from \"../path/simple\";\nimport drawSimple from \"./simple\";\nimport clear from \"../clear\";\nimport DataSet from \"../../data/DataSet\";\n\n// 定义数据项接口\ninterface DataItem {\n    [key: string]: any; // 支持动态属性\n}\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    fillStyle?: string;\n    multiPolygonDraw?: () => void;\n    [key: string]: any; // 支持动态属性\n}\n\nexport default {\n    draw: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 获取数据\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n        \n        // 保存上下文状态\n        context.save();\n\n        // 设置填充样式，默认为半透明黑色\n        context.fillStyle = options.fillStyle || 'rgba(0, 0, 0, 0.5)';\n        // 绘制背景矩形\n        context.fillRect(0, 0, context.canvas.width, context.canvas.height);\n\n        // 定义多边形绘制函数\n        options.multiPolygonDraw = function() {\n            context.save();\n            context.clip();\n            clear(context);\n            context.restore();\n        };\n\n        // 遍历数据，为每个数据项绘制裁剪区域\n        for (let i = 0, len = data.length; i < len; i++) {\n            context.beginPath();\n            // 绘制数据项路径\n            pathSimple.drawDataSet(context, [data[i]], options);\n            context.save();\n            // 设置裁剪区域\n            context.clip();\n            // 清除裁剪区域内的内容\n            clear(context);\n            context.restore();\n        }\n\n        // 恢复上下文状态\n        context.restore();\n    }\n};","/**\n * @author kyle / http://nikai.us/\n */\n\nimport DataSet, { DataItem } from '../../data/DataSet';\n\nconst imageMap: { [key: string]: HTMLImageElement | 'error' } = {};\nlet stacks: { [key: string]: ((img: HTMLImageElement | 'error') => void)[] } = {};\n\nexport default {\n    draw: function (context: CanvasRenderingContext2D, dataSet: DataSet, options: any) {\n        // 保存当前画布状态\n        context.save();\n        // 获取数据集，如果是DataSet实例则调用get()方法获取，否则直接使用\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n        for (let i = 0; i < data.length; i++) {\n            let item = data[i];\n            // 开始一个新的绘制路径\n            context.beginPath();\n            if (item.properties && item.properties.cluster) {\n                // 增强聚类点绘制功能\n                this.drawClusterPoint(item, options, context);\n            } else {\n                this.drawIcon(item, options, context);\n            }\n        }\n        context.restore();\n    },\n\n    /**\n     * 绘制聚类点\n     * @param {*} item 数据项\n     * @param {*} options 配置项\n     * @param {*} context 画布上下文\n     */\n    drawClusterPoint: function (item: any, options: any, context: CanvasRenderingContext2D) {\n        //if判断为新增, 即如果显示聚合点且聚合点的iconOptions.show === true,则显示图像\n        if (options.label && options.label.iconOptions && options.show !== false && options.label.iconOptions.show) {\n            this.drawSeanIcon(item, options.label, context);\n        } else {\n            // 获取元素的坐标\n            let coordinates = item.geometry._coordinates || item.geometry.coordinates;\n            let x = coordinates[0];\n            let y = coordinates[1];\n            // 获取标签配置\n            let labelOptions = Object.assign({}, options.label || {});\n            // 绘制聚类圆形\n            context.beginPath();\n            context.arc(x, y, item.size, 0, Math.PI * 2);\n            context.fillStyle = item.fillStyle || 'rgba(200, 0, 0, 0.8)';\n            context.fill();\n            // 绘制边框\n            context.strokeStyle = 'rgba(255, 255, 255, 1)';\n            context.lineWidth = 1;\n            context.stroke();\n            // 绘制标签文字\n            if (labelOptions.show !== false) {\n                context.fillStyle = labelOptions.fillStyle || 'white';\n                context.textAlign = 'center';\n                context.textBaseline = 'middle';\n                // 设置字体样式\n                if (labelOptions.font) {\n                    context.font = labelOptions.font;\n                } else {\n                    context.font = 'bold 14px Arial';\n                }\n                // 设置阴影颜色\n                if (labelOptions.shadowColor) {\n                    context.shadowColor = labelOptions.shadowColor;\n                }\n                // 设置阴影模糊程度\n                if (labelOptions.shadowBlur) {\n                    context.shadowBlur = labelOptions.shadowBlur;\n                }\n                // 获取标签文本\n                let text = item.properties.point_count.toString();\n                let textWidth = context.measureText(text).width;\n                // 绘制文本\n                context.fillText(text, x + 0.5 - textWidth / 2, y + 0.5 + 3);\n            }\n        }\n    },\n    /**\n     * 绘制图标\n     * @param {Object} item - 数据项\n     * @param {Object} options - 绘制选项\n     * @param {Object} context - 画布上下文\n     */\n    drawIcon: function drawIcon(item: any, options: any, context: CanvasRenderingContext2D) {\n        const _ref = item.geometry._coordinates || item.geometry.coordinates;\n        let x = _ref[0];\n        let y = _ref[1];\n\n        const iconOptions = Object.assign({}, options.iconOptions, item.iconOptions);\n        // 定义绘制点标记的方法\n        const drawPoint = function drawPoint() {\n            context.beginPath();\n            context.arc(_ref[0], _ref[1], options.size || 5, 0, Math.PI * 2);\n            context.fillStyle = options.fillStyle || 'red';\n            context.fill();\n        };\n        // 如果没有图标URL，则绘制点标记\n        if (!iconOptions.url) {\n            drawPoint();\n            return;\n        }\n        let iconWidth = iconOptions.width;\n        let iconHeight = iconOptions.height;\n        const iconOffset = iconOptions.offset || { x: 0, y: 0 };\n        x = x - ~~iconWidth / 2 + iconOffset.x;\n        y = y - ~~iconHeight / 2 + iconOffset.y;\n        const url = window.encodeURIComponent(iconOptions.url);\n        const img = imageMap[url];\n        // 根据图像缓存状态进行绘制或加载图像\n        if (img) {\n            if (img === 'error') {\n                drawPoint();\n            } else if (iconWidth && iconHeight) {\n                context.drawImage(img, x, y, iconWidth, iconHeight);\n            } else {\n                context.drawImage(img, x, y);\n            }\n            // 绘制标签\n            if (iconOptions.label && iconOptions.label.show !== false) {\n                drawLabel(context, x + ~~iconWidth / 2, y + ~~iconHeight / 2, iconWidth, iconHeight, iconOptions.label);\n            }\n        } else {\n            if (!stacks[url]) {\n                stacks[url] = [];\n                getImage(url, function (img, src) {\n                    stacks[src] && stacks[src].forEach(function (fun) {\n                        return fun(img);\n                    });\n                    stacks[src] = [];\n                    imageMap[src] = img;\n                }, function (src) {\n                    stacks[src] && stacks[src].forEach(function (fun) {\n                        return fun('error');\n                    });\n                    stacks[src] = [];\n                    imageMap[src] = 'error';\n                    drawPoint();\n                });\n            }\n            stacks[url].push(function (x, y, iconWidth, iconHeight) {\n                return function (img: HTMLImageElement | 'error') {\n                    if (img === 'error') {\n                        drawPoint();\n                    } else if (iconWidth && iconHeight) {\n                        context.drawImage(img, x, y, iconWidth, iconHeight);\n                    } else {\n                        context.drawImage(img, x, y);\n                    }\n                    // 绘制标签\n                    if (iconOptions.label && iconOptions.label.show !== false) {\n                        drawLabel(context, x + ~~iconWidth / 2, y + ~~iconHeight / 2, iconWidth, iconHeight, iconOptions.label);\n                    }\n                };\n            }(x, y, iconWidth, iconHeight));\n        }\n    },\n    // 确保这段代码在 mapv.js 中已经正确实现\n    drawSeanIcon: function drawSeanIcon(item: any, options: any, context: CanvasRenderingContext2D) {\n        const _ref = item.geometry._coordinates || item.geometry.coordinates;\n        let x = _ref[0];\n        let y = _ref[1];\n\n        const iconOptions = Object.assign({}, options.iconOptions, item.iconOptions);\n        const drawPoint = function drawPoint() {\n            context.arc(_ref[0], _ref[1], options.size || 5, 0, Math.PI * 2);\n            context.fillStyle = options.fillStyle || 'red';\n            context.fill();\n        };\n\n        // 正确处理 url 作为函数的情况\n        let urlValue = iconOptions.url;\n        console.log('原始URL值:', urlValue);\n\n        if (typeof iconOptions.url === 'function') {\n            // 从 item.properties.point_count 获取聚合点数量\n            const count = item.properties ? (item.properties.point_count || 0) : 0;\n            console.log('调用函数，聚合点数:', count);\n            urlValue = iconOptions.url(count);\n            console.log('函数返回的URL:', urlValue);\n        }\n\n        console.log('实际使用的图标URL:', urlValue, \"mapv图标\");\n\n        if (!urlValue) {\n            console.log('没有图标URL，绘制默认点');\n            drawPoint();\n            return;\n        }\n\n        // 设置图像width和height，确保图标比数字大\n        let iconWidth = item.size || 40;  // 增大默认图标尺寸\n        let iconHeight = item.size || 40; // 增大默认图标尺寸\n\n        // 根据聚合点数量动态调整图标大小\n        const pointCount = item.properties ? (item.properties.point_count || 0) : 0;\n        if (pointCount > 100) {\n            iconWidth = 50;\n            iconHeight = 50;\n        } else if (pointCount > 50) {\n            iconWidth = 45;\n            iconHeight = 45;\n        }\n\n        const iconOffset = iconOptions.offset || { x: 0, y: 0 };\n        // 修改坐标计算方式，使图标以中心点对齐\n        x = x - ~~(iconWidth / 2) + iconOffset.x;\n        y = y - ~~(iconHeight / 2) + iconOffset.y;\n\n        // 确保 urlValue 是字符串\n        const url = typeof urlValue === 'string' ? window.encodeURIComponent(urlValue) : '';\n\n        if (!url) {\n            console.log('URL 编码失败，绘制默认点');\n            drawPoint();\n            return;\n        }\n\n        const img = imageMap[url];\n\n        if (img) {\n            if (img === 'error') {\n                console.log('图片加载错误，绘制默认点');\n                drawPoint();\n            } else if (iconWidth && iconHeight) {\n                //如果点设置了阴影，这里要给图片也加上阴影，不然图片遮不住点的阴影\n                context.shadowBlur = iconOptions.shadowBlur;\n                context.shadowColor = iconOptions.shadowColor;\n                context.drawImage(img, x, y, iconWidth, iconHeight);\n            } else {\n                context.shadowBlur = iconOptions.shadowBlur;\n                context.shadowColor = iconOptions.shadowColor;\n                context.drawImage(img, x, y);\n            }\n\n            if (options.iconOptions.show) {\n                // 文字样式设置\n                context.fillStyle = options.fillStyle || 'white';\n                context.textBaseline = 'middle';  // 垂直居中基准\n                context.textAlign = 'center';      // 水平居中\n\n                // 动态字体大小（根据聚合点数量调整）\n                const pointCount = (item.properties && item.properties.point_count) || 0;\n                // 修改为图标大小的一半\n                const fontSize = options.iconOptions.fontSize || Math.floor(iconWidth / 6);\n                context.font = `${fontSize}px Arial`; // 使用 normal 字体样式\n\n                // 绘制文字（完全居中）\n                const text = pointCount.toString();\n                if (text) {\n                    const textX = x + iconWidth / 2;  // 图标水平中心\n                    // const textY = y + iconHeight / 2; // 图标垂直中心\n                    // context.fillText(text, textX, textY);\n                    // 为了更精确的垂直居中，需要考虑字体度量\n                    // 获取字体的度量信息\n                    const metrics = context.measureText(text);\n                    // 计算文字的实际高度\n                    const fontHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;\n                    // 调整Y坐标以实现真正的垂直居中\n                    const textY = y + iconHeight / 2 + (metrics.actualBoundingBoxAscent - fontHeight / 2);\n\n                    context.fillText(text, textX, textY);\n                    // context.strokeStyle = 'red';\n                    // context.beginPath();\n                    // context.moveTo(x + iconWidth / 2, y);\n                    // context.lineTo(x + iconWidth / 2, y + iconHeight);\n                    // context.moveTo(x, y + iconHeight / 2);\n                    // context.lineTo(x + iconWidth, y + iconHeight / 2);\n                    // context.stroke();\n                }\n            }\n\n        } else {\n            // 缓存，操作同上\n            if (!stacks[url]) {\n                stacks[url] = [];\n                console.log('开始加载图片:', urlValue);\n                getImage(url, function (img, src) {\n                    console.log('图片加载成功:', src);\n                    stacks[src] && stacks[src].forEach(function (fun) {\n                        return fun(img);\n                    });\n                    stacks[src] = [];\n                    imageMap[src] = img;\n                }, function (src) {\n                    console.log('图片加载失败:', src);\n                    stacks[src] && stacks[src].forEach(function (fun) {\n                        return fun('error');\n                    });\n                    stacks[src] = [];\n                    imageMap[src] = 'error';\n                    drawPoint();\n                });\n            }\n            stacks[url].push(function (x, y, iconWidth, iconHeight) {\n                return function (img: HTMLImageElement | 'error') {\n                    if (img === 'error') {\n                        console.log('图片加载错误，绘制默认点');\n                        drawPoint();\n                    } else if (iconWidth && iconHeight) {\n                        context.shadowBlur = iconOptions.shadowBlur;\n                        context.shadowColor = iconOptions.shadowColor;\n                        context.drawImage(img, x, y, iconWidth, iconHeight);\n                    } else {\n                        context.shadowBlur = iconOptions.shadowBlur;\n                        context.shadowColor = iconOptions.shadowColor;\n                        context.drawImage(img, x, y);\n                    }\n\n                    if (options.iconOptions.show) {\n                        // 文字样式设置\n                        context.fillStyle = options.fillStyle || 'white';\n                        context.textBaseline = 'middle';  // 垂直居中基准\n                        context.textAlign = 'center';      // 水平居中\n\n                        // 动态字体大小（根据聚合点数量调整）\n                        const pointCount = (item.properties && item.properties.point_count) || 0;\n                        // 修改为图标大小的一半\n                        const fontSize = options.iconOptions.fontSize || Math.floor(iconWidth / 6);\n                        context.font = `${fontSize}px Arial`; // 使用 normal 字体样式\n\n                        // 绘制文字（完全居中）\n                        const text = pointCount.toString();\n                        if (text) {\n                            const textX = x + iconWidth / 2;  // 图标水平中心\n                            // const textY = y + iconHeight / 2; // 图标垂直中心\n                            // context.fillText(text, textX, textY);\n                            // 为了更精确的垂直居中，需要考虑字体度量\n                            // 获取字体的度量信息\n                            const metrics = context.measureText(text);\n                            // 计算文字的实际高度\n                            const fontHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;\n                            // 调整Y坐标以实现真正的垂直居中\n                            const textY = y + iconHeight / 2 + (metrics.actualBoundingBoxAscent - fontHeight / 2);\n\n                            context.fillText(text, textX, textY);\n                            // context.strokeStyle = 'red';\n                            // context.beginPath();\n                            // context.moveTo(x + iconWidth / 2, y);\n                            // context.lineTo(x + iconWidth / 2, y + iconHeight);\n                            // context.moveTo(x, y + iconHeight / 2);\n                            // context.lineTo(x + iconWidth, y + iconHeight / 2);\n                            // context.stroke();\n                        }\n\n                    }\n\n                };\n            }(x, y, iconWidth, iconHeight));\n        }\n    }\n};\n// 定义绘制标签的方法\nfunction drawLabel(context: CanvasRenderingContext2D, x: number, y: number, iconWidth: number, iconHeight: number, labelOptions: any) {\n    const text = labelOptions.text || '';\n    const fontSize = labelOptions.fontSize || '12px';\n    const fontColor = labelOptions.fontColor || 'black';\n    const font = fontSize + ' sans-serif';\n    const padding = labelOptions.padding || 5;\n    const backgroundColor = labelOptions.backgroundColor || 'white';\n    const borderColor = labelOptions.borderColor || 'black';\n    const borderWidth = labelOptions.borderWidth || 1;\n\n    // 设置字体样式\n    context.font = font;\n    context.fillStyle = fontColor;\n    const textWidth = context.measureText(text).width;\n    const textHeight = parseInt(fontSize, 10);\n\n    // 计算标签的位置\n    const labelWidth = textWidth + 2 * padding;\n    const labelHeight = textHeight + 2 * padding;\n\n    // 解析位置属性\n    const parsePosition = function parsePosition(value: any, total: number, defaultValue: number) {\n        if (typeof value === 'string' && value.endsWith('%')) {\n            return parseFloat(value) / 100 * total;\n        } else if (typeof value === 'number') {\n            return value;\n        } else if (value === 'center') {\n            return -total / 2;\n        } else {\n            return defaultValue;\n        }\n    };\n\n    // 计算标签的偏移量\n    const top = parsePosition(labelOptions.top, labelHeight, -labelHeight / 2);\n    const left = parsePosition(labelOptions.left, labelWidth, -labelWidth / 2);\n    const right = parsePosition(labelOptions.right, labelWidth, labelWidth / 2);\n    const bottom = parsePosition(labelOptions.bottom, labelHeight, labelHeight / 2);\n\n    // 计算标签的最终位置\n    let labelX = x + left;\n    let labelY = y + top;\n\n    // 如果设置了 bottom，调整 labelY\n    if (labelOptions.bottom !== undefined) {\n        labelY = y - iconHeight / 2 - labelHeight - bottom;\n    }\n\n    // 绘制标签背景\n    context.fillStyle = backgroundColor;\n    context.fillRect(labelX, labelY, labelWidth, labelHeight);\n\n    // 绘制标签边框（根据 labelOptions.border 决定是否绘制）\n    if (labelOptions.border !== false) {\n        context.strokeStyle = borderColor;\n        context.lineWidth = borderWidth;\n        context.strokeRect(labelX, labelY, labelWidth, labelHeight);\n    }\n\n    // 绘制标签文本\n    context.fillStyle = fontColor;\n    context.fillText(text, labelX + padding, labelY + padding + textHeight);\n}\n/**\n * 加载图像资源\n * @param {String} url - 图像URL\n * @param {Function} callback - 成功回调函数\n * @param {Function} fallback - 失败回调函数\n */\nfunction getImage(url: string, callback: (img: HTMLImageElement, src: string) => void, fallback: (src: string) => void) {\n    let img = new Image();\n    img.onload = function () {\n        callback && callback(img, url);\n    };\n    img.onerror = function () {\n        fallback && fallback(url);\n    };\n    img.src = window.decodeURIComponent(url);\n}\n","/**\n * 文本绘制模块\n * @author Mofei Zhu<mapv@zhuwenlong.com>\n */\n\nimport pathSimple from \"../path/simple\";\nimport DataSet from \"../../data/DataSet\";\n\n// 定义数据项接口\ninterface DataItem {\n    offset?: Offset;\n    geometry: {\n        coordinates: number[];\n        _coordinates?: number[];\n    };\n    [key: string]: any; // 支持动态属性\n}\n\n// 定义偏移量接口\ninterface Offset {\n    x: number;\n    y: number;\n}\n\n// 定义矩形接口\ninterface RectPoint {\n    x: number;\n    y: number;\n}\n\ninterface Rect {\n    sw: RectPoint; // 西南角\n    ne: RectPoint; // 东北角\n}\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    _size?: number;\n    size?: number;\n    textKey?: string;\n    textAlign?: CanvasTextAlign;\n    textBaseline?: CanvasTextBaseline;\n    avoid?: boolean;\n    offset?: Offset;\n    [key: string]: any; // 支持动态属性\n}\n\nexport default {\n    /**\n     * 绘制文本\n     * @param context Canvas上下文\n     * @param dataSet 数据集\n     * @param options 绘制选项\n     */\n    draw: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        // 获取数据\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n        \n        // 保存上下文状态\n        context.save();\n\n        // 设置上下文属性\n        for (const key in options) {\n            (context as any)[key] = options[key];\n        }\n\n        const rects: Rect[] = [];\n            \n        // 设置字体大小\n        const size = options._size || options.size;\n        if (size) {\n            context.font = \"bold \" + size + \"px Arial\";\n        } else {\n            context.font = \"bold 12px Arial\";\n        }\n\n        // 文本属性\n        const textKey = options.textKey || 'text';\n\n        // 设置文本对齐方式\n        if (!options.textAlign) {\n            context.textAlign = 'center';\n        }\n\n        // 设置文本基线\n        if (!options.textBaseline) {\n            context.textBaseline = 'middle';\n        }\n\n        // 标注避让模式\n        if (options.avoid) {\n            for (let i = 0, len = data.length; i < len; i++) {\n                // 获取偏移量\n                const offset = data[i].offset || options.offset || {\n                    x: 0,\n                    y: 0\n                };\n\n                const item = data[i];\n                \n                // 确保geometry存在\n                if (!item.geometry) continue;\n                \n                // 获取坐标\n                const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n                const x = coordinates[0] + offset.x;\n                const y = coordinates[1] + offset.y;\n                const text = item[textKey] as string;\n                \n                // 测量文本宽度\n                const textWidth = context.measureText(text).width;\n\n                // 计算文本矩形区域\n                const px = x - textWidth / 2; \n                const py = y - (size || 12) / 2;\n\n                const rect: Rect = {\n                    sw: {\n                        x: px,\n                        y: py + (size || 12)\n                    },\n                    ne: {\n                        x: px + textWidth,\n                        y: py \n                    }\n                };\n\n                // 检查是否重叠，不重叠则绘制\n                if (!hasOverlay(rects, rect)) {\n                    rects.push(rect);\n                    context.fillText(text, x, y);\n                }\n            }\n        } else {\n            // 普通绘制模式\n            for (let i = 0, len = data.length; i < len; i++) {\n                // 获取偏移量\n                const offset = data[i].offset || options.offset || {\n                    x: 0,\n                    y: 0\n                };\n                \n                const item = data[i];\n                \n                // 确保geometry存在\n                if (!item.geometry) continue;\n                \n                // 获取坐标\n                const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n                const x = coordinates[0] + offset.x;\n                const y = coordinates[1] + offset.y;\n                const text = item[textKey] as string;\n                \n                // 绘制文本\n                context.fillText(text, x, y);\n            }\n        }\n\n        // 恢复上下文状态\n        context.restore();\n    }\n}\n\n/**\n * 检查当前矩形是否与已有的矩形列表重叠\n * @param rects 已有的矩形列表\n * @param overlay 当前矩形\n * @returns 是否重叠\n */\nfunction hasOverlay(rects: Rect[], overlay: Rect): boolean {\n    for (let i = 0; i < rects.length; i++) {\n        if (isRectOverlay(rects[i], overlay)) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/**\n * 判断两个矩形是否重叠\n * @param rect1 第一个矩形\n * @param rect2 第二个矩形\n * @returns 是否重叠\n */\nfunction isRectOverlay(rect1: Rect, rect2: Rect): boolean {\n    // minx、miny 两个矩形右下角最小的x和y\n    // maxx、maxy 两个矩形左上角最大的x和y\n    const minx = Math.min(rect1.ne.x, rect2.ne.x);\n    const miny = Math.min(rect1.sw.y, rect2.sw.y);\n    const maxx = Math.max(rect1.sw.x, rect2.sw.x);\n    const maxy = Math.max(rect1.ne.y, rect2.ne.y);\n    \n    // 如果最小右下角大于最大左上角，则重叠\n    if (minx > maxx && miny > maxy) {\n        return true;\n    }\n    return false;\n}","/**\n * 绘制图标\n * @author wanghyper\n */\n\nimport DataSet, { DataItem as DataSetDataItem } from '../../data/DataSet';\n\n// 图片缓存对象\nconst imageMap: Record<string, HTMLImageElement | 'error' | null> = {};\n// 图片加载队列\nlet stacks: Record<string, Array<(img: HTMLImageElement | 'error') => void>> = {};\n\n// 定义聚类点属性接口\ninterface ClusterProperties {\n    cluster: boolean;\n    point_count: number;\n    [key: string]: any;\n}\n\n// 定义数据项接口，扩展自DataSetDataItem\ntype DataItem = DataSetDataItem & {\n    properties?: ClusterProperties;\n    icon?: string | HTMLImageElement;\n    iconOptions?: IconOptions;\n    size?: number;\n    width?: number;\n    height?: number;\n    deg?: number;\n}\n\n// 定义偏移量接口\ninterface Offset {\n    x: number;\n    y: number;\n}\n\n// 定义图标选项接口\ninterface IconOptions {\n    show?: boolean;\n    url?: string | ((count: number) => string);\n    width?: number;\n    height?: number;\n    offset?: Offset;\n    shadowBlur?: number;\n    shadowColor?: string;\n    fontSize?: number;\n    [key: string]: any;\n}\n\n// 定义标签选项接口\ninterface LabelOptions {\n    show?: boolean;\n    fillStyle?: string;\n    font?: string;\n    [key: string]: any;\n}\n\n// 定义绘制选项接口\ninterface DrawOptions {\n    icon?: string | HTMLImageElement;\n    iconOptions?: IconOptions;\n    size?: number;\n    width?: number;\n    height?: number;\n    _width?: number;\n    _height?: number;\n    offset?: Offset;\n    fillStyle?: string;\n    deg?: number;\n    sx?: number;\n    sy?: number;\n    swidth?: number;\n    sheight?: number;\n    label?: LabelOptions;\n    [key: string]: any;\n}\n\nexport default {\n    draw: function (context: CanvasRenderingContext2D, dataSet: DataSet | DataItem[], options: DrawOptions) {\n        const data = dataSet instanceof DataSet ? dataSet.get() : dataSet;\n        \n        for (let i = 0, len = data.length; i < len; i++) {\n            const item = data[i];\n            if (item.geometry) {\n                // 如果是聚类点且配置了图标选项\n                if (item.properties && item.properties.cluster) {\n                    this.drawClusterIcon(item, options, context);\n                } else {\n                    const icon = item.icon || options.icon;\n                    \n                    if (typeof icon === 'string') {\n                        const url = window.encodeURIComponent(icon);\n                        const img = imageMap[url];\n                        \n                        if (img) {\n                            drawItem(img, options, context, item);\n                        } else {\n                            if (!stacks[url]) {\n                                stacks[url] = [];\n                                getImage(\n                                    url,\n                                    function (img, src) {\n                                        stacks[src] && stacks[src].forEach(fun => fun(img));\n                                        stacks[src] = null as any;\n                                        imageMap[src] = img;\n                                    },\n                                    function (src) {\n                                        stacks[src] && stacks[src].forEach(fun => fun('error'));\n                                        stacks[src] = null as any;\n                                        imageMap[src] = 'error';\n                                    }\n                                );\n                            }\n                            stacks[url].push(function (img) {\n                                drawItem(img, options, context, item);\n                            });\n                        }\n                    } else {\n                        drawItem(icon, options, context, item);\n                    }\n                }\n            }\n        }\n    },\n\n    /**\n     * 绘制聚类图标\n     * @param item 数据项\n     * @param options 配置项\n     * @param context 画布上下文\n     */\n    drawClusterIcon: function(item: DataItem, options: DrawOptions, context: CanvasRenderingContext2D) {\n        // 确保geometry存在\n        if (!item.geometry) return;\n        \n        const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n        const x = coordinates[0];\n        const y = coordinates[1];\n\n        // 获取图标配置\n        const iconOptions = Object.assign({}, options.iconOptions || {}, item.iconOptions || {});\n        \n        // 如果配置了显示图标且图标url存在\n        if (iconOptions.show !== false && (iconOptions.url || item.icon)) {\n            let iconUrl: string = '';\n            \n            // 如果url是函数，则根据聚合点数量调用\n            if (typeof iconOptions.url === 'function') {\n                const count = item.properties ? (item.properties.point_count || 0) : 0;\n                iconUrl = iconOptions.url(count);\n            } else if (typeof iconOptions.url === 'string') {\n                iconUrl = iconOptions.url;\n            }\n\n            if (iconUrl) {\n                const url = window.encodeURIComponent(iconUrl);\n                const img = imageMap[url];\n                \n                if (img) {\n                    if (img === 'error') {\n                        // 图片加载失败，绘制默认点\n                        this.drawDefaultPoint(context, x, y, item, options);\n                    } else {\n                        this.drawImageWithText(context, img, x, y, item, options, iconOptions);\n                    }\n                } else {\n                    // 异步加载图片\n                    if (!stacks[url]) {\n                        stacks[url] = [];\n                        getImage(\n                            url,\n                            function (img, src) {\n                                stacks[src] && stacks[src].forEach(fun => fun(img));\n                                stacks[src] = null as any;\n                                imageMap[src] = img;\n                            },\n                            function (src) {\n                                stacks[src] && stacks[src].forEach(fun => fun('error'));\n                                stacks[src] = null as any;\n                                imageMap[src] = 'error';\n                            }\n                        );\n                    }\n                    stacks[url].push((img) => {\n                        if (img === 'error') {\n                            this.drawDefaultPoint(context, x, y, item, options);\n                        } else {\n                            this.drawImageWithText(context, img, x, y, item, options, iconOptions);\n                        }\n                    });\n                }\n                return;\n            }\n        }\n        \n        // 默认绘制圆形聚类点\n        this.drawDefaultClusterPoint(context, x, y, item, options);\n    },\n\n    /**\n     * 绘制默认点\n     * @param context 画布上下文\n     * @param x x坐标\n     * @param y y坐标\n     * @param item 数据项\n     * @param options 配置项\n     */\n    drawDefaultPoint: function(context: CanvasRenderingContext2D, x: number, y: number, item: DataItem, options: DrawOptions) {\n        context.beginPath();\n        context.arc(x, y, options.size || 5, 0, Math.PI * 2);\n        context.fillStyle = options.fillStyle || 'rgba(255, 0, 0, 0.8)';\n        context.fill();\n    },\n\n    /**\n     * 绘制带文字的图片\n     * @param context 画布上下文\n     * @param img 图片对象\n     * @param x x坐标\n     * @param y y坐标\n     * @param item 数据项\n     * @param options 配置项\n     * @param iconOptions 图标配置项\n     */\n    drawImageWithText: function(context: CanvasRenderingContext2D, img: HTMLImageElement, x: number, y: number, item: DataItem, options: DrawOptions, iconOptions: IconOptions) {\n        context.save();\n        \n        // 设置图标大小\n        let iconWidth = item.size || iconOptions.width || 40;\n        let iconHeight = item.size || iconOptions.height || 40;\n        \n        // 根据聚合点数量动态调整图标大小\n        const pointCount = item.properties ? (item.properties.point_count || 0) : 0;\n        if (pointCount > 100) {\n            iconWidth = 50;\n            iconHeight = 50;\n        } else if (pointCount > 50) {\n            iconWidth = 45;\n            iconHeight = 45;\n        }\n\n        const iconOffset = iconOptions.offset || { x: 0, y: 0 };\n        // 修改坐标计算方式，使图标以中心点对齐\n        x = x - ~~(iconWidth / 2) + iconOffset.x;\n        y = y - ~~(iconHeight / 2) + iconOffset.y;\n\n        // 添加阴影效果\n        if (iconOptions.shadowBlur) {\n            context.shadowBlur = iconOptions.shadowBlur;\n        }\n        if (iconOptions.shadowColor) {\n            context.shadowColor = iconOptions.shadowColor;\n        }\n\n        // 绘制图片\n        context.drawImage(img, x, y, iconWidth, iconHeight);\n\n        // 绘制文字\n        if (iconOptions.show !== false) {\n            // 文字样式设置\n            context.fillStyle = options.fillStyle || 'white';\n            context.textBaseline = 'middle';\n            context.textAlign = 'center';\n\n            // 动态字体大小\n            const fontSize = iconOptions.fontSize || Math.floor(iconWidth / 6);\n            context.font = `${fontSize}px Arial`;\n\n            // 绘制文字（完全居中）\n            const text = pointCount.toString();\n            if (text) {\n                const textX = x + iconWidth / 2;\n                // 获取字体度量信息以实现精确垂直居中\n                const metrics = context.measureText(text);\n                const fontHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;\n                const textY = y + iconHeight / 2 + (metrics.actualBoundingBoxAscent - fontHeight / 2);\n                context.fillText(text, textX, textY);\n            }\n        }\n        \n        context.restore();\n    },\n\n    /**\n     * 绘制默认的聚类圆点\n     * @param context 画布上下文\n     * @param x x坐标\n     * @param y y坐标\n     * @param item 数据项\n     * @param options 配置项\n     */\n    drawDefaultClusterPoint: function(context: CanvasRenderingContext2D, x: number, y: number, item: DataItem, options: DrawOptions) {\n        context.save();\n        \n        let size = item.size || options.size || 10;\n        const pointCount = item.properties ? (item.properties.point_count || 0) : 0;\n        \n        // 根据点数量调整大小\n        if (pointCount > 100) {\n            size = 20;\n        } else if (pointCount > 50) {\n            size = 18;\n        } else if (pointCount > 10) {\n            size = 16;\n        }\n        \n        // 绘制圆形\n        context.beginPath();\n        context.arc(x, y, size, 0, Math.PI * 2);\n        \n        // 根据数量设置颜色\n        if (pointCount > 100) {\n            context.fillStyle = 'rgba(255, 0, 0, 0.8)';\n        } else if (pointCount > 50) {\n            context.fillStyle = 'rgba(255, 165, 0, 0.8)';\n        } else if (pointCount > 10) {\n            context.fillStyle = 'rgba(255, 255, 0, 0.8)';\n        } else {\n            context.fillStyle = 'rgba(0, 128, 0, 0.8)';\n        }\n        \n        context.fill();\n        \n        // 绘制边框\n        context.strokeStyle = 'rgba(255, 255, 255, 0.8)';\n        context.lineWidth = 1;\n        context.stroke();\n        \n        // 绘制数字\n        if (options.label && options.label.show !== false) {\n            context.fillStyle = options.label.fillStyle || 'white';\n            context.textAlign = 'center';\n            context.textBaseline = 'middle';\n            context.font = (options.label.font || 'bold 12px Arial');\n            \n            const text = pointCount.toString();\n            context.fillText(text, x, y);\n        }\n        \n        context.restore();\n    }\n};\n\n/**\n * 绘制单个图标项\n * @param img 图片对象\n * @param options 配置项\n * @param context 画布上下文\n * @param item 数据项\n */\nfunction drawItem(img: HTMLImageElement | 'error', options: DrawOptions, context: CanvasRenderingContext2D, item: DataItem) {\n    // 确保geometry存在\n    if (!item.geometry) return;\n    \n    context.save();\n    const coordinates = item.geometry._coordinates || item.geometry.coordinates;\n    const x = coordinates[0];\n    const y = coordinates[1];\n    const offset = options.offset || {x: 0, y: 0};\n    const width = item.width || options._width || options.width;\n    const height = item.height || options._height || options.height;\n    \n    // 计算图标中心点坐标\n    const centerX = x - ~~(width || 0) / 2 + offset.x;\n    const centerY = y - ~~(height || 0) / 2 + offset.y;\n    \n    // 如果图片加载失败，绘制默认圆点\n    if (img === 'error') {\n        context.beginPath();\n        context.arc(centerX, centerY, options.size || 5, 0, Math.PI * 2);\n        context.fillStyle = options.fillStyle || 'red';\n        context.fill();\n        context.restore();\n        return;\n    }\n    \n    // 处理旋转角度\n    const deg = item.deg || options.deg;\n    if (deg) {\n        context.translate(centerX, centerY);\n        context.rotate((deg * Math.PI) / 180);\n        context.translate(-centerX, -centerY);\n    }\n\n    // 绘制图片\n    if (options.sx !== undefined && options.sy !== undefined && options.swidth !== undefined && options.sheight !== undefined && options.width !== undefined && options.height !== undefined) {\n        context.drawImage(img, options.sx, options.sy, options.swidth, options.sheight, centerX, centerY, width || 0, height || 0);\n    } else if (width && height) {\n        context.drawImage(img, centerX, centerY, width, height);\n    } else {\n        context.drawImage(img, centerX, centerY);\n    }\n    \n    context.restore();\n}\n\n/**\n * 加载图片\n * @param url 图片URL\n * @param callback 成功回调\n * @param fallback 失败回调\n */\nfunction getImage(url: string, callback: (img: HTMLImageElement, src: string) => void, fallback: (src: string) => void) {\n    const img = new Image();\n    img.onload = function () {\n        callback && callback(img, url);\n    };\n    img.onerror = function () {\n        fallback && fallback(url);\n    };\n    img.src = window.decodeURIComponent(url);\n}","function sortKD(ids, coords, nodeSize, left, right, depth) {\r\n    if (right - left <= nodeSize) { return; }\r\n\r\n    var m = (left + right) >> 1;\r\n\r\n    select(ids, coords, m, left, right, depth % 2);\r\n\r\n    sortKD(ids, coords, nodeSize, left, m - 1, depth + 1);\r\n    sortKD(ids, coords, nodeSize, m + 1, right, depth + 1);\r\n}\r\n\r\nfunction select(ids, coords, k, left, right, inc) {\r\n\r\n    while (right > left) {\r\n        if (right - left > 600) {\r\n            var n = right - left + 1;\r\n            var m = k - left + 1;\r\n            var z = Math.log(n);\r\n            var s = 0.5 * Math.exp(2 * z / 3);\r\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\r\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\r\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\r\n            select(ids, coords, k, newLeft, newRight, inc);\r\n        }\r\n\r\n        var t = coords[2 * k + inc];\r\n        var i = left;\r\n        var j = right;\r\n\r\n        swapItem(ids, coords, left, k);\r\n        if (coords[2 * right + inc] > t) { swapItem(ids, coords, left, right); }\r\n\r\n        while (i < j) {\r\n            swapItem(ids, coords, i, j);\r\n            i++;\r\n            j--;\r\n            while (coords[2 * i + inc] < t) { i++; }\r\n            while (coords[2 * j + inc] > t) { j--; }\r\n        }\r\n\r\n        if (coords[2 * left + inc] === t) { swapItem(ids, coords, left, j); }\r\n        else {\r\n            j++;\r\n            swapItem(ids, coords, j, right);\r\n        }\r\n\r\n        if (j <= k) { left = j + 1; }\r\n        if (k <= j) { right = j - 1; }\r\n    }\r\n}\r\n\r\nfunction swapItem(ids, coords, i, j) {\r\n    swap(ids, i, j);\r\n    swap(coords, 2 * i, 2 * j);\r\n    swap(coords, 2 * i + 1, 2 * j + 1);\r\n}\r\n\r\nfunction swap(arr, i, j) {\r\n    var tmp = arr[i];\r\n    arr[i] = arr[j];\r\n    arr[j] = tmp;\r\n}\r\n\r\nfunction range(ids, coords, minX, minY, maxX, maxY, nodeSize) {\r\n    var stack = [0, ids.length - 1, 0];\r\n    var result = [];\r\n    var x, y;\r\n\r\n    while (stack.length) {\r\n        var axis = stack.pop();\r\n        var right = stack.pop();\r\n        var left = stack.pop();\r\n\r\n        if (right - left <= nodeSize) {\r\n            for (var i = left; i <= right; i++) {\r\n                x = coords[2 * i];\r\n                y = coords[2 * i + 1];\r\n                if (x >= minX && x <= maxX && y >= minY && y <= maxY) { result.push(ids[i]); }\r\n            }\r\n            continue;\r\n        }\r\n\r\n        var m = Math.floor((left + right) / 2);\r\n\r\n        x = coords[2 * m];\r\n        y = coords[2 * m + 1];\r\n\r\n        if (x >= minX && x <= maxX && y >= minY && y <= maxY) { result.push(ids[m]); }\r\n\r\n        var nextAxis = (axis + 1) % 2;\r\n\r\n        if (axis === 0 ? minX <= x : minY <= y) {\r\n            stack.push(left);\r\n            stack.push(m - 1);\r\n            stack.push(nextAxis);\r\n        }\r\n        if (axis === 0 ? maxX >= x : maxY >= y) {\r\n            stack.push(m + 1);\r\n            stack.push(right);\r\n            stack.push(nextAxis);\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction within(ids, coords, qx, qy, r, nodeSize) {\r\n    var stack = [0, ids.length - 1, 0];\r\n    var result = [];\r\n    var r2 = r * r;\r\n\r\n    while (stack.length) {\r\n        var axis = stack.pop();\r\n        var right = stack.pop();\r\n        var left = stack.pop();\r\n\r\n        if (right - left <= nodeSize) {\r\n            for (var i = left; i <= right; i++) {\r\n                if (sqDist(coords[2 * i], coords[2 * i + 1], qx, qy) <= r2) { result.push(ids[i]); }\r\n            }\r\n            continue;\r\n        }\r\n\r\n        var m = Math.floor((left + right) / 2);\r\n\r\n        var x = coords[2 * m];\r\n        var y = coords[2 * m + 1];\r\n\r\n        if (sqDist(x, y, qx, qy) <= r2) { result.push(ids[m]); }\r\n\r\n        var nextAxis = (axis + 1) % 2;\r\n\r\n        if (axis === 0 ? qx - r <= x : qy - r <= y) {\r\n            stack.push(left);\r\n            stack.push(m - 1);\r\n            stack.push(nextAxis);\r\n        }\r\n        if (axis === 0 ? qx + r >= x : qy + r >= y) {\r\n            stack.push(m + 1);\r\n            stack.push(right);\r\n            stack.push(nextAxis);\r\n        }\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction sqDist(ax, ay, bx, by) {\r\n    var dx = ax - bx;\r\n    var dy = ay - by;\r\n    return dx * dx + dy * dy;\r\n}\r\n\r\nvar defaultGetX = function (p) { return p[0]; };\r\nvar defaultGetY = function (p) { return p[1]; };\r\n\r\nvar KDBush = function KDBush(points, getX, getY, nodeSize, ArrayType) {\r\n    if ( getX === void 0 ) getX = defaultGetX;\r\n    if ( getY === void 0 ) getY = defaultGetY;\r\n    if ( nodeSize === void 0 ) nodeSize = 64;\r\n    if ( ArrayType === void 0 ) ArrayType = Float64Array;\r\n\r\n    this.nodeSize = nodeSize;\r\n    this.points = points;\r\n\r\n    var IndexArrayType = points.length < 65536 ? Uint16Array : Uint32Array;\r\n\r\n    var ids = this.ids = new IndexArrayType(points.length);\r\n    var coords = this.coords = new ArrayType(points.length * 2);\r\n\r\n    for (var i = 0; i < points.length; i++) {\r\n        ids[i] = i;\r\n        coords[2 * i] = getX(points[i]);\r\n        coords[2 * i + 1] = getY(points[i]);\r\n    }\r\n\r\n    sortKD(ids, coords, nodeSize, 0, ids.length - 1, 0);\r\n};\r\n\r\nKDBush.prototype.range = function range$1 (minX, minY, maxX, maxY) {\r\n    return range(this.ids, this.coords, minX, minY, maxX, maxY, this.nodeSize);\r\n};\r\n\r\nKDBush.prototype.within = function within$1 (x, y, r) {\r\n    return within(this.ids, this.coords, x, y, r, this.nodeSize);\r\n};\r\n\r\nvar defaultOptions = {\r\n    minZoom: 0,   // min zoom to generate clusters on\r\n    maxZoom: 16,  // max zoom level to cluster the points on\r\n    minPoints: 2, // minimum points to form a cluster\r\n    radius: 40,   // cluster radius in pixels\r\n    extent: 512,  // tile extent (radius is calculated relative to it)\r\n    nodeSize: 64, // size of the KD-tree leaf node, affects performance\r\n    log: false,   // whether to log timing info\r\n\r\n    // whether to generate numeric ids for input features (in vector tiles)\r\n    generateId: false,\r\n\r\n    // a reduce function for calculating custom cluster properties\r\n    reduce: null, // (accumulated, props) => { accumulated.sum += props.sum; }\r\n\r\n    // properties to use for individual points when running the reducer\r\n    map: function (props) { return props; } // props => ({sum: props.my_value})\r\n};\r\n\r\nvar Supercluster = function Supercluster(options) {\r\n    this.options = extend(Object.create(defaultOptions), options);\r\n    this.trees = new Array(this.options.maxZoom + 1);\r\n};\r\n\r\nSupercluster.prototype.load = function load (points) {\r\n    var ref = this.options;\r\n        var log = ref.log;\r\n        var minZoom = ref.minZoom;\r\n        var maxZoom = ref.maxZoom;\r\n        var nodeSize = ref.nodeSize;\r\n\r\n    if (log) { console.time('total time'); }\r\n\r\n    var timerId = \"prepare \" + (points.length) + \" points\";\r\n    if (log) { console.time(timerId); }\r\n\r\n    this.points = points;\r\n\r\n    // generate a cluster object for each point and index input points into a KD-tree\r\n    var clusters = [];\r\n    for (var i = 0; i < points.length; i++) {\r\n        if (!points[i].geometry) { continue; }\r\n        clusters.push(createPointCluster(points[i], i));\r\n    }\r\n    this.trees[maxZoom + 1] = new KDBush(clusters, getX, getY, nodeSize, Float32Array);\r\n\r\n    if (log) { console.timeEnd(timerId); }\r\n\r\n    // cluster points on max zoom, then cluster the results on previous zoom, etc.;\r\n    // results in a cluster hierarchy across zoom levels\r\n    for (var z = maxZoom; z >= minZoom; z--) {\r\n        var now = +Date.now();\r\n\r\n        // create a new set of clusters for the zoom and index them with a KD-tree\r\n        clusters = this._cluster(clusters, z);\r\n        this.trees[z] = new KDBush(clusters, getX, getY, nodeSize, Float32Array);\r\n\r\n        if (log) { console.log('z%d: %d clusters in %dms', z, clusters.length, +Date.now() - now); }\r\n    }\r\n\r\n    if (log) { console.timeEnd('total time'); }\r\n\r\n    return this;\r\n};\r\n\r\nSupercluster.prototype.getClusters = function getClusters (bbox, zoom) {\r\n    var minLng = ((bbox[0] + 180) % 360 + 360) % 360 - 180;\r\n    var minLat = Math.max(-90, Math.min(90, bbox[1]));\r\n    var maxLng = bbox[2] === 180 ? 180 : ((bbox[2] + 180) % 360 + 360) % 360 - 180;\r\n    var maxLat = Math.max(-90, Math.min(90, bbox[3]));\r\n\r\n    if (bbox[2] - bbox[0] >= 360) {\r\n        minLng = -180;\r\n        maxLng = 180;\r\n    } else if (minLng > maxLng) {\r\n        var easternHem = this.getClusters([minLng, minLat, 180, maxLat], zoom);\r\n        var westernHem = this.getClusters([-180, minLat, maxLng, maxLat], zoom);\r\n        return easternHem.concat(westernHem);\r\n    }\r\n\r\n    var tree = this.trees[this._limitZoom(zoom)];\r\n    var ids = tree.range(lngX(minLng), latY(maxLat), lngX(maxLng), latY(minLat));\r\n    var clusters = [];\r\n    for (var i = 0, list = ids; i < list.length; i += 1) {\r\n        var id = list[i];\r\n\r\n            var c = tree.points[id];\r\n        clusters.push(c.numPoints ? getClusterJSON(c) : this.points[c.index]);\r\n    }\r\n    return clusters;\r\n};\r\n\r\nSupercluster.prototype.getChildren = function getChildren (clusterId) {\r\n    var originId = this._getOriginId(clusterId);\r\n    var originZoom = this._getOriginZoom(clusterId);\r\n    var errorMsg = 'No cluster with the specified id.';\r\n\r\n    var index = this.trees[originZoom];\r\n    if (!index) { throw new Error(errorMsg); }\r\n\r\n    var origin = index.points[originId];\r\n    if (!origin) { throw new Error(errorMsg); }\r\n\r\n    var r = this.options.radius / (this.options.extent * Math.pow(2, originZoom - 1));\r\n    var ids = index.within(origin.x, origin.y, r);\r\n    var children = [];\r\n    for (var i = 0, list = ids; i < list.length; i += 1) {\r\n        var id = list[i];\r\n\r\n            var c = index.points[id];\r\n        if (c.parentId === clusterId) {\r\n            children.push(c.numPoints ? getClusterJSON(c) : this.points[c.index]);\r\n        }\r\n    }\r\n\r\n    if (children.length === 0) { throw new Error(errorMsg); }\r\n\r\n    return children;\r\n};\r\n\r\nSupercluster.prototype.getLeaves = function getLeaves (clusterId, limit, offset) {\r\n    limit = limit || 10;\r\n    offset = offset || 0;\r\n\r\n    var leaves = [];\r\n    this._appendLeaves(leaves, clusterId, limit, offset, 0);\r\n\r\n    return leaves;\r\n};\r\n\r\nSupercluster.prototype.getTile = function getTile (z, x, y) {\r\n    var tree = this.trees[this._limitZoom(z)];\r\n    var z2 = Math.pow(2, z);\r\n    var ref = this.options;\r\n        var extent = ref.extent;\r\n        var radius = ref.radius;\r\n    var p = radius / extent;\r\n    var top = (y - p) / z2;\r\n    var bottom = (y + 1 + p) / z2;\r\n\r\n    var tile = {\r\n        features: []\r\n    };\r\n\r\n    this._addTileFeatures(\r\n        tree.range((x - p) / z2, top, (x + 1 + p) / z2, bottom),\r\n        tree.points, x, y, z2, tile);\r\n\r\n    if (x === 0) {\r\n        this._addTileFeatures(\r\n            tree.range(1 - p / z2, top, 1, bottom),\r\n            tree.points, z2, y, z2, tile);\r\n    }\r\n    if (x === z2 - 1) {\r\n        this._addTileFeatures(\r\n            tree.range(0, top, p / z2, bottom),\r\n            tree.points, -1, y, z2, tile);\r\n    }\r\n\r\n    return tile.features.length ? tile : null;\r\n};\r\n\r\nSupercluster.prototype.getClusterExpansionZoom = function getClusterExpansionZoom (clusterId) {\r\n    var expansionZoom = this._getOriginZoom(clusterId) - 1;\r\n    while (expansionZoom <= this.options.maxZoom) {\r\n        var children = this.getChildren(clusterId);\r\n        expansionZoom++;\r\n        if (children.length !== 1) { break; }\r\n        clusterId = children[0].properties.cluster_id;\r\n    }\r\n    return expansionZoom;\r\n};\r\n\r\nSupercluster.prototype._appendLeaves = function _appendLeaves (result, clusterId, limit, offset, skipped) {\r\n    var children = this.getChildren(clusterId);\r\n\r\n    for (var i = 0, list = children; i < list.length; i += 1) {\r\n        var child = list[i];\r\n\r\n            var props = child.properties;\r\n\r\n        if (props && props.cluster) {\r\n            if (skipped + props.point_count <= offset) {\r\n                // skip the whole cluster\r\n                skipped += props.point_count;\r\n            } else {\r\n                // enter the cluster\r\n                skipped = this._appendLeaves(result, props.cluster_id, limit, offset, skipped);\r\n                // exit the cluster\r\n            }\r\n        } else if (skipped < offset) {\r\n            // skip a single point\r\n            skipped++;\r\n        } else {\r\n            // add a single point\r\n            result.push(child);\r\n        }\r\n        if (result.length === limit) { break; }\r\n    }\r\n\r\n    return skipped;\r\n};\r\n\r\nSupercluster.prototype._addTileFeatures = function _addTileFeatures (ids, points, x, y, z2, tile) {\r\n    for (var i$1 = 0, list = ids; i$1 < list.length; i$1 += 1) {\r\n        var i = list[i$1];\r\n\r\n            var c = points[i];\r\n        var isCluster = c.numPoints;\r\n        var f = {\r\n            type: 1,\r\n            geometry: [[\r\n                Math.round(this.options.extent * (c.x * z2 - x)),\r\n                Math.round(this.options.extent * (c.y * z2 - y))\r\n            ]],\r\n            tags: isCluster ? getClusterProperties(c) : this.points[c.index].properties\r\n        };\r\n\r\n        // assign id\r\n        var id = (void 0);\r\n        if (isCluster) {\r\n            id = c.id;\r\n        } else if (this.options.generateId) {\r\n            // optionally generate id\r\n            id = c.index;\r\n        } else if (this.points[c.index].id) {\r\n            // keep id if already assigned\r\n            id = this.points[c.index].id;\r\n        }\r\n\r\n        if (id !== undefined) { f.id = id; }\r\n\r\n        tile.features.push(f);\r\n    }\r\n};\r\n\r\nSupercluster.prototype._limitZoom = function _limitZoom (z) {\r\n    return Math.max(this.options.minZoom, Math.min(+z, this.options.maxZoom + 1));\r\n};\r\n\r\nSupercluster.prototype._cluster = function _cluster (points, zoom) {\r\n    var clusters = [];\r\n    var ref = this.options;\r\n        var radius = ref.radius;\r\n        var extent = ref.extent;\r\n        var reduce = ref.reduce;\r\n        var minPoints = ref.minPoints;\r\n    var r = radius / (extent * Math.pow(2, zoom));\r\n\r\n    // loop through each point\r\n    for (var i = 0; i < points.length; i++) {\r\n        var p = points[i];\r\n        // if we've already visited the point at this zoom level, skip it\r\n        if (p.zoom <= zoom) { continue; }\r\n        p.zoom = zoom;\r\n\r\n        // find all nearby points\r\n        var tree = this.trees[zoom + 1];\r\n        var neighborIds = tree.within(p.x, p.y, r);\r\n\r\n        var numPointsOrigin = p.numPoints || 1;\r\n        var numPoints = numPointsOrigin;\r\n\r\n        // count the number of points in a potential cluster\r\n        for (var i$1 = 0, list = neighborIds; i$1 < list.length; i$1 += 1) {\r\n            var neighborId = list[i$1];\r\n\r\n                var b = tree.points[neighborId];\r\n            // filter out neighbors that are already processed\r\n            if (b.zoom > zoom) { numPoints += b.numPoints || 1; }\r\n        }\r\n\r\n        if (numPoints >= minPoints) { // enough points to form a cluster\r\n            var wx = p.x * numPointsOrigin;\r\n            var wy = p.y * numPointsOrigin;\r\n\r\n            var clusterProperties = reduce && numPointsOrigin > 1 ? this._map(p, true) : null;\r\n\r\n            // encode both zoom and point index on which the cluster originated -- offset by total length of features\r\n            var id = (i << 5) + (zoom + 1) + this.points.length;\r\n\r\n            for (var i$2 = 0, list$1 = neighborIds; i$2 < list$1.length; i$2 += 1) {\r\n                var neighborId$1 = list$1[i$2];\r\n\r\n                    var b$1 = tree.points[neighborId$1];\r\n\r\n                if (b$1.zoom <= zoom) { continue; }\r\n                b$1.zoom = zoom; // save the zoom (so it doesn't get processed twice)\r\n\r\n                var numPoints2 = b$1.numPoints || 1;\r\n                wx += b$1.x * numPoints2; // accumulate coordinates for calculating weighted center\r\n                wy += b$1.y * numPoints2;\r\n\r\n                b$1.parentId = id;\r\n\r\n                if (reduce) {\r\n                    if (!clusterProperties) { clusterProperties = this._map(p, true); }\r\n                    reduce(clusterProperties, this._map(b$1));\r\n                }\r\n            }\r\n\r\n            p.parentId = id;\r\n            clusters.push(createCluster(wx / numPoints, wy / numPoints, id, numPoints, clusterProperties));\r\n\r\n        } else { // left points as unclustered\r\n            clusters.push(p);\r\n\r\n            if (numPoints > 1) {\r\n                for (var i$3 = 0, list$2 = neighborIds; i$3 < list$2.length; i$3 += 1) {\r\n                    var neighborId$2 = list$2[i$3];\r\n\r\n                        var b$2 = tree.points[neighborId$2];\r\n                    if (b$2.zoom <= zoom) { continue; }\r\n                    b$2.zoom = zoom;\r\n                    clusters.push(b$2);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return clusters;\r\n};\r\n\r\n// get index of the point from which the cluster originated\r\nSupercluster.prototype._getOriginId = function _getOriginId (clusterId) {\r\n    return (clusterId - this.points.length) >> 5;\r\n};\r\n\r\n// get zoom of the point from which the cluster originated\r\nSupercluster.prototype._getOriginZoom = function _getOriginZoom (clusterId) {\r\n    return (clusterId - this.points.length) % 32;\r\n};\r\n\r\nSupercluster.prototype._map = function _map (point, clone) {\r\n    if (point.numPoints) {\r\n        return clone ? extend({}, point.properties) : point.properties;\r\n    }\r\n    var original = this.points[point.index].properties;\r\n    var result = this.options.map(original);\r\n    return clone && result === original ? extend({}, result) : result;\r\n};\r\n\r\nfunction createCluster(x, y, id, numPoints, properties) {\r\n    return {\r\n        x: x, // weighted cluster center\r\n        y: y,\r\n        zoom: Infinity, // the last zoom the cluster was processed at\r\n        id: id, // encodes index of the first child of the cluster and its zoom level\r\n        parentId: -1, // parent cluster id\r\n        numPoints: numPoints,\r\n        properties: properties\r\n    };\r\n}\r\n\r\nfunction createPointCluster(p, id) {\r\n    var ref = p.geometry.coordinates;\r\n    var x = ref[0];\r\n    var y = ref[1];\r\n    return {\r\n        x: lngX(x), // projected point coordinates\r\n        y: latY(y),\r\n        zoom: Infinity, // the last zoom the point was processed at\r\n        index: id, // index of the source feature in the original input array,\r\n        parentId: -1 // parent cluster id\r\n    };\r\n}\r\n\r\nfunction getClusterJSON(cluster) {\r\n    return {\r\n        type: 'Feature',\r\n        id: cluster.id,\r\n        properties: getClusterProperties(cluster),\r\n        geometry: {\r\n            type: 'Point',\r\n            coordinates: [xLng(cluster.x), yLat(cluster.y)]\r\n        }\r\n    };\r\n}\r\n\r\nfunction getClusterProperties(cluster) {\r\n    var count = cluster.numPoints;\r\n    var abbrev =\r\n        count >= 10000 ? ((Math.round(count / 1000)) + \"k\") :\r\n        count >= 1000 ? ((Math.round(count / 100) / 10) + \"k\") : count;\r\n    return extend(extend({}, cluster.properties), {\r\n        cluster: true,\r\n        cluster_id: cluster.id,\r\n        point_count: count,\r\n        point_count_abbreviated: abbrev\r\n    });\r\n}\r\n\r\n// longitude/latitude to spherical mercator in [0..1] range\r\nfunction lngX(lng) {\r\n    return lng / 360 + 0.5;\r\n}\r\nfunction latY(lat) {\r\n    var sin = Math.sin(lat * Math.PI / 180);\r\n    var y = (0.5 - 0.25 * Math.log((1 + sin) / (1 - sin)) / Math.PI);\r\n    return y < 0 ? 0 : y > 1 ? 1 : y;\r\n}\r\n\r\n// spherical mercator to longitude/latitude\r\nfunction xLng(x) {\r\n    return (x - 0.5) * 360;\r\n}\r\nfunction yLat(y) {\r\n    var y2 = (180 - y * 360) * Math.PI / 180;\r\n    return 360 * Math.atan(Math.exp(y2)) / Math.PI - 90;\r\n}\r\n\r\nfunction extend(dest, src) {\r\n    for (var id in src) { dest[id] = src[id]; }\r\n    return dest;\r\n}\r\n\r\nfunction getX(p) {\r\n    return p.x;\r\n}\r\nfunction getY(p) {\r\n    return p.y;\r\n}\r\n\r\nexport default Supercluster;\r\n","import DataSet, { DataItem } from '../data/DataSet';\nimport TWEEN from '../utils/Tween';\nimport Intensity from '../utils/data-range/Intensity';\nimport Category from '../utils/data-range/Category';\nimport Choropleth from '../utils/data-range/Choropleth';\nimport drawHeatmap from '../canvas/draw/heatmap';\nimport drawArrow from '../canvas/draw/arrow';\nimport drawClip from '../canvas/draw/clip';\nimport drawSimple from '../canvas/draw/simple';\nimport webglDrawSimple from '../webgl/draw/simple';\nimport drawGrid from '../canvas/draw/grid';\nimport drawCluster from '../canvas/draw/cluster';\nimport drawHoneycomb from '../canvas/draw/honeycomb';\nimport drawText from '../canvas/draw/text';\nimport drawIcon from '../canvas/draw/icon';\nimport pathSimple from '../canvas/path/simple';\nimport clear from '../canvas/clear';\n// @ts-ignore\nimport Supercluster from '../utils/supercluster';\n\n// 定义地图类型\nexport interface Map {[key: string]: any;}\n\n// 定义动画选项接口\nexport interface AnimationOptions {\n    enabled?: boolean;\n    stepsRange?: {\n        start: number;\n        end: number;\n    };\n    duration?: number;\n}\n\n// 定义图层选项接口\nexport interface LayerOptions {\n    draw?: string;\n    maxZoom?: number;\n    clusterRadius?: number;\n    minPoints?: number;\n    extent?: number;\n    maxSize?: number;\n    minSize?: number;\n    gradient?: any;\n    max?: number;\n    min?: number;\n    splitList?: any[];\n    color?: any;\n    context?: string;\n    arrow?: {\n        show?: boolean;\n        [key: string]: any;\n    };\n    intensity?: any;\n    animation?: AnimationOptions;\n    methods?: {\n        click?: (dataItem: DataItem | null, e: any) => void;\n        mousemove?: (dataItem: DataItem | null, e: any) => void;\n        hover?: (dataItem: DataItem | null, e: any) => void;\n        doubleClick?: (dataItem: DataItem | null, e: any) => void;\n        tap?: (dataItem: DataItem | null, e: any) => void;\n    };\n    [key: string]: any;\n}\n\n// 定义像素坐标接口\nexport interface Pixel {\n    x: number;\n    y: number;\n}\n\n// 定义上下文配置接口\nexport interface ContextConfig {\n    globalAlpha: number;\n    globalCompositeOperation: string;\n    imageSmoothingEnabled: boolean;\n    strokeStyle: string;\n    fillStyle: string;\n    shadowOffsetX: number;\n    shadowOffsetY: number;\n    shadowBlur: number;\n    shadowColor: string;\n    lineWidth: number;\n    lineCap: string;\n    lineJoin: string;\n    miterLimit: number;\n    lineDashOffset: number;\n    font: string;\n    textAlign: string;\n    textBaseline: string;\n    [key: string]: any;\n}\n\n// 定义图例选项接口\nexport interface LegendOptions {\n    [key: string]: any;\n}\n\n// 定义聚合点类型\nexport interface ClusterPoint {\n    id: number;\n    numPoints: number;\n    [key: string]: any;\n}\n\n// 定义聚合树节点类型\nexport interface ClusterTreeNode {\n    points: ClusterPoint[];\n    max: number;\n    min: number;\n    [key: string]: any;\n}\n\n// 定义Supercluster类型\nexport interface SuperclusterInstance {\n    load(data: DataItem[]): void;\n    trees: ClusterTreeNode[];\n    getChildren(id: number): any[];\n    [key: string]: any;\n}\n\n// 定义BaseLayer类\nexport default class BaseLayer {\n    protected dataSet: DataSet;\n    protected map: Map;\n    protected options: LayerOptions;\n    protected supercluster?: SuperclusterInstance;\n    protected clusterDataSet?: DataSet;\n    protected intensity?: Intensity;\n    protected category?: Category;\n    protected choropleth?: Choropleth;\n    protected canvasLayer?: any;\n    protected animator?: any;\n    protected context?: string;\n    protected steps?: { step: number };\n\n    constructor(map: Map, dataSet: DataSet | DataItem[] | DataItem, options: LayerOptions) {\n        let processedDataSet: DataSet;\n        if (!(dataSet instanceof DataSet)) {\n            processedDataSet = new DataSet(dataSet);\n        } else {\n            processedDataSet = dataSet;\n        }\n\n        this.dataSet = processedDataSet;\n        this.map = map;\n        this.options = options;\n        if (options.draw === 'cluster') {\n            this.refreshCluster(options);\n        }\n    }\n\n    refreshCluster(options: LayerOptions): void {\n        options = options || this.options;\n        this.supercluster = new Supercluster({\n            maxZoom: options.maxZoom || 19,\n            radius: options.clusterRadius || 100,\n            minPoints: options.minPoints || 2,\n            extent: options.extent || 512\n        });\n\n        this.supercluster.load(this.dataSet.get());\n        // 拿到每个级别下的最大值最小值\n        this.supercluster.trees.forEach(item => {\n            let max = 0;\n            let min = Infinity;\n            item.points.forEach(point => {\n                max = Math.max(point.numPoints || 0, max);\n                min = Math.min(point.numPoints || Infinity, min);\n            });\n            item.max = max;\n            item.min = min;\n        });\n        this.clusterDataSet = new DataSet();\n    }\n\n    getDefaultContextConfig(): ContextConfig {\n        return {\n            globalAlpha: 1,\n            globalCompositeOperation: 'source-over',\n            imageSmoothingEnabled: true,\n            strokeStyle: '#000000',\n            fillStyle: '#000000',\n            shadowOffsetX: 0,\n            shadowOffsetY: 0,\n            shadowBlur: 0,\n            shadowColor: 'rgba(0, 0, 0, 0)',\n            lineWidth: 1,\n            lineCap: 'butt',\n            lineJoin: 'miter',\n            miterLimit: 10,\n            lineDashOffset: 0,\n            font: '10px sans-serif',\n            textAlign: 'start',\n            textBaseline: 'alphabetic'\n        };\n    }\n\n    initDataRange(options: LayerOptions): void {\n        const self = this;\n        self.intensity = new Intensity({\n            maxSize: self.options.maxSize,\n            minSize: self.options.minSize,\n            gradient: self.options.gradient,\n            max: self.options.max || this.dataSet.getMax('count')\n        });\n        self.category = new Category(self.options.splitList || []);\n        self.choropleth = new Choropleth(self.options.splitList || []);\n        if (self.options.splitList === undefined) {\n            self.category.generateByDataSet(this.dataSet, self.options.color);\n        }\n        if (self.options.splitList === undefined) {\n            const min = self.options.min || this.dataSet.getMin('count') || 0;\n            const max = self.options.max || this.dataSet.getMax('count') || 100;\n            self.choropleth.generateByMinMax(min, max);\n        }\n    }\n\n    getLegend(options: LegendOptions): any {\n        const draw = this.options.draw;\n        let legend = null;\n        const self = this;\n        if (self.options.draw === 'intensity' || self.options.draw === 'heatmap') {\n            return this.intensity?.getLegend(options);\n        } else if (self.options.draw === 'category') {\n            return this.category?.getLegend(options);\n        } else if (self.options.draw === 'choropleth') {\n            return this.choropleth?.getLegend(options);\n        }\n        return legend;\n    }\n\n    processData(data: DataItem[]): void {\n        const self = this;\n        const draw = self.options.draw;\n        if (draw === 'bubble' || draw === 'intensity' || draw === 'category' || draw === 'choropleth' || draw === 'simple') {\n            for (let i = 0; i < data.length; i++) {\n                const item = data[i];\n\n                if (self.options.draw === 'bubble') {\n                    data[i]._size = self.intensity?.getSize(item.count);\n                } else {\n                    data[i]._size = undefined;\n                }\n\n                let styleType = '_fillStyle';\n\n                if (data[i].geometry?.type === 'LineString' || self.options.styleType === 'stroke') {\n                    styleType = '_strokeStyle';\n                }\n\n                if (self.options.draw === 'intensity') {\n                    data[i][styleType] = self.intensity?.getColor(item.count);\n                } else if (self.options.draw === 'category') {\n                    data[i][styleType] = self.category?.get(item.count);\n                } else if (self.options.draw === 'choropleth') {\n                    data[i][styleType] = self.choropleth?.get(item.count);\n                }\n            }\n        }\n    }\n\n    isEnabledTime(): boolean {\n        const animationOptions = this.options.animation;\n        const flag = animationOptions && !(animationOptions.enabled === false);\n        return !!flag;\n    }\n\n    argCheck(options: LayerOptions): void {\n        if (options.draw === 'heatmap') {\n            if (options.strokeStyle) {\n                console.warn(\n                    '[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]'\n                );\n            }\n        }\n    }\n\n    drawContext(context: CanvasRenderingContext2D | WebGLRenderingContext, dataSet: DataSet, options: LayerOptions, nwPixel: Pixel): void {\n        const self = this;\n        switch (self.options.draw) {\n            case 'heatmap':\n                drawHeatmap.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                break;\n            case 'grid':\n            case 'cluster':\n            case 'honeycomb':\n                self.options.offset = {\n                    x: nwPixel.x,\n                    y: nwPixel.y\n                };\n                if (self.options.draw === 'grid') {\n                    drawGrid.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                } else if (self.options.draw === 'cluster') {\n                    drawCluster.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                } else {\n                    drawHoneycomb.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                }\n                break;\n            case 'text':\n                drawText.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                break;\n            case 'icon':\n                drawIcon.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                break;\n            case 'clip':\n                drawClip.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                break;\n            default:\n                if (self.options.context === 'webgl') {\n                    webglDrawSimple.draw(context as WebGLRenderingContext, dataSet, self.options);\n                } else {\n                    // 使用增强版绘制函数\n                    if (self.options.enhancedDraw) {\n                        drawSimple.drawEnhanced(context as CanvasRenderingContext2D, dataSet, self.options);\n                    } else {\n                        drawSimple.draw(context as CanvasRenderingContext2D, dataSet, self.options);\n                    }\n                }\n        }\n\n        if (self.options.arrow && self.options.arrow.show !== false) {\n            drawArrow.draw(context as CanvasRenderingContext2D, dataSet, self.options as any);\n        }\n    }\n\n    isPointInPath(context: CanvasRenderingContext2D | WebGLRenderingContext | null, pixel: Pixel): DataItem | null {\n        const ctx = this.getContext();\n        const conf = this.getDefaultContextConfig();\n        for (const i in conf) {\n            (ctx as any)[i] = conf[i];\n        }\n        let data: DataItem[];\n        if (\n            this.options.draw === 'cluster' &&\n            (!this.options.maxClusterZoom || this.options.maxClusterZoom >= this.getZoom())\n        ) {\n            data = this.clusterDataSet?.get() || [];\n        } else {\n            data = this.dataSet.get();\n        }\n        for (let i = 0; i < data.length; i++) {\n            (ctx as CanvasRenderingContext2D).beginPath();\n            const options = this.options;\n            const x = pixel.x * (this.canvasLayer?.devicePixelRatio || 1);\n            const y = pixel.y * (this.canvasLayer?.devicePixelRatio || 1);\n\n            options.multiPolygonDraw = function () {\n                if ((ctx as CanvasRenderingContext2D).isPointInPath(x, y)) {\n                    return data[i];\n                }\n                return null;\n            };\n\n            pathSimple.draw(ctx as CanvasRenderingContext2D, data[i], options);\n\n            const geoType = data[i].geometry?.type;\n            if (geoType?.indexOf('LineString') !== -1) {\n                if ((ctx as CanvasRenderingContext2D).isPointInStroke && (ctx as CanvasRenderingContext2D).isPointInStroke(x, y)) {\n                    return data[i];\n                }\n            } else {\n                if ((ctx as CanvasRenderingContext2D).isPointInPath(x, y)) {\n                    return data[i];\n                }\n            }\n        }\n        return null;\n    }\n    \n    // 递归获取聚合点下的所有原始点数据\n    getClusterPoints(cluster: any): any[] {\n        if (cluster.type !== 'Feature') {\n            return [];\n        }\n        const children = this.supercluster?.getChildren(cluster.id) || [];\n        return children\n            .map(item => {\n                if (item.type === 'Feature') {\n                    return this.getClusterPoints(item);\n                } else {\n                    return item;\n                }\n            })\n            .flat();\n    }\n\n    /**\n     * 获取指定范围内的数据点\n     * @param {Object} bounds - 地理范围边界\n     */\n    getDataInBounds(bounds: { contains: (coords: any) => boolean }): DataItem[] {\n        const data = this.dataSet.get();\n        const result: DataItem[] = [];\n        \n        for (let i = 0; i < data.length; i++) {\n            const item = data[i];\n            if (item.geometry && item.geometry.coordinates) {\n                const coords = item.geometry.coordinates;\n                if (bounds.contains(coords)) {\n                    result.push(item);\n                }\n            }\n        }\n        \n        return result;\n    }\n\n    /**\n     * 根据条件过滤数据\n     * @param {Function} filter - 过滤函数\n     */\n    filterData(filter: (item: DataItem) => boolean): DataSet {\n        if (typeof filter === 'function') {\n            const filteredData = this.dataSet.filter(filter);\n            return new DataSet(filteredData);\n        }\n        return this.dataSet;\n    }\n\n    /**\n     * 更新数据集\n     * @param {Array|DataSet} data - 新数据\n     */\n    updateData(data: DataSet | DataItem[]): void {\n        if (data instanceof DataSet) {\n            this.dataSet = data;\n        } else if (Array.isArray(data)) {\n            this.dataSet.set(data);\n        }\n        \n        // 如果是聚类图，需要刷新聚类\n        if (this.options.draw === 'cluster') {\n            this.refreshCluster(this.options);\n        }\n        \n        // 重新初始化数据范围\n        this.initDataRange(this.options);\n        \n        // 重新绘制\n        this.draw();\n    }\n\n    /**\n     * 添加数据\n     * @param {Object|Array} data - 要添加的数据\n     */\n    addData(data: DataItem | DataItem[]): void {\n        this.dataSet.add(data);\n        \n        // 如果是聚类图，需要刷新聚类\n        if (this.options.draw === 'cluster') {\n            this.refreshCluster(this.options);\n        }\n        \n        // 重新初始化数据范围\n        this.initDataRange(this.options);\n        \n        // 重新绘制\n        this.draw();\n    }\n\n    /**\n     * 清除数据\n     */\n    clearData(): void {\n        this.dataSet.clear();\n        \n        // 如果是聚类图，需要刷新聚类\n        if (this.options.draw === 'cluster') {\n            this.refreshCluster(this.options);\n        }\n        \n        // 重新绘制\n        this.draw();\n    }\n\n    /**\n     * 获取数据统计信息\n     */\n    getDataStats(): {\n        count: number;\n        minX: number | undefined;\n        maxX: number | undefined;\n        minY: number | undefined;\n        maxY: number | undefined;\n        minCount: number | undefined;\n        maxCount: number | undefined;\n        avgCount: number;\n    } {\n        const data = this.dataSet.get();\n        return {\n            count: data.length,\n            minX: this.dataSet.getMin('x'),\n            maxX: this.dataSet.getMax('x'),\n            minY: this.dataSet.getMin('y'),\n            maxY: this.dataSet.getMax('y'),\n            minCount: this.dataSet.getMin('count'),\n            maxCount: this.dataSet.getMax('count'),\n            avgCount: this.dataSet.getAverage('count')\n        };\n    }\n\n    clickEvent(pixel: Pixel, e: any): void {\n        if (!this.options.methods) {\n            return;\n        }\n        const dataItem = this.isPointInPath(this.getContext(), pixel);\n\n        if (dataItem) {\n            if (this.options.draw === 'cluster') {\n                const children = this.getClusterPoints(dataItem);\n                dataItem.children = children;\n            }\n            this.options.methods.click?.(dataItem, e);\n        } else {\n            this.options.methods.click?.(null, e);\n        }\n    }\n\n    mousemoveEvent(pixel: Pixel, e: any): void {\n        if (!this.options.methods) {\n            return;\n        }\n        const dataItem = this.isPointInPath(this.getContext(), pixel);\n        if (dataItem) {\n            if (this.options.draw === 'cluster') {\n                const children = this.getClusterPoints(dataItem);\n                dataItem.children = children;\n            }\n            this.options.methods.mousemove?.(dataItem, e);\n        } else {\n            this.options.methods.mousemove?.(null, e);\n        }\n    }\n    \n    /**\n     * 悬停事件处理\n     * @param {Object} pixel - 像素坐标\n     * @param {Event} e - 事件对象\n     */\n    hoverEvent(pixel: Pixel, e: any): void {\n        if (!this.options.methods || !this.options.methods.hover) {\n            return;\n        }\n        \n        const dataItem = this.isPointInPath(this.getContext(), pixel);\n        if (dataItem) {\n            if (this.options.draw === 'cluster') {\n                const children = this.getClusterPoints(dataItem);\n                dataItem.children = children;\n            }\n            this.options.methods.hover?.(dataItem, e);\n        } else {\n            this.options.methods.hover?.(null, e);\n        }\n    }\n    \n    /**\n     * 双击事件处理\n     * @param {Object} pixel - 像素坐标\n     * @param {Event} e - 事件对象\n     */\n    doubleClickEvent(pixel: Pixel, e: any): void {\n        if (!this.options.methods || !this.options.methods.doubleClick) {\n            return;\n        }\n        \n        const dataItem = this.isPointInPath(this.getContext(), pixel);\n        if (dataItem) {\n            if (this.options.draw === 'cluster') {\n                const children = this.getClusterPoints(dataItem);\n                dataItem.children = children;\n            }\n            this.options.methods.doubleClick?.(dataItem, e);\n        } else {\n            this.options.methods.doubleClick?.(null, e);\n        }\n    }\n\n    tapEvent(pixel: Pixel, e: any): void {\n        if (!this.options.methods) {\n            return;\n        }\n        const dataItem = this.isPointInPath(this.getContext(), pixel);\n        if (dataItem) {\n            if (this.options.draw === 'cluster') {\n                const children = this.getClusterPoints(dataItem);\n                dataItem.children = children;\n            }\n            this.options.methods.tap?.(dataItem, e);\n        } else {\n            this.options.methods.tap?.(null, e);\n        }\n    }\n\n    /**\n     * obj.options\n     */\n    update(obj: { options: LayerOptions }, isDraw?: boolean): void {\n        const self = this;\n        const _options = obj.options;\n        const options = self.options;\n        for (const i in _options) {\n            options[i] = _options[i];\n        }\n        self.init(options);\n        if (isDraw !== false) {\n            self.draw();\n        }\n    }\n\n    /**\n     * 更新图层选项\n     * @param {Object} options - 新选项\n     * @param {Boolean} redraw - 是否重绘\n     */\n    updateOptions(options: Partial<LayerOptions>, redraw: boolean = true): void {\n        const self = this;\n        for (const key in options) {\n            self.options[key] = options[key];\n        }\n        \n        // 如果修改了与数据范围相关的选项，需要重新初始化\n        if (options.max !== undefined || options.min !== undefined || \n            options.gradient !== undefined || options.splitList !== undefined) {\n            self.initDataRange(self.options);\n        }\n        \n        if (redraw) {\n            self.draw();\n        }\n    }\n\n    setOptions(options: LayerOptions): void {\n        const self = this;\n        self.dataSet.reset();\n        // console.log('xxx1')\n        self.init(options);\n        // console.log('xxx')\n        self.draw();\n    }\n\n    set(obj: { options: LayerOptions }): void {\n        const self = this;\n        const ctx = this.getContext();\n        const conf = this.getDefaultContextConfig();\n        for (const i in conf) {\n            (ctx as any)[i] = conf[i];\n        }\n        self.init(obj.options);\n        self.draw();\n    }\n\n    destroy(): void {\n        this.unbindEvent();\n        this.hide();\n    }\n\n    initAnimator(): void {\n        const self = this;\n        const animationOptions = self.options.animation;\n\n        if (self.options.draw === 'time' || self.isEnabledTime()) {\n            if (!animationOptions?.stepsRange) {\n                animationOptions!.stepsRange = {\n                    start: this.dataSet.getMin('time') || 0,\n                    end: this.dataSet.getMax('time') || 0\n                };\n            }\n\n            this.steps = { step: animationOptions!.stepsRange!.start };\n            self.animator = new TWEEN.Tween(this.steps)\n                .onUpdate(function (this: { step: number }) {\n                    self._canvasUpdate(this.step);\n                })\n                .repeat(Infinity);\n\n            this.addAnimatorEvent();\n\n            const duration = (animationOptions?.duration || 5) * 1000;\n\n            self.animator.to({ step: animationOptions!.stepsRange!.end }, duration);\n            self.animator.start();\n        } else {\n            self.animator?.stop();\n        }\n    }\n\n    addAnimatorEvent(): void {}\n\n    animatorMovestartEvent(): void {\n        const animationOptions = this.options.animation;\n        if (this.isEnabledTime() && this.animator) {\n            this.steps!.step = animationOptions!.stepsRange!.start;\n            this.animator.stop();\n        }\n    }\n\n    animatorMoveendEvent(): void {\n        if (this.isEnabledTime() && this.animator) {\n            this.animator.start();\n        }\n    }\n    \n    /**\n     * 导出数据为GeoJSON格式\n     */\n    toGeoJSON(): {\n        type: string;\n        features: any[];\n    } {\n        const data = this.dataSet.get();\n        const geojson = {\n            type: \"FeatureCollection\",\n            features: [] as any[]\n        };\n        \n        data.forEach(item => {\n            if (item.geometry) {\n                geojson.features.push({\n                    type: \"Feature\",\n                    properties: Object.assign({}, item),\n                    geometry: item.geometry\n                });\n            }\n        });\n        \n        return geojson;\n    }\n    \n    /**\n     * 导出数据为CSV格式\n     */\n    toCSV(): string {\n        const data = this.dataSet.get();\n        if (data.length === 0) return \"\";\n        \n        // 获取所有属性名作为表头\n        const headers = Object.keys(data[0]).filter(key => key !== 'geometry');\n        let csv = headers.join(',') + '\\n';\n        \n        // 添加数据行\n        data.forEach(item => {\n            const row = headers.map(header => {\n                let value = item[header];\n                // 如果是数组或对象，转换为JSON字符串\n                if (typeof value === 'object') {\n                    value = JSON.stringify(value);\n                }\n                // 转义包含逗号或引号的值\n                if (typeof value === 'string' && (value.includes(',') || value.includes('\"'))) {\n                    value = '\"' + value.replace(/\"/g, '\"\"') + '\"';\n                }\n                return value;\n            });\n            csv += row.join(',') + '\\n';\n        });\n        \n        return csv;\n    }\n\n    // 以下方法需要在子类中实现\n    init(options: LayerOptions): void {}\n    draw(): void {}\n    getContext(): CanvasRenderingContext2D | WebGLRenderingContext | null { return null; }\n    getZoom(): number { return 0; }\n    unbindEvent(): void {}\n    hide(): void {}\n    _canvasUpdate(step: number): void {}\n}\n\nif (typeof window !== 'undefined') {\n    requestAnimationFrame(animate);\n}\n\nfunction animate(time: number): void {\n    requestAnimationFrame(animate);\n    TWEEN.update(time);\n}\n","import clear from \"../../canvas/clear\";\r\nimport BaseLayer from \"../BaseLayer\";\r\nimport CanvasLayer from \"./CanvasLayer\";\r\n\r\nvar global = typeof window === 'undefined' ? {} : window;\r\nvar BMap = global.BMap || global.BMapGL;\r\n\r\nclass AnimationLayer extends BaseLayer{\r\n    constructor (map, dataSet, options) {\r\n\r\n        super(map, dataSet, options);\r\n        this.map = map;\r\n        this.options = options || {};\r\n        this.dataSet = dataSet;\r\n\r\n        var canvasLayer = new CanvasLayer({\r\n            map: map,\r\n            zIndex: this.options.zIndex,\r\n            update: this._canvasUpdate.bind(this)\r\n        });\r\n\r\n        // 动画循环次数\r\n        this.animateLoopFrequency = 0;\r\n\r\n        this.init(this.options);\r\n\r\n        this.canvasLayer = canvasLayer;\r\n        this.transferToMercator();\r\n        var self = this;\r\n        dataSet.on('change', function() {\r\n            self.transferToMercator();\r\n            canvasLayer.draw();\r\n        });\r\n        this.ctx = canvasLayer.canvas.getContext('2d');\r\n\r\n        this.start();\r\n    }\r\n\r\n    draw() {\r\n        this.canvasLayer.draw();\r\n    }\r\n\r\n    init(options) {\r\n\r\n        var self = this;\r\n        self.options = options;\r\n     \r\n        this.initDataRange(options);\r\n        this.context = self.options.context || '2d';\r\n\r\n        if (self.options.zIndex) {\r\n            this.canvasLayer && this.canvasLayer.setZIndex(self.options.zIndex);\r\n        }\r\n\r\n        if (self.options.max) {\r\n            this.intensity.setMax(self.options.max);\r\n        }\r\n\r\n        if (self.options.min) {\r\n            this.intensity.setMin(self.options.min);\r\n        }\r\n\r\n        this.initAnimator();\r\n        \r\n    }\r\n\r\n    // 经纬度左边转换为墨卡托坐标\r\n    transferToMercator() {\r\n        var map = this.map;\r\n        var mapType = map.getMapType();\r\n        var projection;\r\n        if (mapType.getProjection) {\r\n            projection = mapType.getProjection();\r\n        } else {\r\n            projection = {\r\n                lngLatToPoint: function(point) {\r\n                    var mc = map.lnglatToMercator(point.lng, point.lat);\r\n                    return {\r\n                        x: mc[0],\r\n                        y: mc[1]\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.options.coordType !== 'bd09mc') {\r\n            var data = this.dataSet.get();\r\n            data = this.dataSet.transferCoordinate(data, function(coordinates) {\r\n                var pixel = projection.lngLatToPoint({\r\n                    lng: coordinates[0],\r\n                    lat: coordinates[1]\r\n                });\r\n                return [pixel.x, pixel.y];\r\n            }, 'coordinates', 'coordinates_mercator');\r\n            this.dataSet._set(data);\r\n        }\r\n    }\r\n\r\n    _canvasUpdate() {\r\n        var ctx = this.ctx;\r\n        if (!ctx) {\r\n            return;\r\n        }\r\n        //clear(ctx);\r\n        var map = this.map;\r\n        var projection;\r\n        var mcCenter;\r\n        if  (map.getMapType().getProjection) {\r\n            projection = map.getMapType().getProjection();\r\n            mcCenter = projection.lngLatToPoint(map.getCenter());\r\n        } else  {\r\n            mcCenter = {\r\n                x: map.getCenter().lng,\r\n                y: map.getCenter().lat\r\n            };\r\n            if (mcCenter.x > -180 && mcCenter.x < 180) {\r\n                mcCenter = map.lnglatToMercator(mcCenter.x, mcCenter.y);\r\n                mcCenter = {x: mcCenter[0], y: mcCenter[1]}\r\n            }\r\n            projection = {\r\n                lngLatToPoint: function(point) {\r\n                    var mc = map.lnglatToMercator(point.lng, point.lat);\r\n                    return {\r\n                        x: mc[0],\r\n                        y: mc[1]\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        var zoomUnit;\r\n        if (projection.getZoomUnits) {\r\n            zoomUnit = projection.getZoomUnits(map.getZoom());\r\n        } else {\r\n            zoomUnit = Math.pow(2, 18 - map.getZoom());\r\n        }\r\n        var nwMc = new BMap.Pixel(mcCenter.x - (map.getSize().width / 2) * zoomUnit, mcCenter.y + (map.getSize().height / 2) * zoomUnit); //左上角墨卡托坐标\r\n\r\n        clear(ctx);\r\n\r\n        var dataGetOptions = {\r\n            fromColumn: this.options.coordType == 'bd09mc' ? 'coordinates' : 'coordinates_mercator',\r\n            transferCoordinate: function(coordinate) {\r\n                if (!coordinate) {\r\n                    return;\r\n                }\r\n                var x = (coordinate[0] - nwMc.x) / zoomUnit;\r\n                var y = (nwMc.y - coordinate[1]) / zoomUnit;\r\n                return [x, y];\r\n            }\r\n        }\r\n        this.data = this.dataSet.get(dataGetOptions);\r\n        this.processData(this.data);\r\n        this.drawAnimation();\r\n    }\r\n    \r\n    drawAnimation() {\r\n        var ctx = this.ctx;\r\n        var data = this.data;\r\n        if (!data) {\r\n            return;\r\n        }\r\n        ctx.save();\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n        ctx.fillStyle = 'rgba(0, 0, 0, .1)';\r\n        ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        ctx.restore();\r\n\r\n        ctx.save();\r\n        if (this.options.shadowColor) {\r\n            ctx.shadowColor = this.options.shadowColor;\r\n        }\r\n\r\n        if (this.options.shadowBlur) {\r\n            ctx.shadowBlur = this.options.shadowBlur;\r\n        }\r\n\r\n        if (this.options.globalAlpha) {\r\n            ctx.globalAlpha = this.options.globalAlpha;\r\n        }\r\n\r\n        if (this.options.globalCompositeOperation) {\r\n            ctx.globalCompositeOperation = this.options.globalCompositeOperation;\r\n        }\r\n        var options = this.options;\r\n        var hasCalcAnimateLoopFrequency = false;\r\n        for (var i = 0; i < data.length; i++) {\r\n            if (data[i].geometry.type === 'Point') {\r\n                ctx.beginPath();\r\n                var maxSize = data[i].size || this.options.size;\r\n                var minSize = data[i].minSize || this.options.minSize || 0;\r\n                if (data[i]._size === undefined) {\r\n                    data[i]._size = minSize;\r\n                }\r\n                ctx.arc(data[i].geometry._coordinates[0], data[i].geometry._coordinates[1], data[i]._size, 0, Math.PI * 2, true);\r\n                ctx.closePath();\r\n\r\n                data[i]._size++;\r\n\r\n                if (data[i]._size > maxSize) {\r\n                    data[i]._size = minSize;\r\n                }\r\n                ctx.lineWidth = 1;\r\n                ctx.strokeStyle = data[i].strokeStyle || data[i]._strokeStyle || options.strokeStyle || 'yellow';\r\n                ctx.stroke();\r\n                var fillStyle = data[i].fillStyle || data[i]._fillStyle || options.fillStyle;\r\n                if (fillStyle) {\r\n                    ctx.fillStyle = fillStyle;\r\n                    ctx.fill();\r\n                }\r\n            } else if (data[i].geometry.type === 'LineString') {\r\n                ctx.beginPath();\r\n                var size = data[i].size || this.options.size || 5;\r\n                var minSize = data[i].minSize || this.options.minSize || 0;\r\n                if (data[i]._index === undefined) {\r\n                    data[i]._index = 0;\r\n                }\r\n                var index = data[i]._index;\r\n                \r\n                ctx.arc(data[i].geometry._coordinates[index][0], data[i].geometry._coordinates[index][1], size, 0, Math.PI * 2, true);\r\n                ctx.closePath();\r\n                data[i]._index = data[i]._index + (data[i]._step || 1);\r\n                var strokeStyle = data[i].strokeStyle || options.strokeStyle;\r\n                var fillStyle = data[i].fillStyle || options.fillStyle || 'yellow';\r\n                ctx.fillStyle = fillStyle;\r\n                ctx.fill();\r\n                if (strokeStyle && options.lineWidth) {\r\n                    ctx.lineWidth = options.lineWidth || 1;\r\n                    ctx.strokeStyle = strokeStyle;\r\n                    ctx.stroke();\r\n                }\r\n                if (data[i]._index >= data[i].geometry._coordinates.length) {\r\n                    if (options.isRound) {\r\n                        data[i]._step = -1;\r\n                        data[i]._index = data[i].geometry._coordinates.length - 1;\r\n                    } else {\r\n                        data[i]._index = 0;\r\n                        // 达到了临界值，并且在此次循环中动画次数没有计算，则加1 \r\n                        !hasCalcAnimateLoopFrequency && this.animateLoopFrequency++;\r\n                        // 开关关掉，一次循环中只能加一次动画执行次数\r\n                        hasCalcAnimateLoopFrequency = true;\r\n                    }\r\n                } \r\n                if (data[i]._index < 0 && options.isRound) {\r\n                    data[i]._step = 1;\r\n                    data[i]._index = 0;\r\n                    !hasCalcAnimateLoopFrequency && this.animateLoopFrequency++;\r\n                    hasCalcAnimateLoopFrequency = true;\r\n                }\r\n            }\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    animate() {\r\n        var prevAnimateLoopFrequency = this.animateLoopFrequency;\r\n        this.drawAnimation();\r\n        var animateTime = this.options.animateTime || 100;\r\n        var stayTime = this.options.stayTime;\r\n        // 动画有停留的时间，并且 循环次数也改变了，则使用停留时间\r\n        if (stayTime && this.animateLoopFrequency != prevAnimateLoopFrequency) {\r\n            this.hide();\r\n            this.timeout = setTimeout(() => {\r\n                this.canvasLayer.show();\r\n                this.animate();\r\n            }, stayTime);\r\n        } else {\r\n            this.timeout = setTimeout(this.animate.bind(this), animateTime);\r\n        }\r\n        var timesTimer = null;\r\n        if (this.options.times !== undefined && this.animateLoopFrequency >= this.options.times) {\r\n            this.stop();\r\n            timesTimer && clearTimeout(timesTimer);\r\n            timesTimer = setTimeout(this.hide.bind(this), animateTime)\r\n            return;\r\n        }\r\n    }\r\n\r\n    start() {\r\n        this.stop();\r\n        this.animate();\r\n    }\r\n\r\n    stop() {\r\n        clearTimeout(this.timeout);\r\n    }\r\n\r\n    unbindEvent() {\r\n    }\r\n\r\n    hide() {\r\n        this.canvasLayer.hide();\r\n        this.stop();\r\n    }\r\n\r\n    show() {\r\n        this.start();\r\n    }\r\n\r\n    clearData() {\r\n        this.dataSet && this.dataSet.clear();\r\n        this.update({\r\n            options: null\r\n        });\r\n    }\r\n\r\n    destroy() {\r\n        this.stop();\r\n        this.unbindEvent();\r\n        this.clearData();\r\n        this.map.removeOverlay(this.canvasLayer);\r\n        this.canvasLayer = null;\r\n    }\r\n}\r\n\r\nexport default AnimationLayer;\r\n","import BaseLayer from '../BaseLayer';\r\nimport CanvasLayer from './CanvasLayer';\r\nimport clear from '../../canvas/clear';\r\nimport Intensity from '../../utils/data-range/Intensity';\r\n\r\nvar global = typeof window === 'undefined' ? {} : window;\r\nvar BMap = global.BMap || global.BMapGL;\r\n\r\nclass Layer extends BaseLayer {\r\n    constructor(map, dataSet, options) {\r\n        super(map, dataSet, options);\r\n\r\n        var self = this;\r\n        options = options || {};\r\n\r\n        this.clickEvent = this.clickEvent.bind(this);\r\n        this.mousemoveEvent = this.mousemoveEvent.bind(this);\r\n        this.tapEvent = this.tapEvent.bind(this);\r\n        this.doubleClickEvent = this.doubleClickEvent.bind(this);\r\n\r\n        self.init(options);\r\n        self.argCheck(options);\r\n        self.transferToMercator();\r\n\r\n        var canvasLayer = (this.canvasLayer = new CanvasLayer({\r\n            map: map,\r\n            context: this.context,\r\n            updateImmediate: options.updateImmediate,\r\n            paneName: options.paneName,\r\n            mixBlendMode: options.mixBlendMode,\r\n            enableMassClear: options.enableMassClear,\r\n            zIndex: options.zIndex,\r\n            update() {\r\n                self._canvasUpdate();\r\n            }\r\n        }));\r\n\r\n        dataSet.on('change', function () {\r\n            self.transferToMercator();\r\n            // 数据更新后重新生成聚合数据\r\n            if (options.draw === 'cluster') {\r\n                self.refreshCluster();\r\n            }\r\n            canvasLayer.draw();\r\n        });\r\n    }\r\n\r\n    clickEvent(e) {\r\n        var pixel = e.pixel;\r\n        super.clickEvent(pixel, e);\r\n    }\r\n\r\n    mousemoveEvent(e) {\r\n        var pixel = e.pixel;\r\n        super.mousemoveEvent(pixel, e);\r\n    }\r\n\r\n    tapEvent(e) {\r\n        var pixel = e.pixel;\r\n        super.tapEvent(pixel, e);\r\n    }\r\n\r\n    doubleClickEvent(e) {\r\n        var pixel = e.pixel;\r\n        super.doubleClickEvent(pixel, e);\r\n    }\r\n\r\n    bindEvent(e) {\r\n        this.unbindEvent();\r\n        var map = this.map;\r\n        var timer = 0;\r\n        var that = this;\r\n\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.setDefaultCursor('default');\r\n                map.addEventListener('click', this.clickEvent);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.addEventListener('mousemove', this.mousemoveEvent);\r\n            }\r\n            \r\n            // 添加悬停事件支持\r\n            if (this.options.methods.hover) {\r\n                map.addEventListener('mouseover', this.mousemoveEvent);\r\n                map.addEventListener('mouseout', this.mousemoveEvent);\r\n            }\r\n            \r\n            // 添加双击事件支持\r\n            if (this.options.methods.doubleClick) {\r\n                map.addEventListener('dblclick', this.doubleClickEvent);\r\n            }\r\n\r\n            if ('ontouchend' in window.document && this.options.methods.tap) {\r\n                map.addEventListener('touchstart', function (e) {\r\n                    timer = new Date();\r\n                });\r\n                map.addEventListener('touchend', function (e) {\r\n                    if (new Date() - timer < 300) {\r\n                        that.tapEvent(e);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    unbindEvent(e) {\r\n        var map = this.map;\r\n\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.removeEventListener('click', this.clickEvent);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.removeEventListener('mousemove', this.mousemoveEvent);\r\n            }\r\n            // 移除悬停事件\r\n            if (this.options.methods.hover) {\r\n                map.removeEventListener('mouseover', this.mousemoveEvent);\r\n                map.removeEventListener('mouseout', this.mousemoveEvent);\r\n            }\r\n            // 移除双击事件\r\n            if (this.options.methods.doubleClick) {\r\n                map.removeEventListener('dblclick', this.doubleClickEvent);\r\n            }\r\n        }\r\n    }\r\n\r\n    // 经纬度左边转换为墨卡托坐标\r\n    transferToMercator(dataSet) {\r\n        if (!dataSet) {\r\n            dataSet = this.dataSet;\r\n        }\r\n\r\n        var map = this.map;\r\n\r\n        var mapType = map.getMapType();\r\n        var projection;\r\n        if (mapType.getProjection) {\r\n            projection = mapType.getProjection();\r\n        } else {\r\n            projection = {\r\n                lngLatToPoint: function (point) {\r\n                    var mc = map.lnglatToMercator(point.lng, point.lat);\r\n                    return {\r\n                        x: mc[0],\r\n                        y: mc[1]\r\n                    };\r\n                }\r\n            };\r\n        }\r\n\r\n        if (this.options.coordType !== 'bd09mc') {\r\n            var data = dataSet.get();\r\n            data = dataSet.transferCoordinate(\r\n                data,\r\n                function (coordinates) {\r\n                    if (coordinates[0] < -180 || coordinates[0] > 180 || coordinates[1] < -90 || coordinates[1] > 90) {\r\n                        return coordinates;\r\n                    } else {\r\n                        var pixel = projection.lngLatToPoint({\r\n                            lng: coordinates[0],\r\n                            lat: coordinates[1]\r\n                        });\r\n                        return [pixel.x, pixel.y];\r\n                    }\r\n                },\r\n                'coordinates',\r\n                'coordinates_mercator'\r\n            );\r\n            dataSet._set(data);\r\n        }\r\n    }\r\n\r\n    getContext() {\r\n        return this.canvasLayer.canvas.getContext(this.context);\r\n    }\r\n\r\n    _canvasUpdate(time) {\r\n        if (!this.canvasLayer) {\r\n            return;\r\n        }\r\n        var self = this;\r\n        var animationOptions = this.options.animation;\r\n        var map = this.canvasLayer._map;\r\n        var projection;\r\n        var mcCenter;\r\n        if (map.getMapType().getProjection) {\r\n            projection = map.getMapType().getProjection();\r\n            mcCenter = projection.lngLatToPoint(map.getCenter());\r\n        } else {\r\n            mcCenter = {\r\n                x: map.getCenter().lng,\r\n                y: map.getCenter().lat\r\n            };\r\n            if (mcCenter.x > -180 && mcCenter.x < 180) {\r\n                mcCenter = map.lnglatToMercator(mcCenter.x, mcCenter.y);\r\n                mcCenter = {x: mcCenter[0], y: mcCenter[1]};\r\n            }\r\n            projection = {\r\n                lngLatToPoint: function (point) {\r\n                    var mc = map.lnglatToMercator(point.lng, point.lat);\r\n                    return {\r\n                        x: mc[0],\r\n                        y: mc[1]\r\n                    };\r\n                }\r\n            };\r\n        }\r\n        var zoomUnit;\r\n        if (projection.getZoomUnits) {\r\n            zoomUnit = projection.getZoomUnits(map.getZoom());\r\n        } else {\r\n            zoomUnit = Math.pow(2, 18 - map.getZoom());\r\n        }\r\n        //左上角墨卡托坐标\r\n        var nwMc = new BMap.Pixel(\r\n            mcCenter.x - (map.getSize().width / 2) * zoomUnit,\r\n            mcCenter.y + (map.getSize().height / 2) * zoomUnit\r\n        );\r\n\r\n        var context = this.getContext();\r\n        if (this.isEnabledTime()) {\r\n            if (time === undefined) {\r\n                clear(context);\r\n                return;\r\n            }\r\n            if (this.context == '2d') {\r\n                context.save();\r\n                context.globalCompositeOperation = 'destination-out';\r\n                context.fillStyle = 'rgba(0, 0, 0, .1)';\r\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n                context.restore();\r\n            }\r\n        } else {\r\n            clear(context);\r\n        }\r\n\r\n        if (this.context == '2d') {\r\n            for (var key in this.options) {\r\n                context[key] = this.options[key];\r\n            }\r\n        } else {\r\n            context.clear(context.COLOR_BUFFER_BIT);\r\n        }\r\n\r\n        if (\r\n            (this.options.minZoom && map.getZoom() < this.options.minZoom) ||\r\n            (this.options.maxZoom && map.getZoom() > this.options.maxZoom)\r\n        ) {\r\n            return;\r\n        }\r\n\r\n        var scale = 1;\r\n        if (this.context != '2d') {\r\n            scale = this.canvasLayer.devicePixelRatio;\r\n        }\r\n\r\n        var dataGetOptions = {\r\n            fromColumn: this.options.coordType == 'bd09mc' ? 'coordinates' : 'coordinates_mercator',\r\n            transferCoordinate: function (coordinate) {\r\n                var x = ((coordinate[0] - nwMc.x) / zoomUnit) * scale;\r\n                var y = ((nwMc.y - coordinate[1]) / zoomUnit) * scale;\r\n                return [x, y];\r\n            }\r\n        };\r\n\r\n        if (time !== undefined) {\r\n            dataGetOptions.filter = function (item) {\r\n                var trails = animationOptions.trails || 10;\r\n                if (time && item.time > time - trails && item.time < time) {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            };\r\n        }\r\n\r\n        // get data from data set\r\n        var data;\r\n        var zoom = this.getZoom();\r\n        if (this.options.draw === 'cluster' && (!this.options.maxClusterZoom || this.options.maxClusterZoom >= zoom)) {\r\n            var bounds = this.map.getBounds();\r\n            var ne = bounds.getNorthEast();\r\n            var sw = bounds.getSouthWest();\r\n            var clusterData = this.supercluster.getClusters([sw.lng, sw.lat, ne.lng, ne.lat], zoom);\r\n            this.pointCountMax = this.supercluster.trees[zoom].max;\r\n            this.pointCountMin = this.supercluster.trees[zoom].min;\r\n            var intensity = {};\r\n            var color = null;\r\n            var size = null;\r\n            if (this.pointCountMax === this.pointCountMin) {\r\n                color = this.options.fillStyle;\r\n                size = this.options.minSize || 8;\r\n            } else {\r\n                intensity = new Intensity({\r\n                    min: this.pointCountMin,\r\n                    max: this.pointCountMax,\r\n                    minSize: this.options.minSize || 8,\r\n                    maxSize: this.options.maxSize || 30,\r\n                    gradient: this.options.gradient\r\n                });\r\n            }\r\n            for (var i = 0; i < clusterData.length; i++) {\r\n                var item = clusterData[i];\r\n                if (item.properties && item.properties.cluster_id) {\r\n                    clusterData[i].size = size || intensity.getSize(item.properties.point_count);\r\n                    clusterData[i].fillStyle = color || intensity.getColor(item.properties.point_count);\r\n                } else {\r\n                    clusterData[i].size = self.options.size;\r\n                }\r\n            }\r\n\r\n            this.clusterDataSet.set(clusterData);\r\n            this.transferToMercator(this.clusterDataSet);\r\n            data = self.clusterDataSet.get(dataGetOptions);\r\n        } else {\r\n            data = self.dataSet.get(dataGetOptions);\r\n        }\r\n\r\n        this.processData(data);\r\n\r\n        var nwPixel = map.pointToPixel(new BMap.Point(0, 0));\r\n\r\n        if (self.options.unit == 'm') {\r\n            if (self.options.size) {\r\n                self.options._size = self.options.size / zoomUnit;\r\n            }\r\n            if (self.options.width) {\r\n                self.options._width = self.options.width / zoomUnit;\r\n            }\r\n            if (self.options.height) {\r\n                self.options._height = self.options.height / zoomUnit;\r\n            }\r\n        } else {\r\n            self.options._size = self.options.size;\r\n            self.options._height = self.options.height;\r\n            self.options._width = self.options.width;\r\n        }\r\n\r\n        this.drawContext(context, data, self.options, nwPixel);\r\n\r\n        //console.timeEnd('draw');\r\n\r\n        //console.timeEnd('update')\r\n        self.options.updateCallback && self.options.updateCallback(time);\r\n    }\r\n\r\n    init(options) {\r\n        var self = this;\r\n        self.options = options;\r\n        this.initDataRange(options);\r\n        this.context = self.options.context || '2d';\r\n\r\n        if (self.options.zIndex) {\r\n            this.canvasLayer && this.canvasLayer.setZIndex(self.options.zIndex);\r\n        }\r\n\r\n        if (self.options.max) {\r\n            this.intensity.setMax(self.options.max);\r\n        }\r\n\r\n        if (self.options.min) {\r\n            this.intensity.setMin(self.options.min);\r\n        }\r\n\r\n        this.initAnimator();\r\n        this.bindEvent();\r\n    }\r\n\r\n    getZoom() {\r\n        return this.map.getZoom();\r\n    }\r\n\r\n    addAnimatorEvent() {\r\n        this.map.addEventListener('movestart', this.animatorMovestartEvent.bind(this));\r\n        this.map.addEventListener('moveend', this.animatorMoveendEvent.bind(this));\r\n    }\r\n\r\n    show() {\r\n        this.map.addOverlay(this.canvasLayer);\r\n        this.bindEvent();\r\n    }\r\n\r\n    hide() {\r\n        this.unbindEvent();\r\n        this.map.removeOverlay(this.canvasLayer);\r\n    }\r\n\r\n    draw() {\r\n        this.canvasLayer && this.canvasLayer.draw();\r\n    }\r\n\r\n    clearData() {\r\n        this.dataSet && this.dataSet.clear();\r\n        this.update({\r\n            options: null\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 更新图层数据\r\n     * @param {Array|DataSet} data - 新数据\r\n     */\r\n    updateData(data) {\r\n        if (data instanceof DataSet) {\r\n            this.dataSet = data;\r\n        } else if (Array.isArray(data)) {\r\n            this.dataSet.set(data);\r\n        }\r\n        \r\n        // 如果是聚类图，需要刷新聚类\r\n        if (this.options.draw === 'cluster') {\r\n            this.refreshCluster(this.options);\r\n        }\r\n        \r\n        // 重新初始化数据范围\r\n        this.initDataRange(this.options);\r\n        \r\n        // 重新绘制\r\n        this.draw();\r\n    }\r\n\r\n    /**\r\n     * 添加数据\r\n     * @param {Object|Array} data - 要添加的数据\r\n     */\r\n    addData(data) {\r\n        this.dataSet.add(data);\r\n        \r\n        // 如果是聚类图，需要刷新聚类\r\n        if (this.options.draw === 'cluster') {\r\n            this.refreshCluster(this.options);\r\n        }\r\n        \r\n        // 重新初始化数据范围\r\n        this.initDataRange(this.options);\r\n        \r\n        // 重新绘制\r\n        this.draw();\r\n    }\r\n\r\n    /**\r\n     * 获取当前视图范围内的数据\r\n     */\r\n    getDataInBounds() {\r\n        var bounds = this.map.getBounds();\r\n        var ne = bounds.getNorthEast();\r\n        var sw = bounds.getSouthWest();\r\n        var boundsArray = [sw.lng, sw.lat, ne.lng, ne.lat];\r\n        var zoom = this.getZoom();\r\n        \r\n        if (this.options.draw === 'cluster' && (!this.options.maxClusterZoom || this.options.maxClusterZoom >= zoom)) {\r\n            return this.supercluster.getClusters(boundsArray, zoom);\r\n        } else {\r\n            // 简单过滤，实际应该使用更精确的方法\r\n            return this.dataSet.get().filter(item => {\r\n                if (item.geometry && item.geometry.coordinates) {\r\n                    var coords = item.geometry.coordinates;\r\n                    return coords[0] >= sw.lng && coords[0] <= ne.lng && \r\n                           coords[1] >= sw.lat && coords[1] <= ne.lat;\r\n                }\r\n                return false;\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 设置图层透明度\r\n     * @param {Number} opacity - 透明度值 (0-1)\r\n     */\r\n    setOpacity(opacity) {\r\n        if (this.canvasLayer && this.canvasLayer.canvas) {\r\n            this.canvasLayer.canvas.style.opacity = opacity;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取图层透明度\r\n     */\r\n    getOpacity() {\r\n        if (this.canvasLayer && this.canvasLayer.canvas) {\r\n            return parseFloat(this.canvasLayer.canvas.style.opacity) || 1;\r\n        }\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * 切换图层可见性\r\n     */\r\n    toggle() {\r\n        if (this.canvasLayer && this.canvasLayer.canvas) {\r\n            var canvas = this.canvasLayer.canvas;\r\n            canvas.style.display = canvas.style.display === 'none' ? 'block' : 'none';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取图层状态信息\r\n     */\r\n    getLayerInfo() {\r\n        return {\r\n            zoom: this.getZoom(),\r\n            visible: this.canvasLayer && this.canvasLayer.canvas ? \r\n                     this.canvasLayer.canvas.style.display !== 'none' : true,\r\n            opacity: this.getOpacity(),\r\n            dataCount: this.dataSet ? this.dataSet.getTotal() : 0,\r\n            drawType: this.options.draw\r\n        };\r\n    }\r\n\r\n    destroy() {\r\n        this.unbindEvent();\r\n        this.clearData();\r\n        this.map.removeOverlay(this.canvasLayer);\r\n        this.canvasLayer = null;\r\n    }\r\n}\r\n\r\nexport default Layer;","/**\r\n * Copyright 2012 Google Inc. All Rights Reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * @fileoverview Extends OverlayView to provide a canvas \"Layer\".\r\n * @author Brendan Kenny\r\n */\r\n\r\n/**\r\n * A map layer that provides a canvas over the slippy map and a callback\r\n * system for efficient animation. Requires canvas and CSS 2D transform\r\n * support.\r\n * @constructor\r\n * @extends google.maps.OverlayView\r\n * @param {CanvasLayerOptions=} opt_options Options to set in this CanvasLayer.\r\n */\r\nfunction CanvasLayer(opt_options) {\r\n  /**\r\n   * If true, canvas is in a map pane and the OverlayView is fully functional.\r\n   * See google.maps.OverlayView.onAdd for more information.\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.isAdded_ = false;\r\n\r\n  /**\r\n   * If true, each update will immediately schedule the next.\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.isAnimated_ = false;\r\n\r\n  /**\r\n   * The name of the MapPane in which this layer will be displayed.\r\n   * @type {string}\r\n   * @private\r\n   */\r\n  this.paneName_ = CanvasLayer.DEFAULT_PANE_NAME_;\r\n\r\n  /**\r\n   * A user-supplied function called whenever an update is required. Null or\r\n   * undefined if a callback is not provided.\r\n   * @type {?function=}\r\n   * @private\r\n   */\r\n  this.updateHandler_ = null;\r\n\r\n  /**\r\n   * A user-supplied function called whenever an update is required and the\r\n   * map has been resized since the last update. Null or undefined if a\r\n   * callback is not provided.\r\n   * @type {?function}\r\n   * @private\r\n   */\r\n  this.resizeHandler_ = null;\r\n\r\n  /**\r\n   * The LatLng coordinate of the top left of the current view of the map. Will\r\n   * be null when this.isAdded_ is false.\r\n   * @type {google.maps.LatLng}\r\n   * @private\r\n   */\r\n  this.topLeft_ = null;\r\n\r\n  /**\r\n   * The map-pan event listener. Will be null when this.isAdded_ is false. Will\r\n   * be null when this.isAdded_ is false.\r\n   * @type {?function}\r\n   * @private\r\n   */\r\n  this.centerListener_ = null;\r\n\r\n  /**\r\n   * The map-resize event listener. Will be null when this.isAdded_ is false.\r\n   * @type {?function}\r\n   * @private\r\n   */\r\n  this.resizeListener_ = null;\r\n\r\n  /**\r\n   * If true, the map size has changed and this.resizeHandler_ must be called\r\n   * on the next update.\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this.needsResize_ = true;\r\n\r\n  /**\r\n   * A browser-defined id for the currently requested callback. Null when no\r\n   * callback is queued.\r\n   * @type {?number}\r\n   * @private\r\n   */\r\n  this.requestAnimationFrameId_ = null;\r\n\r\n  var canvas = document.createElement('canvas');\r\n  canvas.style.position = 'absolute';\r\n  canvas.style.top = 0;\r\n  canvas.style.left = 0;\r\n  canvas.style.pointerEvents = 'none';\r\n\r\n  /**\r\n   * The canvas element.\r\n   * @type {!HTMLCanvasElement}\r\n   */\r\n  this.canvas = canvas;\r\n\r\n  /**\r\n   * The CSS width of the canvas, which may be different than the width of the\r\n   * backing store.\r\n   * @private {number}\r\n   */\r\n  this.canvasCssWidth_ = 300;\r\n\r\n  /**\r\n   * The CSS height of the canvas, which may be different than the height of\r\n   * the backing store.\r\n   * @private {number}\r\n   */\r\n  this.canvasCssHeight_ = 150;\r\n\r\n  /**\r\n   * A value for scaling the CanvasLayer resolution relative to the CanvasLayer\r\n   * display size.\r\n   * @private {number}\r\n   */\r\n  this.resolutionScale_ = 1;\r\n\r\n  /**\r\n   * Simple bind for functions with no args for bind-less browsers (Safari).\r\n   * @param {Object} thisArg The this value used for the target function.\r\n   * @param {function} func The function to be bound.\r\n   */\r\n  function simpleBindShim(thisArg, func) {\r\n    return function() { func.apply(thisArg); };\r\n  }\r\n\r\n  /**\r\n   * A reference to this.repositionCanvas_ with this bound as its this value.\r\n   * @type {function}\r\n   * @private\r\n   */\r\n  this.repositionFunction_ = simpleBindShim(this, this.repositionCanvas_);\r\n\r\n  /**\r\n   * A reference to this.resize_ with this bound as its this value.\r\n   * @type {function}\r\n   * @private\r\n   */\r\n  this.resizeFunction_ = simpleBindShim(this, this.resize_);\r\n\r\n  /**\r\n   * A reference to this.update_ with this bound as its this value.\r\n   * @type {function}\r\n   * @private\r\n   */\r\n  this.requestUpdateFunction_ = simpleBindShim(this, this.update_);\r\n\r\n  // set provided options, if any\r\n  if (opt_options) {\r\n    this.setOptions(opt_options);\r\n  }\r\n}\r\n\r\n\r\nvar global = typeof window === 'undefined' ? {} : window;\r\n\r\nif (global.google && global.google.maps) {\r\n\r\nCanvasLayer.prototype = new google.maps.OverlayView();\r\n\r\n/**\r\n * The default MapPane to contain the canvas.\r\n * @type {string}\r\n * @const\r\n * @private\r\n */\r\nCanvasLayer.DEFAULT_PANE_NAME_ = 'overlayLayer';\r\n\r\n/**\r\n * Transform CSS property name, with vendor prefix if required. If browser\r\n * does not support transforms, property will be ignored.\r\n * @type {string}\r\n * @const\r\n * @private\r\n */\r\nCanvasLayer.CSS_TRANSFORM_ = (function() {\r\n  var div = document.createElement('div');\r\n  var transformProps = [\r\n    'transform',\r\n    'WebkitTransform',\r\n    'MozTransform',\r\n    'OTransform',\r\n    'msTransform'\r\n  ];\r\n  for (var i = 0; i < transformProps.length; i++) {\r\n    var prop = transformProps[i];\r\n    if (div.style[prop] !== undefined) {\r\n      return prop;\r\n    }\r\n  }\r\n\r\n  // return unprefixed version by default\r\n  return transformProps[0];\r\n})();\r\n\r\n/**\r\n * The requestAnimationFrame function, with vendor-prefixed or setTimeout-based\r\n * fallbacks. MUST be called with window as thisArg.\r\n * @type {function}\r\n * @param {function} callback The function to add to the frame request queue.\r\n * @return {number} The browser-defined id for the requested callback.\r\n * @private\r\n */\r\nCanvasLayer.prototype.requestAnimFrame_ =\r\n    global.requestAnimationFrame ||\r\n    global.webkitRequestAnimationFrame ||\r\n    global.mozRequestAnimationFrame ||\r\n    global.oRequestAnimationFrame ||\r\n    global.msRequestAnimationFrame ||\r\n    function(callback) {\r\n      return global.setTimeout(callback, 1000 / 60);\r\n    };\r\n\r\n/**\r\n * The cancelAnimationFrame function, with vendor-prefixed fallback. Does not\r\n * fall back to clearTimeout as some platforms implement requestAnimationFrame\r\n * but not cancelAnimationFrame, and the cost is an extra frame on onRemove.\r\n * MUST be called with window as thisArg.\r\n * @type {function}\r\n * @param {number=} requestId The id of the frame request to cancel.\r\n * @private\r\n */\r\nCanvasLayer.prototype.cancelAnimFrame_ =\r\n    global.cancelAnimationFrame ||\r\n    global.webkitCancelAnimationFrame ||\r\n    global.mozCancelAnimationFrame ||\r\n    global.oCancelAnimationFrame ||\r\n    global.msCancelAnimationFrame ||\r\n    function(requestId) {};\r\n\r\n/**\r\n * Sets any options provided. See CanvasLayerOptions for more information.\r\n * @param {CanvasLayerOptions} options The options to set.\r\n */\r\nCanvasLayer.prototype.setOptions = function(options) {\r\n  if (options.animate !== undefined) {\r\n    this.setAnimate(options.animate);\r\n  }\r\n\r\n  if (options.paneName !== undefined) {\r\n    this.setPaneName(options.paneName);\r\n  }\r\n\r\n  if (options.updateHandler !== undefined) {\r\n    this.setUpdateHandler(options.updateHandler);\r\n  }\r\n\r\n  if (options.resizeHandler !== undefined) {\r\n    this.setResizeHandler(options.resizeHandler);\r\n  }\r\n\r\n  if (options.resolutionScale !== undefined) {\r\n    this.setResolutionScale(options.resolutionScale);\r\n  }\r\n\r\n  if (options.map !== undefined) {\r\n    this.setMap(options.map);\r\n  }\r\n};\r\n\r\n/**\r\n * Set the animated state of the layer. If true, updateHandler will be called\r\n * repeatedly, once per frame. If false, updateHandler will only be called when\r\n * a map property changes that could require the canvas content to be redrawn.\r\n * @param {boolean} animate Whether the canvas is animated.\r\n */\r\nCanvasLayer.prototype.setAnimate = function(animate) {\r\n  this.isAnimated_ = !!animate;\r\n\r\n  if (this.isAnimated_) {\r\n    this.scheduleUpdate();\r\n  }\r\n};\r\n\r\n/**\r\n * @return {boolean} Whether the canvas is animated.\r\n */\r\nCanvasLayer.prototype.isAnimated = function() {\r\n  return this.isAnimated_;\r\n};\r\n\r\n/**\r\n * Set the MapPane in which this layer will be displayed, by name. See\r\n * {@code google.maps.MapPanes} for the panes available.\r\n * @param {string} paneName The name of the desired MapPane.\r\n */\r\nCanvasLayer.prototype.setPaneName = function(paneName) {\r\n  this.paneName_ = paneName;\r\n\r\n  this.setPane_();\r\n};\r\n\r\n/**\r\n * @return {string} The name of the current container pane.\r\n */\r\nCanvasLayer.prototype.getPaneName = function() {\r\n  return this.paneName_;\r\n};\r\n\r\n/**\r\n * Adds the canvas to the specified container pane. Since this is guaranteed to\r\n * execute only after onAdd is called, this is when paneName's existence is\r\n * checked (and an error is thrown if it doesn't exist).\r\n * @private\r\n */\r\nCanvasLayer.prototype.setPane_ = function() {\r\n  if (!this.isAdded_) {\r\n    return;\r\n  }\r\n\r\n  // onAdd has been called, so panes can be used\r\n  var panes = this.getPanes();\r\n  if (!panes[this.paneName_]) {\r\n    throw new Error('\"' + this.paneName_ + '\" is not a valid MapPane name.');\r\n  }\r\n\r\n  panes[this.paneName_].appendChild(this.canvas);\r\n};\r\n\r\n/**\r\n * Set a function that will be called whenever the parent map and the overlay's\r\n * canvas have been resized. If opt_resizeHandler is null or unspecified, any\r\n * existing callback is removed.\r\n * @param {?function=} opt_resizeHandler The resize callback function.\r\n */\r\nCanvasLayer.prototype.setResizeHandler = function(opt_resizeHandler) {\r\n  this.resizeHandler_ = opt_resizeHandler;\r\n};\r\n\r\n/**\r\n * Sets a value for scaling the canvas resolution relative to the canvas\r\n * display size. This can be used to save computation by scaling the backing\r\n * buffer down, or to support high DPI devices by scaling it up (by e.g.\r\n * window.devicePixelRatio).\r\n * @param {number} scale\r\n */\r\nCanvasLayer.prototype.setResolutionScale = function(scale) {\r\n  if (typeof scale === 'number') {\r\n    this.resolutionScale_ = scale;\r\n    this.resize_();\r\n  }\r\n};\r\n\r\n/**\r\n * Set a function that will be called when a repaint of the canvas is required.\r\n * If opt_updateHandler is null or unspecified, any existing callback is\r\n * removed.\r\n * @param {?function=} opt_updateHandler The update callback function.\r\n */\r\nCanvasLayer.prototype.setUpdateHandler = function(opt_updateHandler) {\r\n  this.updateHandler_ = opt_updateHandler;\r\n};\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nCanvasLayer.prototype.onAdd = function() {\r\n  if (this.isAdded_) {\r\n    return;\r\n  }\r\n\r\n  this.isAdded_ = true;\r\n  this.setPane_();\r\n\r\n  this.resizeListener_ = google.maps.event.addListener(this.getMap(),\r\n      'resize', this.resizeFunction_);\r\n  this.centerListener_ = google.maps.event.addListener(this.getMap(),\r\n      'center_changed', this.repositionFunction_);\r\n\r\n  this.resize_();\r\n  this.repositionCanvas_();\r\n};\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nCanvasLayer.prototype.onRemove = function() {\r\n  if (!this.isAdded_) {\r\n    return;\r\n  }\r\n\r\n  this.isAdded_ = false;\r\n  this.topLeft_ = null;\r\n\r\n  // remove canvas and listeners for pan and resize from map\r\n  this.canvas.parentElement.removeChild(this.canvas);\r\n  if (this.centerListener_) {\r\n    google.maps.event.removeListener(this.centerListener_);\r\n    this.centerListener_ = null;\r\n  }\r\n  if (this.resizeListener_) {\r\n    google.maps.event.removeListener(this.resizeListener_);\r\n    this.resizeListener_ = null;\r\n  }\r\n\r\n  // cease canvas update callbacks\r\n  if (this.requestAnimationFrameId_) {\r\n    this.cancelAnimFrame_.call(global, this.requestAnimationFrameId_);\r\n    this.requestAnimationFrameId_ = null;\r\n  }\r\n};\r\n\r\n/**\r\n * The internal callback for resize events that resizes the canvas to keep the\r\n * map properly covered.\r\n * @private\r\n */\r\nCanvasLayer.prototype.resize_ = function() {\r\n  if (!this.isAdded_) {\r\n    return;\r\n  }\r\n\r\n  var map = this.getMap();\r\n  var mapWidth = map.getDiv().offsetWidth;\r\n  var mapHeight = map.getDiv().offsetHeight;\r\n\r\n  var newWidth = mapWidth * this.resolutionScale_;\r\n  var newHeight = mapHeight * this.resolutionScale_;\r\n  var oldWidth = this.canvas.width;\r\n  var oldHeight = this.canvas.height;\r\n\r\n  // resizing may allocate a new back buffer, so do so conservatively\r\n  if (oldWidth !== newWidth || oldHeight !== newHeight) {\r\n    this.canvas.width = newWidth;\r\n    this.canvas.height = newHeight;\r\n\r\n    this.needsResize_ = true;\r\n    this.scheduleUpdate();\r\n  }\r\n\r\n  // reset styling if new sizes don't match; resize of data not needed\r\n  if (this.canvasCssWidth_ !== mapWidth ||\r\n      this.canvasCssHeight_ !== mapHeight) {\r\n    this.canvasCssWidth_ = mapWidth;\r\n    this.canvasCssHeight_ = mapHeight;\r\n    this.canvas.style.width = mapWidth + 'px';\r\n    this.canvas.style.height = mapHeight + 'px';\r\n  }\r\n};\r\n\r\n/**\r\n * @inheritDoc\r\n */\r\nCanvasLayer.prototype.draw = function() {\r\n  this.repositionCanvas_();\r\n};\r\n\r\n/**\r\n * Internal callback for map view changes. Since the Maps API moves the overlay\r\n * along with the map, this function calculates the opposite translation to\r\n * keep the canvas in place.\r\n * @private\r\n */\r\nCanvasLayer.prototype.repositionCanvas_ = function() {\r\n  // TODO(bckenny): *should* only be executed on RAF, but in current browsers\r\n  //     this causes noticeable hitches in map and overlay relative\r\n  //     positioning.\r\n\r\n  var map = this.getMap();\r\n\r\n  // topLeft can't be calculated from map.getBounds(), because bounds are\r\n  // clamped to -180 and 180 when completely zoomed out. Instead, calculate\r\n  // left as an offset from the center, which is an unwrapped LatLng.\r\n  var top = map.getBounds().getNorthEast().lat();\r\n  var center = map.getCenter();\r\n  var scale = Math.pow(2, map.getZoom());\r\n  var left = center.lng() - (this.canvasCssWidth_ * 180) / (256 * scale);\r\n  this.topLeft_ = new google.maps.LatLng(top, left);\r\n\r\n  // Canvas position relative to draggable map's container depends on\r\n  // overlayView's projection, not the map's. Have to use the center of the\r\n  // map for this, not the top left, for the same reason as above.\r\n  var projection = this.getProjection();\r\n  var divCenter = projection.fromLatLngToDivPixel(center);\r\n  var offsetX = -Math.round(this.canvasCssWidth_ / 2 - divCenter.x);\r\n  var offsetY = -Math.round(this.canvasCssHeight_ / 2 - divCenter.y);\r\n  this.canvas.style[CanvasLayer.CSS_TRANSFORM_] = 'translate(' +\r\n      offsetX + 'px,' + offsetY + 'px)';\r\n\r\n  this.scheduleUpdate();\r\n};\r\n\r\n/**\r\n * Internal callback that serves as main animation scheduler via\r\n * requestAnimationFrame. Calls resize and update callbacks if set, and\r\n * schedules the next frame if overlay is animated.\r\n * @private\r\n */\r\nCanvasLayer.prototype.update_ = function() {\r\n  this.requestAnimationFrameId_ = null;\r\n\r\n  if (!this.isAdded_) {\r\n    return;\r\n  }\r\n\r\n  if (this.isAnimated_) {\r\n    this.scheduleUpdate();\r\n  }\r\n\r\n  if (this.needsResize_ && this.resizeHandler_) {\r\n    this.needsResize_ = false;\r\n    this.resizeHandler_();\r\n  }\r\n\r\n  if (this.updateHandler_) {\r\n    this.updateHandler_();\r\n  }\r\n};\r\n\r\n/**\r\n * A convenience method to get the current LatLng coordinate of the top left of\r\n * the current view of the map.\r\n * @return {google.maps.LatLng} The top left coordinate.\r\n */\r\nCanvasLayer.prototype.getTopLeft = function() {\r\n  return this.topLeft_;\r\n};\r\n\r\n/**\r\n * Schedule a requestAnimationFrame callback to updateHandler. If one is\r\n * already scheduled, there is no effect.\r\n */\r\nCanvasLayer.prototype.scheduleUpdate = function() {\r\n  if (this.isAdded_ && !this.requestAnimationFrameId_) {\r\n    this.requestAnimationFrameId_ =\r\n        this.requestAnimFrame_.call(global, this.requestUpdateFunction_);\r\n  }\r\n};\r\n\r\n}\r\n\r\nexport default CanvasLayer;\r\n","/**\r\n * @author kyle / http://nikai.us/\r\n */\r\n\r\nimport BaseLayer from \"../BaseLayer\";\r\nimport CanvasLayer from \"./CanvasLayer\";\r\nimport clear from \"../../canvas/clear\";\r\nimport DataSet from \"../../data/DataSet\";\r\nimport TWEEN from \"../../utils/Tween\";\r\n\r\nclass Layer extends BaseLayer{\r\n\r\n    constructor(map, dataSet, options) {\r\n\r\n        super(map, dataSet, options);\r\n\r\n        var self = this;\r\n        var data = null;\r\n        options = options || {};\r\n\r\n        self.init(options);\r\n        self.argCheck(options);\r\n\r\n        var canvasLayerOptions = {\r\n            map: map,\r\n            animate: false,\r\n            updateHandler: function() {\r\n                self._canvasUpdate();\r\n            },\r\n            resolutionScale: resolutionScale\r\n        };\r\n\r\n        var canvasLayer = this.canvasLayer = new CanvasLayer(canvasLayerOptions);\r\n\r\n        this.clickEvent = this.clickEvent.bind(this);\r\n        this.mousemoveEvent = this.mousemoveEvent.bind(this);\r\n        this.bindEvent();\r\n    }\r\n\r\n    clickEvent(e) {\r\n        var pixel = e.pixel;\r\n        super.clickEvent(pixel, e);\r\n    }\r\n\r\n    mousemoveEvent(e) {\r\n        var pixel = e.pixel;\r\n        super.mousemoveEvent(pixel, e);\r\n    }\r\n\r\n    bindEvent(e) {\r\n        var map = this.map;\r\n\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.setDefaultCursor(\"default\");\r\n                map.addListener('click', this.clickEvent);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.addListener('mousemove', this.mousemoveEvent);\r\n            }\r\n        }\r\n    }\r\n\r\n    unbindEvent(e) {\r\n        var map = this.map;\r\n\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.removeListener('click', this.clickEvent);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.removeListener('mousemove', this.mousemoveEvent);\r\n            }\r\n        }\r\n    }\r\n\r\n    getContext() {\r\n        return this.canvasLayer.canvas.getContext(this.context);\r\n    }\r\n\r\n    _canvasUpdate(time) {\r\n        if (!this.canvasLayer) {\r\n            return;\r\n        }\r\n\r\n        var self = this;\r\n\r\n        var animationOptions = self.options.animation;\r\n\r\n        var context = this.getContext();\r\n\r\n        if (self.isEnabledTime()) {\r\n            if (time === undefined) {\r\n                clear(context);\r\n                return;\r\n            }\r\n            if (this.context == '2d') {\r\n                context.save();\r\n                context.globalCompositeOperation = 'destination-out';\r\n                context.fillStyle = 'rgba(0, 0, 0, .1)';\r\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n                context.restore();\r\n            }\r\n        } else {\r\n            clear(context);\r\n        }\r\n\r\n        if (this.context == '2d') {\r\n            for (var key in self.options) {\r\n                context[key] = self.options[key];\r\n            }\r\n        } else {\r\n            context.clear(context.COLOR_BUFFER_BIT);\r\n        }\r\n\r\n        if (self.options.minZoom && map.getZoom() < self.options.minZoom || self.options.maxZoom && map.getZoom() > self.options.maxZoom) {\r\n            return;\r\n        }\r\n\r\n        var scale = 1;\r\n        if (this.context != '2d') {\r\n            scale = this.canvasLayer.devicePixelRatio;\r\n        }\r\n\r\n        var map = this.map;\r\n        var mapProjection = map.getProjection();\r\n        var scale = Math.pow(2, map.zoom) * resolutionScale;\r\n        var offset = mapProjection.fromLatLngToPoint(this.canvasLayer.getTopLeft());\r\n        var dataGetOptions = {\r\n            //fromColumn: self.options.coordType == 'bd09mc' ? 'coordinates' : 'coordinates_mercator',\r\n            transferCoordinate: function(coordinate) {\r\n                var latLng = new google.maps.LatLng(coordinate[1], coordinate[0]);\r\n                var worldPoint = mapProjection.fromLatLngToPoint(latLng);\r\n                var pixel = {\r\n                    x: (worldPoint.x - offset.x) * scale,\r\n                    y: (worldPoint.y - offset.y) * scale,\r\n                }\r\n                return [pixel.x, pixel.y];\r\n            }\r\n        }\r\n\r\n        if (time !== undefined) {\r\n            dataGetOptions.filter = function(item) {\r\n                var trails = animationOptions.trails || 10;\r\n                if (time && item.time > (time - trails) && item.time < time) {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n\r\n        // get data from data set\r\n        var data = self.dataSet.get(dataGetOptions);\r\n\r\n        this.processData(data);\r\n\r\n        var latLng = new google.maps.LatLng(0, 0);\r\n        var worldPoint = mapProjection.fromLatLngToPoint(latLng);\r\n        var pixel = {\r\n            x: (worldPoint.x - offset.x) * scale,\r\n            y: (worldPoint.y - offset.y) * scale,\r\n        }\r\n\r\n\r\n        if (self.options.unit == 'm' && self.options.size) {\r\n            self.options._size = self.options.size / zoomUnit;\r\n        } else {\r\n            self.options._size = self.options.size;\r\n        }\r\n\r\n        this.drawContext(context, new DataSet(data), self.options, pixel);\r\n\r\n        //console.timeEnd('draw');\r\n\r\n        //console.timeEnd('update')\r\n        self.options.updateCallback && self.options.updateCallback(time);\r\n    }\r\n\r\n    init(options) {\r\n\r\n        var self = this;\r\n\r\n        self.options = options;\r\n\r\n        this.initDataRange(options);\r\n\r\n        this.context = self.options.context || '2d';\r\n\r\n        if (self.options.zIndex) {\r\n            this.canvasLayer && this.canvasLayer.setZIndex(self.options.zIndex);\r\n        }\r\n\r\n        this.initAnimator();\r\n    }\r\n\r\n    addAnimatorEvent() {\r\n        this.map.addListener('movestart', this.animatorMovestartEvent.bind(this));\r\n        this.map.addListener('moveend', this.animatorMoveendEvent.bind(this));\r\n    }\r\n\r\n    show() {\r\n        this.map.addOverlay(this.canvasLayer);\r\n    }\r\n\r\n    hide() {\r\n        this.map.removeOverlay(this.canvasLayer);\r\n    }\r\n\r\n    draw() {\r\n        self.canvasLayer.draw();\r\n    }\r\n\r\n}\r\n\r\n\r\nexport default Layer;\r\n","/**\r\n * MapV for maptalks.js (https://github.com/maptalks/maptalks.js)\r\n * @author fuzhenn / https://github.com/fuzhenn\r\n */\r\n// import * as maptalks from 'maptalks';\r\nimport BaseLayer from \"../BaseLayer\";\r\nimport clear from \"../../canvas/clear\";\r\nimport DataSet from \"../../data/DataSet\";\r\nimport TWEEN from \"../../utils/Tween\";\r\n\r\nlet Layer;\r\nif (typeof(maptalks) !== 'undefined') {\r\n    Layer = class extends maptalks.Layer{\r\n\r\n        constructor(id, dataSet, options) {\r\n            super(id, options);\r\n            this.options_ = options;\r\n            this.dataSet = dataSet;\r\n            this._initBaseLayer(options);\r\n        }\r\n    \r\n        _initBaseLayer(options) {\r\n            const self = this;\r\n            const baseLayer = this.baseLayer = new BaseLayer(null, this.dataSet, options);\r\n            self.init(options);\r\n            baseLayer.argCheck(options);\r\n        } \r\n    \r\n        clickEvent(e) {\r\n            if (!this.baseLayer) {\r\n                return;\r\n            }\r\n            const pixel = e.containerPoint;\r\n            this.baseLayer.clickEvent(pixel, e.domEvent);\r\n        }\r\n    \r\n        mousemoveEvent(e) {\r\n            if (!this.baseLayer) {\r\n                return;\r\n            }\r\n            const pixel = e.containerPoint;\r\n            this.baseLayer.mousemoveEvent(pixel, e.domEvent);\r\n        }\r\n    \r\n        getEvents() {\r\n            return {\r\n                'click' : this.clickEvent,\r\n                'mousemove' : this.mousemoveEvent\r\n            };\r\n        }\r\n        \r\n        init(options) {\r\n    \r\n            const base = this.baseLayer;\r\n    \r\n            base.options = options;\r\n    \r\n            base.initDataRange(options);\r\n    \r\n            base.context = base.options.context || '2d';\r\n    \r\n            base.initAnimator();\r\n        }\r\n    \r\n        addAnimatorEvent() {\r\n            this.map.addListener('movestart', this.animatorMovestartEvent.bind(this));\r\n            this.map.addListener('moveend', this.animatorMoveendEvent.bind(this));\r\n        }\r\n    \r\n    }\r\n    \r\n    class LayerRenderer extends maptalks.renderer.CanvasRenderer {\r\n    \r\n        needToRedraw() {\r\n            const base = this.layer.baseLayer;\r\n            if (base.isEnabledTime()) {\r\n                return true;\r\n            }\r\n            return super.needToRedraw();\r\n        }\r\n    \r\n        draw() {\r\n            const base = this.layer.baseLayer;\r\n            if (!this.canvas || !base.isEnabledTime() || this._shouldClear) {\r\n                this.prepareCanvas();\r\n                this._shouldClear = false;\r\n            }\r\n            this._update(this.gl || this.context, this._mapvFrameTime);\r\n            delete this._mapvFrameTime;\r\n            this.completeRender();\r\n        }\r\n    \r\n        drawOnInteracting() {\r\n            this.draw();\r\n            this._shouldClear = false;\r\n        }\r\n    \r\n        onSkipDrawOnInteracting() {\r\n            this._shouldClear = true;\r\n        }\r\n    \r\n        _canvasUpdate(time) {\r\n            this.setToRedraw();\r\n            this._mapvFrameTime = time;\r\n        }\r\n    \r\n        _update(context, time) {\r\n            if (!this.canvas) {\r\n                return;\r\n            }\r\n    \r\n            const self = this.layer.baseLayer;\r\n    \r\n            const animationOptions = self.options.animation;\r\n    \r\n            const map = this.getMap();\r\n    \r\n            if (self.isEnabledTime()) {\r\n                if (time === undefined) {\r\n                    clear(context);\r\n                    return;\r\n                }\r\n                if (self.context == '2d') {\r\n                    context.save();\r\n                    context.globalCompositeOperation = 'destination-out';\r\n                    context.fillStyle = 'rgba(0, 0, 0, .1)';\r\n                    context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n                    context.restore();\r\n                }\r\n            } else {\r\n                clear(context);\r\n            }\r\n    \r\n            if (self.context == '2d') {\r\n                for (const key in self.options) {\r\n                    context[key] = self.options[key];\r\n                }\r\n            } else {\r\n                context.clear(context.COLOR_BUFFER_BIT);\r\n            }\r\n    \r\n            const scale = 1;\r\n    \r\n            //reuse to save coordinate instance creation\r\n            const coord = new maptalks.Coordinate(0, 0);\r\n            const dataGetOptions = {\r\n                fromColumn: self.options.coordType === 'bd09mc' ? 'coordinates_mercator' : 'coordinates',\r\n                transferCoordinate: function(coordinate) {\r\n                    coord.x = coordinate[0];\r\n                    coord.y = coordinate[1];\r\n                    const r = map.coordToContainerPoint(coord)._multi(scale).toArray();\r\n                    return r;\r\n                }\r\n            }\r\n    \r\n            if (time !== undefined) {\r\n                dataGetOptions.filter = function(item) {\r\n                    const trails = animationOptions.trails || 10;\r\n                    if (time && item.time > (time - trails) && item.time < time) {\r\n                        return true;\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n    \r\n            // get data from data set\r\n            const data = self.dataSet.get(dataGetOptions);\r\n    \r\n            self.processData(data);\r\n    \r\n            if (self.options.unit == 'm') {\r\n                if (self.options.size) {\r\n                    self.options._size = self.options.size / zoomUnit;\r\n                }\r\n                if (self.options.width) {\r\n                    self.options._width = self.options.width / zoomUnit;\r\n                }\r\n                if (self.options.height) {\r\n                    self.options._height = self.options.height / zoomUnit;\r\n                }\r\n            } else {\r\n                self.options._size = self.options.size;\r\n                self.options._height = self.options.height;\r\n                self.options._width = self.options.width;\r\n            }\r\n    \r\n            const zeroZero = new maptalks.Point(0, 0);\r\n            //screen position of the [0, 0] point\r\n            const zeroZeroScreen = map._pointToContainerPoint(zeroZero)._multi(scale);\r\n            self.drawContext(context, data, self.options, zeroZeroScreen);\r\n    \r\n            //console.timeEnd('draw');\r\n    \r\n            //console.timeEnd('update')\r\n            self.options.updateCallback && self.options.updateCallback(time);\r\n        }\r\n    \r\n        createCanvas() {\r\n            if (this.canvas) {\r\n                return;\r\n            }\r\n            const map = this.getMap();\r\n            const size = map.getSize();\r\n            const r = map.getDevicePixelRatio ? map.getDevicePixelRatio() : (maptalks.Browser.retina ? 2 : 1),\r\n                w = r * size.width,\r\n                h = r * size.height;\r\n            this.canvas = maptalks.Canvas.createCanvas(w, h, map.CanvasClass);\r\n            const mapvContext = this.layer.baseLayer.context;\r\n            if (mapvContext === '2d') {\r\n                this.context = this.canvas.getContext('2d');\r\n                if (this.layer.options['globalCompositeOperation']) {\r\n                    this.context.globalCompositeOperation = this.layer.options['globalCompositeOperation'];\r\n                }\r\n                if (this.layer.baseLayer.options.draw !== 'heatmap' && r !== 1) {\r\n                    //in heatmap.js, devicePixelRatio is being mulitplied independently\r\n                    this.context.scale(r, r);\r\n                }\r\n                \r\n            } else {\r\n                const attributes = {\r\n                    'alpha': true,\r\n                    'preserveDrawingBuffer' : true,\r\n                    'antialias' : false\r\n                };\r\n                this.gl = this.canvas.getContext('webgl', attributes);\r\n            }\r\n    \r\n            this.onCanvasCreate();\r\n    \r\n            this._bindToMapv();\r\n    \r\n            this.layer.fire('canvascreate', {\r\n                'context' : this.context,\r\n                'gl' : this.gl\r\n            });\r\n        }\r\n    \r\n        _bindToMapv() {\r\n            //some bindings needed by mapv baselayer\r\n            const base = this.layer.baseLayer;\r\n            const map = this.getMap();\r\n            this.devicePixelRatio = map.getDevicePixelRatio ? map.getDevicePixelRatio() : (maptalks.Browser.retina ? 2 : 1);\r\n            base.canvasLayer = this;\r\n            base._canvasUpdate = this._canvasUpdate.bind(this);\r\n            base.getContext = function () {\r\n                const renderer = self.getRenderer();\r\n                return renderer.gl || renderer.context;\r\n            };\r\n        }\r\n    }\r\n    \r\n    Layer.registerRenderer('canvas', LayerRenderer);\r\n}\r\n\r\nexport default Layer;\r\n","/**\r\n * MapV for AMap\r\n * @author sakitam-fdd - https://github.com/sakitam-fdd\r\n */\r\n\r\nimport BaseLayer from \"../BaseLayer\";\r\nimport clear from \"../../canvas/clear\";\r\nimport DataSet from \"../../data/DataSet\";\r\nimport TWEEN from \"../../utils/Tween\";\r\n\r\n/**\r\n * create canvas\r\n * @param width\r\n * @param height\r\n * @param Canvas\r\n * @returns {HTMLCanvasElement}\r\n */\r\nconst createCanvas = (width, height, Canvas) => {\r\n    if (typeof document !== 'undefined') {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        return canvas\r\n    } else {\r\n        // create a new canvas instance in node.js\r\n        // the canvas class needs to have a default constructor without any parameter\r\n        return new Canvas(width, height)\r\n    }\r\n};\r\n\r\nclass Layer extends BaseLayer {\r\n    constructor(map = null, dataSet, options) {\r\n        super(map, dataSet, options);\r\n\r\n        this.options = options;\r\n\r\n        /**\r\n         * internal\r\n         * @type {{canvas: null, devicePixelRatio: number}}\r\n         */\r\n        this.canvasLayer = {\r\n            canvas: null,\r\n            devicePixelRatio: window.devicePixelRatio\r\n        };\r\n\r\n        /**\r\n         * canvas layer\r\n         * @type {null}\r\n         * @private\r\n         */\r\n        this.layer_ = null;\r\n\r\n        this.initDataRange(options);\r\n        this.initAnimator();\r\n        this.onEvents()\r\n        map.on('complete', function () {\r\n            this.init(map, options);\r\n            this.argCheck(options);\r\n        }, this);\r\n    }\r\n\r\n    /**\r\n     * init mapv layer\r\n     * @param map\r\n     * @param options\r\n     */\r\n    init(map, options) {\r\n        if (map) {\r\n            this.map = map;\r\n            this.context = this.options.context || '2d';\r\n            this.getCanvasLayer();\r\n        } else {\r\n            throw new Error('not map object')\r\n        }\r\n    }\r\n\r\n    /**\r\n     * update layer\r\n     * @param time\r\n     * @private\r\n     */\r\n    _canvasUpdate(time) {\r\n        this.render(this.canvasLayer.canvas, time);\r\n    }\r\n\r\n    /**\r\n     * render layer\r\n     * @param canvas\r\n     * @param time\r\n     * @returns {Layer}\r\n     */\r\n    render(canvas, time) {\r\n        if (!canvas) return;\r\n        const map = this.map;\r\n        const context = canvas.getContext(this.context);\r\n        const animationOptions = this.options.animation;\r\n        if (this.isEnabledTime()) {\r\n            if (time === undefined) {\r\n                clear(context);\r\n                return this;\r\n            }\r\n            if (this.context === '2d') {\r\n                context.save();\r\n                context.globalCompositeOperation = 'destination-out';\r\n                context.fillStyle = 'rgba(0, 0, 0, .1)';\r\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n                context.restore();\r\n            }\r\n        } else {\r\n            clear(context);\r\n        }\r\n\r\n        if (this.context === '2d') {\r\n            for (const key in this.options) {\r\n                context[key] = this.options[key];\r\n            }\r\n        } else {\r\n            context.clear(context.COLOR_BUFFER_BIT);\r\n        }\r\n        const dataGetOptions = {\r\n            transferCoordinate: function (coordinate) {\r\n                const _pixel = map.lngLatToContainer(new AMap.LngLat(coordinate[0], coordinate[1]));\r\n                return [_pixel['x'], _pixel['y']];\r\n            }\r\n        };\r\n\r\n        if (time !== undefined) {\r\n            dataGetOptions.filter = function (item) {\r\n                const trails = animationOptions.trails || 10;\r\n                if (time && item.time > (time - trails) && item.time < time) {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n\r\n        const data = this.dataSet.get(dataGetOptions);\r\n        this.processData(data);\r\n\r\n        if (this.options.unit === 'm') {\r\n            if (this.options.size) {\r\n                this.options._size = this.options.size / zoomUnit;\r\n            }\r\n            if (this.options.width) {\r\n                this.options._width = this.options.width / zoomUnit;\r\n            }\r\n            if (this.options.height) {\r\n                this.options._height = this.options.height / zoomUnit;\r\n            }\r\n        } else {\r\n            this.options._size = this.options.size;\r\n            this.options._height = this.options.height;\r\n            this.options._width = this.options.width;\r\n        }\r\n\r\n        this.drawContext(context, new DataSet(data), this.options, {x: 0, y: 0});\r\n        this.options.updateCallback && this.options.updateCallback(time);\r\n        return this\r\n    }\r\n\r\n    /**\r\n     * get canvas layer\r\n     */\r\n    getCanvasLayer() {\r\n        if (!this.canvasLayer.canvas && !this.layer_) {\r\n            const canvas = this.canvasFunction();\r\n            const bounds = this.map.getBounds();\r\n            this.layer_ = new AMap.CanvasLayer({\r\n                canvas: canvas,\r\n                bounds: this.options.bounds || bounds,\r\n                zooms: this.options.zooms || [0, 22],\r\n            });\r\n            this.layer_.setMap(this.map);\r\n            this.map.on('mapmove', this.canvasFunction, this);\r\n            this.map.on('zoomchange', this.canvasFunction, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * canvas constructor\r\n     * @returns {*}\r\n     */\r\n    canvasFunction() {\r\n        const [width, height] = [this.map.getSize().width, this.map.getSize().height]\r\n        if (!this.canvasLayer.canvas) {\r\n            this.canvasLayer.canvas = createCanvas(width, height)\r\n        } else {\r\n            this.canvasLayer.canvas.width = width;\r\n            this.canvasLayer.canvas.height = height;\r\n            const bounds = this.map.getBounds();\r\n            if (this.layer_) {\r\n                this.layer_.setBounds(this.options.bounds || bounds);\r\n            }\r\n        }\r\n        this.render(this.canvasLayer.canvas)\r\n        return this.canvasLayer.canvas\r\n    }\r\n\r\n    /**\r\n     * remove layer\r\n     */\r\n    removeLayer() {\r\n        if (!this.map) return;\r\n        this.unEvents();\r\n        this.map.removeLayer(this.layer_);\r\n        delete this.map;\r\n        delete this.layer_;\r\n        delete this.canvasLayer.canvas;\r\n    }\r\n\r\n    getContext() {\r\n        return this.canvasLayer.canvas.getContext(this.context);\r\n    }\r\n\r\n    /**\r\n     * handle click event\r\n     * @param event\r\n     */\r\n    clickEvent(event) {\r\n        const pixel = event.pixel;\r\n        super.clickEvent(pixel, event);\r\n    }\r\n\r\n    /**\r\n     * handle mousemove/pointermove event\r\n     * @param event\r\n     */\r\n    mousemoveEvent(event) {\r\n        const pixel = event.pixel;\r\n        super.mousemoveEvent(pixel, event);\r\n    }\r\n\r\n    /**\r\n     * add animator event\r\n     */\r\n    addAnimatorEvent() {\r\n        this.map.on('movestart', this.animatorMovestartEvent, this);\r\n        this.map.on('moveend', this.animatorMoveendEvent, this);\r\n    }\r\n\r\n    /**\r\n     * bind event\r\n     */\r\n    onEvents() {\r\n        const map = this.map;\r\n        this.unEvents();\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.on('click', this.clickEvent, this);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.on('mousemove', this.mousemoveEvent, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * unbind events\r\n     */\r\n    unEvents() {\r\n        const map = this.map;\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.off('click', this.clickEvent, this);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.off('mousemove', this.mousemoveEvent, this);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default Layer","/**\r\n * MapV for openlayers (https://openlayers.org)\r\n * @author sakitam-fdd - https://github.com/sakitam-fdd\r\n */\r\n\r\nimport BaseLayer from \"../BaseLayer\";\r\nimport clear from \"../../canvas/clear\";\r\nimport DataSet from \"../../data/DataSet\";\r\nimport TWEEN from \"../../utils/Tween\";\r\n\r\n/**\r\n * create canvas\r\n * @param width\r\n * @param height\r\n * @returns {HTMLCanvasElement}\r\n */\r\nconst createCanvas = (width, height) => {\r\n  if (typeof document !== 'undefined') {\r\n    const canvas = document.createElement('canvas')\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    return canvas;\r\n  } else {\r\n    // create a new canvas instance in node.js\r\n    // the canvas class needs to have a default constructor without any parameter\r\n  }\r\n}\r\n\r\nclass Layer extends BaseLayer {\r\n  constructor (map = null, dataSet, options) {\r\n    super(map, dataSet, options);\r\n\r\n    this.options = options;\r\n\r\n    /**\r\n     * internal\r\n     * @type {{canvas: null, devicePixelRatio: number}}\r\n     */\r\n    this.canvasLayer = {\r\n      canvas: null,\r\n      devicePixelRatio: window.devicePixelRatio\r\n    }\r\n\r\n    /**\r\n     * cavnas layer\r\n     * @type {null}\r\n     * @private\r\n     */\r\n    this.layer_ = null;\r\n\r\n    /**\r\n     * previous cursor\r\n     * @type {undefined}\r\n     * @private\r\n     */\r\n    this.previousCursor_ = undefined\r\n\r\n    this.init(map, options);\r\n    this.argCheck(options);\r\n  }\r\n\r\n  /**\r\n   * init mapv layer\r\n   * @param map\r\n   * @param options\r\n   */\r\n  init (map, options) {\r\n    if (map && map instanceof ol.Map) {\r\n      this.$Map = map;\r\n      this.context = this.options.context || '2d';\r\n      this.getCanvasLayer();\r\n      this.initDataRange(options);\r\n      this.initAnimator();\r\n      this.onEvents()\r\n    } else {\r\n      throw new Error('not map object')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * update layer\r\n   * @param time\r\n   * @private\r\n   */\r\n  _canvasUpdate (time) {\r\n    this.render(this.canvasLayer.canvas, time);\r\n  }\r\n\r\n  /**\r\n   * render layer\r\n   * @param canvas\r\n   * @param time\r\n   * @returns {Layer}\r\n   */\r\n  render (canvas, time) {\r\n    const map = this.$Map;\r\n    const context = canvas.getContext(this.context);\r\n    const animationOptions = this.options.animation;\r\n    const _projection = this.options.hasOwnProperty('projection') ? this.options.projection : 'EPSG:4326';\r\n    const mapViewProjection = this.$Map.getView().getProjection().getCode();\r\n    if (this.isEnabledTime()) {\r\n      if (time === undefined) {\r\n        clear(context);\r\n        return this;\r\n      }\r\n      if (this.context === '2d') {\r\n        context.save();\r\n        context.globalCompositeOperation = 'destination-out';\r\n        context.fillStyle = 'rgba(0, 0, 0, .1)';\r\n        context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n        context.restore();\r\n      }\r\n    } else {\r\n      clear(context);\r\n    }\r\n\r\n    if (this.context === '2d') {\r\n      for (const key in this.options) {\r\n        context[key] = this.options[key];\r\n      }\r\n    } else {\r\n      context.clear(context.COLOR_BUFFER_BIT);\r\n    }\r\n\tconst dataGetOptions = {}\r\n    dataGetOptions.transferCoordinate = ((_projection === mapViewProjection) ? function (coordinate) {\r\n\t\t\t// 当数据与map的投影一致时不再进行投影转换\r\n\t\t\treturn map.getPixelFromCoordinate(coordinate);\r\n\t\t} : function (coordinate) {\r\n\t\t\t// 数据与Map投影不一致时 将数据投影转换为 Map的投影\r\n\t\t\treturn map.getPixelFromCoordinate(ol.proj.transform(coordinate, _projection, mapViewProjection));\r\n\t\t});\r\n\r\n    if (time !== undefined) {\r\n      dataGetOptions.filter = function(item) {\r\n        const trails = animationOptions.trails || 10;\r\n        if (time && item.time > (time - trails) && item.time < time) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n\r\n    const data = this.dataSet.get(dataGetOptions);\r\n    this.processData(data);\r\n\r\n    if (this.options.unit === 'm') {\r\n      if (this.options.size) {\r\n        this.options._size = this.options.size / zoomUnit;\r\n      }\r\n      if (this.options.width) {\r\n        this.options._width = this.options.width / zoomUnit;\r\n      }\r\n      if (this.options.height) {\r\n        this.options._height = this.options.height / zoomUnit;\r\n      }\r\n    } else {\r\n      this.options._size = this.options.size;\r\n      this.options._height = this.options.height;\r\n      this.options._width = this.options.width;\r\n    }\r\n\r\n    this.drawContext(context, new DataSet(data), this.options, {x: 0, y: 0});\r\n    this.options.updateCallback && this.options.updateCallback(time);\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * get canvas layer\r\n   */\r\n  getCanvasLayer () {\r\n    if (!this.canvasLayer.canvas && !this.layer_) {\r\n      const extent = this.getMapExtent();\r\n      this.layer_ = new ol.layer.Image({\r\n        layerName: this.options.layerName,\r\n        minResolution: this.options.minResolution,\r\n        maxResolution: this.options.maxResolution,\r\n        zIndex: this.options.zIndex,\r\n        extent: extent,\r\n        source: new ol.source.ImageCanvas({\r\n          canvasFunction: this.canvasFunction.bind(this),\r\n          projection: this.$Map.getView().getProjection().getCode(), // 图层投影与Map保持一致\r\n          ratio: (this.options.hasOwnProperty('ratio') ? this.options.ratio : 1)\r\n        })\r\n      });\r\n      this.$Map.addLayer(this.layer_);\r\n      this.$Map.un('precompose', this.reRender, this);\r\n      this.$Map.on('precompose', this.reRender, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * re render\r\n   */\r\n  reRender () {\r\n    if (!this.layer_) return;\r\n    const extent = this.getMapExtent();\r\n    this.layer_.setExtent(extent);\r\n  }\r\n\r\n  /**\r\n   * canvas constructor\r\n   * @param extent\r\n   * @param resolution\r\n   * @param pixelRatio\r\n   * @param size\r\n   * @param projection\r\n   * @returns {*}\r\n   */\r\n  canvasFunction (extent, resolution, pixelRatio, size, projection) {\r\n    if (!this.canvasLayer.canvas) {\r\n      this.canvasLayer.canvas = createCanvas(size[0], size[1])\r\n    } else {\r\n      this.canvasLayer.canvas.width = size[0];\r\n      this.canvasLayer.canvas.height = size[1];\r\n    }\r\n    this.render(this.canvasLayer.canvas)\r\n    return this.canvasLayer.canvas\r\n  }\r\n\r\n  /**\r\n   * get map current extent\r\n   * @returns {Array}\r\n   */\r\n  getMapExtent () {\r\n    const size = this.$Map.getSize();\r\n    return this.$Map.getView().calculateExtent(size);\r\n  }\r\n\r\n  /**\r\n   * add layer to map\r\n   * @param map\r\n   */\r\n  addTo (map) {\r\n    this.init(map, this.options);\r\n  }\r\n\r\n  /**\r\n   * remove layer\r\n   */\r\n  removeLayer () {\r\n    if (!this.$Map) return;\r\n    this.unEvents();\r\n    this.$Map.un('precompose', this.reRender, this);\r\n    this.$Map.removeLayer(this.layer_);\r\n    delete this.$Map;\r\n    delete this.layer_;\r\n    delete this.canvasLayer.canvas;\r\n  }\r\n\r\n  getContext() {\r\n    return this.canvasLayer.canvas.getContext(this.context);\r\n  }\r\n\r\n  /**\r\n   * handle click event\r\n   * @param event\r\n   */\r\n  clickEvent(event) {\r\n    const pixel = event.pixel;\r\n    super.clickEvent({\r\n      x: pixel[0],\r\n      y: pixel[1]\r\n    }, event);\r\n  }\r\n\r\n  /**\r\n   * handle mousemove/pointermove event\r\n   * @param event\r\n   */\r\n  mousemoveEvent(event) {\r\n    const pixel = event.pixel;\r\n    super.mousemoveEvent({\r\n      x: pixel[0],\r\n      y: pixel[1]\r\n    }, event);\r\n  }\r\n\r\n  /**\r\n   * add animator event\r\n   */\r\n  addAnimatorEvent() {\r\n    this.$Map.on('movestart', this.animatorMovestartEvent, this);\r\n    this.$Map.on('moveend', this.animatorMoveendEvent, this);\r\n  }\r\n\r\n  /**\r\n   * bind event\r\n   */\r\n  onEvents () {\r\n    const map = this.$Map;\r\n    this.unEvents();\r\n    if (this.options.methods) {\r\n      if (this.options.methods.click) {\r\n        map.on('click', this.clickEvent, this);\r\n      }\r\n      if (this.options.methods.mousemove) {\r\n        map.on('pointermove', this.mousemoveEvent, this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * unbind events\r\n   */\r\n  unEvents () {\r\n    const map = this.$Map;\r\n    if (this.options.methods) {\r\n      if (this.options.methods.click) {\r\n        map.un('click', this.clickEvent, this);\r\n      }\r\n      if (this.options.methods.pointermove) {\r\n        map.un('pointermove', this.mousemoveEvent, this);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * set map cursor\r\n   * @param cursor\r\n   * @param feature\r\n   */\r\n  setDefaultCursor (cursor, feature) {\r\n    if (!this.$Map) return;\r\n    const element = this.$Map.getTargetElement()\r\n    if (feature) {\r\n      if (element.style.cursor !== cursor) {\r\n        this.previousCursor_ = element.style.cursor\r\n        element.style.cursor = cursor\r\n      }\r\n    } else if (this.previousCursor_ !== undefined) {\r\n      element.style.cursor = this.previousCursor_\r\n      this.previousCursor_ = undefined\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * 显示图层\r\n   */\r\n  show() {\r\n    this.$Map.addLayer(this.layer_);\r\n  }\r\n\r\n  /**\r\n   * 隐藏图层\r\n   */\r\n  hide() {\r\n    this.$Map.removeLayer(this.layer_);\r\n  }\r\n}\r\n\r\nexport default Layer\r\n","// https://github.com/SuperMap/iClient-JavaScript\r\nimport BaseLayer from \"../BaseLayer\";\r\n/**\r\n * @class MapVRenderer\r\n * @classdesc 地图渲染类。\r\n * @category Visualization MapV\r\n * @private\r\n * @extends mapv.BaseLayer\r\n * @param {L.Map} map - 待渲染的地图。\r\n * @param {L.Layer} layer - 待渲染的图层。\r\n * @param {DataSet} dataSet - 待渲染的数据集。\r\n * @param {Object} options - 渲染的参数。\r\n */\r\nexport class MapVRenderer extends BaseLayer {\r\n\r\n    constructor(map, layer, dataSet, options) {\r\n        super(map, dataSet, options);\r\n        if (!BaseLayer) {\r\n            return;\r\n        }\r\n\r\n\r\n        var self = this;\r\n        options = options || {};\r\n\r\n        self.init(options);\r\n        self.argCheck(options);\r\n        this.canvasLayer = layer;\r\n        this.clickEvent = this.clickEvent.bind(this);\r\n        this.mousemoveEvent = this.mousemoveEvent.bind(this);\r\n        this._moveStartEvent = this.moveStartEvent.bind(this);\r\n        this._moveEndEvent = this.moveEndEvent.bind(this);\r\n        this._zoomStartEvent = this.zoomStartEvent.bind(this);\r\n        this.bindEvent();\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.clickEvent\r\n     * @description 点击事件。\r\n     * @param {Object} e - 触发对象。\r\n     */\r\n    clickEvent(e) {\r\n        var offset = this.map.containerPointToLayerPoint([0, 0]);\r\n        var devicePixelRatio = this.devicePixelRatio = this.canvasLayer.devicePixelRatio = window.devicePixelRatio;\r\n        var pixel = e.layerPoint;\r\n        super.clickEvent(L.point((pixel.x - offset.x) / devicePixelRatio, (pixel.y - offset.y) / devicePixelRatio), e);\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.mousemoveEvent\r\n     * @description 鼠标移动事件。\r\n     * @param {Object} e - 触发对象。\r\n     */\r\n    mousemoveEvent(e) {\r\n        var pixel = e.layerPoint;\r\n        super.mousemoveEvent(pixel, e);\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.bindEvent\r\n     * @description 绑定鼠标移动和鼠标点击事件。\r\n     * @param {Object} e - 触发对象。\r\n     */\r\n    bindEvent() {\r\n        var map = this.map;\r\n\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.on('click', this.clickEvent);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.on('mousemove', this.mousemoveEvent);\r\n            }\r\n        }\r\n        this.map.on('movestart', this._moveStartEvent);\r\n        this.map.on('moveend', this._moveEndEvent);\r\n        this.map.on('zoomstart', this._zoomStartEvent);\r\n    }\r\n    /**\r\n     * @function MapVRenderer.prototype.destroy\r\n     * @description 释放资源。\r\n     */\r\n    destroy() {\r\n        this.unbindEvent();\r\n        this.clearData();\r\n        this.animator && this.animator.stop();\r\n        this.animator = null;\r\n        this.canvasLayer = null;\r\n    }\r\n    /**\r\n     * @function MapVRenderer.prototype.unbindEvent\r\n     * @description 解绑鼠标移动和鼠标滑动触发的事件。\r\n     * @param {Object} e - 触发对象。\r\n     */\r\n    unbindEvent() {\r\n        var map = this.map;\r\n\r\n        if (this.options.methods) {\r\n            if (this.options.methods.click) {\r\n                map.off('click', this.clickEvent);\r\n            }\r\n            if (this.options.methods.mousemove) {\r\n                map.off('mousemove', this.mousemoveEvent);\r\n            }\r\n        }\r\n        this.map.off('movestart', this._moveStartEvent);\r\n        this.map.off('moveend', this._moveEndEvent);\r\n        this.map.off('zoomstart', this._zoomStartEvent);\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.getContext\r\n     * @description 获取信息。\r\n     */\r\n    getContext() {\r\n        return this.canvasLayer.getCanvas().getContext(this.context);\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.addData\r\n     * @description 添加数据。\r\n     * @param {Object} data - 待添加的数据。\r\n     * @param  {Object} options - 待添加的数据信息。\r\n     */\r\n    addData(data, options) {\r\n        var _data = data;\r\n        if (data && data.get) {\r\n            _data = data.get();\r\n        }\r\n        this.dataSet.add(_data);\r\n        this.update({\r\n            options: options\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.update\r\n     * @description 更新图层。\r\n     * @param {Object} opt - 待更新的数据。\r\n     * @param {Object} opt.data - mapv数据集。\r\n     * @param {Object} opt.options - mapv绘制参数。\r\n     */\r\n    update(opt) {\r\n        var update = opt || {};\r\n        var _data = update.data;\r\n        if (_data && _data.get) {\r\n            _data = _data.get();\r\n        }\r\n        if (_data != undefined) {\r\n            this.dataSet.set(_data);\r\n        }\r\n        super.update({\r\n            options: update.options\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.getData\r\n     * @description 获取数据\r\n     */\r\n    getData() {\r\n        return this.dataSet;\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.removeData\r\n     * @description 删除符合过滤条件的数据。\r\n     * @param {Function} filter - 过滤条件。条件参数为数据项，返回值为 true，表示删除该元素；否则表示不删除。\r\n     */\r\n    removeData(filter) {\r\n        if (!this.dataSet) {\r\n            return;\r\n        }\r\n        var newData = this.dataSet.get({\r\n            filter: function (data) {\r\n                return (filter != null && typeof filter === \"function\") ? !filter(data) : true;\r\n            }\r\n        });\r\n        this.dataSet.set(newData);\r\n        this.update({\r\n            options: null\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.clearData\r\n     * @description 清除数据\r\n     */\r\n    clearData() {\r\n        this.dataSet && this.dataSet.clear();\r\n        this.update({\r\n            options: null\r\n        });\r\n    }\r\n\r\n    _canvasUpdate(time) {\r\n        if (!this.canvasLayer) {\r\n            return;\r\n        }\r\n\r\n        var self = this;\r\n\r\n        var animationOptions = self.options.animation;\r\n\r\n        var context = this.getContext();\r\n        var map = this.map;\r\n        if (self.isEnabledTime()) {\r\n            if (time === undefined) {\r\n                this.clear(context);\r\n                return;\r\n            }\r\n            if (this.context === '2d') {\r\n                context.save();\r\n                context.globalCompositeOperation = 'destination-out';\r\n                context.fillStyle = 'rgba(0, 0, 0, .1)';\r\n                context.fillRect(0, 0, context.canvas.width, context.canvas.height);\r\n                context.restore();\r\n            }\r\n        } else {\r\n            this.clear(context);\r\n        }\r\n\r\n        if (this.context === '2d') {\r\n            for (var key in self.options) {\r\n                context[key] = self.options[key];\r\n            }\r\n        } else {\r\n            context.clear(context.COLOR_BUFFER_BIT);\r\n        }\r\n\r\n        if (self.options.minZoom && map.getZoom() < self.options.minZoom || self.options.maxZoom && map.getZoom() > self.options.maxZoom) {\r\n            return;\r\n        }\r\n\r\n        var bounds = map.getBounds();\r\n        //获取当前像素下的地理范围\r\n        var dw = bounds.getEast() - bounds.getWest();\r\n        var dh = bounds.getNorth() - bounds.getSouth();\r\n        var mapCanvas = map.getSize();\r\n\r\n        var resolutionX = dw / mapCanvas.x,\r\n            resolutionY = dh / mapCanvas.y;\r\n        //var centerPx = map.latLngToLayerPoint(map.getCenter());\r\n\r\n        //获取屏幕左上角的地理坐标坐标\r\n        //左上角屏幕坐标为0,0\r\n        var topLeft = this.canvasLayer.getTopLeft();\r\n\r\n        var topLeftPX = map.latLngToContainerPoint(topLeft);\r\n        // 获取精确的像素坐标. https://github.com/SuperMap/iClient-JavaScript/blob/eacc26952b8915bba0122db751d766056c5fb24d/src/leaflet/core/Base.js\r\n        // var topLeftPX = map.latLngToAccurateContainerPoint(topLeft);\r\n        // var lopLeft = map.containerPointToLatLng([0, 0]);\r\n        var dataGetOptions = {\r\n            transferCoordinate: function (coordinate) {\r\n                var offset;\r\n                if (self.context === '2d') {\r\n                    offset = map.latLngToContainerPoint(L.latLng(coordinate[1], coordinate[0]));\r\n                    // offset = map.latLngToAccurateContainerPoint(L.latLng(coordinate[1], coordinate[0]));\r\n                } else {\r\n                    offset = {\r\n                        'x': (coordinate[0] - topLeft.lng) / resolutionX,\r\n                        'y': (topLeft.lat - coordinate[1]) / resolutionY\r\n                    };\r\n                }\r\n                var pixel = {\r\n                    x: offset.x - topLeftPX.x,\r\n                    y: offset.y - topLeftPX.y\r\n                };\r\n                return [pixel.x, pixel.y];\r\n            }\r\n        };\r\n\r\n        if (time !== undefined) {\r\n            dataGetOptions.filter = function (item) {\r\n                var trails = animationOptions.trails || 10;\r\n                return (time && item.time > (time - trails) && item.time < time);\r\n            }\r\n        }\r\n\r\n        var data = self.dataSet.get(dataGetOptions);\r\n\r\n        this.processData(data);\r\n\r\n        self.options._size = self.options.size;\r\n\r\n        var worldPoint = map.latLngToContainerPoint(L.latLng(0, 0));\r\n        var pixel = {\r\n            x: worldPoint.x - topLeftPX.x,\r\n            y: worldPoint.y - topLeftPX.y\r\n        };\r\n        this.drawContext(context, data, self.options, pixel);\r\n\r\n        self.options.updateCallback && self.options.updateCallback(time);\r\n    }\r\n\r\n    init(options) {\r\n\r\n        var self = this;\r\n\r\n        self.options = options;\r\n\r\n        this.initDataRange(options);\r\n\r\n        this.context = self.options.context || '2d';\r\n\r\n        if (self.options.zIndex) {\r\n            this.canvasLayer && this.canvasLayer.setZIndex(self.options.zIndex);\r\n        }\r\n\r\n        this.initAnimator();\r\n    }\r\n\r\n    addAnimatorEvent() { }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.moveStartEvent\r\n     * @description 开始移动事件。\r\n     */\r\n    moveStartEvent() {\r\n        var animationOptions = this.options.animation;\r\n        if (this.isEnabledTime() && this.animator) {\r\n            this.steps.step = animationOptions.stepsRange.start;\r\n            this._hide();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.moveEndEvent\r\n     * @description 结束移动事件。\r\n     */\r\n    moveEndEvent() {\r\n        this.canvasLayer.draw();\r\n        this._show();\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.zoomStartEvent\r\n     * @description 隐藏渲染样式。\r\n     */\r\n    zoomStartEvent() {\r\n        this._hide();\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.clear\r\n     * @description 清除信息。\r\n     * @param {string} context - 指定要清除的信息。\r\n     */\r\n    clear(context) {\r\n        context && context.clearRect && context.clearRect(0, 0, context.canvas.width, context.canvas.height);\r\n    }\r\n\r\n    _hide() {\r\n        this.canvasLayer.canvas.style.display = 'none';\r\n    }\r\n\r\n    _show() {\r\n        this.canvasLayer.canvas.style.display = 'block';\r\n    }\r\n\r\n    /**\r\n     * @function MapVRenderer.prototype.draw\r\n     * @description 绘制渲染\r\n     */\r\n    draw() {\r\n        this.canvasLayer.draw();\r\n    }\r\n}","import { MapVRenderer } from \"./MapVRenderer\";\r\n\r\nvar mapVLayer;\r\nif (typeof (L) !== 'undefined') {\r\n    /**\r\n     * @class mapVLayer\r\n     * @classdesc MapV 图层。\r\n     * @category Visualization MapV\r\n     * @extends {L.Layer}\r\n     * @param {mapv.DataSet} dataSet - MapV 图层数据集。\r\n     * @param {Object} mapVOptions - MapV 图层参数。\r\n     * @param {Object} options - 参数。\r\n     * @param {string} [options.attributionPrefix] - 版权信息前缀。\r\n     * @param {string} [options.attribution='© 2018 百度 MapV'] - 版权信息。\r\n     * @fires mapVLayer#loaded\r\n     */\r\n    var MapVLayer = L.Layer.extend({\r\n\r\n        options: {\r\n            attributionPrefix: null,\r\n            attribution: ''\r\n        },\r\n\r\n        initialize: function (dataSet, mapVOptions, options) {\r\n            options = options || {};\r\n            this.dataSet = dataSet || {};\r\n            this.mapVOptions = mapVOptions || {};\r\n            this.render = this.render.bind(this);\r\n            L.Util.setOptions(this, options);\r\n            if (this.options.attributionPrefix) {\r\n                this.options.attribution = this.options.attributionPrefix + this.options.attribution;\r\n            }\r\n\r\n            this.canvas = this._createCanvas();\r\n            L.stamp(this);\r\n        },\r\n\r\n        /**\r\n         * @private\r\n         * @function mapVLayer.prototype.onAdd\r\n         * @description 添加地图图层。\r\n         * @param {L.Map} map - 要添加的地图。\r\n         */\r\n        onAdd: function (map) {\r\n            this._map = map;\r\n            var overlayPane = this.getPane();\r\n            var container = this.container = L.DomUtil.create(\"div\", \"leaflet-layer leaflet-zoom-animated\", overlayPane);\r\n            container.appendChild(this.canvas);\r\n            var size = map.getSize();\r\n            container.style.width = size.x + \"px\";\r\n            container.style.height = size.y + \"px\";\r\n            this.renderer = new MapVRenderer(map, this, this.dataSet, this.mapVOptions);\r\n            this.draw();\r\n            /**\r\n             * @event mapVLayer#loaded\r\n             * @description 图层添加完成之后触发。\r\n             */\r\n            this.fire(\"loaded\");\r\n        },\r\n\r\n        // _hide: function () {\r\n        //     this.canvas.style.display = 'none';\r\n        // },\r\n\r\n        // _show: function () {\r\n        //     this.canvas.style.display = 'block';\r\n        // },\r\n\r\n        /**\r\n         * @private\r\n         * @function mapVLayer.prototype.onRemove\r\n         * @description 删除地图图层。\r\n         */\r\n        onRemove: function () {\r\n            L.DomUtil.remove(this.container);\r\n            this.renderer.destroy();\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.addData\r\n         * @description 追加数据。\r\n         * @param {Object} data - 要追加的数据。\r\n         * @param {Object} options - 要追加的值。\r\n         */\r\n        addData: function (data, options) {\r\n            this.renderer.addData(data, options);\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.update\r\n         * @description 更新图层。\r\n         * @param {Object} opt - 待更新的数据。\r\n         * @param {Object} data - mapv 数据集。\r\n         * @param {Object} options - mapv 绘制参数。\r\n         */\r\n        update: function (opt) {\r\n            this.renderer.update(opt);\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.getData\r\n         * @description 获取数据。\r\n         * @returns {mapv.DataSet} mapv 数据集。\r\n         */\r\n        getData: function () {\r\n            if (this.renderer) {\r\n                this.dataSet = this.renderer.getData();\r\n            }\r\n            return this.dataSet;\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.removeData\r\n         * @description 删除符合过滤条件的数据。\r\n         * @param {Function} filter - 过滤条件。条件参数为数据项，返回值为 true，表示删除该元素；否则表示不删除。\r\n         * @example\r\n         *  filter=function(data){\r\n         *    if(data.id==\"1\"){\r\n         *      return true\r\n         *    }\r\n         *    return false;\r\n         *  }\r\n         */\r\n        removeData: function (filter) {\r\n            this.renderer && this.renderer.removeData(filter);\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.clearData\r\n         * @description 清除数据。\r\n         */\r\n        clearData: function () {\r\n            this.renderer.clearData();\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.draw\r\n         * @description 绘制图层。\r\n         */\r\n        draw: function () {\r\n            return this._reset();\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.setZIndex\r\n         * @description 设置 canvas 层级。\r\n         * @param {number} zIndex - canvas 层级。\r\n         */\r\n        setZIndex: function (zIndex) {\r\n            this.canvas.style.zIndex = zIndex;\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.render\r\n         * @description 渲染。\r\n         */\r\n        render: function () {\r\n            this.renderer._canvasUpdate();\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.getCanvas\r\n         * @description 获取 canvas。\r\n         * @returns {HTMLElement} 返回 mapV 图层包含的 canvas 对象。\r\n         */\r\n        getCanvas: function () {\r\n            return this.canvas;\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.getContainer\r\n         * @description 获取容器。\r\n         * @returns {HTMLElement} 返回包含 mapV 图层的 dom 对象。\r\n         */\r\n        getContainer: function () {\r\n            return this.container;\r\n        },\r\n\r\n        /**\r\n         * @function mapVLayer.prototype.getTopLeft\r\n         * @description 获取左上角坐标。\r\n         * @returns {L.Bounds} 返回左上角坐标。\r\n         */\r\n        getTopLeft: function () {\r\n            var map = this._map;\r\n            var topLeft;\r\n            if (map) {\r\n                var bounds = map.getBounds();\r\n                topLeft = bounds.getNorthWest();\r\n            }\r\n            return topLeft;\r\n\r\n        },\r\n\r\n        _createCanvas: function () {\r\n            var canvas = document.createElement('canvas');\r\n            canvas.style.position = 'absolute';\r\n            canvas.style.top = 0 + \"px\";\r\n            canvas.style.left = 0 + \"px\";\r\n            canvas.style.pointerEvents = \"none\";\r\n            canvas.style.zIndex = this.options.zIndex || 600;\r\n            var global$2 = typeof window === 'undefined' ? {} : window;\r\n            var devicePixelRatio = this.devicePixelRatio = global$2.devicePixelRatio;\r\n            if (!this.mapVOptions.context || this.mapVOptions.context === '2d') {\r\n                canvas.getContext('2d').scale(devicePixelRatio, devicePixelRatio);\r\n            }\r\n            return canvas;\r\n        },\r\n\r\n\r\n        _resize: function () {\r\n            var canvas = this.canvas;\r\n            if (!canvas) {\r\n                return;\r\n            }\r\n\r\n            var map = this._map;\r\n            var size = map.getSize();\r\n            canvas.width = size.x;\r\n            canvas.height = size.y;\r\n            canvas.style.width = size.x + 'px';\r\n            canvas.style.height = size.y + 'px';\r\n            var bounds = map.getBounds();\r\n            var topLeft = map.latLngToLayerPoint(bounds.getNorthWest());\r\n            L.DomUtil.setPosition(canvas, topLeft);\r\n\r\n        },\r\n\r\n        _reset: function () {\r\n            this._resize();\r\n            this._render()\r\n        },\r\n        redraw: function () {\r\n            this._resize();\r\n            this._render()\r\n        },\r\n        _render: function () {\r\n            this.render();\r\n        }\r\n\r\n    });\r\n\r\n    mapVLayer = function (dataSet, mapVOptions, options) {\r\n        return new MapVLayer(dataSet, mapVOptions, options);\r\n    };\r\n}\r\nexport default mapVLayer;","import BaseLayer from \"../BaseLayer\";\r\nimport DataSet from \"../../data/DataSet\";\r\n\r\n\r\nexport class MapVRenderer extends BaseLayer {\r\n\r\n    /**\r\n     * Creates an instance of MapVRenderer.\r\n     * @param {*} viewer cesium viewer\r\n     * @param {*} dataset mapv dataset\r\n     * @param {*} option mapvOptions\r\n     * @param {*} mapVLayer\r\n     * @memberof MapVRenderer\r\n     */\r\n    constructor(viewer, dataset, option, mapVLayer) {\r\n        super(viewer, dataset, option)\r\n        if (!BaseLayer) {\r\n            return;\r\n        }\r\n        this.map = viewer,\r\n            this.scene = viewer.scene,\r\n            this.dataSet = dataset;\r\n        option = option || {},\r\n            this.init(option),\r\n            this.argCheck(option),\r\n            this.initDevicePixelRatio(),\r\n            this.canvasLayer = mapVLayer,\r\n            this.stopAniamation = !1,\r\n            this.animation = option.animation,\r\n            this.clickEvent = this.clickEvent.bind(this),\r\n            this.mousemoveEvent = this.mousemoveEvent.bind(this),\r\n            this.bindEvent()\r\n    }\r\n    initDevicePixelRatio() {\r\n        this.devicePixelRatio = window.devicePixelRatio || 1\r\n    }\r\n    clickEvent(t) {\r\n        var e = t.point;\r\n        super.clickEvent(e, t)\r\n    }\r\n    mousemoveEvent(t) {\r\n        var e = t.point;\r\n        super.mousemoveEvent(e, t)\r\n    }\r\n    addAnimatorEvent() { }\r\n    animatorMovestartEvent() {\r\n        var t = this.options.animation;\r\n        this.isEnabledTime() && this.animator && (this.steps.step = t.stepsRange.start)\r\n    }\r\n    animatorMoveendEvent() {\r\n        this.isEnabledTime() && this.animator\r\n    }\r\n    bindEvent() {\r\n        this.map;\r\n        this.options.methods && (this.options.methods.click,\r\n            this.options.methods.mousemove)\r\n    }\r\n    unbindEvent() {\r\n        var t = this.map;\r\n        this.options.methods && (this.options.methods.click && t.off(\"click\", this.clickEvent),\r\n            this.options.methods.mousemove && t.off(\"mousemove\", this.mousemoveEvent))\r\n    }\r\n    getContext() {\r\n        return this.canvasLayer.canvas.getContext(this.context)\r\n    }\r\n    init(t) {\r\n        this.options = t,\r\n            this.initDataRange(t),\r\n            this.context = this.options.context || \"2d\",\r\n            this.options.zIndex && this.canvasLayer && this.canvasLayer.setZIndex(this.options.zIndex),\r\n            this.initAnimator()\r\n    }\r\n    _canvasUpdate(t) {\r\n        this.map;\r\n        var e = this.scene;\r\n        if (this.canvasLayer && !this.stopAniamation) {\r\n            var i = this.options.animation\r\n                , n = this.getContext();\r\n            if (this.isEnabledTime()) {\r\n                if (void 0 === t)\r\n                    return void this.clear(n);\r\n                \"2d\" === this.context && (n.save(),\r\n                    n.globalCompositeOperation = \"destination-out\",\r\n                    n.fillStyle = \"rgba(0, 0, 0, .1)\",\r\n                    n.fillRect(0, 0, n.canvas.width, n.canvas.height),\r\n                    n.restore())\r\n            } else\r\n                this.clear(n);\r\n            if (\"2d\" === this.context)\r\n                for (var o in this.options)\r\n                    n[o] = this.options[o];\r\n            else\r\n                n.clear(n.COLOR_BUFFER_BIT);\r\n            var a = {\r\n                transferCoordinate: function (t) {\r\n                    var i = Cesium.Cartesian3.fromDegrees(t[0], t[1])\r\n                        , n = Cesium.SceneTransforms.wgs84ToWindowCoordinates(e, i);\r\n                    return void 0 == n ? [-1, -1] : [n.x, n.y]\r\n                }\r\n            };\r\n            void 0 !== t && (a.filter = function (e) {\r\n                var n = i.trails || 10;\r\n                return !!(t && e.time > t - n && e.time < t)\r\n            }\r\n            );\r\n            var c = this.dataSet.get(a);\r\n            this.processData(c),\r\n                \"m\" == this.options.unit && this.options.size,\r\n                this.options._size = this.options.size;\r\n            var h = Cesium.SceneTransforms.wgs84ToWindowCoordinates(e, Cesium.Cartesian3.fromDegrees(0, 0));\r\n            this.drawContext(n, new DataSet(c), this.options, h),\r\n                this.options.updateCallback && this.options.updateCallback(t)\r\n        }\r\n    }\r\n    updateData(t, e) {\r\n        var i = t;\r\n        i && i.get && (i = i.get()),\r\n            void 0 != i && this.dataSet.set(i),\r\n            super.update({\r\n                options: e\r\n            })\r\n    }\r\n    addData(t, e) {\r\n        var i = t;\r\n        t && t.get && (i = t.get()),\r\n            this.dataSet.add(i),\r\n            this.update({\r\n                options: e\r\n            })\r\n    }\r\n    getData() {\r\n        return this.dataSet\r\n    }\r\n    removeData(t) {\r\n        if (this.dataSet) {\r\n            var e = this.dataSet.get({\r\n                filter: function (e) {\r\n                    return null == t || \"function\" != typeof t || !t(e)\r\n                }\r\n            });\r\n            this.dataSet.set(e),\r\n                this.update({\r\n                    options: null\r\n                })\r\n        }\r\n    }\r\n    clearData() {\r\n        this.dataSet && this.dataSet.clear(),\r\n            this.update({\r\n                options: null\r\n            })\r\n    }\r\n    draw() {\r\n        this.canvasLayer.draw()\r\n    }\r\n    clear(t) {\r\n        t && t.clearRect && t.clearRect(0, 0, t.canvas.width, t.canvas.height)\r\n    }\r\n}","import { MapVRenderer } from \"./MapVRenderer\";\r\n\r\nvar mapVLayer;\r\nif (typeof (Cesium) !== 'undefined') {\r\n    var defIndex = 0;\r\n    var r = Cesium;\r\n    class MapVLayer {\r\n        /**\r\n         *Creates an instance of MapVLayer.\r\n         * @param {*} viewer\r\n         * @param {*} dataset\r\n         * @param {*} options\r\n         * @param {*} container default viewer.container\r\n         * @memberof MapVLayer\r\n         */\r\n        constructor(viewer, dataset, options, container) {\r\n            this.map = viewer,\r\n                this.scene = viewer.scene,\r\n                this.mapvBaseLayer = new MapVRenderer(viewer, dataset, options, this),\r\n                this.mapVOptions = options,\r\n                this.initDevicePixelRatio(),\r\n                this.canvas = this._createCanvas(),\r\n                this.render = this.render.bind(this);\r\n            if (container) {\r\n                this.container = container;\r\n            } else {\r\n                const inner = viewer.container.querySelector('.cesium-viewer-cesiumWidgetContainer')\r\n                this.container = inner ? inner : viewer.container;\r\n            }\r\n            this.addInnerContainer();\r\n\r\n            // void 0 != container ? (this.container = container,\r\n            //     container.appendChild(this.canvas)) : (this.container = viewer.container,\r\n            //         this.addInnerContainer()),\r\n            this.bindEvent();\r\n            this._reset();\r\n        }\r\n        initDevicePixelRatio() {\r\n            this.devicePixelRatio = window.devicePixelRatio || 1\r\n        }\r\n        addInnerContainer() {\r\n            this.container.appendChild(this.canvas)\r\n        }\r\n        bindEvent() {\r\n            var that = this;\r\n\r\n            this.innerMoveStart = this.moveStartEvent.bind(this);\r\n            this.innerMoveEnd = this.moveEndEvent.bind(this);\r\n            this.scene.camera.moveStart.addEventListener(this.innerMoveStart, this);\r\n            this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd, this);\r\n\r\n            var t = new Cesium.ScreenSpaceEventHandler(this.scene.canvas);\r\n\r\n            t.setInputAction(function (t) {\r\n                that.innerMoveEnd()\r\n            }, Cesium.ScreenSpaceEventType.LEFT_UP);\r\n            t.setInputAction(function (t) {\r\n                that.innerMoveEnd()\r\n            }, Cesium.ScreenSpaceEventType.MIDDLE_UP);\r\n            this.handler = t;\r\n        }\r\n        unbindEvent() {\r\n            this.scene.camera.moveStart.removeEventListener(this.innerMoveStart, this);\r\n            this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd, this);\r\n            this.scene.postRender.removeEventListener(this._reset, this);\r\n            this.handler && (this.handler.destroy(), this.handler = null)\r\n        }\r\n        moveStartEvent() {\r\n            if (this.mapvBaseLayer) {\r\n                this.mapvBaseLayer.animatorMovestartEvent();\r\n                this.scene.postRender.addEventListener(this._reset, this);\r\n            }\r\n        }\r\n        moveEndEvent() {\r\n            if (this.mapvBaseLayer) {\r\n                this.scene.postRender.removeEventListener(this._reset, this),\r\n                    this.mapvBaseLayer.animatorMoveendEvent();\r\n                this._reset();\r\n            }\r\n        }\r\n        zoomStartEvent() {\r\n            this._unvisiable()\r\n        }\r\n        zoomEndEvent() {\r\n            this._unvisiable()\r\n        }\r\n        addData(t, e) {\r\n            void 0 != this.mapvBaseLayer && this.mapvBaseLayer.addData(t, e)\r\n        }\r\n        updateData(t, e) {\r\n            void 0 != this.mapvBaseLayer && this.mapvBaseLayer.updateData(t, e)\r\n        }\r\n        getData() {\r\n            return this.mapvBaseLayer && (this.dataSet = this.mapvBaseLayer.getData()),\r\n                this.dataSet\r\n        }\r\n        removeData(t) {\r\n            void 0 != this.mapvBaseLayer && this.mapvBaseLayer && this.mapvBaseLayer.removeData(t)\r\n        }\r\n        removeAllData() {\r\n            void 0 != this.mapvBaseLayer && this.mapvBaseLayer.clearData()\r\n        }\r\n        _visiable() {\r\n            return this.canvas.style.display = \"block\",\r\n                this\r\n        }\r\n        _unvisiable() {\r\n            return this.canvas.style.display = \"none\",\r\n                this\r\n        }\r\n        _createCanvas() {\r\n            var t = document.createElement(\"canvas\");\r\n            t.id = this.mapVOptions.layerid || \"mapv\" + defIndex++ ,\r\n                t.style.position = \"absolute\",\r\n                t.style.top = \"0px\",\r\n                t.style.left = \"0px\",\r\n                t.style.pointerEvents = \"none\",\r\n                t.style.zIndex = this.mapVOptions.zIndex || 0,\r\n                t.width = parseInt(this.map.canvas.width),\r\n                t.height = parseInt(this.map.canvas.height),\r\n                t.style.width = this.map.canvas.style.width,\r\n                t.style.height = this.map.canvas.style.height;\r\n            var e = this.devicePixelRatio;\r\n            return \"2d\" == this.mapVOptions.context && t.getContext(this.mapVOptions.context).scale(e, e),\r\n                t\r\n        }\r\n        _reset() {\r\n            this.resizeCanvas();\r\n            this.fixPosition();\r\n            this.onResize();\r\n            this.render();\r\n        }\r\n        draw() {\r\n            this._reset()\r\n        }\r\n        show() {\r\n            this._visiable()\r\n        }\r\n        hide() {\r\n            this._unvisiable()\r\n        }\r\n        destroy() {\r\n            this.remove()\r\n        }\r\n        remove() {\r\n            void 0 != this.mapvBaseLayer && (this.removeAllData(),\r\n                this.mapvBaseLayer.clear(this.mapvBaseLayer.getContext()),\r\n                this.mapvBaseLayer = void 0,\r\n                this.canvas.parentElement.removeChild(this.canvas))\r\n        }\r\n        update(t) {\r\n            void 0 != t && this.updateData(t.data, t.options)\r\n        }\r\n        resizeCanvas() {\r\n            if (void 0 != this.canvas && null != this.canvas) {\r\n                var t = this.canvas;\r\n                t.style.position = \"absolute\",\r\n                    t.style.top = \"0px\",\r\n                    t.style.left = \"0px\",\r\n                    t.width = parseInt(this.map.canvas.width),\r\n                    t.height = parseInt(this.map.canvas.height),\r\n                    t.style.width = this.map.canvas.style.width,\r\n                    t.style.height = this.map.canvas.style.height\r\n            }\r\n        }\r\n        fixPosition() { }\r\n        onResize() { }\r\n        render() {\r\n            void 0 != this.mapvBaseLayer && this.mapvBaseLayer._canvasUpdate()\r\n        }\r\n    }\r\n    mapVLayer = function (viewer, dataSet, mapVOptions, container) {\r\n        return new MapVLayer(viewer, dataSet, mapVOptions, container);\r\n    };\r\n}\r\n\r\nexport default mapVLayer;","/**\n * GeoJSON解析模块\n * @author kyle / http://nikai.us/\n */\n\nimport DataSet from \"./DataSet\";\n\n// 定义GeoJSON几何类型接口\ninterface Geometry {\n    type: string;\n    coordinates: number[] | number[][] | number[][][];\n    [key: string]: any;\n}\n\n// 定义GeoJSON属性接口\ninterface Properties {\n    [key: string]: any;\n}\n\n// 定义GeoJSON要素接口\ninterface Feature {\n    type: string;\n    geometry: Geometry;\n    properties: Properties;\n    [key: string]: any;\n}\n\n// 定义GeoJSON对象接口\ninterface GeoJSON {\n    type: string;\n    features: Feature[];\n    [key: string]: any;\n}\n\n// 定义转换后的数据项接口\ninterface DataItem {\n    geometry: Geometry;\n    [key: string]: any;\n}\n\nexport default {\n    /**\n     * 将GeoJSON对象转换为DataSet对象\n     * @param geoJson GeoJSON对象\n     * @returns DataSet对象\n     */\n    getDataSet: function (geoJson: GeoJSON): DataSet {\n        const data: DataItem[] = [];\n        const features = geoJson.features;\n        \n        // 遍历GeoJSON要素\n        if (features) {\n            for (let i = 0; i < features.length; i++) {\n                const feature = features[i];\n                const geometry = feature.geometry;\n                const properties = feature.properties;\n                const item: DataItem = {\n                    geometry: geometry\n                };\n                \n                // 复制属性\n                for (const key in properties) {\n                    item[key] = properties[key];\n                }\n                \n                data.push(item);\n            }\n        }\n        \n        // 创建并返回DataSet对象\n        return new DataSet(data);\n    }\n};","/**\n * CSV解析模块\n * @author kyle / http://nikai.us/\n */\n\nimport DataSet from \"./DataSet\";\n\n// 定义CSV解析结果接口\ntype CSVArray = string[][];\n\n// 定义CSV数据项接口\ninterface CSVDataItem {\n    [key: string]: any;\n}\n\nexport default {\n    /**\n     * 将CSV字符串转换为二维数组\n     * @param strData CSV字符串\n     * @param strDelimiter 分隔符，默认为逗号\n     * @returns 解析后的二维数组\n     */\n    CSVToArray: function(strData: string, strDelimiter?: string): CSVArray {\n        // 检查分隔符是否定义，默认使用逗号\n        strDelimiter = (strDelimiter || \",\");\n\n        // 创建正则表达式来解析CSV值\n        const objPattern = new RegExp(\n            (\n                // 分隔符\n                \"(\\\"\" + strDelimiter + \"|\\\\r?\\\\n|\\\\r|^)\" +\n\n                // 带引号的字段\n                \"(?:\\\"([^\\\"]*(?:\\\"\\\"[^\\\"]*)*)\\\"|\" +\n\n                // 标准字段\n                \"([^\\\"\\\"\" + strDelimiter + \"\\\\r\\\\n]*))\"\n            ),\n            \"gi\"\n        );\n\n        // 创建数组来保存数据，默认添加一个空的第一行\n        const arrData: CSVArray = [[]];\n\n        // 创建数组来保存单个模式匹配组\n        let arrMatches: RegExpExecArray | null = null;\n\n        // 循环匹配正则表达式，直到找不到匹配项\n        while ((arrMatches = objPattern.exec(strData)) !== null) {\n            // 获取找到的分隔符\n            const strMatchedDelimiter = arrMatches[1];\n\n            // 检查分隔符是否有长度（不是字符串开头）并且是否匹配字段分隔符\n            // 如果不匹配，则表示这是行分隔符\n            if (\n                strMatchedDelimiter.length &&\n                strMatchedDelimiter !== strDelimiter\n            ) {\n                // 由于我们已经到达新的数据行，向数据数组添加一个空行\n                arrData.push([]);\n            }\n\n            let strMatchedValue: string;\n\n            // 检查捕获的是哪种值（带引号或不带引号）\n            if (arrMatches[2]) {\n                // 找到带引号的值，移除转义的双引号\n                strMatchedValue = arrMatches[2].replace(\n                    new RegExp(\"\\\"\\\"\", \"g\"),\n                    \"\\\"\"\n                );\n            } else {\n                // 找到不带引号的值\n                strMatchedValue = arrMatches[3];\n            }\n\n            // 将值添加到数据数组\n            arrData[arrData.length - 1].push(strMatchedValue);\n        }\n\n        // 返回解析后的数据\n        return arrData;\n    },\n\n    /**\n     * 将CSV字符串转换为DataSet对象\n     * @param csvStr CSV字符串\n     * @param split 分隔符，默认为逗号\n     * @returns DataSet对象\n     */\n    getDataSet: function (csvStr: string, split?: string): DataSet {\n        // 解析CSV字符串为二维数组\n        const arr = this.CSVToArray(csvStr, split || ',');\n\n        const data: CSVDataItem[] = [];\n\n        // 获取表头\n        const header = arr[0];\n\n        // 遍历数据行，跳过表头和最后一行（可能为空）\n        for (let i = 1; i < arr.length - 1; i++) {\n            const line = arr[i];\n            const item: CSVDataItem = {};\n            \n            // 遍历每个字段\n            for (let j = 0; j < line.length; j++) {\n                let value = line[j];\n                \n                // 如果字段名是'geometry'，则解析为JSON对象\n                if (header[j] === 'geometry') {\n                    value = JSON.parse(value);\n                }\n                \n                item[header[j]] = value;\n            }\n            \n            data.push(item);\n        }\n\n        // 创建并返回DataSet对象\n        return new DataSet(data);\n    }\n};"],"names":["version","clear","context","resolutionScale$1","devicePixelRatio","Event","event","callback","subscribers","i","params","senderId","len","subscriber","obj","citycenter","getCenter","g","coords","getProvinceNameByCityName","name","provinces","provinceName","cities","j","getCenterByCityName","cityCenter","DataSet$1","data","options","timeStr","args","newData","cbk","condition","flag","key","transferFn","fromColumn","toColumnName","geometry","coordinates","newLineCoordinates","newPolygonCoordinates","newMultiPolygonCoordinates","polygon","newPolygon","newCoordinates","c","coordinate","newcoordinate","item","center","columnName","max","value","sum","min","maps","result","count","order","a","b","aVal","bVal","page","pageSize","start","end","groups","predicate","mapper","hex_corner","size","angle_deg","angle_rad","draw","x","y","pathSimple","dataSet","DataSet","type","symbol","drawHoneycomb","lineString","imageOptions","imageUrl","img","width","height","gradient","drawSimple","lastItem","Canvas","canvas","Intensity","maxSize","minSize","lineGradient","imageData","normalizedValue","index","theme","themes","paletteCtx","maxLabel","minLabel","midLabel","createCircle","shadowBlur","r2","offsetDistance","circle","colorize","pixels","getMax","getMin","diff","range","jMin","jMax","maxOpacity","minOpacity","drawGray","intensity","circleHalfWidth","circleHalfHeight","dataOrderByAlpha","alpha","_data","pointCoordinates","strength","shadowCanvas","shadowContext","colored","drawHeatmap","drawGrid","grids","enableCluster","offset","gridKey","text","textWidth","r","dx","dy","binsById","py","pj","px","pi","py1","px1","pi2","pj2","px2","py2","id","bin","createShader","gl","src","shader","initShaders","vs_source","fs_source","vertexShader","fragmentShader","glProgram","getColorData","color","tmpCanvas","tmpCtx","vs_s","fs_s","program","halfCanvasWidth","halfCanvasHeight","vertexBuffer","a_Position","uFragColor","_geometry","verticesData","vertices","line","a_PointSize","n","point","earcut","holeIndices","dim","hasHoles","outerLen","outerNode","linkedList","triangles","minX","minY","maxX","maxY","eliminateHoles","earcutLinked","clockwise","last","signedArea","insertNode","equals","removeNode","filterPoints","p","again","area","ear","pass","indexCurve","stop","prev","next","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","minZ","zOrder","maxZ","intersects","locallyInside","isValidDiagonal","splitPolygon","queue","list","getLeftmost","compareX","eliminateHole","hole","findHoleBridge","hx","hy","qx","m","mx","my","tanMin","tan","sortLinked","q","e","tail","numMerges","pSize","qSize","inSize","leftmost","ax","ay","bx","by","cx","cy","intersectsPolygon","middleInside","p1","p2","q1","q2","inside","a2","Node","b2","an","bp","polygonArea","trianglesArea","holeIndex","d","verticesArr","trianglesArr","indexOffset","flatten","webglDrawSimple","getCurveByTwoPoints","obj1","obj2","B1","B2","B3","curveCoordinates","pointCount","inc","lat1","lat2","lng1","lng2","adjustedLng1","adjustedLng2","t","h","h2","lat3","lng3","t2","lng1_src","lng2_src","getCurvePoints","points","curvePoints","curve","ForceEdgeBundling","data_nodes","data_edges","compatibility_list_for_edge","subdivision_points_for_edge","K","S_initial","P_initial","P_rate","C","I_initial","I_rate","compatibility_threshold","eps","vector_dot_product","edge_as_vector","P","edge_length","custom_edge_length","edge_midpoint","middle_x","middle_y","compute_divided_edge_length","e_idx","length","segment_length","euclidean_distance","project_point_on_line","Q","L","initialize_edge_subdivisions","initialize_compatibility_lists","filter_self_loops","edgelist","filtered_edge_list","apply_spring_force","kP","crnt","apply_electrostatic_force","S","sum_of_forces","compatible_edges_list","oe","force","apply_resulting_forces_on_subdivision_points","resulting_forces_for_subdivision_points","resulting_force","spring_force","electrostatic_force","update_edge_divisions","divided_edge_length","current_segment_length","new_subdivision_points","old_segment_length","percent_position","new_subdivision_point_x","new_subdivision_point_y","angle_compatibility","scale_compatibility","lavg","position_compatibility","midP","midQ","edge_visibility","I0","I1","midI","visibility_compatibility","compatibility_score","are_compatible","compute_compatibility_lists","forcebundle","I","cycle","iteration","forces","edge","nl","ll","k","step","Category","splitList","colors","dataCount","uniqueValues","colorArray","container","html","Choropleth","rule","startCondition","endCondition","splitNum","maxNum","ranges","label","MapHelper","opt","zoom","map","datas","CanvasLayer","global","BMap","pane","that","self","pixel","zIndex","TWEEN","_tweens","tween","time","preserve","object","_object","_valuesStart","_valuesEnd","_valuesStartRepeat","_duration","_repeat","_repeatDelayTime","_yoyo","_isPlaying","_delayTime","_startTime","_easingFunction","_interpolationFunction","_chainedTweens","_onStartCallback","_onStartCallbackFired","_onUpdateCallback","_onCompleteCallback","_onStopCallback","properties","duration","property","numChainedTweens","amount","times","yoyo","easing","interpolation","numArgs","elapsed","parsedEnd","endValue","tmp","endVal","s","v","f","fn","pw","bn","p0","fc","p3","v0","v1","t3","getAngle","diff_x","diff_y","deg","imageCache","imageCacheKey","directionImage","image","preCoordinate","interval","getDistance","angle","coordinateA","coordinateB","drawClip","imageMap","stacks","drawCluster","labelOptions","_ref","iconOptions","drawPoint","iconWidth","iconHeight","iconOffset","url","drawLabel","getImage","fun","urlValue","fontSize","textX","metrics","fontHeight","textY","fontColor","font","padding","backgroundColor","borderColor","borderWidth","textHeight","labelWidth","labelHeight","parsePosition","total","defaultValue","top","left","bottom","labelX","labelY","fallback","drawText","rects","textKey","rect","hasOverlay","overlay","isRectOverlay","rect1","rect2","minx","miny","maxx","maxy","drawIcon","icon","drawItem","iconUrl","centerX","centerY","sortKD","ids","nodeSize","right","depth","select","z","sd","newLeft","newRight","swapItem","swap","arr","stack","axis","nextAxis","within","qy","sqDist","defaultGetX","defaultGetY","KDBush","getX","getY","ArrayType","IndexArrayType","defaultOptions","props","Supercluster","extend","ref","log","minZoom","maxZoom","timerId","clusters","createPointCluster","now","bbox","minLng","minLat","maxLng","maxLat","easternHem","westernHem","tree","lngX","latY","getClusterJSON","clusterId","originId","originZoom","errorMsg","origin","children","limit","leaves","z2","extent","radius","tile","expansionZoom","skipped","child","i$1","isCluster","getClusterProperties","reduce","minPoints","neighborIds","numPointsOrigin","numPoints","neighborId","wx","wy","clusterProperties","i$2","list$1","neighborId$1","b$1","numPoints2","createCluster","i$3","list$2","neighborId$2","b$2","clone","original","cluster","xLng","yLat","abbrev","lng","lat","sin","y2","dest","BaseLayer","processedDataSet","legend","styleType","animationOptions","nwPixel","drawArrow","ctx","conf","bounds","filter","filteredData","dataItem","isDraw","_options","redraw","geojson","headers","csv","row","header","animate","AnimationLayer","canvasLayer","mapType","projection","mc","mcCenter","zoomUnit","nwMc","dataGetOptions","hasCalcAnimateLoopFrequency","fillStyle","strokeStyle","prevAnimateLoopFrequency","animateTime","stayTime","timesTimer","timer","scale","trails","ne","sw","clusterData","boundsArray","opacity","opt_options","simpleBindShim","thisArg","func","div","transformProps","prop","requestId","paneName","panes","opt_resizeHandler","opt_updateHandler","mapWidth","mapHeight","newWidth","newHeight","oldWidth","oldHeight","divCenter","offsetX","offsetY","canvasLayerOptions","mapProjection","latLng","worldPoint","Layer","baseLayer","base","LayerRenderer","coord","zeroZero","zeroZeroScreen","w","attributes","renderer","Layer_default","createCanvas","_pixel","_projection","mapViewProjection","resolution","pixelRatio","cursor","feature","element","layer","update","dw","dh","mapCanvas","resolutionX","resolutionY","topLeft","topLeftPX","mapVLayer","MapVLayer","mapVOptions","overlayPane","MapVRenderer","global$2","mapVLayer_default$1","viewer","dataset","option","o","defIndex","inner","mapVLayer_default","geoJson","features","strData","strDelimiter","objPattern","arrData","arrMatches","strMatchedDelimiter","strMatchedValue","csvStr","split"],"mappings":"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"}