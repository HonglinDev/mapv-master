((t,e)=>{"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.mapv=t.mapv||{})})(this,function(t){function x(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}function n(){this._subscribers={}}n.prototype.on=function(t,e){var n=this._subscribers[t];n||(this._subscribers[t]=n=[]),n.push({callback:e})},n.prototype.off=function(t,e){var n=this._subscribers[t];if(n)for(var i=0;i<n.length;i++)n[i].callback==e&&(n.splice(i,1),i--)},n.prototype._trigger=function(t,e,n){if("*"==t)throw new Error("Cannot trigger event *");var i=[];t in this._subscribers&&(i=i.concat(this._subscribers[t]));for(var o=0,a=((i="*"in this._subscribers?i.concat(this._subscribers["*"]):i).length);o<a;o++){var s=i[o];s.callback&&s.callback(t,e,n||null)}};var s={municipalities:[{n:"北京",g:"116.395645,39.929986|12"},{n:"上海",g:"121.487899,31.249162|12"},{n:"天津",g:"117.210813,39.14393|12"},{n:"重庆",g:"106.530635,29.544606|12"}],provinces:[{n:"安徽",g:"117.216005,31.859252|8",cities:[{n:"合肥",g:"117.282699,31.866942|12"},{n:"安庆",g:"117.058739,30.537898|13"},{n:"蚌埠",g:"117.35708,32.929499|13"},{n:"亳州",g:"115.787928,33.871211|13"},{n:"巢湖",g:"117.88049,31.608733|13"},{n:"池州",g:"117.494477,30.660019|14"},{n:"滁州",g:"118.32457,32.317351|13"},{n:"阜阳",g:"115.820932,32.901211|13"},{n:"淮北",g:"116.791447,33.960023|13"},{n:"淮南",g:"117.018639,32.642812|13"},{n:"黄山",g:"118.29357,29.734435|13"},{n:"六安",g:"116.505253,31.755558|13"},{n:"马鞍山",g:"118.515882,31.688528|13"},{n:"宿州",g:"116.988692,33.636772|13"},{n:"铜陵",g:"117.819429,30.94093|14"},{n:"芜湖",g:"118.384108,31.36602|12"},{n:"宣城",g:"118.752096,30.951642|13"}]},{n:"福建",g:"117.984943,26.050118|8",cities:[{n:"福州",g:"119.330221,26.047125|12"},{n:"龙岩",g:"117.017997,25.078685|13"},{n:"南平",g:"118.181883,26.643626|13"},{n:"宁德",g:"119.542082,26.656527|14"},{n:"莆田",g:"119.077731,25.44845|13"},{n:"泉州",g:"118.600362,24.901652|12"},{n:"三明",g:"117.642194,26.270835|14"},{n:"厦门",g:"118.103886,24.489231|12"},{n:"漳州",g:"117.676205,24.517065|12"}]},{n:"甘肃",g:"102.457625,38.103267|6",cities:[{n:"兰州",g:"103.823305,36.064226|12"},{n:"白银",g:"104.171241,36.546682|13"},{n:"定西",g:"104.626638,35.586056|13"},{n:"甘南州",g:"102.917442,34.992211|14"},{n:"嘉峪关",g:"98.281635,39.802397|13"},{n:"金昌",g:"102.208126,38.516072|13"},{n:"酒泉",g:"98.508415,39.741474|13"},{n:"临夏州",g:"103.215249,35.598514|13"},{n:"陇南",g:"104.934573,33.39448|14"},{n:"平凉",g:"106.688911,35.55011|13"},{n:"庆阳",g:"107.644227,35.726801|13"},{n:"天水",g:"105.736932,34.584319|13"},{n:"武威",g:"102.640147,37.933172|13"},{n:"张掖",g:"100.459892,38.93932|13"}]},{n:"广东",g:"113.394818,23.408004|8",cities:[{n:"广州",g:"113.30765,23.120049|12"},{n:"潮州",g:"116.630076,23.661812|13"},{n:"东莞",g:"113.763434,23.043024|12"},{n:"佛山",g:"113.134026,23.035095|13"},{n:"河源",g:"114.713721,23.757251|12"},{n:"惠州",g:"114.410658,23.11354|12"},{n:"江门",g:"113.078125,22.575117|13"},{n:"揭阳",g:"116.379501,23.547999|13"},{n:"茂名",g:"110.931245,21.668226|13"},{n:"梅州",g:"116.126403,24.304571|13"},{n:"清远",g:"113.040773,23.698469|13"},{n:"汕头",g:"116.72865,23.383908|13"},{n:"汕尾",g:"115.372924,22.778731|14"},{n:"韶关",g:"113.594461,24.80296|13"},{n:"深圳",g:"114.025974,22.546054|12"},{n:"阳江",g:"111.97701,21.871517|14"},{n:"云浮",g:"112.050946,22.937976|13"},{n:"湛江",g:"110.365067,21.257463|13"},{n:"肇庆",g:"112.479653,23.078663|13"},{n:"中山",g:"113.42206,22.545178|12"},{n:"珠海",g:"113.562447,22.256915|13"}]},{n:"广西",g:"108.924274,23.552255|7",cities:[{n:"南宁",g:"108.297234,22.806493|12"},{n:"百色",g:"106.631821,23.901512|13"},{n:"北海",g:"109.122628,21.472718|13"},{n:"崇左",g:"107.357322,22.415455|14"},{n:"防城港",g:"108.351791,21.617398|15"},{n:"桂林",g:"110.26092,25.262901|12"},{n:"贵港",g:"109.613708,23.103373|13"},{n:"河池",g:"108.069948,24.699521|14"},{n:"贺州",g:"111.552594,24.411054|14"},{n:"来宾",g:"109.231817,23.741166|14"},{n:"柳州",g:"109.422402,24.329053|12"},{n:"钦州",g:"108.638798,21.97335|13"},{n:"梧州",g:"111.305472,23.485395|13"},{n:"玉林",g:"110.151676,22.643974|14"}]},{n:"贵州",g:"106.734996,26.902826|8",cities:[{n:"贵阳",g:"106.709177,26.629907|12"},{n:"安顺",g:"105.92827,26.228595|13"},{n:"毕节地区",g:"105.300492,27.302612|14"},{n:"六盘水",g:"104.852087,26.591866|13"},{n:"铜仁地区",g:"109.196161,27.726271|14"},{n:"遵义",g:"106.93126,27.699961|13"},{n:"黔西南州",g:"104.900558,25.095148|11"},{n:"黔东南州",g:"107.985353,26.583992|11"},{n:"黔南州",g:"107.523205,26.264536|11"}]},{n:"海南",g:"109.733755,19.180501|9",cities:[{n:"海口",g:"110.330802,20.022071|13"},{n:"白沙",g:"109.358586,19.216056|12"},{n:"保亭",g:"109.656113,18.597592|12"},{n:"昌江",g:"109.0113,19.222483|12"},{n:"儋州",g:"109.413973,19.571153|13"},{n:"澄迈",g:"109.996736,19.693135|13"},{n:"东方",g:"108.85101,18.998161|13"},{n:"定安",g:"110.32009,19.490991|13"},{n:"琼海",g:"110.414359,19.21483|13"},{n:"琼中",g:"109.861849,19.039771|12"},{n:"乐东",g:"109.062698,18.658614|12"},{n:"临高",g:"109.724101,19.805922|13"},{n:"陵水",g:"109.948661,18.575985|12"},{n:"三亚",g:"109.522771,18.257776|12"},{n:"屯昌",g:"110.063364,19.347749|13"},{n:"万宁",g:"110.292505,18.839886|13"},{n:"文昌",g:"110.780909,19.750947|13"},{n:"五指山",g:"109.51775,18.831306|13"}]},{n:"河北",g:"115.661434,38.61384|7",cities:[{n:"石家庄",g:"114.522082,38.048958|12"},{n:"保定",g:"115.49481,38.886565|13"},{n:"沧州",g:"116.863806,38.297615|13"},{n:"承德",g:"117.933822,40.992521|14"},{n:"邯郸",g:"114.482694,36.609308|13"},{n:"衡水",g:"115.686229,37.746929|13"},{n:"廊坊",g:"116.703602,39.518611|13"},{n:"秦皇岛",g:"119.604368,39.945462|12"},{n:"唐山",g:"118.183451,39.650531|13"},{n:"邢台",g:"114.520487,37.069531|13"},{n:"张家口",g:"114.893782,40.811188|13"}]},{n:"河南",g:"113.486804,34.157184|7",cities:[{n:"郑州",g:"113.649644,34.75661|12"},{n:"安阳",g:"114.351807,36.110267|12"},{n:"鹤壁",g:"114.29777,35.755426|13"},{n:"焦作",g:"113.211836,35.234608|13"},{n:"开封",g:"114.351642,34.801854|13"},{n:"洛阳",g:"112.447525,34.657368|12"},{n:"漯河",g:"114.046061,33.576279|13"},{n:"南阳",g:"112.542842,33.01142|13"},{n:"平顶山",g:"113.300849,33.745301|13"},{n:"濮阳",g:"115.026627,35.753298|12"},{n:"三门峡",g:"111.181262,34.78332|13"},{n:"商丘",g:"115.641886,34.438589|13"},{n:"新乡",g:"113.91269,35.307258|13"},{n:"信阳",g:"114.085491,32.128582|13"},{n:"许昌",g:"113.835312,34.02674|13"},{n:"周口",g:"114.654102,33.623741|13"},{n:"驻马店",g:"114.049154,32.983158|13"}]},{n:"黑龙江",g:"128.047414,47.356592|6",cities:[{n:"哈尔滨",g:"126.657717,45.773225|12"},{n:"大庆",g:"125.02184,46.596709|12"},{n:"大兴安岭地区",g:"124.196104,51.991789|10"},{n:"鹤岗",g:"130.292472,47.338666|13"},{n:"黑河",g:"127.50083,50.25069|14"},{n:"鸡西",g:"130.941767,45.32154|13"},{n:"佳木斯",g:"130.284735,46.81378|12"},{n:"牡丹江",g:"129.608035,44.588521|13"},{n:"七台河",g:"131.019048,45.775005|14"},{n:"齐齐哈尔",g:"123.987289,47.3477|13"},{n:"双鸭山",g:"131.171402,46.655102|13"},{n:"绥化",g:"126.989095,46.646064|13"},{n:"伊春",g:"128.910766,47.734685|14"}]},{n:"湖北",g:"112.410562,31.209316|8",cities:[{n:"武汉",g:"114.3162,30.581084|12"},{n:"鄂州",g:"114.895594,30.384439|14"},{n:"恩施",g:"109.517433,30.308978|14"},{n:"黄冈",g:"114.906618,30.446109|14"},{n:"黄石",g:"115.050683,30.216127|13"},{n:"荆门",g:"112.21733,31.042611|13"},{n:"荆州",g:"112.241866,30.332591|12"},{n:"潜江",g:"112.768768,30.343116|13"},{n:"神农架林区",g:"110.487231,31.595768|13"},{n:"十堰",g:"110.801229,32.636994|13"},{n:"随州",g:"113.379358,31.717858|13"},{n:"天门",g:"113.12623,30.649047|13"},{n:"仙桃",g:"113.387448,30.293966|13"},{n:"咸宁",g:"114.300061,29.880657|13"},{n:"襄阳",g:"112.176326,32.094934|12"},{n:"孝感",g:"113.935734,30.927955|13"},{n:"宜昌",g:"111.310981,30.732758|13"}]},{n:"湖南",g:"111.720664,27.695864|7",cities:[{n:"长沙",g:"112.979353,28.213478|12"},{n:"常德",g:"111.653718,29.012149|12"},{n:"郴州",g:"113.037704,25.782264|13"},{n:"衡阳",g:"112.583819,26.898164|13"},{n:"怀化",g:"109.986959,27.557483|13"},{n:"娄底",g:"111.996396,27.741073|13"},{n:"邵阳",g:"111.461525,27.236811|13"},{n:"湘潭",g:"112.935556,27.835095|13"},{n:"湘西州",g:"109.745746,28.317951|14"},{n:"益阳",g:"112.366547,28.588088|13"},{n:"永州",g:"111.614648,26.435972|13"},{n:"岳阳",g:"113.146196,29.378007|13"},{n:"张家界",g:"110.48162,29.124889|13"},{n:"株洲",g:"113.131695,27.827433|13"}]},{n:"江苏",g:"119.368489,33.013797|8",cities:[{n:"南京",g:"118.778074,32.057236|12"},{n:"常州",g:"119.981861,31.771397|12"},{n:"淮安",g:"119.030186,33.606513|12"},{n:"连云港",g:"119.173872,34.601549|12"},{n:"南通",g:"120.873801,32.014665|12"},{n:"苏州",g:"120.619907,31.317987|12"},{n:"宿迁",g:"118.296893,33.95205|13"},{n:"泰州",g:"119.919606,32.476053|13"},{n:"无锡",g:"120.305456,31.570037|12"},{n:"徐州",g:"117.188107,34.271553|12"},{n:"盐城",g:"120.148872,33.379862|12"},{n:"扬州",g:"119.427778,32.408505|13"},{n:"镇江",g:"119.455835,32.204409|13"}]},{n:"江西",g:"115.676082,27.757258|7",cities:[{n:"南昌",g:"115.893528,28.689578|12"},{n:"抚州",g:"116.360919,27.954545|13"},{n:"赣州",g:"114.935909,25.845296|13"},{n:"吉安",g:"114.992039,27.113848|13"},{n:"景德镇",g:"117.186523,29.303563|12"},{n:"九江",g:"115.999848,29.71964|13"},{n:"萍乡",g:"113.859917,27.639544|13"},{n:"上饶",g:"117.955464,28.457623|13"},{n:"新余",g:"114.947117,27.822322|13"},{n:"宜春",g:"114.400039,27.81113|13"},{n:"鹰潭",g:"117.03545,28.24131|13"}]},{n:"吉林",g:"126.262876,43.678846|7",cities:[{n:"长春",g:"125.313642,43.898338|12"},{n:"白城",g:"122.840777,45.621086|13"},{n:"白山",g:"126.435798,41.945859|13"},{n:"吉林",g:"126.564544,43.871988|12"},{n:"辽源",g:"125.133686,42.923303|13"},{n:"四平",g:"124.391382,43.175525|12"},{n:"松原",g:"124.832995,45.136049|13"},{n:"通化",g:"125.94265,41.736397|13"},{n:"延边",g:"129.485902,42.896414|13"}]},{n:"辽宁",g:"122.753592,41.6216|8",cities:[{n:"沈阳",g:"123.432791,41.808645|12"},{n:"鞍山",g:"123.007763,41.118744|13"},{n:"本溪",g:"123.778062,41.325838|12"},{n:"朝阳",g:"120.446163,41.571828|13"},{n:"大连",g:"121.593478,38.94871|12"},{n:"丹东",g:"124.338543,40.129023|12"},{n:"抚顺",g:"123.92982,41.877304|12"},{n:"阜新",g:"121.660822,42.01925|14"},{n:"葫芦岛",g:"120.860758,40.74303|13"},{n:"锦州",g:"121.147749,41.130879|13"},{n:"辽阳",g:"123.172451,41.273339|14"},{n:"盘锦",g:"122.073228,41.141248|13"},{n:"铁岭",g:"123.85485,42.299757|13"},{n:"营口",g:"122.233391,40.668651|13"}]},{n:"内蒙古",g:"114.415868,43.468238|5",cities:[{n:"呼和浩特",g:"111.660351,40.828319|12"},{n:"阿拉善盟",g:"105.695683,38.843075|14"},{n:"包头",g:"109.846239,40.647119|12"},{n:"巴彦淖尔",g:"107.423807,40.76918|12"},{n:"赤峰",g:"118.930761,42.297112|12"},{n:"鄂尔多斯",g:"109.993706,39.81649|12"},{n:"呼伦贝尔",g:"119.760822,49.201636|12"},{n:"通辽",g:"122.260363,43.633756|12"},{n:"乌海",g:"106.831999,39.683177|13"},{n:"乌兰察布",g:"113.112846,41.022363|12"},{n:"锡林郭勒盟",g:"116.02734,43.939705|11"},{n:"兴安盟",g:"122.048167,46.083757|11"}]},{n:"宁夏",g:"106.155481,37.321323|8",cities:[{n:"银川",g:"106.206479,38.502621|12"},{n:"固原",g:"106.285268,36.021523|13"},{n:"石嘴山",g:"106.379337,39.020223|13"},{n:"吴忠",g:"106.208254,37.993561|14"},{n:"中卫",g:"105.196754,37.521124|14"}]},{n:"青海",g:"96.202544,35.499761|7",cities:[{n:"西宁",g:"101.767921,36.640739|12"},{n:"果洛州",g:"100.223723,34.480485|11"},{n:"海东地区",g:"102.085207,36.51761|11"},{n:"海北州",g:"100.879802,36.960654|11"},{n:"海南州",g:"100.624066,36.284364|11"},{n:"海西州",g:"97.342625,37.373799|11"},{n:"黄南州",g:"102.0076,35.522852|11"},{n:"玉树州",g:"97.013316,33.00624|14"}]},{n:"山东",g:"118.527663,36.09929|8",cities:[{n:"济南",g:"117.024967,36.682785|12"},{n:"滨州",g:"117.968292,37.405314|12"},{n:"东营",g:"118.583926,37.487121|12"},{n:"德州",g:"116.328161,37.460826|12"},{n:"菏泽",g:"115.46336,35.26244|13"},{n:"济宁",g:"116.600798,35.402122|13"},{n:"莱芜",g:"117.684667,36.233654|13"},{n:"聊城",g:"115.986869,36.455829|12"},{n:"临沂",g:"118.340768,35.072409|12"},{n:"青岛",g:"120.384428,36.105215|12"},{n:"日照",g:"119.50718,35.420225|12"},{n:"泰安",g:"117.089415,36.188078|13"},{n:"威海",g:"122.093958,37.528787|13"},{n:"潍坊",g:"119.142634,36.716115|12"},{n:"烟台",g:"121.309555,37.536562|12"},{n:"枣庄",g:"117.279305,34.807883|13"},{n:"淄博",g:"118.059134,36.804685|12"}]},{n:"山西",g:"112.515496,37.866566|7",cities:[{n:"太原",g:"112.550864,37.890277|12"},{n:"长治",g:"113.120292,36.201664|12"},{n:"大同",g:"113.290509,40.113744|12"},{n:"晋城",g:"112.867333,35.499834|13"},{n:"晋中",g:"112.738514,37.693362|13"},{n:"临汾",g:"111.538788,36.099745|13"},{n:"吕梁",g:"111.143157,37.527316|14"},{n:"朔州",g:"112.479928,39.337672|13"},{n:"忻州",g:"112.727939,38.461031|12"},{n:"阳泉",g:"113.569238,37.869529|13"},{n:"运城",g:"111.006854,35.038859|13"}]},{n:"陕西",g:"109.503789,35.860026|7",cities:[{n:"西安",g:"108.953098,34.2778|12"},{n:"安康",g:"109.038045,32.70437|13"},{n:"宝鸡",g:"107.170645,34.364081|12"},{n:"汉中",g:"107.045478,33.081569|13"},{n:"商洛",g:"109.934208,33.873907|13"},{n:"铜川",g:"108.968067,34.908368|13"},{n:"渭南",g:"109.483933,34.502358|13"},{n:"咸阳",g:"108.707509,34.345373|13"},{n:"延安",g:"109.50051,36.60332|13"},{n:"榆林",g:"109.745926,38.279439|12"}]},{n:"四川",g:"102.89916,30.367481|7",cities:[{n:"成都",g:"104.067923,30.679943|12"},{n:"阿坝州",g:"102.228565,31.905763|15"},{n:"巴中",g:"106.757916,31.869189|14"},{n:"达州",g:"107.494973,31.214199|14"},{n:"德阳",g:"104.402398,31.13114|13"},{n:"甘孜州",g:"101.969232,30.055144|15"},{n:"广安",g:"106.63572,30.463984|13"},{n:"广元",g:"105.819687,32.44104|13"},{n:"乐山",g:"103.760824,29.600958|13"},{n:"凉山州",g:"102.259591,27.892393|14"},{n:"泸州",g:"105.44397,28.89593|14"},{n:"南充",g:"106.105554,30.800965|13"},{n:"眉山",g:"103.84143,30.061115|13"},{n:"绵阳",g:"104.705519,31.504701|12"},{n:"内江",g:"105.073056,29.599462|13"},{n:"攀枝花",g:"101.722423,26.587571|14"},{n:"遂宁",g:"105.564888,30.557491|12"},{n:"雅安",g:"103.009356,29.999716|13"},{n:"宜宾",g:"104.633019,28.769675|13"},{n:"资阳",g:"104.63593,30.132191|13"},{n:"自贡",g:"104.776071,29.359157|13"}]},{n:"西藏",g:"89.137982,31.367315|6",cities:[{n:"拉萨",g:"91.111891,29.662557|13"},{n:"阿里地区",g:"81.107669,30.404557|11"},{n:"昌都地区",g:"97.185582,31.140576|15"},{n:"林芝地区",g:"94.349985,29.666941|11"},{n:"那曲地区",g:"92.067018,31.48068|14"},{n:"日喀则地区",g:"88.891486,29.269023|14"},{n:"山南地区",g:"91.750644,29.229027|11"}]},{n:"新疆",g:"85.614899,42.127001|6",cities:[{n:"乌鲁木齐",g:"87.564988,43.84038|12"},{n:"阿拉尔",g:"81.291737,40.61568|13"},{n:"阿克苏地区",g:"80.269846,41.171731|12"},{n:"阿勒泰地区",g:"88.137915,47.839744|13"},{n:"巴音郭楞",g:"86.121688,41.771362|12"},{n:"博尔塔拉州",g:"82.052436,44.913651|11"},{n:"昌吉州",g:"87.296038,44.007058|13"},{n:"哈密地区",g:"93.528355,42.858596|13"},{n:"和田地区",g:"79.930239,37.116774|13"},{n:"喀什地区",g:"75.992973,39.470627|12"},{n:"克拉玛依",g:"84.88118,45.594331|13"},{n:"克孜勒苏州",g:"76.137564,39.750346|11"},{n:"石河子",g:"86.041865,44.308259|13"},{n:"塔城地区",g:"82.974881,46.758684|12"},{n:"图木舒克",g:"79.198155,39.889223|13"},{n:"吐鲁番地区",g:"89.181595,42.96047|13"},{n:"五家渠",g:"87.565449,44.368899|13"},{n:"伊犁州",g:"81.297854,43.922248|11"}]},{n:"云南",g:"101.592952,24.864213|7",cities:[{n:"昆明",g:"102.714601,25.049153|12"},{n:"保山",g:"99.177996,25.120489|13"},{n:"楚雄州",g:"101.529382,25.066356|13"},{n:"大理州",g:"100.223675,25.5969|14"},{n:"德宏州",g:"98.589434,24.44124|14"},{n:"迪庆州",g:"99.713682,27.831029|14"},{n:"红河州",g:"103.384065,23.367718|11"},{n:"丽江",g:"100.229628,26.875351|13"},{n:"临沧",g:"100.092613,23.887806|14"},{n:"怒江州",g:"98.859932,25.860677|14"},{n:"普洱",g:"100.980058,22.788778|14"},{n:"曲靖",g:"103.782539,25.520758|12"},{n:"昭通",g:"103.725021,27.340633|13"},{n:"文山",g:"104.089112,23.401781|14"},{n:"西双版纳",g:"100.803038,22.009433|13"},{n:"玉溪",g:"102.545068,24.370447|13"}]},{n:"浙江",g:"119.957202,29.159494|8",cities:[{n:"杭州",g:"120.219375,30.259244|12"},{n:"湖州",g:"120.137243,30.877925|12"},{n:"嘉兴",g:"120.760428,30.773992|13"},{n:"金华",g:"119.652576,29.102899|12"},{n:"丽水",g:"119.929576,28.4563|13"},{n:"宁波",g:"121.579006,29.885259|12"},{n:"衢州",g:"118.875842,28.95691|12"},{n:"绍兴",g:"120.592467,30.002365|13"},{n:"台州",g:"121.440613,28.668283|13"},{n:"温州",g:"120.690635,28.002838|12"},{n:"舟山",g:"122.169872,30.03601|13"}]}],other:[{n:"香港",g:"114.186124,22.293586|11"},{n:"澳门",g:"113.557519,22.204118|13"},{n:"台湾",g:"120.961454,23.80406|8"}]};function F(t){t=t.split("|");return t[0]=t[0].split(","),{lng:parseFloat(t[0][0]),lat:parseFloat(t[0][1])}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var U={getProvinceNameByCityName:function(t){for(var e=s.provinces,n=0;n<e.length;n++)for(var i=e[n].n,o=e[n].cities,a=0;a<o.length;a++)if(o[a].n==t)return i;return null},getCenterByCityName:function(t){t=t.replace("市","");for(var e=0;e<s.municipalities.length;e++)if(s.municipalities[e].n==t)return F(s.municipalities[e].g);for(e=0;e<s.other.length;e++)if(s.other[e].n==t)return F(s.other[e].g);for(var n=s.provinces,e=0;e<n.length;e++){if(n[e].n==t)return F(n[e].g);for(var i=n[e].cities,o=0;o<i.length;o++)if(i[o].n==t)return F(i[o].g)}return null}},Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e,n){return e&&j(t.prototype,e),n&&j(t,n),t};function j(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);return void 0!==i?"value"in i?i.value:void 0!==(i=i.get)?i.call(n):void 0:null!==(i=Object.getPrototypeOf(t))?o(i,e,n):void 0}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function h(t,e){if(t)return!e||"object"!=typeof e&&"function"!=typeof e?t:e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function E(t,e){n.bind(this)(),this._options=e||{},this._data=[],t&&this.add(t)}function N(t,e,n,i){for(var o,a,s=0;s<6;s++){r={x:e,y:n},o=i,a=s,a=Math.PI/180*(60*a+30);var r=[r.x+o*Math.cos(a),r.y+o*Math.sin(a)];t.lineTo(r[0],r[1])}}(E.prototype=Object.create(n.prototype)).add=function(t,e){if(Array.isArray(t))for(var n,i=0,o=t.length;i<o;i++)t[i]&&(t[i].time&&14==t[i].time.length&&"20"==t[i].time.substr(0,2)&&(n=t[i].time,t[i].time=new Date(n.substr(0,4)+"-"+n.substr(4,2)+"-"+n.substr(6,2)+" "+n.substr(8,2)+":"+n.substr(10,2)+":"+n.substr(12,2)).getTime()),this._data.push(t[i]));else{if(!(t instanceof Object))throw new Error("Unknown dataType");this._data.push(t)}this._dataCache=JSON.parse(JSON.stringify(this._data))},E.prototype.reset=function(){this._data=JSON.parse(JSON.stringify(this._dataCache))},E.prototype.get=function(t){t=t||{};new Date;var e=this._data;new Date;if(t.filter){for(var n=[],i=0;i<e.length;i++)t.filter(e[i])&&n.push(e[i]);e=n}return e=t.transferCoordinate?this.transferCoordinate(e,t.transferCoordinate,t.fromColumn,t.toColumn):e},E.prototype.set=function(t){this._set(t),this._trigger("change")},E.prototype._set=function(t){this.clear(),this.add(t)},E.prototype.clear=function(t){this._data=[]},E.prototype.remove=function(t){},E.prototype.update=function(t,e){for(var n=this._data,i=0;i<n.length;i++)if(e){var o,a=!0;for(o in e)n[i][o]!=e[o]&&(a=!1);a&&t&&t(n[i])}else t&&t(n[i]);this._dataCache=JSON.parse(JSON.stringify(this._data)),this._trigger("change")},E.prototype.transferCoordinate=function(t,s,e,n){n=n||"_coordinates",e=e||"coordinates";for(var i=0;i<t.length;i++){var o=t[i].geometry,a=o[e];switch(o.type){case"Point":o[n]=s(a);break;case"LineString":for(var r=[],h=0;h<a.length;h++)r.push(s(a[h]));o[n]=r;break;case"MultiLineString":case"Polygon":r=c(a);o[n]=r;break;case"MultiPolygon":for(var r=[],l=0;l<a.length;l++){var u=c(a[l]);r.push(u)}o[n]=r}}function c(t){for(var e=[],n=0;n<t.length;n++){for(var i=t[n],o=[],a=0;a<i.length;a++)o.push(s(i[a]));e.push(o)}return e}return t},E.prototype.initGeometry=function(e){e?this._data.forEach(function(t){t.geometry=e(t)}):this._data.forEach(function(t){var e;t.geometry||(t.lng&&t.lat?t.geometry={type:"Point",coordinates:[t.lng,t.lat]}:t.city&&(e=U.getCenterByCityName(t.city))&&(t.geometry={type:"Point",coordinates:[e.lng,e.lat]}))})},E.prototype.getMax=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),i=1;i<e.length;i++){var o=parseFloat(e[i][t]);n<o&&(n=o)}return n}},E.prototype.getSum=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=0,i=0;i<e.length;i++)e[i][t]&&(n+=parseFloat(e[i][t]));return n}},E.prototype.getMin=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),i=1;i<e.length;i++){var o=parseFloat(e[i][t]);o<n&&(n=o)}return n}},E.prototype.getUnique=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n={},i=1;i<e.length;i++)n[e[i][t]]=!0;var o,e=[];for(o in n)e.push(o);return e}},E.prototype.getAverage=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=0,i=0,o=0;o<e.length;o++)void 0!==e[o][t]&&(n+=parseFloat(e[o][t]),i++);return 0<i?n/i:0}},E.prototype.sort=function(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"asc";this._data.sort(function(t,e){t=parseFloat(t[n]),e=parseFloat(e[n]);return"desc"===i?e-t:t-e}),this._trigger("change")},E.prototype.getPage=function(t,e){t=(t-1)*e;return this._data.slice(t,t+e)},E.prototype.getTotal=function(){return this._data.length},E.prototype.groupBy=function(n){var i={};return this._data.forEach(function(t){var e=t[n];i[e]||(i[e]=[]),i[e].push(t)}),i},E.prototype.find=function(t){for(var e=0;e<this._data.length;e++)if(t(this._data[e]))return this._data[e];return null},E.prototype.findAll=function(t){return this._data.filter(t)},E.prototype.map=function(t){return this._data.map(t)},E.prototype.filter=function(t){return this._data.filter(t)};var f={drawDataSet:function(t,e,n){for(var i=e instanceof E?e.get():e,o=0,a=i.length;o<a;o++){var s=i[o];this.draw(t,s,n)}},draw:function(t,e,n){var i=e.geometry.type,o=e.geometry._coordinates||e.geometry.coordinates,a=e.symbol||n.symbol||"circle";switch(i){case"Point":var s=e._size||e.size||n._size||n.size||5;"circle"===a?("Point"===n.bigData&&t.moveTo(o[0],o[1]),t.arc(o[0],o[1],s,0,2*Math.PI)):"rect"===a?t.rect(o[0]-s/2,o[1]-s/2,s,s):"honeycomb"===a?N(t,o[0],o[1],s):"image"===a&&this.drawImageMarker(t,e,n);break;case"LineString":this.drawLineString(t,o);break;case"MultiLineString":for(var r=0;r<o.length;r++){var h=o[r];this.drawLineString(t,h)}break;case"Polygon":this.drawPolygon(t,o);break;case"MultiPolygon":for(r=0;r<o.length;r++){var l=o[r];if(this.drawPolygon(t,l),n.multiPolygonDraw){l=n.multiPolygonDraw();if(l)return l}}break;default:console.error("type"+i+"is not support now!")}},drawImageMarker:function(n,i,o){var a,t=i.geometry._coordinates||i.geometry.coordinates,s=t[0],r=t[1],h=Object.assign({},o.image||{},i.image||{}),t=h.url;t?((a=new Image).onload=function(){var t=i._size||i.size||o._size||o.size||20,e=h.width||t,t=h.height||t;n.drawImage(a,s-e/2,r-t/2,e,t)},a.src=t):(t=i._size||i.size||o._size||o.size||5,n.arc(s,r,t,0,2*Math.PI))},drawLineString:function(t,e){for(var n=0;n<e.length;n++){var i=e[n][0],o=e[n][1];0==n?t.moveTo(i,o):t.lineTo(i,o)}},drawPolygon:function(t,e){t.beginPath();for(var n=0;n<e.length;n++){var i=e[n];t.moveTo(i[0][0],i[0][1]);for(var o=1;o<i.length;o++)t.lineTo(i[o][0],i[o][1]);t.lineTo(i[0][0],i[0][1]),t.closePath()}},drawPolygonEnhanced:function(t,e,n){t.beginPath();for(var i=0;i<e.length;i++){var o=e[i];t.moveTo(o[0][0],o[0][1]);for(var a=1;a<o.length;a++)t.lineTo(o[a][0],o[a][1]);if(t.lineTo(o[0][0],o[0][1]),t.closePath(),n.gradient){var s,r=t.createLinearGradient(o[0][0],o[0][1],(o[2]||o[0])[0],(o[2]||o[0])[1]);for(s in n.gradient)r.addColorStop(parseFloat(s),n.gradient[s]);t.fillStyle=r}}}},W={draw:function(t,e,n){var i,o=e instanceof E?e.get():e;for(i in t.save(),n)t[i]=n[i];if(n.bigData){t.save(),t.beginPath();for(var a=0,s=o.length;a<s;a++){var r=o[a];f.draw(t,r,n)}"Point"==(h=n.bigData)||"Polygon"==h||"MultiPolygon"==h?(t.fill(),t.lineDash&&t.setLineDash(t.lineDash),r.lineDash&&t.setLineDash(r.lineDash),(r.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=h&&"MultiLineString"!=h||t.stroke(),t.restore()}else for(a=0,s=o.length;a<s;a++){var r=o[a],h=(t.save(),(r.fillStyle||r._fillStyle)&&(t.fillStyle=r.fillStyle||r._fillStyle),(r.strokeStyle||r._strokeStyle)&&(t.strokeStyle=r.strokeStyle||r._strokeStyle),t.lineDash&&t.setLineDash(t.lineDash),r.lineDash&&t.setLineDash(r.lineDash),r.geometry.type);t.beginPath(),n.multiPolygonDraw=function(){t.fill(),(r.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()},f.draw(t,r,n),"Point"==h||"Polygon"==h||"MultiPolygon"==h?(t.fill(),(r.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=h&&"MultiLineString"!=h||((r.lineWidth||r._lineWidth)&&(t.lineWidth=r.lineWidth||r._lineWidth),t.stroke()),t.restore()}t.restore()},drawEnhanced:function(t,e,n){var i,o=e instanceof E?e.get():e;for(i in t.save(),n)["data","filter","transferCoordinate"].includes(i)||(t[i]=n[i]);if(n.filter&&"function"==typeof n.filter&&(o=o.filter(n.filter)),n.bigData){t.save(),t.beginPath();for(var a=0,s=o.length;a<s;a++){var r=o[a];f.draw(t,r,n)}"Point"==(h=n.bigData)||"Polygon"==h||"MultiPolygon"==h?(t.fill(),t.lineDash&&t.setLineDash(t.lineDash),r.lineDash&&t.setLineDash(r.lineDash),(r.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=h&&"MultiLineString"!=h||t.stroke(),t.restore()}else for(a=0,s=o.length;a<s;a++){var r=o[a],h=(t.save(),(r.fillStyle||r._fillStyle)&&(t.fillStyle=r.fillStyle||r._fillStyle),(r.strokeStyle||r._strokeStyle)&&(t.strokeStyle=r.strokeStyle||r._strokeStyle),(r.lineWidth||r._lineWidth)&&(t.lineWidth=r.lineWidth||r._lineWidth),t.lineDash&&t.setLineDash(t.lineDash),r.lineDash&&t.setLineDash(r.lineDash),(r.shadowBlur||n.shadowBlur)&&(t.shadowBlur=r.shadowBlur||n.shadowBlur||0),(r.shadowColor||n.shadowColor)&&(t.shadowColor=r.shadowColor||n.shadowColor||"rgba(0, 0, 0, 0)"),(r.shadowOffsetX||n.shadowOffsetX)&&(t.shadowOffsetX=r.shadowOffsetX||n.shadowOffsetX||0),(r.shadowOffsetY||n.shadowOffsetY)&&(t.shadowOffsetY=r.shadowOffsetY||n.shadowOffsetY||0),r.geometry.type);t.beginPath(),n.multiPolygonDraw=function(){t.fill(),(r.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()},f.draw(t,r,n),"Point"==h||"Polygon"==h||"MultiPolygon"==h?(t.fill(),(r.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"!=h&&"MultiLineString"!=h||t.stroke(),t.restore()}t.restore()}};function q(t,e){var n;return"undefined"!=typeof document&&(n=document.createElement("canvas"),t&&(n.width=t),e)&&(n.height=e),n}function M(t){this.gradient=(t=t||{}).gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}M.prototype.setMax=function(t){this.max=t||100},M.prototype.setMin=function(t){this.min=t||0},M.prototype.setMaxSize=function(t){this.maxSize=t||35},M.prototype.setMinSize=function(t){this.minSize=t||0},M.prototype.initPalette=function(){var t,e=this.gradient,n=new q(256,1),n=this.paletteCtx=n.getContext("2d"),i=n.createLinearGradient(0,0,256,1);for(t in e)i.addColorStop(parseFloat(t),e[t]);n.fillStyle=i,n.fillRect(0,0,256,1)},M.prototype.getColor=function(t){t=this.getImageData(t);return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]/256+")"},M.prototype.getImageData=function(t){var e,n,i=this.paletteCtx.getImageData(0,0,256,1).data;return void 0===t?i:((t=(e=this.max)<t?e:t)<(n=this.min)&&(t=n),[i[t=4*Math.floor((t-n)/(e-n)*255)],i[1+t],i[2+t],i[3+t]])},M.prototype.getSize=function(t){var e=this.max,n=this.min,i=this.maxSize,o=this.minSize;return n<e?o+((t=(t=e<t?e:t)<n?n:t)-n)/(e-n)*(i-o):i},M.prototype.setGradient=function(t){this.gradient=t,this.initPalette()},M.prototype.getGradient=function(){return this.gradient},M.prototype.setTheme=function(t){var e={rainbow:{0:"blue",.25:"cyan",.5:"lime",.75:"yellow",1:"red"},fire:{0:"black",.25:"purple",.5:"orange",.75:"yellow",1:"white"},water:{0:"white",.25:"lightblue",.5:"blue",.75:"darkblue",1:"black"},earth:{0:"green",.25:"yellowgreen",.5:"yellow",.75:"orange",1:"brown"}};return!!e[t]&&(this.gradient=e[t],this.initPalette(),!0)},M.prototype.getThemes=function(){return["rainbow","fire","water","earth"]},M.prototype.setMinMax=function(t,e){this.min=t,this.max=e},M.prototype.setMinMaxSize=function(t,e){this.minSize=t,this.maxSize=e},M.prototype.getLegend=function(t){var e,n,i=this.gradient,o=t.width||20,a=t.height||180,s=new q(o,a),r=s.getContext("2d"),h=r.createLinearGradient(0,a,0,0);for(e in i)h.addColorStop(parseFloat(e),i[e]);return r.fillStyle=h,r.fillRect(0,0,o,a),!1!==t.showLabels&&(r.fillStyle="black",r.font="12px Arial",r.textAlign="left",t=this.max.toString(),n=this.min.toString(),r.fillText(t,o+5,12),r.fillText(n,o+5,a),t=((this.max+this.min)/2).toFixed(1),r.fillText(t,o+5,a/2)),s};var H=("undefined"==typeof window?{}:window).devicePixelRatio||1;function V(t){return t.max||100}function Y(t){return t.min||0}function $(a,t,s){var e,n,i,o,r,h=V(s),l=Y(s),u=s._size,c=(null==u&&null==(u=s.size)&&(u=13),new M({gradient:s.gradient,max:h,min:l})),p=(n=new q(2*(e=(l=u)+(u=l/2)),2*e),(i=n.getContext("2d")).shadowBlur=u,i.shadowColor="black",i.shadowOffsetX=i.shadowOffsetY=1e4,i.beginPath(),i.arc(e-1e4,e-1e4,l,0,2*Math.PI,!0),i.closePath(),i.fill(),n),d=p.width/2,g=p.height/2,v={};for(o in t.forEach(function(t,e){var n=void 0===t.count?1:t.count,n=Math.min(1,n/h).toFixed(2);v[n]=v[n]||[],v[n].push(t)}),v)isNaN(o)||(r=v[o],a.beginPath(),s.withoutAlpha||(a.globalAlpha=o),a.strokeStyle=c.getColor(o*h),r.forEach(function(t,e){var n,i,o;t.geometry&&(n=t.geometry._coordinates||t.geometry.coordinates,"Point"===(i=t.geometry.type)?(o=void 0===t.count?1:t.count,a.globalAlpha=o/h,a.drawImage(p,n[0]-d,n[1]-g)):"LineString"===i&&(o=void 0===t.count?1:t.count,a.globalAlpha=o/h,a.beginPath(),f.draw(a,t,s),a.stroke()))}))}var G={draw:function(t,e,n){if(!(t.canvas.width<=0||t.canvas.height<=0)){var i=n.strength||.3,i=(t.strokeStyle="rgba(0,0,0,"+i+")",new q(t.canvas.width,t.canvas.height)),i=i.getContext("2d"),e=(i.scale(H,H),n=n||{},e instanceof E?e.get():e),o=(t.save(),new M({gradient:n.gradient}));if($(i,e,n),!n.absolute){for(var a,s,e=i.getImageData(0,0,t.canvas.width,t.canvas.height),r=e.data,h=o.getImageData(),i=n,n=V(i),l=Y(i),n=n-l,u=0,c=1024,p=((a=i.range||null)&&2===a.length&&(u=(a[0]-l)/n*1024),a&&2===a.length&&(c=(a[1]-l)/n*1024),i.maxOpacity||.8),d=i.minOpacity||0,g=3,v=r.length;g<v;g+=4)s=4*r[g],p<r[g]/256&&(r[g]=256*p),r[g]/256<d&&(r[g]=256*d),s&&u<=s&&s<=c?(r[g-3]=h[s],r[g-2]=h[1+s],r[g-1]=h[2+s]):r[g]=0;t.putImageData(e,0,0),t.restore()}o=null}}},J={draw:function(t,e,n){t.save();var i=e instanceof E?e.get():e,o={},a=n._size||n.size||50,s=!("enableCluster"in n)||n.enableCluster,r=n.offset||{x:0,y:0},h=new M({min:n.min||0,max:n.max||100,gradient:n.gradient});if(s){for(var l,u=0;u<i.length;u++){c=i[u].geometry._coordinates||i[u].geometry.coordinates;o[g=Math.floor((c[0]-r.x)/a)+","+Math.floor((c[1]-r.y)/a)]||(o[g]=0),o[g]+=~~(i[u].count||1)}for(l in o)l=l.split(","),t.beginPath(),t.rect(l[0]*a+.5+r.x,l[1]*a+.5+r.y,a,a),t.fillStyle=h.getColor(o[l]),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}else{for(var c,p,d=0;d<i.length;d++)o[g=(c=i[d].geometry._coordinates||i[d].geometry.coordinates).join(",")]=i[d].count||1;for(p in o)p=p.split(","),t.beginPath(),t.rect(+p[0]-a/2,+p[1]-a/2,a,a),t.fillStyle=h.getColor(o[p]),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&!1!==n.label.show)for(var g in t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur),o){var v=o[g=g.split(",")],f=t.measureText(v).width;s?t.fillText(v,g[0]*a+.5+r.x+a/2-f/2,g[1]*a+.5+r.y+a/2+5):t.fillText(v,+g[0]-f/2,+g[1]+5)}t.restore()}};var X={draw:function(t,e,n){t.save();var i=e instanceof E?e.get():e;for(S in n)t[S]=n[S];for(var o,a=n.offset||{x:10,y:10},s=2*(o=(n._size||n.size||40)/2/Math.sin(Math.PI/3))*Math.sin(Math.PI/3),r=1.5*o,h={},l=0;l<i.length;l++){var u,c,p=i[l].geometry._coordinates||i[l].geometry.coordinates,d=(p[1]-a.y)/r,g=Math.round(d),p=(p[0]-a.x)/s-(1&g?.5:0),v=Math.round(p),f=d-g,p=(1<3*Math.abs(f)&&(c=p-(u=v+(p<v?-1:1)/2))*c+(d=d-(c=g+(d<g?-1:1)))*d<(d=p-v)*d+f*f&&(v=u+(1&g?1:-1)/2,g=c),v+"-"+g),d=h[p];d?d.push(i[l]):((d=h[p]=[i[l]]).i=v,d.j=g,d.x=(v+(1&g?.5:0))*s,d.y=g*r)}var y,m,x=new M({max:n.max||100,maxSize:o,gradient:n.gradient});for(S in h){var w=h[S];t.beginPath();for(var _=0;_<6;_++){b={x:w.x+a.x,y:w.y+a.y},y=o,m=_,m=Math.PI/180*(60*m+30);var b=[b.x+y*Math.cos(m),b.y+y*Math.sin(m)];t.lineTo(b[0],b[1])}t.closePath();for(var k=0,l=0;l<w.length;l++)k+=w[l].count||1;w.count=k,t.fillStyle=x.getColor(k),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&!1!==n.label.show)for(var S in t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur),h){var C=(C=(w=h[S]).count)<0?C.toFixed(2):~~C,L=t.measureText(C).width;t.fillText(C,w.x+a.x-L/2,w.y+a.y+5)}t.restore()}};function Q(t,e,n){n=t.createShader(n);return t.shaderSource(n,e),t.compileShader(n),n}function K(t,e,n){var e=Q(t,e,t.VERTEX_SHADER),n=Q(t,n,t.FRAGMENT_SHADER),i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.useProgram(i),i}function tt(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=1,e.height=1,n.fillStyle=t,n.fillRect(0,0,1,1),n.getImageData(0,0,1,1).data}var et=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),nt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");var it={draw:function(t,e,n){if(e){var i=K(t,et,nt),o=(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),t.clear(t.COLOR_BUFFER_BIT),t.canvas.width/2),a=t.canvas.height/2,s=t.createBuffer(),s=(t.bindBuffer(t.ARRAY_BUFFER,s),t.getAttribLocation(i,"a_Position")),s=(t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s),t.getUniformLocation(i,"u_FragColor")),i=tt(n.strokeStyle||"red");t.uniform4f(s,i[0]/255,i[1]/255,i[2]/255,i[3]/255),t.lineWidth(n.lineWidth||1);for(var r=0,h=e.length;r<h;r++){for(var l=e[r].geometry._coordinates,u=[],c=0;c<l.length;c++){var p=l[c],d=(p[0]-o)/o;u.push(d,(a-p[1])/a)}var g=new Float32Array(u);t.bufferData(t.ARRAY_BUFFER,g,t.STATIC_DRAW),t.drawArrays(t.LINE_STRIP,0,l.length)}}}},ot=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),at=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");var st={draw:function(t,e,n){if(e){for(var i=K(t,ot,at),o=t.getAttribLocation(i,"a_Position"),a=t.getAttribLocation(i,"a_PointSize"),i=t.getUniformLocation(i,"u_FragColor"),s=(t.clear(t.COLOR_BUFFER_BIT),t.canvas.width/2),r=t.canvas.height/2,h=[],l=0,u=0;u<e.length;u++){var c=e[u].geometry._coordinates,p=(c[0]-s)/s,c=(r-c[1])/r;p<-1||1<p||c<-1||1<c||(h.push(p,c),l++)}var d=new Float32Array(h),g=l,v=t.createBuffer(),v=(t.bindBuffer(t.ARRAY_BUFFER,v),t.bufferData(t.ARRAY_BUFFER,d,t.STATIC_DRAW),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),t.vertexAttrib1f(a,n._size),tt(n.fillStyle||"red"));t.uniform4f(i,v[0]/255,v[1]/255,v[2]/255,v[3]/255),t.drawArrays(t.POINTS,0,g)}}};function rt(t,e,n){n=n||2;var i,o,a,s,r,h=e&&e.length,l=h?e[0]*n:t.length,u=ht(t,0,l,n,!0),c=[];if(u){if(h&&(u=((t,e,n,i)=>{var o,a,s,r,h=[];for(o=0,a=e.length;o<a;o++)r=e[o]*i,s=o<a-1?e[o+1]*i:t.length,(r=ht(t,r,s,i,!1))===r.next&&(r.steiner=!0),h.push((t=>{for(var e=t,n=t;e.x<n.x&&(n=e),(e=e.next)!==t;);return n})(r));for(h.sort(ct),o=0;o<h.length;o++){{l=void 0;u=void 0;var l=h[o];var u=n;(u=((t,e)=>{var n,i=e,o=t.x,a=t.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y){var r=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(r<=o&&s<r){if((s=r)===o){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}}while((i=i.next)!==e);if(!n)return null;if(o===s)return n.prev;var h,l=n,u=n.x,c=n.y,p=1/0;for(i=n.next;i!==l;)o>=i.x&&i.x>=u&&dt(a<c?o:s,a,u,c,a<c?s:o,a,i.x,i.y)&&((h=Math.abs(a-i.y)/(o-i.x))<p||h===p&&i.x>n.x)&&vt(i,t)&&(n=i,p=h),i=i.next;return n})(l,u))&&lt(u=ft(u,l),u.next)}n=lt(n,n.next)}return n})(t,e,u,n)),t.length>80*n){for(var p=i=t[0],d=o=t[1],g=n;g<l;g+=n)(a=t[g])<p&&(p=a),(s=t[g+1])<d&&(d=s),i<a&&(i=a),o<s&&(o=s);r=Math.max(i-p,o-d)}ut(u,c,n,p,d,r)}return c}function ht(t,e,n,i,o){var a,s;if(o===0<wt(t,e,n,i))for(a=e;a<n;a+=i)s=yt(a,t[a],t[a+1],s);else for(a=n-i;e<=a;a-=i)s=yt(a,t[a],t[a+1],s);return s&&z(s,s.next)&&(mt(s),s=s.next),s}function lt(t,e){if(!t)return t;e=e||t;var n,i=t;do{if(n=!1,i.steiner||!z(i,i.next)&&0!==C(i.prev,i,i.next))i=i.next;else{if(mt(i),(i=e=i.prev)===i.next)return null;n=!0}}while(n||i!==e);return e}function ut(t,e,n,i,o,a,s){if(t){if(!s&&a){for(var r=t,h=i,l=o,u=a,c=r;null===c.z&&(c.z=pt(c.x,c.y,h,l,u)),c.prevZ=c.prev,c.nextZ=c.next,(c=c.next)!==r;);c.prevZ.nextZ=null,c.prevZ=null;var p,d,g,v,f,y,m,x,w=c,_=1;do{for(d=w,f=w=null,y=0;d;){for(y++,g=d,p=m=0;p<_&&(m++,g=g.nextZ);p++);for(x=_;0<m||0<x&&g;)0!==m&&(0===x||!g||d.z<=g.z)?(d=(v=d).nextZ,m--):(g=(v=g).nextZ,x--),f?f.nextZ=v:w=v,v.prevZ=f,f=v;d=g}}while(f.nextZ=null,_*=2,1<y)}for(var b,k,S=t;t.prev!==t.next;)if(b=t.prev,k=t.next,a?((t,e,n,i)=>{var o=t.prev,a=t,s=t.next;if(!(0<=C(o,a,s))){for(var r=(o.x<a.x?o.x<s.x?o:s:a.x<s.x?a:s).x,h=(o.y<a.y?o.y<s.y?o:s:a.y<s.y?a:s).y,l=(a.x<o.x?o.x>s.x?o:s:a.x>s.x?a:s).x,u=(a.y<o.y?o.y>s.y?o:s:a.y>s.y?a:s).y,c=pt(r,h,e,n,i),p=pt(l,u,e,n,i),d=t.nextZ;d&&d.z<=p;){if(d!==t.prev&&d!==t.next&&dt(o.x,o.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&dt(o.x,o.y,a.x,a.y,s.x,s.y,d.x,d.y)&&0<=C(d.prev,d,d.next))return;d=d.prevZ}return 1}})(t,i,o,a):(t=>{var e=t.prev,n=t,i=t.next;if(!(0<=C(e,n,i))){for(var o=t.next.next;o!==t.prev;){if(dt(e.x,e.y,n.x,n.y,i.x,i.y,o.x,o.y)&&0<=C(o.prev,o,o.next))return;o=o.next}return 1}})(t))e.push(b.i/n),e.push(t.i/n),e.push(k.i/n),mt(t),t=k.next,S=k.next;else if((t=k)===S){s?1===s?ut(t=((t,e,n)=>{var i=t;do{var o=i.prev,a=i.next.next}while(!z(o,a)&&gt(o,i,i.next,a)&&vt(o,a)&&vt(a,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(a.i/n),mt(i),mt(i.next),i=t=a),(i=i.next)!==t);return i})(t,e,n),e,n,i,o,a,2):2===s&&((t,e,n,i,o,a)=>{var s=t;do{for(var r,h=s.next.next;h!==s.prev;){if(s.i!==h.i&&((t,e)=>t.next.i!==e.i&&t.prev.i!==e.i&&!((t,e)=>{var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&gt(n,n.next,t,e))return 1}while((n=n.next)!==t)})(t,e)&&vt(t,e)&&vt(e,t)&&((t,e)=>{for(var n=t,i=!1,o=(t.x+e.x)/2,a=(t.y+e.y)/2;n.y>a!=n.next.y>a&&o<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),(n=n.next)!==t;);return i})(t,e))(s,h))return r=ft(s,h),s=lt(s,s.next),r=lt(r,r.next),ut(s,e,n,i,o,a),ut(r,e,n,i,o,a);h=h.next}}while((s=s.next)!==t)})(t,e,n,i,o,a):ut(lt(t),e,n,i,o,a,1);break}}}function ct(t,e){return t.x-e.x}function pt(t,e,n,i,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dt(t,e,n,i,o,a,s,r){return 0<=(o-s)*(e-r)-(t-s)*(a-r)&&0<=(t-s)*(i-r)-(n-s)*(e-r)&&0<=(n-s)*(a-r)-(o-s)*(i-r)}function C(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function z(t,e){return t.x===e.x&&t.y===e.y}function gt(t,e,n,i){return z(t,e)&&z(n,i)||z(t,i)&&z(n,e)||0<C(t,e,n)!=0<C(t,e,i)&&0<C(n,i,t)!=0<C(n,i,e)}function vt(t,e){return C(t.prev,t,t.next)<0?0<=C(t,e,t.next)&&0<=C(t,t.prev,e):C(t,e,t.prev)<0||C(t,t.next,e)<0}function ft(t,e){var n=new xt(t.i,t.x,t.y),i=new xt(e.i,e.x,e.y),o=t.next,a=e.prev;return(t.next=e).prev=t,(n.next=o).prev=n,i.next=n,(a.next=n.prev=i).prev=a,i}function yt(t,e,n,i){t=new xt(t,e,n);return i?(t.next=i.next,(t.prev=i).next.prev=t,i.next=t):(t.prev=t).next=t,t}function mt(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function xt(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wt(t,e,n,i){for(var o=0,a=e,s=n-i;a<n;a+=i)o+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return o}rt.deviation=function(t,e,n,i){var o=e&&e.length,a=o?e[0]*n:t.length,s=Math.abs(wt(t,0,a,n));if(o)for(var r=0,h=e.length;r<h;r++){var l=e[r]*n,u=r<h-1?e[r+1]*n:t.length;s-=Math.abs(wt(t,l,u,n))}for(var c=0,r=0;r<i.length;r+=3){var p=i[r]*n,d=i[r+1]*n,g=i[r+2]*n;c+=Math.abs((t[p]-t[g])*(t[1+d]-t[1+p])-(t[p]-t[d])*(t[1+g]-t[1+p]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},rt.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,o=0;o<t.length;o++){for(var a=0;a<t[o].length;a++)for(var s=0;s<e;s++)n.vertices.push(t[o][a][s]);0<o&&(i+=t[o-1].length,n.holes.push(i))}return n};var _t=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),bt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");var kt={draw:function(t,e,n){if(e){t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,t.canvas.width,t.canvas.height);for(var i=K(t,_t,bt),o=(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),t.canvas.width/2),a=t.canvas.height/2,s=(t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer()),t.getAttribLocation(i,"a_Position")),s=(t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s),t.getUniformLocation(i,"u_FragColor")),i=tt(n.fillStyle||"red"),r=(t.uniform4f(s,i[0]/255,i[1]/255,i[2]/255,i[3]/255),t.lineWidth(n.lineWidth||1),[]),h=[],l=0,u=0,c=e.length;u<c;u++){for(var p=rt.flatten(e[u].geometry._coordinates||e[u].geometry.coordinates),d=p.vertices,l=r.length/2,g=0;g<d.length;g+=2)d[g]=(d[g]-o)/o,d[g+1]=(a-d[g+1])/a;65536<(r.length+d.length)/2&&(t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),r.length=0,l=h.length=0);for(g=0;g<d.length;g++)r.push(d[g]);for(var v=rt(d,p.holes,p.dimensions),g=0;g<v.length;g++)h.push(v[g]+l)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,h.length,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},St={draw:function(t,e,n){e=e instanceof E?e.get():e;0<e.length&&("LineString"==e[0].geometry.type?it:"Polygon"==e[0].geometry.type||"MultiPolygon"==e[0].geometry.type?kt:st).draw(t,e,n)}};var Ct={getPoints:function(t,e){e=e||{};for(var n=[],i=0;i<t.length-1;i++){var o=((t,e,n)=>{if(!t||!e)return null;function i(t){return 1-2*t+t*t}function o(t){return 2*t-2*t*t}function a(t){return t*t}var s,r,h,l,u,c=[],n=n||40,p=0,d=0;if(void 0!==e){var g=parseFloat(t.lat),v=parseFloat(e.lat),f=parseFloat(t.lng),y=parseFloat(e.lng);for(f<y&&180<parseFloat(y-f)&&f<0&&(f=parseFloat(360+f),y=parseFloat(360+y)),u=0,s=v==g?(r=0,f-y):y==f?(r=Math.PI/2,g-v):(r=Math.atan((v-g)/(y-f)),(v-g)/Math.sin(r)),0==u&&(u=r+Math.PI/5),l=(r=s/2)*Math.cos(u)+f,h=r*Math.sin(u)+g,p=0;p<n+1;p++){var m=f*i(d)+l*o(d)+y*a(d),x=g*i(d)+h*o(d)+v*a(d),w=t.lng,_=e.lng;c.push([w<0&&0<_?m-360:m,x]),d+=1/n}return c}void 0!==c&&(c=[])})(t[i],t[i+1],e.count);o&&0<o.length&&(n=n.concat(o))}return n}};function a(t){this.splitList=t||{other:1}}function l(t){this.splitList=t||[{start:0,value:"red"}]}a.prototype.get=function(t){var e,n=this.splitList,i=n.other;for(e in n)if(t==e){i=n[e];break}return i},a.prototype.generateByDataSet=function(t,e){for(var n=e||["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],i=t.get(),o=(this.splitList={},0),a=0;a<i.length&&(void 0===this.splitList[i[a].count]&&(this.splitList[i[a].count]=n[o],o++),!(o>=n.length-1));a++);this.splitList.other=n[n.length-1]},a.prototype.generateByUniqueValues=function(t,e,n){var i=t.getUnique(e),o=n||this.getDefaultColors();this.splitList={};for(var a=0;a<i.length;a++)this.splitList[i[a]]=o[a%o.length];this.splitList.other=o[o.length-1]},a.prototype.getDefaultColors=function(){return["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)","rgba(0, 176, 104, 0.8)","rgba(128, 128, 128, 0.8)","rgba(255, 0, 255, 0.8)"]},a.prototype.addCategory=function(t,e){this.splitList[t]=e},a.prototype.removeCategory=function(t){delete this.splitList[t]},a.prototype.updateCategory=function(t,e){return void 0!==this.splitList[t]&&(this.splitList[t]=e,!0)},a.prototype.getCategories=function(){return this.splitList},a.prototype.getLegend=function(t){var e,n=this.splitList,i=document.createElement("div"),o=(i.style.cssText="background:#fff; padding: 5px; border: 1px solid #ccc;","");for(e in n)o+='<div style="line-height: 19px;" value="'+e+'"><span style="vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:'+n[e]+';"></span><span style="margin-left: 3px;">'+e+"<span></div>";return i.innerHTML=o,i},l.prototype.get=function(t){for(var e=this.splitList,n=!1,i=0;i<e.length;i++)if((void 0===e[i].start||void 0!==e[i].start&&t>=e[i].start)&&(void 0===e[i].end||void 0!==e[i].end&&t<e[i].end)){n=e[i].value;break}return n},l.prototype.generateByDataSet=function(t){var e=t.getMin("count"),t=t.getMax("count");this.generateByMinMax(e,t)},l.prototype.generateByMinMax=function(t,e){for(var n=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],i=Number((e-t)/7),o=(e=Number(e),Number(t)),a=(this.splitList=[],0);o<e;)this.splitList.push({start:o,end:o+i,value:n[a]}),a++,o+=i},l.prototype.generateByCustomRange=function(t,e){var n=e||this.getDefaultColors();this.splitList=[];for(var i=0;i<t.length;i++)this.splitList.push({start:t[i].start,end:t[i].end,value:n[i%n.length]})},l.prototype.getDefaultColors=function(){return["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)","rgba(0, 176, 104, 0.8)","rgba(128, 128, 128, 0.8)","rgba(255, 0, 255, 0.8)"]},l.prototype.addRange=function(t){this.splitList.push(t),this.splitList.sort(function(t,e){return(t.start||0)-(e.start||0)})},l.prototype.removeRange=function(t){0<=t&&t<this.splitList.length&&this.splitList.splice(t,1)},l.prototype.updateRange=function(t,e){return 0<=t&&t<this.splitList.length&&(this.splitList[t]=e,!0)},l.prototype.getRanges=function(){return this.splitList},l.prototype.getLegend=function(t){for(var e=this.splitList,n=document.createElement("div"),i=(n.style.cssText="background:#fff; padding: 5px; border: 1px solid #ccc;",""),o=0;o<e.length;o++){var a=e[o],s="",s=void 0!==a.start&&void 0!==a.end?a.start+" - "+a.end:void 0!==a.start?"> "+a.start:void 0!==a.end?"< "+a.end:"All";i+='<div style="line-height: 19px;"><span style="vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:'+a.value+';"></span><span style="margin-left: 3px;">'+s+"<span></div>"}return n.innerHTML=i,n};e(Et,[{key:"addLayer",value:function(t,e){if("baidu"==this.type)return new mapv.baiduMapLayer(this.map,dataSet,e)}},{key:"getMap",value:function(){return this.map}}]);var Lt=Et;function Et(t,e,n){if(r(this,Et),!t||!e)return console.warn("id 和 type 为必填项"),!1;if("baidu"==e){if(!BMap)return console.warn("请先引入百度地图JS API"),!1}else console.warn("暂不支持你的地图类型");this.type=e;e=n&&n.center?n.center:[106.962497,38.208726],n=n&&n.zoom?n.zoom:5,t=this.map=new BMap.Map(t,{enableMapClick:!1});t.centerAndZoom(new BMap.Point(e[0],e[1]),n),t.enableScrollWheelZoom(!0),t.setMapStyle({style:"light"})}function u(t){this.options=t||{},this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=t.map,this._lastDrawTime=null,this.show()}var c,Mt,Pt="undefined"==typeof window?{}:window,zt=Pt.BMap||Pt.BMapGL,O=(zt&&((u.prototype=new zt.Overlay).initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";user-select:none;",e.style.mixBlendMode=this.mixBlendMode,this.adjustSize();(t.getPanes()[this.paneName]||t.getPanes().floatShadow).appendChild(e);var n=this;return t.addEventListener("resize",function(){n.adjustSize(),n._draw()}),t.addEventListener("update",function(){n._draw()}),this.options.updateImmediate&&setTimeout(function(){n._draw()},100),this.canvas},u.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,n=this.devicePixelRatio=Pt.devicePixelRatio||1;e.width=t.width*n,e.height=t.height*n,"2d"==this.context&&e.getContext(this.context).scale(n,n),e.style.width=t.width+"px",e.style.height=t.height+"px"},u.prototype.draw=function(){var t=this;this.options.updateImmediate?t._draw():(clearTimeout(t.timeoutID),t.timeoutID=setTimeout(function(){t._draw()},15))},u.prototype._draw=function(){var t=this._map,e=t.getSize(),n=t.getCenter();n&&(t=t.pointToOverlayPixel(n),this.canvas.style.left=t.x-e.width/2+"px",this.canvas.style.top=t.y-e.height/2+"px",this.dispatchEvent("draw"),this.options.update)&&this.options.update.call(this)},u.prototype.getContainer=function(){return this.canvas},u.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},u.prototype.hide=function(){this.canvas.style.display="none"},u.prototype.setZIndex=function(t){this.zIndex=t,this.canvas.style.zIndex=this.zIndex},u.prototype.getZIndex=function(){return this.zIndex}),O||(c=[],{getAll:function(){return c},removeAll:function(){c=[]},add:function(t){c.push(t)},remove:function(t){t=c.indexOf(t);-1!==t&&c.splice(t,1)},update:function(t,e){if(0===c.length)return!1;var n=0;for(t=void 0!==t?t:O.now();n<c.length;)c[n].update(t)||e?n++:c.splice(n,1);return!0}}));"undefined"==typeof window&&"undefined"!=typeof process?O.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?O.now=window.performance.now.bind(window.performance):void 0!==Date.now?O.now=Date.now:O.now=function(){return(new Date).getTime()},O.Tween=function(t){var l,u=t,c={},p={},d={},g=1e3,v=0,f=!1,n=!1,y=0,m=null,x=O.Easing.Linear.None,w=O.Interpolation.Linear,_=[],b=null,k=!1,S=null,C=null,e=null;this.to=function(t,e){return p=t,void 0!==e&&(g=e),this},this.start=function(t){for(var e in O.add(this),k=!(n=!0),m=void 0!==t?t:O.now(),m+=y,p){if(p[e]instanceof Array){if(0===p[e].length)continue;p[e]=[u[e]].concat(p[e])}void 0!==u[e]&&(c[e]=u[e],c[e]instanceof Array==!1&&(c[e]*=1),d[e]=c[e]||0)}return this},this.stop=function(){return n&&(O.remove(this),n=!1,null!==e&&e.call(u,u),this.stopChainedTweens()),this},this.end=function(){return this.update(m+g),this},this.stopChainedTweens=function(){for(var t=0,e=_.length;t<e;t++)_[t].stop()},this.delay=function(t){return y=t,this},this.repeat=function(t){return v=t,this},this.repeatDelay=function(t){return l=t,this},this.yoyo=function(t){return f=t,this},this.easing=function(t){return x=t,this},this.interpolation=function(t){return w=t,this},this.chain=function(){return _=arguments,this},this.onStart=function(t){return b=t,this},this.onUpdate=function(t){return S=t,this},this.onComplete=function(t){return C=t,this},this.onStop=function(t){return e=t,this},this.update=function(t){var e,n,i,o,a,s;if(t<m)return!0;for(e in!1===k&&(null!==b&&b.call(u,u),k=!0),i=x(n=1<(n=(t-m)/g)?1:n),p)void 0!==c[e]&&(o=c[e]||0,(a=p[e])instanceof Array?u[e]=w(a,i):"number"==typeof(a="string"==typeof a?"+"===a.charAt(0)||"-"===a.charAt(0)?o+parseFloat(a):parseFloat(a):a)&&(u[e]=o+(a-o)*i));if(null!==S&&S.call(u,i),1!=n)return!0;if(0<v){for(e in isFinite(v)&&v--,d)"string"==typeof p[e]&&(d[e]=d[e]+parseFloat(p[e])),f&&(s=d[e],d[e]=p[e],p[e]=s),c[e]=d[e];return f&&0,m=void 0!==l?t+l:t+y,!0}null!==C&&C.call(u,u);for(var r=0,h=_.length;r<h;r++)_[r].start(m+g);return!1}},O.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((1+e)*t-e)*.5:.5*((t-=2)*t*((1+e)*t+e)+2)}},Bounce:{In:function(t){return 1-O.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*O.Easing.Bounce.In(2*t):.5*O.Easing.Bounce.Out(2*t-1)+.5}}},O.Interpolation={Linear:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),a=O.Interpolation.Utils.Linear;return e<0?a(t[0],t[1],i):1<e?a(t[n],t[n-1],n-i):a(t[o],t[n<o+1?n:o+1],i-o)},Bezier:function(t,e){for(var n=0,i=t.length-1,o=Math.pow,a=O.Interpolation.Utils.Bernstein,s=0;s<=i;s++)n+=o(1-e,i-s)*o(e,s)*t[s]*a(i,s);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),a=O.Interpolation.Utils.CatmullRom;return t[0]===t[n]?a(t[((o=e<0?Math.floor(i=n*(1+e)):o)-1+n)%n],t[o],t[(o+1)%n],t[(o+2)%n],i-o):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-i)-t[0]):1<e?t[n]-(a(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):a(t[o?o-1:0],t[o],t[n<o+1?n:o+1],t[n<o+2?n:o+2],i-o)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=O.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(Mt=[1],function(t){var e=1;if(Mt[t])return Mt[t];for(var n=t;1<n;n--)e*=n;return Mt[t]=e}),CatmullRom:function(t,e,n,i,o){var t=.5*(n-t),i=.5*(i-e),a=o*o;return(2*e-2*n+t+i)*(o*a)+(-3*e+3*n-2*t-i)*a+t*o+e}}};var Ot={},At={draw:function(t,e,n){var i,o,a="http://huiyan.baidu.com/github/tools/gis-drawing/static/images/direction.png",s=(n.arrow&&n.arrow.url&&(a=n.arrow.url),Ot[a]||(Ot[a]=null),Ot[a]);if(s){var r,h=e instanceof E?e.get():e;for(r in t.save(),n)t[r]=n[r];for(var l,u,c=[],p=null,d=0,g=h.length;d<g;d++){var v=h[d],f=(t.save(),(v.fillStyle||v._fillStyle)&&(t.fillStyle=v.fillStyle||v._fillStyle),(v.strokeStyle||v._strokeStyle)&&(t.strokeStyle=v.strokeStyle||v._strokeStyle),v.geometry.type);if(t.beginPath(),"LineString"===f)for(var y,m,x=v.geometry._coordinates||v.geometry.coordinates,w=void 0!==n.arrow.interval?n.arrow.interval:1,_=0;_<x.length;_+=w)x[_]&&x[_+1]&&(y=x[_],p&&(l=y,u=p,Math.sqrt(Math.pow(l[0]-u[0],2)+Math.pow(l[1]-u[1],2))<30)||(t.save(),l=x[_],u=x[_+1],m=void 0,m=u[0]-l[0],m=360*Math.atan((u[1]-l[1])/m)/(2*Math.PI),u[0]<l[0]&&(m+=180),m=m,t.translate(y[0],y[1]),t.rotate(m*Math.PI/180),t.drawImage(s,-s.width/2/2,-s.height/2/2,s.width/2,s.height/2),t.restore(),c.push(y),p=y));t.restore()}t.restore()}else i=Array.prototype.slice.call(arguments),(o=new Image).onload=function(){Ot[a]=o,At.draw.apply(null,i)},o.src=a}};var It=function(t,e,n){var i=e instanceof E?e.get():e;t.save(),t.fillStyle=n.fillStyle||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,t.canvas.width,t.canvas.height),n.multiPolygonDraw=function(){t.save(),t.clip(),x(t),t.restore()};for(var o=0,a=i.length;o<a;o++)t.beginPath(),f.drawDataSet(t,[i[o]],n),t.save(),t.clip(),x(t),t.restore();t.restore()},m={},w={},Rt={draw:function(t,e,n){t.save();for(var i=e instanceof E?e.get():e,o=0;o<i.length;o++){var a=i[o];t.beginPath(),a.properties&&a.properties.cluster?this.drawClusterPoint(a,n,t):this.drawIcon(a,n,t)}t.restore()},drawClusterPoint:function(t,e,n){var i=t.geometry._coordinates||t.geometry.coordinates,o=i[0],i=i[1],e=Object.assign({},e.label||{});n.beginPath(),n.arc(o,i,t.size,0,2*Math.PI),n.fillStyle=t.fillStyle||"rgba(200, 0, 0, 0.8)",n.fill(),n.strokeStyle="rgba(255, 255, 255, 1)",n.lineWidth=1,n.stroke(),!1!==e.show&&(n.fillStyle=e.fillStyle||"white",n.textAlign="center",n.textBaseline="middle",e.font?n.font=e.font:n.font="bold 14px Arial",e.shadowColor&&(n.shadowColor=e.shadowColor),e.shadowBlur&&(n.shadowBlur=e.shadowBlur),e=t.properties.point_count.toString(),n.measureText(e).width,n.fillText(e,o,i))},drawIcon:function(t,e,n){function i(){n.beginPath(),n.arc(c,p,e.size||5,0,2*Math.PI),n.fillStyle=e.fillStyle||"red",n.fill()}var o,a,s,r,h,l,u=t.geometry._coordinates||t.geometry.coordinates,u=slicedToArray(u,2),c=u[0],p=u[1],d=Object.assign({},e.iconOptions,t.iconOptions);d.url?(c=c-~~(u=d.width)/2+(t=d.offset||{x:0,y:0}).x,p=p-~~(o=d.height)/2+t.y,t=window.encodeURIComponent(d.url),(a=m[t])?("error"===a?i():u&&o?n.drawImage(a,c,p,u,o):n.drawImage(a,c,p),d.label&&!1!==d.label.show&&Dt(n,c+~~u/2,p+~~o/2,0,o,d.label)):(w[t]||(w[t]=[],Tt(t,function(e,t){w[t]&&w[t].forEach(function(t){return t(e)}),w[t]=null,m[t]=e},function(e){w[e]&&w[e].forEach(function(t){return t("error",e)}),w[e]=null,m[e]="error",i()})),w[t].push((s=c,r=p,h=u,l=o,function(t){"error"===t?i():h&&l?n.drawImage(t,s,r,h,l):n.drawImage(t,s,r),d.label&&!1!==d.label.show&&Dt(n,s+~~h/2,r+~~l/2,0,l,d.label)})))):i()},drawSeanIcon:function(o,a,s){function r(){s.arc(v,f,a.size||5,0,2*Math.PI),s.fillStyle=a.fillStyle||"red",s.fill()}var t,e,n,i,h,l,u,c,p,d,g=o.geometry._coordinates||o.geometry.coordinates,g=slicedToArray(g,2),v=g[0],f=g[1],y=Object.assign({},a.iconOptions,o.iconOptions),g=y.url;"function"==typeof y.url&&(t=o.properties&&o.properties.point_count||0,g=y.url(t)),g&&(t=o.size||40,e=o.size||40,100<(n=o.properties&&o.properties.point_count||0)?e=t=50:50<n&&(e=t=45),n=y.offset||{x:0,y:0},v=v-~~(t/2)+n.x,f=f-~~(e/2)+n.y,n="string"==typeof g?window.encodeURIComponent(g):"")?(g=m[n])?("error"===g?r():t&&e?(s.shadowBlur=y.shadowBlur,s.shadowColor=y.shadowColor,s.drawImage(g,v,f,t,e)):(s.shadowBlur=y.shadowBlur,s.shadowColor=y.shadowColor,s.drawImage(g,v,f)),a.iconOptions.show&&(s.fillStyle=a.fillStyle||"white",s.textBaseline="middle",s.textAlign="center",g=o.properties&&o.properties.point_count||0,i=a.iconOptions.fontSize||Math.floor(t/6),s.font=i+"px Arial",i=g.toString())&&(g=v+t/2,h=(l=s.measureText(i)).actualBoundingBoxAscent+l.actualBoundingBoxDescent,l=f+e/2+(l.actualBoundingBoxAscent-h/2),s.fillText(i,g,l))):(w[n]||(w[n]=[],Tt(n,function(e,t){w[t]&&w[t].forEach(function(t){return t(e)}),w[t]=null,m[t]=e},function(e){w[e]&&w[e].forEach(function(t){return t("error",e)}),w[e]=null,m[e]="error",r()})),w[n].push((u=v,c=f,p=t,d=e,function(t){var e,n,i;"error"===t?r():p&&d?(s.shadowBlur=y.shadowBlur,s.shadowColor=y.shadowColor,s.drawImage(t,u,c,p,d)):(s.shadowBlur=y.shadowBlur,s.shadowColor=y.shadowColor,s.drawImage(t,u,c)),a.iconOptions.show&&(s.fillStyle=a.fillStyle||"white",s.textBaseline="middle",s.textAlign="center",t=o.properties&&o.properties.point_count||0,e=a.iconOptions.fontSize||Math.floor(p/6),s.font=e+"px Arial",e=t.toString())&&(t=u+p/2,i=(n=s.measureText(e)).actualBoundingBoxAscent+n.actualBoundingBoxDescent,s.fillText(e,t,c+d/2+(n.actualBoundingBoxAscent-i/2)))}))):r()}};function Dt(t,e,n,i,o,a){function s(t,e,n){return"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:"number"==typeof t?t:"center"===t?-e/2:n}var r=a.text||"",h=a.fontSize||"12px",l=a.fontColor||"black",u=a.padding||5,c=a.backgroundColor||"white",p=a.borderColor||"black",d=a.borderWidth||1,g=(t.font=h+" sans-serif",t.fillStyle=l,t.measureText(r).width),h=parseInt(h,10),g=g+2*u,v=h+2*u,f=s(a.top,v,-v/2),y=s(a.left,g,-g/2),m=(s(a.right,g,g/2),s(a.bottom,v,v/2)),e=e+y,y=void 0!==a.bottom?n-o/2-v-m:n+f;t.fillStyle=c,t.fillRect(e,y,g,v),!1!==a.border&&(t.strokeStyle=p,t.lineWidth=d,t.strokeRect(e,y,g,v)),t.fillStyle=l,t.fillText(r,e+u,y+u+h)}function Tt(t,e,n){var i=new Image;i.onload=function(){e&&e(i,t)},i.onerror=function(){n&&n(t)},i.src=window.decodeURIComponent(t)}var Bt=function(t,e,n){var i,o=e instanceof E?e.get():e;for(i in t.save(),n)t[i]=n[i];var a=[],s=n._size||n.size,r=(s?t.font="bold "+s+"px Arial":s=12,n.textKey||"text");if(n.textAlign||(t.textAlign="center"),n.textBaseline||(t.textBaseline="middle"),n.avoid)for(var h=0,l=o.length;h<l;h++){var u=o[h].offset||n.offset||{x:0,y:0},c=(m=o[h].geometry._coordinates||o[h].geometry.coordinates)[0]+u.x,p=m[1]+u.y,d=o[h][r],g=t.measureText(d).width,v=c-g/2,f=p-s/2,y={sw:{x:v,y:f+s},ne:{x:v+g,y:f}};((t,e)=>{for(var n=0;n<t.length;n++)if(((t,e)=>{var n=Math.min(t.ne.x,e.ne.x),i=Math.min(t.sw.y,e.sw.y),o=Math.max(t.sw.x,e.sw.x),t=Math.max(t.ne.y,e.ne.y);return o<n&&t<i})(t[n],e))return 1})(a,y)||(a.push(y),v+=g/2,f+=s/2,t.fillText(d,v,f))}else for(h=0,l=o.length;h<l;h++){var m,u=o[h].offset||n.offset||{x:0,y:0},c=(m=o[h].geometry._coordinates||o[h].geometry.coordinates)[0]+u.x,p=m[1]+u.y,d=o[h][r];t.fillText(d,c,p)}t.restore()};var p={},d={},Ft={draw:function(i,t,o){for(var a,s=this,r=t instanceof E?t.get():t,h=0,e=r.length;h<e;h++)(()=>{var t,e,n=r[h];n.geometry&&(n.properties&&n.properties.cluster?s.drawClusterIcon(n,o,i):"string"==typeof(a=n.icon||o.icon)?(t=window.encodeURIComponent(a),(e=p[t])?Ut(e,o,i,n):(d[t]||(d[t]=[],Zt(t,function(e,t){d[t]&&d[t].forEach(function(t){return t(e)}),d[t]=null,p[t]=e},function(t){d[t]&&d[t].forEach(function(t){return t("error")}),d[t]=null,p[t]="error"})),d[t].push(function(t){Ut(t,o,i,n)}))):Ut(a,o,i,n))})()},drawClusterIcon:function(e,n,i){var o=this,t=e.geometry._coordinates||e.geometry.coordinates,a=t[0],s=t[1],r=Object.assign({},n.iconOptions||{},e.iconOptions||{});if(!1!==r.show&&(r.url||e.icon)){var h,t=r.url;if("function"==typeof r.url&&(h=e.properties&&e.properties.point_count||0,t=r.url(h)),t)return h=window.encodeURIComponent(t),void((t=p[h])?"error"===t?this.drawDefaultPoint(i,a,s,e,n):this.drawImageWithText(i,t,a,s,e,n,r):(d[h]||(d[h]=[],Zt(h,function(e,t){d[t]&&d[t].forEach(function(t){return t(e)}),d[t]=null,p[t]=e},function(t){d[t]&&d[t].forEach(function(t){return t("error")}),d[t]=null,p[t]="error"})),d[h].push(function(t){"error"===t?o.drawDefaultPoint(i,a,s,e,n):o.drawImageWithText(i,t,a,s,e,n,r)})))}this.drawDefaultClusterPoint(i,a,s,e,n)},drawDefaultPoint:function(t,e,n,i,o){t.beginPath(),t.arc(e,n,o.size||5,0,2*Math.PI),t.fillStyle=o.fillStyle||"rgba(255, 0, 0, 0.8)",t.fill()},drawImageWithText:function(t,e,n,i,o,a,s){t.save();var r=o.size||s.width||40,h=o.size||s.height||40,o=o.properties&&o.properties.point_count||0,l=(100<o?h=r=50:50<o&&(h=r=45),s.offset||{x:0,y:0});n=n-~~(r/2)+l.x,i=i-~~(h/2)+l.y,s.shadowBlur&&(t.shadowBlur=s.shadowBlur),s.shadowColor&&(t.shadowColor=s.shadowColor),t.drawImage(e,n,i,r,h),!1!==s.show&&(t.fillStyle=a.fillStyle||"white",t.textBaseline="middle",t.textAlign="center",l=s.fontSize||Math.floor(r/6),t.font=l+"px Arial",e=o.toString())&&(a=n+r/2,l=(s=t.measureText(e)).actualBoundingBoxAscent+s.actualBoundingBoxDescent,t.fillText(e,a,i+h/2+(s.actualBoundingBoxAscent-l/2))),t.restore()},drawDefaultClusterPoint:function(t,e,n,i,o){t.save();var a=i.size||o.size||10,i=i.properties&&i.properties.point_count||0;100<i?a=20:50<i?a=18:10<i&&(a=16),t.beginPath(),t.arc(e,n,a,0,2*Math.PI),t.fillStyle=100<i?"rgba(255, 0, 0, 0.8)":50<i?"rgba(255, 165, 0, 0.8)":10<i?"rgba(255, 255, 0, 0.8)":"rgba(0, 128, 0, 0.8)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=1,t.stroke(),o.label&&!1!==o.label.show&&(t.fillStyle=o.label.fillStyle||"white",t.textAlign="center",t.textBaseline="middle",t.font=o.label.font||"bold 12px Arial",a=i.toString(),t.fillText(a,e,n)),t.restore()}};function Ut(t,e,n,i){n.save();var o=i.geometry._coordinates||i.geometry.coordinates,a=o[0],s=e.offset||{x:0,y:0},r=i.width||e._width||e.width,h=i.height||e._height||e.height,a=a-~~r/2+s.x,o=o[1]-~~h/2+s.y;"string"==typeof t?(n.beginPath(),n.arc(a,o,e.size||5,0,2*Math.PI),n.fillStyle=e.fillStyle||"red",n.fill()):((s=i.deg||e.deg)&&(n.translate(a,o),n.rotate(s*Math.PI/180),n.translate(-a,-o)),e.sx&&e.sy&&e.swidth&&e.sheight&&e.width&&e.height?n.drawImage(t,e.sx,e.sy,e.swidth,e.sheight,a,o,r,h):r&&h?n.drawImage(t,a,o,r,h):n.drawImage(t,a,o),n.restore())}function Zt(t,e,n){var i=new Image;i.onload=function(){e&&e(i,t)},i.onerror=function(){n&&n(t)},i.src=window.decodeURIComponent(t)}function jt(t,e,n,i,o,a){var s;o-i<=n||(function t(e,n,i,o,a,s){for(;o<a;){600<a-o&&(r=a-o+1,c=i-o+1,l=Math.log(r),h=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*h*(r-h)/r)*(c-r/2<0?-1:1),u=Math.max(o,Math.floor(i-c*h/r+l)),c=Math.min(a,Math.floor(i+(r-c)*h/r+l)),t(e,n,i,u,c,s));var r,h,l,u,c,p=n[2*i+s],d=o,g=a;for(Nt(e,n,o,i),n[2*a+s]>p&&Nt(e,n,o,a);d<g;){for(Nt(e,n,d,g),d++,g--;n[2*d+s]<p;)d++;for(;n[2*g+s]>p;)g--}n[2*o+s]===p?Nt(e,n,o,g):Nt(e,n,++g,a),g<=i&&(o=g+1),i<=g&&(a=g-1)}}(t,e,s=i+o>>1,i,o,a%2),jt(t,e,n,i,s-1,a+1),jt(t,e,n,1+s,o,a+1))}function Nt(t,e,n,i){Wt(t,n,i),Wt(e,2*n,2*i),Wt(e,2*n+1,2*i+1)}function Wt(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function qt(t,e,n,i){t-=n,n=e-i;return t*t+n*n}function Ht(t){return t[0]}function Vt(t){return t[1]}function Yt(t,e,n,i,o){void 0===e&&(e=Ht),void 0===n&&(n=Vt),void 0===i&&(i=64),void 0===o&&(o=Float64Array),this.nodeSize=i;for(var a=(this.points=t).length<65536?Uint16Array:Uint32Array,s=this.ids=new a(t.length),r=this.coords=new o(2*t.length),h=0;h<t.length;h++)r[2*(s[h]=h)]=e(t[h]),r[2*h+1]=n(t[h]);jt(s,r,i,0,s.length-1,0)}function g(t){this.options=Kt(Object.create($t),t),this.trees=new Array(this.options.maxZoom+1)}Yt.prototype.range=function(t,e,n,i){for(var o=this.ids,a=this.coords,s=t,r=e,h=n,l=i,u=this.nodeSize,c=[0,o.length-1,0],p=[];c.length;){var d=c.pop(),g=c.pop(),v=c.pop();if(g-v<=u)for(var f=v;f<=g;f++)m=a[2*f],x=a[2*f+1],s<=m&&m<=h&&r<=x&&x<=l&&p.push(o[f]);else{var y=Math.floor((v+g)/2),m=a[2*y],x=a[2*y+1],w=(s<=m&&m<=h&&r<=x&&x<=l&&p.push(o[y]),(d+1)%2);(0===d?s<=m:r<=x)&&(c.push(v),c.push(y-1),c.push(w)),(0===d?m<=h:x<=l)&&(c.push(y+1),c.push(g),c.push(w))}}return p};var $t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!(Yt.prototype.within=function(t,e,n){for(var i=this.ids,o=this.coords,a=t,s=e,r=n,h=this.nodeSize,l=[0,i.length-1,0],u=[],c=r*r;l.length;){var p=l.pop(),d=l.pop(),g=l.pop();if(d-g<=h)for(var v=g;v<=d;v++)qt(o[2*v],o[2*v+1],a,s)<=c&&u.push(i[v]);else{var f=Math.floor((g+d)/2),y=o[2*f],m=o[2*f+1],x=(qt(y,m,a,s)<=c&&u.push(i[f]),(p+1)%2);(0===p?a-r<=y:s-r<=m)&&(l.push(g),l.push(f-1),l.push(x)),(0===p?y<=a+r:m<=s+r)&&(l.push(f+1),l.push(d),l.push(x))}}return u}),generateId:!1,reduce:null,map:function(t){return t}};function Gt(t){return{type:"Feature",id:t.id,properties:Jt(t),geometry:{type:"Point",coordinates:[360*(t.x-.5),(t=>(t=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(t))/Math.PI-90))(t.y)]}}}function Jt(t){var e=t.numPoints,n=1e4<=e?Math.round(e/1e3)+"k":1e3<=e?Math.round(e/100)/10+"k":e;return Kt(Kt({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function Xt(t){return t/360+.5}function Qt(t){t=Math.sin(t*Math.PI/180),t=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return t<0?0:1<t?1:t}function Kt(t,e){for(var n in e)t[n]=e[n];return t}function te(t){return t.x}function ee(t){return t.y}g.prototype.load=function(t){for(var e=this.options,n=(e.log,e.minZoom),i=e.maxZoom,o=e.nodeSize,a=(t.length,this.points=t,[]),s=0;s<t.length;s++)t[s].geometry&&a.push(((t,e)=>({x:Xt((t=t.geometry.coordinates)[0]),y:Qt(t[1]),zoom:1/0,index:e,parentId:-1}))(t[s],s));this.trees[i+1]=new Yt(a,te,ee,o,Float32Array);for(var r=i;n<=r;r--){Date.now();a=this._cluster(a,r);this.trees[r]=new Yt(a,te,ee,o,Float32Array)}return this},g.prototype.getClusters=function(t,e){var n,i=((t[0]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[1])),a=180===t[2]?180:((t[2]+180)%360+360)%360-180,s=Math.max(-90,Math.min(90,t[3]));if(360<=t[2]-t[0])i=-180,a=180;else if(a<i)return t=this.getClusters([i,o,180,s],e),n=this.getClusters([-180,o,a,s],e),t.concat(n);for(var r=this.trees[this._limitZoom(e)],h=[],l=0,u=r.range(Xt(i),Qt(s),Xt(a),Qt(o));l<u.length;l+=1){var c=u[l],c=r.points[c];h.push(c.numPoints?Gt(c):this.points[c.index])}return h},g.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),i="No cluster with the specified id.",o=this.trees[n];if(!o)throw new Error(i);e=o.points[e];if(!e)throw new Error(i);for(var n=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=[],s=0,r=o.within(e.x,e.y,n);s<r.length;s+=1){var h=r[s],h=o.points[h];h.parentId===t&&a.push(h.numPoints?Gt(h):this.points[h.index])}if(0===a.length)throw new Error(i);return a},g.prototype.getLeaves=function(t,e,n){var i=[];return this._appendLeaves(i,t,e=e||10,n=n||0,0),i},g.prototype.getTile=function(t,e,n){var i=this.trees[this._limitZoom(t)],t=Math.pow(2,t),o=this.options,a=o.extent,o=o.radius/a,a=(n-o)/t,s=(n+1+o)/t,r={features:[]};return this._addTileFeatures(i.range((e-o)/t,a,(e+1+o)/t,s),i.points,e,n,t,r),0===e&&this._addTileFeatures(i.range(1-o/t,a,1,s),i.points,t,n,t,r),e===t-1&&this._addTileFeatures(i.range(0,a,o/t,s),i.points,-1,n,t,r),r.features.length?r:null},g.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},g.prototype._appendLeaves=function(t,e,n,i,o){for(var a=0,s=this.getChildren(e);a<s.length;a+=1){var r=s[a],h=r.properties;if(h&&h.cluster?o+h.point_count<=i?o+=h.point_count:o=this._appendLeaves(t,h.cluster_id,n,i,o):o<i?o++:t.push(r),t.length===n)break}return o},g.prototype._addTileFeatures=function(t,e,n,i,o,a){for(var s=0,r=t;s<r.length;s+=1){var h=e[r[s]],l=h.numPoints,u={type:1,geometry:[[Math.round(this.options.extent*(h.x*o-n)),Math.round(this.options.extent*(h.y*o-i))]],tags:l?Jt(h):this.points[h.index].properties},c=void 0;l?c=h.id:this.options.generateId?c=h.index:this.points[h.index].id&&(c=this.points[h.index].id),void 0!==c&&(u.id=c),a.features.push(u)}},g.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},g.prototype._cluster=function(t,e){for(var n=[],i=this.options,o=i.radius,a=i.reduce,s=i.minPoints,r=o/(i.extent*Math.pow(2,e)),h=0;h<t.length;h++){var l=t[h];if(!(l.zoom<=e)){for(var u=this.trees[(l.zoom=e)+1],c=u.within(l.x,l.y,r),p=l.numPoints||1,d=p,g=0,v=c;g<v.length;g+=1){var f=v[g],f=u.points[f];f.zoom>e&&(d+=f.numPoints||1)}if(s<=d){for(var y=l.x*p,m=l.y*p,x=a&&1<p?this._map(l,!0):null,w=(h<<5)+(e+1)+this.points.length,_=0,b=c;_<b.length;_+=1){var k,S=b[_],S=u.points[S];S.zoom<=e||(S.zoom=e,y+=S.x*(k=S.numPoints||1),m+=S.y*k,S.parentId=w,a&&a(x=x||this._map(l,!0),this._map(S)))}l.parentId=w,n.push({x:y/d,y:m/d,zoom:1/0,id:w,parentId:-1,numPoints:d,properties:x})}else if(n.push(l),1<d)for(var C=0,L=c;C<L.length;C+=1){var E=L[C],E=u.points[E];E.zoom<=e||(E.zoom=e,n.push(E))}}}return n},g.prototype._getOriginId=function(t){return t-this.points.length>>5},g.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},g.prototype._map=function(t,e){var n;return t.numPoints?e?Kt({},t.properties):t.properties:(t=this.points[t.index].properties,n=this.options.map(t),e&&n===t?Kt({},n):n)},"undefined"!=typeof window&&requestAnimationFrame(function t(e){requestAnimationFrame(t);O.update(e)});e(ne,[{key:"refreshCluster",value:function(t){t=t||this.options,this.supercluster=new g({maxZoom:t.maxZoom||19,radius:t.clusterRadius||100,minPoints:t.minPoints||2,extent:t.extent||512}),this.supercluster.load(this.dataSet.get()),this.supercluster.trees.forEach(function(t){var e=0,n=1/0;t.points.forEach(function(t){e=Math.max(t.numPoints||0,e),n=Math.min(t.numPoints||1/0,n)}),t.max=e,t.min=n}),this.clusterDataSet=new E}},{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(t){var e,n,i=this;i.intensity=new M({maxSize:i.options.maxSize,minSize:i.options.minSize,gradient:i.options.gradient,max:i.options.max||this.dataSet.getMax("count")}),i.category=new a(i.options.splitList),i.choropleth=new l(i.options.splitList),void 0===i.options.splitList&&i.category.generateByDataSet(this.dataSet,i.options.color),void 0===i.options.splitList&&(e=i.options.min||this.dataSet.getMin("count"),n=i.options.max||this.dataSet.getMax("count"),i.choropleth.generateByMinMax(e,n))}},{key:"getLegend",value:function(t){this.options.draw;return"intensity"==this.options.draw||"heatmap"==this.options.draw?this.intensity.getLegend(t):"category"==this.options.draw?this.category.getLegend(t):"choropleth"==this.options.draw?this.choropleth.getLegend(t):void 0}},{key:"processData",value:function(t){var e=this,n=e.options.draw;if("bubble"==n||"intensity"==n||"category"==n||"choropleth"==n||"simple"==n)for(var i=0;i<t.length;i++){var o=t[i],a=("bubble"==e.options.draw?t[i]._size=e.intensity.getSize(o.count):t[i]._size=void 0,"_fillStyle");"LineString"!==t[i].geometry.type&&"stroke"!==e.options.styleType||(a="_strokeStyle"),"intensity"==e.options.draw?t[i][a]=e.intensity.getColor(o.count):"category"==e.options.draw?t[i][a]=e.category.get(o.count):"choropleth"==e.options.draw&&(t[i][a]=e.choropleth.get(o.count))}}},{key:"isEnabledTime",value:function(){var t=this.options.animation;return t&&!(!1===t.enabled)}},{key:"argCheck",value:function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(t,e,n,i){var o=this;switch(o.options.draw){case"heatmap":G.draw(t,e,o.options);break;case"grid":case"cluster":case"honeycomb":o.options.offset={x:i.x,y:i.y},("grid"===o.options.draw?J:"cluster"===o.options.draw?Rt:X).draw(t,e,o.options);break;case"text":Bt(t,e,o.options);break;case"icon":Ft.draw(t,e,o.options);break;case"clip":It(t,e,o.options);break;default:"webgl"==o.options.context?St.draw(o.canvasLayer.canvas.getContext("webgl"),e,o.options):o.options.enhancedDraw?W.drawEnhanced(t,e,o.options):W.draw(t,e,o.options)}o.options.arrow&&!1!==o.options.arrow.show&&At.draw(t,e,o.options)}},{key:"isPointInPath",value:function(t,e){for(var t=this.canvasLayer.canvas.getContext(this.context),n=("cluster"===this.options.draw&&(!this.options.maxClusterZoom||this.options.maxClusterZoom>=this.getZoom())?this.clusterDataSet:this.dataSet).get(),i=0;i<n.length;i++){t.beginPath();var o=this.options,a=e.x*this.canvasLayer.devicePixelRatio,s=e.y*this.canvasLayer.devicePixelRatio;if(o.multiPolygonDraw=function(){if(t.isPointInPath(a,s))return n[i]},f.draw(t,n[i],o),-1<(n[i].geometry&&n[i].geometry.type).indexOf("LineString")){if(t.isPointInStroke&&t.isPointInStroke(a,s))return n[i]}else if(t.isPointInPath(a,s))return n[i]}}},{key:"getClusterPoints",value:function(t){var e=this;return"Feature"!==t.type?[]:this.supercluster.getChildren(t.id).map(function(t){return"Feature"===t.type?e.getClusterPoints(t):t}).flat()}},{key:"getDataInBounds",value:function(t){for(var e=this.dataSet.get(),n=[],i=0;i<e.length;i++){var o,a=e[i];a.geometry&&a.geometry.coordinates&&(o=a.geometry.coordinates,t.contains(o))&&n.push(a)}return n}},{key:"filterData",value:function(t){return"function"==typeof t?new E(this.dataSet.filter(t)):this.dataSet}},{key:"updateData",value:function(t){t instanceof E?this.dataSet=t:Array.isArray(t)&&this.dataSet.set(t),"cluster"===this.options.draw&&this.refreshCluster(this.options),this.initDataRange(this.options),this.draw()}},{key:"addData",value:function(t){this.dataSet.add(t),"cluster"===this.options.draw&&this.refreshCluster(this.options),this.initDataRange(this.options),this.draw()}},{key:"clearData",value:function(){this.dataSet.clear(),"cluster"===this.options.draw&&this.refreshCluster(this.options),this.draw()}},{key:"getDataStats",value:function(){return{count:this.dataSet.get().length,minX:this.dataSet.getMin("x"),maxX:this.dataSet.getMax("x"),minY:this.dataSet.getMin("y"),maxY:this.dataSet.getMax("y"),minCount:this.dataSet.getMin("count"),maxCount:this.dataSet.getMax("count"),avgCount:this.dataSet.getAverage("count")}}},{key:"clickEvent",value:function(t,e){var n;this.options.methods&&((t=this.isPointInPath(this.getContext(),t))?("cluster"===this.options.draw&&(n=this.getClusterPoints(t),t.children=n),this.options.methods.click(t,e)):this.options.methods.click(null,e))}},{key:"mousemoveEvent",value:function(t,e){var n;this.options.methods&&((t=this.isPointInPath(this.getContext(),t))?("cluster"===this.options.draw&&(n=this.getClusterPoints(t),t.children=n),this.options.methods.mousemove(t,e)):this.options.methods.mousemove(null,e))}},{key:"hoverEvent",value:function(t,e){var n;this.options.methods&&this.options.methods.hover&&((t=this.isPointInPath(this.getContext(),t))?("cluster"===this.options.draw&&(n=this.getClusterPoints(t),t.children=n),this.options.methods.hover(t,e)):this.options.methods.hover(null,e))}},{key:"doubleClickEvent",value:function(t,e){var n;this.options.methods&&this.options.methods.doubleClick&&((t=this.isPointInPath(this.getContext(),t))?("cluster"===this.options.draw&&(n=this.getClusterPoints(t),t.children=n),this.options.methods.doubleClick(t,e)):this.options.methods.doubleClick(null,e))}},{key:"tapEvent",value:function(t,e){var n;this.options.methods&&((t=this.isPointInPath(this.getContext(),t))?("cluster"===this.options.draw&&(n=this.getClusterPoints(t),t.children=n),this.options.methods.tap(t,e)):this.options.methods.tap(null,e))}},{key:"update",value:function(t,e){var n,i=t.options,o=this.options;for(n in i)o[n]=i[n];this.init(o),!1!==e&&this.draw()}},{key:"updateOptions",value:function(t){var e,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];for(e in t)this.options[e]=t[e];void 0===t.max&&void 0===t.min&&void 0===t.gradient&&void 0===t.splitList||this.initDataRange(this.options),n&&this.draw()}},{key:"setOptions",value:function(t){this.dataSet.reset(),this.init(t),this.draw()}},{key:"set",value:function(t){var e,n=this.getContext(),i=this.getDefaultContextConfig();for(e in i)n[e]=i[e];this.init(t.options),this.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var t,e=this,n=e.options.animation;"time"==e.options.draw||e.isEnabledTime()?(n.stepsRange||(n.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:n.stepsRange.start},e.animator=new O.Tween(this.steps).onUpdate(function(){e._canvasUpdate(this.step)}).repeat(1/0),this.addAnimatorEvent(),t=1e3*n.duration||5e3,e.animator.to({step:n.stepsRange.end},t),e.animator.start()):e.animator&&e.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}},{key:"toGeoJSON",value:function(){var t=this.dataSet.get(),e={type:"FeatureCollection",features:[]};return t.forEach(function(t){t.geometry&&e.features.push({type:"Feature",properties:Object.assign({},t),geometry:t.geometry})}),e}},{key:"toCSV",value:function(){var n,i,t=this.dataSet.get();return 0===t.length?"":(n=Object.keys(t[0]).filter(function(t){return"geometry"!==t}),i=n.join(",")+"\n",t.forEach(function(e){var t=n.map(function(t){t=e[t];return t="string"==typeof(t="object"===(void 0===t?"undefined":Z(t))?JSON.stringify(t):t)&&(t.includes(",")||t.includes('"'))?'"'+t.replace(/"/g,'""')+'"':t});i+=t.join(",")+"\n"}),i)}}]);var v=ne;function ne(t,e,n){r(this,ne),e instanceof E||(e=new E(e)),this.dataSet=e,this.map=t,"cluster"===n.draw&&this.refreshCluster(n)}var zt="undefined"==typeof window?{}:window,ie=zt.BMap||zt.BMapGL,zt=(i(y,v),e(y,[{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),e.options.max&&this.intensity.setMax(e.options.max),e.options.min&&this.intensity.setMin(e.options.min),this.initAnimator()}},{key:"transferToMercator",value:function(){var e=this.map,t=e.getMapType(),n=t.getProjection?t.getProjection():{lngLatToPoint:function(t){t=e.lnglatToMercator(t.lng,t.lat);return{x:t[0],y:t[1]}}};"bd09mc"!==this.options.coordType&&(t=this.dataSet.get(),t=this.dataSet.transferCoordinate(t,function(t){t=n.lngLatToPoint({lng:t[0],lat:t[1]});return[t.x,t.y]},"coordinates","coordinates_mercator"),this.dataSet._set(t))}},{key:"_canvasUpdate",value:function(){var e,t,n,i,o,a=this.ctx;a&&((e=this.map).getMapType().getProjection?t=(o=e.getMapType().getProjection()).lngLatToPoint(e.getCenter()):(-180<(t={x:e.getCenter().lng,y:e.getCenter().lat}).x&&t.x<180&&(t={x:(t=e.lnglatToMercator(t.x,t.y))[0],y:t[1]}),o={lngLatToPoint:function(t){t=e.lnglatToMercator(t.lng,t.lat);return{x:t[0],y:t[1]}}}),n=o.getZoomUnits?o.getZoomUnits(e.getZoom()):Math.pow(2,18-e.getZoom()),i=new ie.Pixel(t.x-e.getSize().width/2*n,t.y+e.getSize().height/2*n),x(a),o={fromColumn:"bd09mc"==this.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){if(t)return[(t[0]-i.x)/n,(i.y-t[1])/n]}},this.data=this.dataSet.get(o),this.processData(this.data),this.drawAnimation())}},{key:"drawAnimation",value:function(){var t=this.ctx,e=this.data;if(e){t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore(),t.save(),this.options.shadowColor&&(t.shadowColor=this.options.shadowColor),this.options.shadowBlur&&(t.shadowBlur=this.options.shadowBlur),this.options.globalAlpha&&(t.globalAlpha=this.options.globalAlpha),this.options.globalCompositeOperation&&(t.globalCompositeOperation=this.options.globalCompositeOperation);for(var n,i,o,a,s=this.options,r=!1,h=0;h<e.length;h++)"Point"===e[h].geometry.type?(t.beginPath(),a=e[h].size||this.options.size,i=e[h].minSize||this.options.minSize||0,void 0===e[h]._size&&(e[h]._size=i),t.arc(e[h].geometry._coordinates[0],e[h].geometry._coordinates[1],e[h]._size,0,2*Math.PI,!0),t.closePath(),e[h]._size++,e[h]._size>a&&(e[h]._size=i),t.lineWidth=1,t.strokeStyle=e[h].strokeStyle||e[h]._strokeStyle||s.strokeStyle||"yellow",t.stroke(),(a=e[h].fillStyle||e[h]._fillStyle||s.fillStyle)&&(t.fillStyle=a,t.fill())):"LineString"===e[h].geometry.type&&(t.beginPath(),n=e[h].size||this.options.size||5,i=e[h].minSize||this.options.minSize||0,void 0===e[h]._index&&(e[h]._index=0),o=e[h]._index,t.arc(e[h].geometry._coordinates[o][0],e[h].geometry._coordinates[o][1],n,0,2*Math.PI,!0),t.closePath(),e[h]._index=e[h]._index+(e[h]._step||1),o=e[h].strokeStyle||s.strokeStyle,a=e[h].fillStyle||s.fillStyle||"yellow",t.fillStyle=a,t.fill(),o&&s.lineWidth&&(t.lineWidth=s.lineWidth||1,t.strokeStyle=o,t.stroke()),e[h]._index>=e[h].geometry._coordinates.length&&(s.isRound?(e[h]._step=-1,e[h]._index=e[h].geometry._coordinates.length-1):(e[h]._index=0,r||this.animateLoopFrequency++,r=!0)),e[h]._index<0)&&s.isRound&&(e[h]._step=1,e[h]._index=0,r||this.animateLoopFrequency++,r=!0);t.restore()}}},{key:"animate",value:function(){var t=this,e=this.animateLoopFrequency,n=(this.drawAnimation(),this.options.animateTime||100),i=this.options.stayTime;i&&this.animateLoopFrequency!=e?(this.hide(),this.timeout=setTimeout(function(){t.canvasLayer.show(),t.animate()},i)):this.timeout=setTimeout(this.animate.bind(this),n);void 0!==this.options.times&&this.animateLoopFrequency>=this.options.times&&(this.stop(),setTimeout(this.hide.bind(this),n))}},{key:"start",value:function(){this.stop(),this.animate()}},{key:"stop",value:function(){clearTimeout(this.timeout)}},{key:"unbindEvent",value:function(){}},{key:"hide",value:function(){this.canvasLayer.hide(),this.stop()}},{key:"show",value:function(){this.start()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"destroy",value:function(){this.stop(),this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),y);function y(t,e,n){r(this,y);var i=h(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,t,e,n)),o=(i.map=t,i.options=n||{},i.dataSet=e,new u({map:t,zIndex:i.options.zIndex,update:i._canvasUpdate.bind(i)})),a=(i.animateLoopFrequency=0,i.init(i.options),i.canvasLayer=o,i.transferToMercator(),i);return e.on("change",function(){a.transferToMercator(),o.draw()}),i.ctx=o.canvas.getContext("2d"),i.start(),i}var oe="undefined"==typeof window?{}:window,ae=oe.BMap||oe.BMapGL,oe=(i(_,v),e(_,[{key:"clickEvent",value:function(t){var e=t.pixel;o(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"clickEvent",this).call(this,e,t)}},{key:"mousemoveEvent",value:function(t){var e=t.pixel;o(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"tapEvent",value:function(t){var e=t.pixel;o(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"tapEvent",this).call(this,e,t)}},{key:"doubleClickEvent",value:function(t){var e=t.pixel;o(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"doubleClickEvent",this).call(this,e,t)}},{key:"bindEvent",value:function(t){this.unbindEvent();var e=this.map,n=0,i=this;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addEventListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addEventListener("mousemove",this.mousemoveEvent),this.options.methods.hover&&(e.addEventListener("mouseover",this.mousemoveEvent),e.addEventListener("mouseout",this.mousemoveEvent)),this.options.methods.doubleClick&&e.addEventListener("dblclick",this.doubleClickEvent),"ontouchend"in window.document)&&this.options.methods.tap&&(e.addEventListener("touchstart",function(t){n=new Date}),e.addEventListener("touchend",function(t){new Date-n<300&&i.tapEvent(t)}))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeEventListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeEventListener("mousemove",this.mousemoveEvent),this.options.methods.hover&&(e.removeEventListener("mouseover",this.mousemoveEvent),e.removeEventListener("mouseout",this.mousemoveEvent)),this.options.methods.doubleClick)&&e.removeEventListener("dblclick",this.doubleClickEvent)}},{key:"transferToMercator",value:function(t){t=t||this.dataSet;var e=this.map,n=e.getMapType(),i=n.getProjection?n.getProjection():{lngLatToPoint:function(t){t=e.lnglatToMercator(t.lng,t.lat);return{x:t[0],y:t[1]}}};"bd09mc"!==this.options.coordType&&(n=t.get(),n=t.transferCoordinate(n,function(t){return t[0]<-180||180<t[0]||t[1]<-90||90<t[1]?t:[(t=i.lngLatToPoint({lng:t[0],lat:t[1]})).x,t.y]},"coordinates","coordinates_mercator"),t._set(n))}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(n){if(this.canvasLayer){var e,t=this,i=this.options.animation,o=this.canvasLayer._map,a=(o.getMapType().getProjection?u=(l=o.getMapType().getProjection()).lngLatToPoint(o.getCenter()):(-180<(u={x:o.getCenter().lng,y:o.getCenter().lat}).x&&u.x<180&&(u={x:(u=o.lnglatToMercator(u.x,u.y))[0],y:u[1]}),l={lngLatToPoint:function(t){t=o.lnglatToMercator(t.lng,t.lat);return{x:t[0],y:t[1]}}}),e=l.getZoomUnits?l.getZoomUnits(o.getZoom()):Math.pow(2,18-o.getZoom()),new ae.Pixel(u.x-o.getSize().width/2*e,u.y+o.getSize().height/2*e)),s=this.getContext();if(this.isEnabledTime()){if(void 0===n)return void x(s);"2d"==this.context&&(s.save(),s.globalCompositeOperation="destination-out",s.fillStyle="rgba(0, 0, 0, .1)",s.fillRect(0,0,s.canvas.width,s.canvas.height),s.restore())}else x(s);if("2d"==this.context)for(var r in this.options)s[r]=this.options[r];else s.clear(s.COLOR_BUFFER_BIT);if(!(this.options.minZoom&&o.getZoom()<this.options.minZoom||this.options.maxZoom&&o.getZoom()>this.options.maxZoom)){var h=1,l=("2d"!=this.context&&(h=this.canvasLayer.devicePixelRatio),{fromColumn:"bd09mc"==this.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){return[(t[0]-a.x)/e*h,(a.y-t[1])/e*h]}}),u=(void 0!==n&&(l.filter=function(t){var e=i.trails||10;return!!(n&&t.time>n-e&&t.time<n)}),this.getZoom());if("cluster"===this.options.draw&&(!this.options.maxClusterZoom||this.options.maxClusterZoom>=u)){var c=this.map.getBounds(),p=c.getNorthEast(),c=c.getSouthWest(),d=this.supercluster.getClusters([c.lng,c.lat,p.lng,p.lat],u),g=(this.pointCountMax=this.supercluster.trees[u].max,this.pointCountMin=this.supercluster.trees[u].min,{}),v=null,f=null;this.pointCountMax===this.pointCountMin?(v=this.options.fillStyle,f=this.options.minSize||8):g=new M({min:this.pointCountMin,max:this.pointCountMax,minSize:this.options.minSize||8,maxSize:this.options.maxSize||30,gradient:this.options.gradient});for(var y=0;y<d.length;y++){var m=d[y];m.properties&&m.properties.cluster_id?(d[y].size=f||g.getSize(m.properties.point_count),d[y].fillStyle=v||g.getColor(m.properties.point_count)):d[y].size=t.options.size}this.clusterDataSet.set(d),this.transferToMercator(this.clusterDataSet),c=t.clusterDataSet.get(l)}else c=t.dataSet.get(l);this.processData(c);p=o.pointToPixel(new ae.Point(0,0));"m"==t.options.unit?(t.options.size&&(t.options._size=t.options.size/e),t.options.width&&(t.options._width=t.options.width/e),t.options.height&&(t.options._height=t.options.height/e)):(t.options._size=t.options.size,t.options._height=t.options.height,t.options._width=t.options.width),this.drawContext(s,c,t.options,p),t.options.updateCallback&&t.options.updateCallback(n)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),e.options.max&&this.intensity.setMax(e.options.max),e.options.min&&this.intensity.setMin(e.options.min),this.initAnimator(),this.bindEvent()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"addAnimatorEvent",value:function(){this.map.addEventListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addEventListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer),this.bindEvent()}},{key:"hide",value:function(){this.unbindEvent(),this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer&&this.canvasLayer.draw()}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"updateData",value:function(t){t instanceof DataSet?this.dataSet=t:Array.isArray(t)&&this.dataSet.set(t),"cluster"===this.options.draw&&this.refreshCluster(this.options),this.initDataRange(this.options),this.draw()}},{key:"addData",value:function(t){this.dataSet.add(t),"cluster"===this.options.draw&&this.refreshCluster(this.options),this.initDataRange(this.options),this.draw()}},{key:"getDataInBounds",value:function(){var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest(),t=[n.lng,n.lat,e.lng,e.lat],i=this.getZoom();return"cluster"===this.options.draw&&(!this.options.maxClusterZoom||this.options.maxClusterZoom>=i)?this.supercluster.getClusters(t,i):this.dataSet.get().filter(function(t){return!(!t.geometry||!t.geometry.coordinates)&&(t=t.geometry.coordinates)[0]>=n.lng&&t[0]<=e.lng&&t[1]>=n.lat&&t[1]<=e.lat})}},{key:"setOpacity",value:function(t){this.canvasLayer&&this.canvasLayer.canvas&&(this.canvasLayer.canvas.style.opacity=t)}},{key:"getOpacity",value:function(){return this.canvasLayer&&this.canvasLayer.canvas&&parseFloat(this.canvasLayer.canvas.style.opacity)||1}},{key:"toggle",value:function(){var t;this.canvasLayer&&this.canvasLayer.canvas&&((t=this.canvasLayer.canvas).style.display="none"===t.style.display?"block":"none")}},{key:"getLayerInfo",value:function(){return{zoom:this.getZoom(),visible:!this.canvasLayer||!this.canvasLayer.canvas||"none"!==this.canvasLayer.canvas.style.display,opacity:this.getOpacity(),dataCount:this.dataSet?this.dataSet.getTotal():0,drawType:this.options.draw}}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.map.removeOverlay(this.canvasLayer),this.canvasLayer=null}}]),_);function _(t,e,n){r(this,_);var i=h(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,t,e,n)),o=i,a=(n=n||{},i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),i.tapEvent=i.tapEvent.bind(i),i.doubleClickEvent=i.doubleClickEvent.bind(i),o.init(n),o.argCheck(n),o.transferToMercator(),i.canvasLayer=new u({map:t,context:i.context,updateImmediate:n.updateImmediate,paneName:n.paneName,mixBlendMode:n.mixBlendMode,enableMassClear:n.enableMassClear,zIndex:n.zIndex,update:function(){o._canvasUpdate()}}));return e.on("change",function(){o.transferToMercator(),"cluster"===n.draw&&o.refreshCluster(),a.draw()}),i}function b(t){this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=b.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var e=document.createElement("canvas");function n(t,e){return function(){e.apply(t)}}e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.pointerEvents="none",this.canvas=e,this.canvasCssWidth_=300,this.canvasCssHeight_=150,this.resolutionScale_=1,this.repositionFunction_=n(this,this.repositionCanvas_),this.resizeFunction_=n(this,this.resize_),this.requestUpdateFunction_=n(this,this.update_),t&&this.setOptions(t)}var k="undefined"==typeof window?{}:window,se=(k.google&&k.google.maps&&(b.prototype=new google.maps.OverlayView,b.DEFAULT_PANE_NAME_="overlayLayer",b.CSS_TRANSFORM_=(()=>{for(var t=document.createElement("div"),e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],n=0;n<e.length;n++){var i=e[n];if(void 0!==t.style[i])return i}return e[0]})(),b.prototype.requestAnimFrame_=k.requestAnimationFrame||k.webkitRequestAnimationFrame||k.mozRequestAnimationFrame||k.oRequestAnimationFrame||k.msRequestAnimationFrame||function(t){return k.setTimeout(t,1e3/60)},b.prototype.cancelAnimFrame_=k.cancelAnimationFrame||k.webkitCancelAnimationFrame||k.mozCancelAnimationFrame||k.oCancelAnimationFrame||k.msCancelAnimationFrame||function(t){},b.prototype.setOptions=function(t){void 0!==t.animate&&this.setAnimate(t.animate),void 0!==t.paneName&&this.setPaneName(t.paneName),void 0!==t.updateHandler&&this.setUpdateHandler(t.updateHandler),void 0!==t.resizeHandler&&this.setResizeHandler(t.resizeHandler),void 0!==t.resolutionScale&&this.setResolutionScale(t.resolutionScale),void 0!==t.map&&this.setMap(t.map)},b.prototype.setAnimate=function(t){this.isAnimated_=!!t,this.isAnimated_&&this.scheduleUpdate()},b.prototype.isAnimated=function(){return this.isAnimated_},b.prototype.setPaneName=function(t){this.paneName_=t,this.setPane_()},b.prototype.getPaneName=function(){return this.paneName_},b.prototype.setPane_=function(){if(this.isAdded_){var t=this.getPanes();if(!t[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');t[this.paneName_].appendChild(this.canvas)}},b.prototype.setResizeHandler=function(t){this.resizeHandler_=t},b.prototype.setResolutionScale=function(t){"number"==typeof t&&(this.resolutionScale_=t,this.resize_())},b.prototype.setUpdateHandler=function(t){this.updateHandler_=t},b.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},b.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_)&&(this.cancelAnimFrame_.call(k,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null)},b.prototype.resize_=function(){var t,e,n,i,o,a;this.isAdded_&&(t=(e=this.getMap()).getDiv().offsetWidth,e=e.getDiv().offsetHeight,n=t*this.resolutionScale_,i=e*this.resolutionScale_,o=this.canvas.width,a=this.canvas.height,o===n&&a===i||(this.canvas.width=n,this.canvas.height=i,this.needsResize_=!0,this.scheduleUpdate()),this.canvasCssWidth_===t&&this.canvasCssHeight_===e||(this.canvasCssWidth_=t,this.canvasCssHeight_=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"))},b.prototype.draw=function(){this.repositionCanvas_()},b.prototype.repositionCanvas_=function(){var t=this.getMap(),e=t.getBounds().getNorthEast().lat(),n=t.getCenter(),t=Math.pow(2,t.getZoom()),t=n.lng()-180*this.canvasCssWidth_/(256*t);this.topLeft_=new google.maps.LatLng(e,t);e=this.getProjection().fromLatLngToDivPixel(n),t=-Math.round(this.canvasCssWidth_/2-e.x),n=-Math.round(this.canvasCssHeight_/2-e.y);this.canvas.style[b.CSS_TRANSFORM_]="translate("+t+"px,"+n+"px)",this.scheduleUpdate()},b.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_)&&this.updateHandler_()},b.prototype.getTopLeft=function(){return this.topLeft_},b.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(k,this.requestUpdateFunction_))}),i(S,v),e(S,[{key:"clickEvent",value:function(t){var e=t.pixel;o(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"clickEvent",this).call(this,e,t)}},{key:"mousemoveEvent",value:function(t){var e=t.pixel;o(S.prototype.__proto__||Object.getPrototypeOf(S.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"bindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addListener("click",this.clickEvent)),this.options.methods.mousemove)&&e.addListener("mousemove",this.mousemoveEvent)}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeListener("click",this.clickEvent),this.options.methods.mousemove)&&e.removeListener("mousemove",this.mousemoveEvent)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(n){if(this.canvasLayer){var e,i,o,t,a,s=this,r=s.options.animation,h=this.getContext();if(s.isEnabledTime()){if(void 0===n)return void x(h);"2d"==this.context&&(h.save(),h.globalCompositeOperation="destination-out",h.fillStyle="rgba(0, 0, 0, .1)",h.fillRect(0,0,h.canvas.width,h.canvas.height),h.restore())}else x(h);if("2d"==this.context)for(var l in s.options)h[l]=s.options[l];else h.clear(h.COLOR_BUFFER_BIT);s.options.minZoom&&t.getZoom()<s.options.minZoom||s.options.maxZoom&&t.getZoom()>s.options.maxZoom||(i=1,"2d"!=this.context&&(i=this.canvasLayer.devicePixelRatio),t=this.map,e=t.getProjection(),i=Math.pow(2,t.zoom)*resolutionScale,o=e.fromLatLngToPoint(this.canvasLayer.getTopLeft()),t={transferCoordinate:function(t){t=new google.maps.LatLng(t[1],t[0]),t=e.fromLatLngToPoint(t);return[(t.x-o.x)*i,(t.y-o.y)*i]}},void 0!==n&&(t.filter=function(t){var e=r.trails||10;return!!(n&&t.time>n-e&&t.time<n)}),t=s.dataSet.get(t),this.processData(t),a=new google.maps.LatLng(0,0),a={x:((a=e.fromLatLngToPoint(a)).x-o.x)*i,y:(a.y-o.y)*i},"m"==s.options.unit&&s.options.size?s.options._size=s.options.size/zoomUnit:s.options._size=s.options.size,this.drawContext(h,new E(t),s.options,a),s.options.updateCallback&&s.options.updateCallback(n))}}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){self.canvasLayer.draw()}}]),S);function S(t,e,n){r(this,S);var e=h(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,t,e,n)),i=e,n=(i.init(n=n||{}),i.argCheck(n),{map:t,animate:!1,updateHandler:function(){i._canvasUpdate()},resolutionScale:resolutionScale});e.canvasLayer=new b(n);return e.clickEvent=e.clickEvent.bind(e),e.mousemoveEvent=e.mousemoveEvent.bind(e),e.bindEvent(),e}var re=void 0;function A(){return r(this,A),h(this,(A.__proto__||Object.getPrototypeOf(A)).apply(this,arguments))}function I(t,e,n){r(this,I);t=h(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,t,n));return t.options_=n,t.dataSet=e,t._initBaseLayer(n),t}"undefined"!=typeof maptalks&&(i(I,maptalks.Layer),e(I,[{key:"_initBaseLayer",value:function(t){var e=this.baseLayer=new v(null,this.dataSet,t);this.init(t),e.argCheck(t)}},{key:"clickEvent",value:function(t){var e;this.baseLayer&&(e=t.containerPoint,this.baseLayer.clickEvent(e,t.domEvent))}},{key:"mousemoveEvent",value:function(t){var e;this.baseLayer&&(e=t.containerPoint,this.baseLayer.mousemoveEvent(e,t.domEvent))}},{key:"getEvents",value:function(){return{click:this.clickEvent,mousemove:this.mousemoveEvent}}},{key:"init",value:function(t){var e=this.baseLayer;e.options=t,e.initDataRange(t),e.context=e.options.context||"2d",e.initAnimator()}},{key:"addAnimatorEvent",value:function(){this.map.addListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addListener("moveend",this.animatorMoveendEvent.bind(this))}}]),re=I,he=maptalks.renderer.CanvasRenderer,i(A,he),e(A,[{key:"needToRedraw",value:function(){return!!this.layer.baseLayer.isEnabledTime()||o(A.prototype.__proto__||Object.getPrototypeOf(A.prototype),"needToRedraw",this).call(this)}},{key:"draw",value:function(){var t=this.layer.baseLayer;this.canvas&&t.isEnabledTime()&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this._update(this.gl||this.context,this._mapvFrameTime),delete this._mapvFrameTime,this.completeRender()}},{key:"drawOnInteracting",value:function(){this.draw(),this._shouldClear=!1}},{key:"onSkipDrawOnInteracting",value:function(){this._shouldClear=!0}},{key:"_canvasUpdate",value:function(t){this.setToRedraw(),this._mapvFrameTime=t}},{key:"_update",value:function(t,n){if(this.canvas){var e=this.layer.baseLayer,i=e.options.animation,o=this.getMap();if(e.isEnabledTime()){if(void 0===n)return void x(t);"2d"==e.context&&(t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore())}else x(t);if("2d"==e.context)for(var a in e.options)t[a]=e.options[a];else t.clear(t.COLOR_BUFFER_BIT);var s=new maptalks.Coordinate(0,0),r={fromColumn:"bd09mc"===e.options.coordType?"coordinates_mercator":"coordinates",transferCoordinate:function(t){return s.x=t[0],s.y=t[1],o.coordToContainerPoint(s)._multi(1).toArray()}},r=(void 0!==n&&(r.filter=function(t){var e=i.trails||10;return!!(n&&t.time>n-e&&t.time<n)}),e.dataSet.get(r)),h=(e.processData(r),"m"==e.options.unit?(e.options.size&&(e.options._size=e.options.size/zoomUnit),e.options.width&&(e.options._width=e.options.width/zoomUnit),e.options.height&&(e.options._height=e.options.height/zoomUnit)):(e.options._size=e.options.size,e.options._height=e.options.height,e.options._width=e.options.width),new maptalks.Point(0,0)),h=o._pointToContainerPoint(h)._multi(1);e.drawContext(t,r,e.options,h),e.options.updateCallback&&e.options.updateCallback(n)}}},{key:"createCanvas",value:function(){var t,e,n,i;this.canvas||(e=(t=this.getMap()).getSize(),i=(n=t.getDevicePixelRatio?t.getDevicePixelRatio():maptalks.Browser.retina?2:1)*e.width,this.canvas=maptalks.Canvas.createCanvas(i,n*e.height,t.CanvasClass),"2d"===this.layer.baseLayer.context?(this.context=this.canvas.getContext("2d"),this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation),"heatmap"!==this.layer.baseLayer.options.draw&&1!==n&&this.context.scale(n,n)):this.gl=this.canvas.getContext("webgl",{alpha:!0,preserveDrawingBuffer:!0,antialias:!1}),this.onCanvasCreate(),this._bindToMapv(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl}))}},{key:"_bindToMapv",value:function(){var t=this.layer.baseLayer,e=this.getMap();this.devicePixelRatio=e.getDevicePixelRatio?e.getDevicePixelRatio():maptalks.Browser.retina?2:1,t.canvasLayer=this,t._canvasUpdate=this._canvasUpdate.bind(this),t.getContext=function(){var t=self.getRenderer();return t.gl||t.context}}}]),re.registerRenderer("canvas",A));var he=re,re=(i(R,v),e(R,[{key:"init",value:function(t,e){if(!t)throw new Error("not map object");this.map=t,this.context=this.options.context||"2d",this.getCanvasLayer()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,n){if(t){var e=this.map,i=t.getContext(this.context),o=this.options.animation;if(this.isEnabledTime()){if(void 0===n)return x(i),this;"2d"===this.context&&(i.save(),i.globalCompositeOperation="destination-out",i.fillStyle="rgba(0, 0, 0, .1)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore())}else x(i);if("2d"===this.context)for(var a in this.options)i[a]=this.options[a];else i.clear(i.COLOR_BUFFER_BIT);t={transferCoordinate:function(t){t=e.lngLatToContainer(new AMap.LngLat(t[0],t[1]));return[t.x,t.y]}},t=(void 0!==n&&(t.filter=function(t){var e=o.trails||10;return!!(n&&t.time>n-e&&t.time<n)}),this.dataSet.get(t));return this.processData(t),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(i,new E(t),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(n),this}}},{key:"getCanvasLayer",value:function(){var t,e;this.canvasLayer.canvas||this.layer_||(t=this.canvasFunction(),e=this.map.getBounds(),this.layer_=new AMap.CanvasLayer({canvas:t,bounds:this.options.bounds||e,zooms:this.options.zooms||[0,22]}),this.layer_.setMap(this.map),this.map.on("mapmove",this.canvasFunction,this),this.map.on("zoomchange",this.canvasFunction,this))}},{key:"canvasFunction",value:function(){var t,e,n=[this.map.getSize().width,this.map.getSize().height],i=n[0],n=n[1];return this.canvasLayer.canvas?(this.canvasLayer.canvas.width=i,this.canvasLayer.canvas.height=n,t=this.map.getBounds(),this.layer_&&this.layer_.setBounds(this.options.bounds||t)):this.canvasLayer.canvas=(t=i,i=n,"undefined"!=typeof document?((n=document.createElement("canvas")).width=t,n.height=i,n):new e(t,i)),this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"removeLayer",value:function(){this.map&&(this.unEvents(),this.map.removeLayer(this.layer_),delete this.map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var e=t.pixel;o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"clickEvent",this).call(this,e,t)}},{key:"mousemoveEvent",value:function(t){var e=t.pixel;o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"addAnimatorEvent",value:function(){this.map.on("movestart",this.animatorMovestartEvent,this),this.map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove)&&t.on("mousemove",this.mousemoveEvent,this)}},{key:"unEvents",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent,this),this.options.methods.mousemove)&&t.off("mousemove",this.mousemoveEvent,this)}}]),R);function R(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=arguments[1],n=arguments[2],e=(r(this,R),h(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,t,e,n)));return e.options=n,e.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},e.layer_=null,e.initDataRange(n),e.initAnimator(),e.onEvents(),t.on("complete",function(){this.init(t,n),this.argCheck(n)},e),e}i(D,v),e(D,[{key:"init",value:function(t,e){if(!(t&&t instanceof ol.Map))throw new Error("not map object");this.$Map=t,this.context=this.options.context||"2d",this.getCanvasLayer(),this.initDataRange(e),this.initAnimator(),this.onEvents()}},{key:"_canvasUpdate",value:function(t){this.render(this.canvasLayer.canvas,t)}},{key:"render",value:function(t,n){var e=this.$Map,i=t.getContext(this.context),o=this.options.animation,a=this.options.hasOwnProperty("projection")?this.options.projection:"EPSG:4326",s=this.$Map.getView().getProjection().getCode();if(this.isEnabledTime()){if(void 0===n)return x(i),this;"2d"===this.context&&(i.save(),i.globalCompositeOperation="destination-out",i.fillStyle="rgba(0, 0, 0, .1)",i.fillRect(0,0,i.canvas.width,i.canvas.height),i.restore())}else x(i);if("2d"===this.context)for(var r in this.options)i[r]=this.options[r];else i.clear(i.COLOR_BUFFER_BIT);t={},t.transferCoordinate=a===s?function(t){return e.getPixelFromCoordinate(t)}:function(t){return e.getPixelFromCoordinate(ol.proj.transform(t,a,s))},void 0!==n&&(t.filter=function(t){var e=o.trails||10;return!!(n&&t.time>n-e&&t.time<n)}),t=this.dataSet.get(t);return this.processData(t),"m"===this.options.unit?(this.options.size&&(this.options._size=this.options.size/zoomUnit),this.options.width&&(this.options._width=this.options.width/zoomUnit),this.options.height&&(this.options._height=this.options.height/zoomUnit)):(this.options._size=this.options.size,this.options._height=this.options.height,this.options._width=this.options.width),this.drawContext(i,new E(t),this.options,{x:0,y:0}),this.options.updateCallback&&this.options.updateCallback(n),this}},{key:"getCanvasLayer",value:function(){var t;this.canvasLayer.canvas||this.layer_||(t=this.getMapExtent(),this.layer_=new ol.layer.Image({layerName:this.options.layerName,minResolution:this.options.minResolution,maxResolution:this.options.maxResolution,zIndex:this.options.zIndex,extent:t,source:new ol.source.ImageCanvas({canvasFunction:this.canvasFunction.bind(this),projection:this.$Map.getView().getProjection().getCode(),ratio:this.options.hasOwnProperty("ratio")?this.options.ratio:1})}),this.$Map.addLayer(this.layer_),this.$Map.un("precompose",this.reRender,this),this.$Map.on("precompose",this.reRender,this))}},{key:"reRender",value:function(){var t;this.layer_&&(t=this.getMapExtent(),this.layer_.setExtent(t))}},{key:"canvasFunction",value:function(t,e,n,i,o){return this.canvasLayer.canvas?(this.canvasLayer.canvas.width=i[0],this.canvasLayer.canvas.height=i[1]):this.canvasLayer.canvas=((t,e)=>{var n;if("undefined"!=typeof document)return(n=document.createElement("canvas")).width=t,n.height=e,n})(i[0],i[1]),this.render(this.canvasLayer.canvas),this.canvasLayer.canvas}},{key:"getMapExtent",value:function(){var t=this.$Map.getSize();return this.$Map.getView().calculateExtent(t)}},{key:"addTo",value:function(t){this.init(t,this.options)}},{key:"removeLayer",value:function(){this.$Map&&(this.unEvents(),this.$Map.un("precompose",this.reRender,this),this.$Map.removeLayer(this.layer_),delete this.$Map,delete this.layer_,delete this.canvasLayer.canvas)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"clickEvent",value:function(t){var e=t.pixel;o(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"clickEvent",this).call(this,{x:e[0],y:e[1]},t)}},{key:"mousemoveEvent",value:function(t){var e=t.pixel;o(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"mousemoveEvent",this).call(this,{x:e[0],y:e[1]},t)}},{key:"addAnimatorEvent",value:function(){this.$Map.on("movestart",this.animatorMovestartEvent,this),this.$Map.on("moveend",this.animatorMoveendEvent,this)}},{key:"onEvents",value:function(){var t=this.$Map;this.unEvents(),this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent,this),this.options.methods.mousemove)&&t.on("pointermove",this.mousemoveEvent,this)}},{key:"unEvents",value:function(){var t=this.$Map;this.options.methods&&(this.options.methods.click&&t.un("click",this.clickEvent,this),this.options.methods.pointermove)&&t.un("pointermove",this.mousemoveEvent,this)}},{key:"setDefaultCursor",value:function(t,e){var n;this.$Map&&(n=this.$Map.getTargetElement(),e?n.style.cursor!==t&&(this.previousCursor_=n.style.cursor,n.style.cursor=t):void 0!==this.previousCursor_&&(n.style.cursor=this.previousCursor_,this.previousCursor_=void 0))}},{key:"show",value:function(){this.$Map.addLayer(this.layer_)}},{key:"hide",value:function(){this.$Map.removeLayer(this.layer_)}}]);var le=D;function D(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=arguments[1],n=arguments[2],e=(r(this,D),h(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,t,e,n)));return e.options=n,e.canvasLayer={canvas:null,devicePixelRatio:window.devicePixelRatio},e.layer_=null,e.previousCursor_=void 0,e.init(t,n),e.argCheck(n),e}i(T,v),e(T,[{key:"clickEvent",value:function(t){var e=this.map.containerPointToLayerPoint([0,0]),n=this.devicePixelRatio=this.canvasLayer.devicePixelRatio=window.devicePixelRatio,i=t.layerPoint;o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"clickEvent",this).call(this,L.point((i.x-e.x)/n,(i.y-e.y)/n),t)}},{key:"mousemoveEvent",value:function(t){var e=t.layerPoint;o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"bindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.on("click",this.clickEvent),this.options.methods.mousemove)&&t.on("mousemove",this.mousemoveEvent),this.map.on("movestart",this._moveStartEvent),this.map.on("moveend",this._moveEndEvent),this.map.on("zoomstart",this._zoomStartEvent)}},{key:"destroy",value:function(){this.unbindEvent(),this.clearData(),this.animator&&this.animator.stop(),this.animator=null,this.canvasLayer=null}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove)&&t.off("mousemove",this.mousemoveEvent),this.map.off("movestart",this._moveStartEvent),this.map.off("moveend",this._moveEndEvent),this.map.off("zoomstart",this._zoomStartEvent)}},{key:"getContext",value:function(){return this.canvasLayer.getCanvas().getContext(this.context)}},{key:"addData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet.add(n),this.update({options:e})}},{key:"update",value:function(t){var e=(t=t||{}).data;null!=(e=e&&e.get?e.get():e)&&this.dataSet.set(e),o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"update",this).call(this,{options:t.options})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(e){var t;this.dataSet&&(t=this.dataSet.get({filter:function(t){return null==e||"function"!=typeof e||!e(t)}}),this.dataSet.set(t),this.update({options:null}))}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"_canvasUpdate",value:function(n){if(this.canvasLayer){var e,i,o,a,t,s,r,h=this,l=h.options.animation,u=this.getContext(),c=this.map;if(h.isEnabledTime()){if(void 0===n)return void this.clear(u);"2d"===this.context&&(u.save(),u.globalCompositeOperation="destination-out",u.fillStyle="rgba(0, 0, 0, .1)",u.fillRect(0,0,u.canvas.width,u.canvas.height),u.restore())}else this.clear(u);if("2d"===this.context)for(var p in h.options)u[p]=h.options[p];else u.clear(u.COLOR_BUFFER_BIT);h.options.minZoom&&c.getZoom()<h.options.minZoom||h.options.maxZoom&&c.getZoom()>h.options.maxZoom||(r=(t=c.getBounds()).getEast()-t.getWest(),t=t.getNorth()-t.getSouth(),s=c.getSize(),e=r/s.x,i=t/s.y,o=this.canvasLayer.getTopLeft(),a=c.latLngToContainerPoint(o),r={transferCoordinate:function(t){t="2d"===h.context?c.latLngToContainerPoint(L.latLng(t[1],t[0])):{x:(t[0]-o.lng)/e,y:(o.lat-t[1])/i};return[t.x-a.x,t.y-a.y]}},void 0!==n&&(r.filter=function(t){var e=l.trails||10;return n&&t.time>n-e&&t.time<n}),t=h.dataSet.get(r),this.processData(t),h.options._size=h.options.size,r={x:(s=c.latLngToContainerPoint(L.latLng(0,0))).x-a.x,y:s.y-a.y},this.drawContext(u,t,h.options,r),h.options.updateCallback&&h.options.updateCallback(n))}}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"addAnimatorEvent",value:function(){}},{key:"moveStartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this._hide())}},{key:"moveEndEvent",value:function(){this.canvasLayer.draw(),this._show()}},{key:"zoomStartEvent",value:function(){this._hide()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}},{key:"_hide",value:function(){this.canvasLayer.canvas.style.display="none"}},{key:"_show",value:function(){this.canvasLayer.canvas.style.display="block"}},{key:"draw",value:function(){this.canvasLayer.draw()}}]);var ue,ce=T;function T(t,e,n,i){r(this,T);t=h(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,t,n,i));return v?((n=t).init(i=i||{}),n.argCheck(i),t.canvasLayer=e,t.clickEvent=t.clickEvent.bind(t),t.mousemoveEvent=t.mousemoveEvent.bind(t),t._moveStartEvent=t.moveStartEvent.bind(t),t._moveEndEvent=t.moveEndEvent.bind(t),t._zoomStartEvent=t.zoomStartEvent.bind(t),t.bindEvent(),t):h(t)}"undefined"!=typeof L&&(ue=L.Layer.extend({options:{attributionPrefix:null,attribution:""},initialize:function(t,e,n){n=n||{},this.dataSet=t||{},this.mapVOptions=e||{},this.render=this.render.bind(this),L.Util.setOptions(this,n),this.options.attributionPrefix&&(this.options.attribution=this.options.attributionPrefix+this.options.attribution),this.canvas=this._createCanvas(),L.stamp(this)},onAdd:function(t){this._map=t;var e=this.getPane(),e=this.container=L.DomUtil.create("div","leaflet-layer leaflet-zoom-animated",e),n=(e.appendChild(this.canvas),t.getSize());e.style.width=n.x+"px",e.style.height=n.y+"px",this.renderer=new ce(t,this,this.dataSet,this.mapVOptions),this.draw(),this.fire("loaded")},onRemove:function(){L.DomUtil.remove(this.container),this.renderer.destroy()},addData:function(t,e){this.renderer.addData(t,e)},update:function(t){this.renderer.update(t)},getData:function(){return this.renderer&&(this.dataSet=this.renderer.getData()),this.dataSet},removeData:function(t){this.renderer&&this.renderer.removeData(t)},clearData:function(){this.renderer.clearData()},draw:function(){return this._reset()},setZIndex:function(t){this.canvas.style.zIndex=t},render:function(){this.renderer._canvasUpdate()},getCanvas:function(){return this.canvas},getContainer:function(){return this.container},getTopLeft:function(){var t,e=this._map;return t=e?e.getBounds().getNorthWest():t},_createCanvas:function(){var t=document.createElement("canvas"),e=(t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.options.zIndex||600,"undefined"==typeof window?{}:window),e=this.devicePixelRatio=e.devicePixelRatio;return this.mapVOptions.context&&"2d"!==this.mapVOptions.context||t.getContext("2d").scale(e,e),t},_resize:function(){var t,e,n=this.canvas;n&&(t=(e=this._map).getSize(),n.width=t.x,n.height=t.y,n.style.width=t.x+"px",n.style.height=t.y+"px",t=e.getBounds(),e=e.latLngToLayerPoint(t.getNorthWest()),L.DomUtil.setPosition(n,e))},_reset:function(){this._resize(),this._render()},redraw:function(){this._resize(),this._render()},_render:function(){this.render()}}),ge=function(t,e,n){return new ue(t,e,n)});i(B,v),e(B,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"clickEvent",value:function(t){var e=t.point;o(B.prototype.__proto__||Object.getPrototypeOf(B.prototype),"clickEvent",this).call(this,e,t)}},{key:"mousemoveEvent",value:function(t){var e=t.point;o(B.prototype.__proto__||Object.getPrototypeOf(B.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start)}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator}},{key:"bindEvent",value:function(){this.map,this.options.methods&&(this.options.methods.click,this.options.methods.mousemove)}},{key:"unbindEvent",value:function(){var t=this.map;this.options.methods&&(this.options.methods.click&&t.off("click",this.clickEvent),this.options.methods.mousemove)&&t.off("mousemove",this.mousemoveEvent)}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"init",value:function(t){this.options=t,this.initDataRange(t),this.context=this.options.context||"2d",this.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(this.options.zIndex),this.initAnimator()}},{key:"_canvasUpdate",value:function(n){this.map;var e=this.scene;if(this.canvasLayer&&!this.stopAniamation){var i=this.options.animation,t=this.getContext();if(this.isEnabledTime()){if(void 0===n)return void this.clear(t);"2d"===this.context&&(t.save(),t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, .1)",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore())}else this.clear(t);if("2d"===this.context)for(var o in this.options)t[o]=this.options[o];else t.clear(t.COLOR_BUFFER_BIT);var a={transferCoordinate:function(t){t=Cesium.Cartesian3.fromDegrees(t[0],t[1]),t=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,t);return null==t?[-1,-1]:[t.x,t.y]}},a=(void 0!==n&&(a.filter=function(t){var e=i.trails||10;return!!(n&&t.time>n-e&&t.time<n)}),this.dataSet.get(a)),s=(this.processData(a),"m"==this.options.unit&&this.options.size,this.options._size=this.options.size,Cesium.SceneTransforms.wgs84ToWindowCoordinates(e,Cesium.Cartesian3.fromDegrees(0,0)));this.drawContext(t,new E(a),this.options,s),this.options.updateCallback&&this.options.updateCallback(n)}}},{key:"updateData",value:function(t,e){null!=(t=t&&t.get?t.get():t)&&this.dataSet.set(t),o(B.prototype.__proto__||Object.getPrototypeOf(B.prototype),"update",this).call(this,{options:e})}},{key:"addData",value:function(t,e){var n=t;t&&t.get&&(n=t.get()),this.dataSet.add(n),this.update({options:e})}},{key:"getData",value:function(){return this.dataSet}},{key:"removeData",value:function(e){var t;this.dataSet&&(t=this.dataSet.get({filter:function(t){return null==e||"function"!=typeof e||!e(t)}}),this.dataSet.set(t),this.update({options:null}))}},{key:"clearData",value:function(){this.dataSet&&this.dataSet.clear(),this.update({options:null})}},{key:"draw",value:function(){this.canvasLayer.draw()}},{key:"clear",value:function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)}}]);var pe,de,ge,ve=B;function B(t,e,n,i){r(this,B);var o=h(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,t,e,n));return v?(o.map=t,o.scene=t.scene,o.dataSet=e,o.init(n=n||{}),o.argCheck(n),o.initDevicePixelRatio(),o.canvasLayer=i,o.stopAniamation=!1,o.animation=n.animation,o.clickEvent=o.clickEvent.bind(o),o.mousemoveEvent=o.mousemoveEvent.bind(o),o.bindEvent(),o):h(o)}function fe(t,e,n,i){r(this,fe),this.map=t,this.scene=t.scene,this.mapvBaseLayer=new ve(t,e,n,this),this.mapVOptions=n,this.initDevicePixelRatio(),this.canvas=this._createCanvas(),this.render=this.render.bind(this),i?this.container=i:(e=t.container.querySelector(".cesium-viewer-cesiumWidgetContainer"),this.container=e||t.container),this.addInnerContainer(),this.bindEvent(),this._reset()}"undefined"!=typeof Cesium&&(pe=0,e(fe,[{key:"initDevicePixelRatio",value:function(){this.devicePixelRatio=window.devicePixelRatio||1}},{key:"addInnerContainer",value:function(){this.container.appendChild(this.canvas)}},{key:"bindEvent",value:function(){var e=this,t=(this.innerMoveStart=this.moveStartEvent.bind(this),this.innerMoveEnd=this.moveEndEvent.bind(this),this.scene.camera.moveStart.addEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.addEventListener(this.innerMoveEnd,this),new Cesium.ScreenSpaceEventHandler(this.scene.canvas));t.setInputAction(function(t){e.innerMoveEnd()},Cesium.ScreenSpaceEventType.LEFT_UP),t.setInputAction(function(t){e.innerMoveEnd()},Cesium.ScreenSpaceEventType.MIDDLE_UP),this.handler=t}},{key:"unbindEvent",value:function(){this.scene.camera.moveStart.removeEventListener(this.innerMoveStart,this),this.scene.camera.moveEnd.removeEventListener(this.innerMoveEnd,this),this.scene.postRender.removeEventListener(this._reset,this),this.handler&&(this.handler.destroy(),this.handler=null)}},{key:"moveStartEvent",value:function(){this.mapvBaseLayer&&(this.mapvBaseLayer.animatorMovestartEvent(),this.scene.postRender.addEventListener(this._reset,this))}},{key:"moveEndEvent",value:function(){this.mapvBaseLayer&&(this.scene.postRender.removeEventListener(this._reset,this),this.mapvBaseLayer.animatorMoveendEvent(),this._reset())}},{key:"zoomStartEvent",value:function(){this._unvisiable()}},{key:"zoomEndEvent",value:function(){this._unvisiable()}},{key:"addData",value:function(t,e){null!=this.mapvBaseLayer&&this.mapvBaseLayer.addData(t,e)}},{key:"updateData",value:function(t,e){null!=this.mapvBaseLayer&&this.mapvBaseLayer.updateData(t,e)}},{key:"getData",value:function(){return this.mapvBaseLayer&&(this.dataSet=this.mapvBaseLayer.getData()),this.dataSet}},{key:"removeData",value:function(t){null!=this.mapvBaseLayer&&this.mapvBaseLayer&&this.mapvBaseLayer.removeData(t)}},{key:"removeAllData",value:function(){null!=this.mapvBaseLayer&&this.mapvBaseLayer.clearData()}},{key:"_visiable",value:function(){return this.canvas.style.display="block",this}},{key:"_unvisiable",value:function(){return this.canvas.style.display="none",this}},{key:"_createCanvas",value:function(){var t=document.createElement("canvas"),e=(t.id=this.mapVOptions.layerid||"mapv"+pe++,t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=this.mapVOptions.zIndex||0,t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height,this.devicePixelRatio);return"2d"==this.mapVOptions.context&&t.getContext(this.mapVOptions.context).scale(e,e),t}},{key:"_reset",value:function(){this.resizeCanvas(),this.fixPosition(),this.onResize(),this.render()}},{key:"draw",value:function(){this._reset()}},{key:"show",value:function(){this._visiable()}},{key:"hide",value:function(){this._unvisiable()}},{key:"destroy",value:function(){this.remove()}},{key:"remove",value:function(){null!=this.mapvBaseLayer&&(this.removeAllData(),this.mapvBaseLayer.clear(this.mapvBaseLayer.getContext()),this.mapvBaseLayer=void 0,this.canvas.parentElement.removeChild(this.canvas))}},{key:"update",value:function(t){null!=t&&this.updateData(t.data,t.options)}},{key:"resizeCanvas",value:function(){var t;null!=this.canvas&&null!=this.canvas&&((t=this.canvas).style.position="absolute",t.style.top="0px",t.style.left="0px",t.width=parseInt(this.map.canvas.width),t.height=parseInt(this.map.canvas.height),t.style.width=this.map.canvas.style.width,t.style.height=this.map.canvas.style.height)}},{key:"fixPosition",value:function(){}},{key:"onResize",value:function(){}},{key:"render",value:function(){null!=this.mapvBaseLayer&&this.mapvBaseLayer._canvasUpdate()}}]),de=fe,ye=function(t,e,n,i){return new de(t,e,n,i)});var e=ye,ye={getDataSet:function(t){var e=[],n=t.features;if(n)for(var i=0;i<n.length;i++){var o,a=n[i],s=a.geometry,r=a.properties,h={};for(o in r)h[o]=r[o];h.geometry=s,e.push(h)}return new E(e)}},me={CSVToArray:function(t,e){e=e||",";for(var n=new RegExp("(\\"+e+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+e+"\\r\\n]*))","gi"),i=[[]],o=null;o=n.exec(t);){var a=o[1];a.length&&a!==e&&i.push([]),a=o[2]?o[2].replace(new RegExp('""',"g"),'"'):o[3],i[i.length-1].push(a)}return i},getDataSet:function(t,e){for(var n=this.CSVToArray(t,e||","),i=[],o=n[0],a=1;a<n.length-1;a++){for(var s=n[a],r={},h=0;h<s.length;h++){var l=s[h];"geometry"==o[h]&&(l=JSON.parse(l)),r[o[h]]=l}i.push(r)}return new E(i)}};t.version="2.0.62",t.canvasClear=x,t.canvasResolutionScale=function(t){var e=window.devicePixelRatio||1;t.canvas.width=t.canvas.width*e,t.canvas.height=t.canvas.height*e,t.canvas.style.width=t.canvas.width/e+"px",t.canvas.style.height=t.canvas.height/e+"px",t.scale(e,e)},t.canvasDrawSimple=W,t.canvasDrawHeatmap=G,t.canvasDrawGrid=J,t.canvasDrawHoneycomb=X,t.webglDrawSimple=St,t.webglDrawPoint=st,t.webglDrawLine=it,t.webglDrawPolygon=kt,t.utilCityCenter=U,t.utilCurve=Ct,t.utilForceEdgeBundling=function(){var c={},p=[],d=[],g=[],v=.1,f=.1,y=1,e=2,m=6,x=70,w=.6666667,o=.6,r=1e-8;function a(t){return{x:c[t.target].x-c[t.source].x,y:c[t.target].y-c[t.source].y}}function _(t){return Math.sqrt(Math.pow(c[t.source].x-c[t.target].x,2)+Math.pow(c[t.source].y-c[t.target].y,2))}function b(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function s(t,e){var n=Math.sqrt((e.target.x-e.source.x)*(e.target.x-e.source.x)+(e.target.y-e.source.y)*(e.target.y-e.source.y)),t=((e.source.y-t.y)*(e.source.y-e.target.y)-(e.source.x-t.x)*(e.target.x-e.source.x))/(n*n);return{x:e.source.x+t*(e.target.x-e.source.x),y:e.source.y+t*(e.target.y-e.source.y)}}function k(t,e){for(var n={x:0,y:0},i=d[t],o=0;o<i.length;o++){var a,s={x:g[i[o]][e].x-g[t][e].x,y:g[i[o]][e].y-g[t][e].y};(Math.abs(s.x)>r||Math.abs(s.y)>r)&&(a=1/Math.pow((a={source:g[i[o]][e],target:g[t][e]},Math.sqrt(Math.pow(a.source.x-a.target.x,2)+Math.pow(a.source.y-a.target.y,2))),1),n.x+=s.x*a,n.y+=s.y*a)}return n}function S(t,e,n){for(var i,o,a=v/(_(p[t])*(e+1)),s=[{x:0,y:0}],r=1;r<e+1;r++){var h={x:0,y:0},l=(i=r,o=l=o=void 0,o=g[u=t][i-1],l=g[u][i+1],u=g[u][i],i=o.x-u.x+l.x-u.x,o=o.y-u.y+l.y-u.y,{x:i*=a,y:o*=a}),u=k(t,r);h.x=n*(l.x+u.x),h.y=n*(l.y+u.y),s.push(h)}return s.push({x:0,y:0}),s}function C(t){for(var e,n=0;n<p.length;n++)if(1==t)g[n].push(c[p[n].source]),g[n].push((e=p[n],{x:(c[e.source].x+c[e.target].x)/2,y:(c[e.source].y+c[e.target].y)/2})),g[n].push(c[p[n].target]);else{var i=(t=>{for(var e=0,n=1;n<g[t].length;n++)e+=b(g[t][n],g[t][n-1]);return e})(n)/(t+1),o=i,a=[];a.push(c[p[n].source]);for(var s=1;s<g[n].length;s++){for(var r=b(g[n][s],g[n][s-1]);o<r;){var h=o/r,l=g[n][s-1].x,u=g[n][s-1].y;l+=h*(g[n][s].x-g[n][s-1].x),u+=h*(g[n][s].y-g[n][s-1].y),a.push({x:l,y:u}),r-=o,o=i}o-=r}a.push(c[p[n].target]),g[n]=a}}function h(t,e){var n=s(c[e.source],{source:c[t.source],target:c[t.target]}),e=s(c[e.target],{source:c[t.source],target:c[t.target]}),i={x:(n.x+e.x)/2,y:(n.y+e.y)/2},t={x:(c[t.source].x+c[t.target].x)/2,y:(c[t.source].y+c[t.target].y)/2};return Math.max(0,1-2*b(t,i)/b(n,e))}function l(t,e){var n,i,o;return n=e,Math.abs((i=a(t),o=a(n),(i.x*o.x+i.y*o.y)/(_(t)*_(n))))*(i=e,2/((n=(_(o=t)+_(i))/2)/Math.min(_(o),_(i))+Math.max(_(o),_(i))/n))*(o=e,(n=(_(i=t)+_(o))/2)/(n+b({x:(c[i.source].x+c[i.target].x)/2,y:(c[i.source].y+c[i.target].y)/2},{x:(c[o.source].x+c[o.target].x)/2,y:(c[o.source].y+c[o.target].y)/2})))*(n=t,i=e,Math.min(h(n,i),h(i,n)))}function L(){for(var t,e,n=0;n<p.length-1;n++)for(var i=n+1;i<p.length;i++)n!=i&&(t=p[n],e=p[i],l(t,e)>=o)&&(d[n].push(i),d[i].push(n))}function n(){for(var t=f,e=x,n=y,i=0;i<p.length;i++)1==y?g[i]=[]:(g[i]=[],g[i].push(c[p[i].source]),g[i].push(c[p[i].target]));for(var o=0;o<p.length;o++)d[o]=[];C(n),L();for(var a=0;a<m;a++){for(var s=0;s<e;s++){for(var r=[],h=0;h<p.length;h++)r[h]=S(h,n,t);for(var l=0;l<p.length;l++)for(var u=0;u<n+1;u++)g[l][u].x+=r[l][u].x,g[l][u].y+=r[l][u].y}t/=2,e*=w,C(n*=2)}return g}return n.nodes=function(t){return 0==arguments.length?c:(c=t,n)},n.edges=function(t){return 0==arguments.length?p:(p=(t=>{for(var e=[],n=0;n<t.length;n++)c[t[n].source].x!=c[t[n].target].x&&c[t[n].source].y!=c[t[n].target].y&&e.push(t[n]);return e})(t),n)},n.bundling_stiffness=function(t){return 0==arguments.length?v:(v=t,n)},n.step_size=function(t){return 0==arguments.length?f:(f=t,n)},n.cycles=function(t){return 0==arguments.length?m:(m=t,n)},n.iterations=function(t){return 0==arguments.length?x:(x=t,n)},n.iterations_rate=function(t){return 0==arguments.length?w:(w=t,n)},n.subdivision_points_seed=function(t){return 0==arguments.length?P:(P=t,n)},n.subdivision_rate=function(t){return 0==arguments.length?e:(e=t,n)},n.compatbility_threshold=function(t){return 0==arguments.length?compatbility_threshold:(o=t,n)},n},t.utilDataRangeIntensity=M,t.utilDataRangeCategory=a,t.utilDataRangeChoropleth=l,t.Map=Lt,t.baiduMapCanvasLayer=u,t.baiduMapAnimationLayer=zt,t.baiduMapLayer=oe,t.googleMapCanvasLayer=b,t.googleMapLayer=se,t.MaptalksLayer=he,t.AMapLayer=re,t.OpenlayersLayer=le,t.leafletMapLayer=ge,t.cesiumMapLayer=e,t.DataSet=E,t.geojson=ye,t.csv=me,Object.defineProperty(t,"__esModule",{value:!0})});